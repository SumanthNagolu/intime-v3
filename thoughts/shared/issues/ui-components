# **InTime v3 - Guidewire-Inspired PCF Architecture Specification**

## **Mapping Guidewire Hierarchy to React/Next.js**

| Guidewire Concept | InTime v3 Equivalent | Implementation |
|-------------------|---------------------|----------------|
| **Application** | Next.js App | `src/app/` |
| **Tabs** | Top Navigation (8 tabs) | `TopNavigation.tsx` |
| **Screens** | Pages | `page.tsx` files |
| **PanelSet** | Layout Component | `EntityLayout.tsx` |
| **DetailView** | Detail PCF Component | `<EntityDetailView>` |
| **ListView** | List PCF Component | `<EntityListView>` |
| **Wizard** | Intake Wizard PCF | `<EntityWizard>` |
| **Panels/Sections** | Section Components | Tab content / Sidebar sections |
| **Widgets** | UI Components | Input, Button, Select, etc. |

---

## **Complete PCF Component Architecture**

### **Level 1: Application Shell**
```
Application (layout.tsx)
├── TopNavigation (8 Tabs)
│   ├── My Work
│   ├── Accounts
│   ├── Contacts
│   ├── Jobs
│   ├── Candidates
│   ├── CRM
│   ├── Pipeline
│   └── Administration
```

### **Level 2: Tab → Screens**
Each Tab contains multiple **Screens** (pages):

```
Accounts Tab
├── AccountsListView (screen)      → /employee/recruiting/accounts
├── AccountDetailView (screen)     → /employee/recruiting/accounts/[id]
└── AccountOnboardingWizard        → /employee/recruiting/accounts/new

Jobs Tab
├── JobsListView (screen)          → /employee/recruiting/jobs
├── JobDetailView (screen)         → /employee/recruiting/jobs/[id]
└── JobIntakeWizard                → /employee/recruiting/jobs/intake

CRM Tab
├── CampaignsListView (screen)     → /employee/crm/campaigns
├── CampaignDetailView (screen)    → /employee/crm/campaigns/[id]
├── LeadsListView (screen)         → /employee/crm/leads
├── LeadDetailView (screen)        → /employee/crm/leads/[id]
├── DealsListView (screen)         → /employee/crm/deals
└── DealDetailView (screen)        → /employee/crm/deals/[id]
```

### **Level 3: Screen → PanelSets**
Each Screen contains **PanelSets** that organize content:

```
AccountDetailView.pcf (Screen)
├── PanelSet.AccountHeader
│   └── AccountInfoDV (header details)
├── PanelSet.AccountSections
│   ├── OverviewSection
│   ├── ContactsLV
│   ├── JobsLV
│   ├── ActivitiesLV
│   ├── NotesLV
│   └── DocumentsLV
└── PanelSet.QuickActions
    └── ActionToolbar
```

### **Level 4: Panel → Widgets**
Each Panel contains **Widgets** (form fields, buttons, tables):

```
AccountInfoDV (DetailView)
├── TextInput (Company Name)
├── SelectInput (Industry)
├── TextInput (Website)
├── SelectInput (Health Status)
├── DateInput (Created At)
└── ButtonGroup (Edit, Save, Cancel)
```

---

## **Core PCF Components to Build**

### **1. EntityListView.pcf** - List Screen Component

```typescript
// src/components/pcf/EntityListView.tsx

interface EntityListViewProps<T> {
  // Configuration
  config: ListViewConfig<T>;
  
  // Data
  items: T[];
  total: number;
  stats?: Record<string, number | string>;
  
  // State
  filters: FilterState;
  onFiltersChange: (filters: FilterState) => void;
  
  // Actions
  onItemClick: (item: T) => void;
  onPrimaryAction?: () => void;
  
  // Loading
  isLoading?: boolean;
}

interface ListViewConfig<T> {
  // Header
  title: string;
  description?: string;
  icon?: LucideIcon;
  
  // Primary Action
  primaryAction?: {
    label: string;
    icon?: LucideIcon;
    onClick?: () => void;
    href?: string;
  };
  
  // Stats Cards (PanelSet.Stats)
  statsCards?: Array<{
    key: string;
    label: string;
    icon?: LucideIcon;
    color?: string;
    format?: 'number' | 'currency' | 'percent';
  }>;
  
  // Filters (PanelSet.Filters)
  filters?: Array<{
    key: string;
    type: 'search' | 'select' | 'multi-select' | 'date-range';
    label: string;
    placeholder?: string;
    options?: Array<{ value: string; label: string }>;
  }>;
  
  // Table Columns (ListView columns)
  columns: Array<{
    key: string;
    header: string;
    sortable?: boolean;
    width?: string;
    render?: (item: T) => React.ReactNode;
  }>;
  
  // Empty State
  emptyState: {
    icon: LucideIcon;
    title: string;
    description: string;
    action?: { label: string; onClick: () => void };
  };
  
  // Row Actions
  rowActions?: Array<{
    key: string;
    label: string;
    icon?: LucideIcon;
    onClick: (item: T) => void;
    variant?: 'default' | 'destructive';
  }>;
  
  // Bulk Actions
  bulkActions?: Array<{
    key: string;
    label: string;
    icon?: LucideIcon;
    onClick: (selectedIds: string[]) => void;
  }>;
}
```

**Usage Example:**
```tsx
<EntityListView
  config={jobsListConfig}
  items={jobs}
  total={total}
  stats={stats}
  filters={filters}
  onFiltersChange={setFilters}
  onItemClick={(job) => router.push(`/employee/recruiting/jobs/${job.id}`)}
  onPrimaryAction={() => router.push('/employee/recruiting/jobs/intake')}
  isLoading={isLoading}
/>
```

---

### **2. EntityDetailView.pcf** - Detail Screen Component

```typescript
// src/components/pcf/EntityDetailView.tsx

interface EntityDetailViewProps<T> {
  // Configuration
  config: DetailViewConfig<T>;
  
  // Data
  entity: T;
  
  // Navigation mode
  viewMode: 'journey' | 'sections';
  currentSection?: string;
  currentStep?: number;
  
  // Actions
  onViewModeChange?: (mode: 'journey' | 'sections') => void;
  onSectionChange?: (section: string) => void;
  onStepChange?: (step: number) => void;
  onQuickAction?: (actionId: string) => void;
  
  // Loading
  isLoading?: boolean;
}

interface DetailViewConfig<T> {
  // Entity Info
  entityType: string;
  
  // Header (PanelSet.Header)
  header: {
    titleField: keyof T;
    subtitleFields?: Array<{
      key: keyof T;
      icon?: LucideIcon;
      format?: (value: any) => string;
    }>;
    statusField?: keyof T;
    statusConfig?: Record<string, { label: string; color: string }>;
  };
  
  // Summary Cards (PanelSet.Summary)
  summaryCards?: Array<{
    key: string;
    label: string;
    icon?: LucideIcon;
    getValue: (entity: T) => string | number;
    format?: 'number' | 'currency' | 'date' | 'custom';
  }>;
  
  // Navigation Mode Support
  navigationMode: 'journey' | 'sections' | 'both';
  
  // Journey Steps (for workflow entities)
  journeySteps?: Array<{
    id: string;
    label: string;
    icon?: LucideIcon;
    isComplete: (entity: T) => boolean;
    isCurrent: (entity: T) => boolean;
  }>;
  
  // Sections (for information entities)
  sections?: Array<{
    id: string;
    label: string;
    icon?: LucideIcon;
    count?: (entity: T) => number;
    component: React.ComponentType<{ entity: T; entityId: string }>;
  }>;
  
  // Quick Actions (status changes, workflows)
  quickActions?: Array<{
    id: string;
    label: string;
    icon?: LucideIcon;
    variant?: 'default' | 'premium' | 'destructive';
    isVisible?: (entity: T) => boolean;
    isDisabled?: (entity: T) => boolean;
  }>;
  
  // Related Entities (for inline panels)
  relatedEntities?: Array<{
    type: string;
    label: string;
    listComponent: React.ComponentType<{ parentId: string }>;
    detailComponent: React.ComponentType<{ id: string; onClose: () => void }>;
  }>;
}
```

**Usage Example:**
```tsx
<EntityDetailView
  config={jobDetailConfig}
  entity={job}
  viewMode={viewMode}
  currentSection={section}
  onViewModeChange={setViewMode}
  onSectionChange={setSection}
  onQuickAction={handleQuickAction}
/>
```

---

### **3. EntityWizard.pcf** - Multi-Step Wizard Component

```typescript
// src/components/pcf/EntityWizard.tsx

interface EntityWizardProps<T> {
  // Configuration
  config: WizardConfig<T>;
  
  // State
  currentStep: number;
  data: Partial<T>;
  
  // Actions
  onStepChange: (step: number) => void;
  onDataChange: (data: Partial<T>) => void;
  onSubmit: (data: T) => void;
  onCancel: () => void;
  onSaveDraft?: (data: Partial<T>) => void;
  
  // Loading
  isSubmitting?: boolean;
}

interface WizardConfig<T> {
  // Wizard Info
  title: string;
  description?: string;
  
  // Steps
  steps: Array<{
    id: string;
    label: string;
    description?: string;
    icon?: LucideIcon;
    
    // Fields for this step
    fields: Array<FieldConfig>;
    
    // Validation schema for this step
    validation?: ZodSchema;
    
    // Custom component (optional, overrides auto-generated form)
    component?: React.ComponentType<WizardStepProps<T>>;
  }>;
  
  // Review step (optional)
  reviewStep?: {
    title: string;
    sections: Array<{
      label: string;
      fields: Array<keyof T>;
    }>;
  };
  
  // Actions
  submitLabel?: string;
  saveDraftLabel?: string;
  cancelLabel?: string;
}

interface FieldConfig {
  key: string;
  label: string;
  type: 'text' | 'textarea' | 'number' | 'currency' | 'select' | 
        'multi-select' | 'date' | 'date-range' | 'checkbox' | 
        'radio' | 'skills' | 'rich-text' | 'file';
  placeholder?: string;
  required?: boolean;
  options?: Array<{ value: string; label: string }>;
  helpText?: string;
  dependsOn?: { field: string; value: any };
  columns?: 1 | 2;  // For layout
}
```

**Usage Example:**
```tsx
<EntityWizard
  config={jobIntakeConfig}
  currentStep={step}
  data={formData}
  onStepChange={setStep}
  onDataChange={setFormData}
  onSubmit={handleSubmit}
  onCancel={() => router.back()}
  onSaveDraft={handleSaveDraft}
  isSubmitting={isSubmitting}
/>
```

---

### **4. EntityForm.pcf** - Single-Step Form Component

```typescript
// src/components/pcf/EntityForm.tsx

interface EntityFormProps<T> {
  // Configuration
  config: FormConfig<T>;
  
  // Data
  initialData?: Partial<T>;
  
  // Actions
  onSubmit: (data: T) => void;
  onCancel?: () => void;
  
  // Loading
  isSubmitting?: boolean;
}

interface FormConfig<T> {
  title: string;
  description?: string;
  
  // Form sections
  sections: Array<{
    title?: string;
    columns?: 1 | 2 | 3;
    fields: Array<FieldConfig>;
  }>;
  
  // Validation
  validation: ZodSchema;
  
  // Actions
  submitLabel?: string;
  cancelLabel?: string;
}
```

---

## **Entity Configuration Files**

Each entity gets a configuration file:

```
src/configs/entities/
├── jobs.config.ts          # Jobs ListView, DetailView, IntakeWizard configs
├── accounts.config.ts      # Accounts ListView, DetailView, OnboardingWizard configs
├── leads.config.ts         # Leads ListView, DetailView, IntakeForm configs
├── deals.config.ts         # Deals ListView, DetailView, IntakeWizard configs
├── campaigns.config.ts     # Campaigns ListView, DetailView, IntakeWizard configs
├── candidates.config.ts    # Candidates ListView, DetailView, IntakeForm configs
├── contacts.config.ts      # Contacts ListView, DetailView, IntakeForm configs
├── submissions.config.ts   # Submissions ListView, DetailView, Wizard configs
├── vendors.config.ts       # Vendors ListView, DetailView, IntakeForm configs
├── interviews.config.ts    # Interviews ListView, DetailView, IntakeWizard configs
├── placements.config.ts    # Placements ListView, DetailView, IntakeWizard configs
└── index.ts                # Export all configs
```

**Example Configuration (Jobs):**

```typescript
// src/configs/entities/jobs.config.ts

export const jobsListConfig: ListViewConfig<Job> = {
  title: 'Jobs',
  description: 'Manage your job requisitions and pipelines',
  icon: Briefcase,
  
  primaryAction: {
    label: 'New Job',
    icon: Plus,
    href: '/employee/recruiting/jobs/intake',
  },
  
  statsCards: [
    { key: 'total', label: 'Total Jobs', icon: Briefcase },
    { key: 'active', label: 'Active', icon: Zap, color: 'green' },
    { key: 'onHold', label: 'On Hold', icon: Pause, color: 'amber' },
    { key: 'filled', label: 'Filled', icon: CheckCircle, color: 'purple' },
    { key: 'urgent', label: 'Urgent', icon: AlertTriangle, color: 'red' },
  ],
  
  filters: [
    { key: 'search', type: 'search', label: 'Search', placeholder: 'Search jobs...' },
    { 
      key: 'status', 
      type: 'select', 
      label: 'Status',
      options: [
        { value: 'all', label: 'All Status' },
        { value: 'draft', label: 'Draft' },
        { value: 'open', label: 'Open' },
        { value: 'active', label: 'Active' },
        { value: 'on_hold', label: 'On Hold' },
        { value: 'filled', label: 'Filled' },
        { value: 'cancelled', label: 'Cancelled' },
      ],
    },
  ],
  
  columns: [
    { key: 'title', header: 'Job Title', sortable: true },
    { key: 'account.name', header: 'Account', sortable: true },
    { key: 'status', header: 'Status', render: (job) => <StatusBadge status={job.status} config={JOB_STATUS_CONFIG} /> },
    { key: 'location', header: 'Location' },
    { key: 'billingRate', header: 'Rate', format: 'currency' },
    { key: 'submissionCount', header: 'Submissions' },
    { key: 'createdAt', header: 'Created', format: 'relative-date' },
  ],
  
  emptyState: {
    icon: Briefcase,
    title: 'No jobs found',
    description: 'Create your first job to get started',
    action: { label: 'Create Job', onClick: () => {} },
  },
  
  rowActions: [
    { key: 'view', label: 'View Details', icon: Eye },
    { key: 'edit', label: 'Edit', icon: Pencil },
    { key: 'duplicate', label: 'Duplicate', icon: Copy },
    { key: 'delete', label: 'Delete', icon: Trash2, variant: 'destructive' },
  ],
};

export const jobDetailConfig: DetailViewConfig<Job> = {
  entityType: 'job',
  
  header: {
    titleField: 'title',
    subtitleFields: [
      { key: 'account.name', icon: Building2 },
      { key: 'location', icon: MapPin },
      { key: 'job_type', icon: Briefcase },
    ],
    statusField: 'status',
    statusConfig: JOB_STATUS_CONFIG,
  },
  
  summaryCards: [
    { key: 'positions', label: 'Positions', icon: Users, getValue: (j) => `${j.positions_filled}/${j.positions_count}` },
    { key: 'rate', label: 'Rate Range', icon: DollarSign, getValue: (j) => `$${j.rate_min}-${j.rate_max}` },
    { key: 'submissions', label: 'Submissions', icon: Users, getValue: (j) => j.submissionCount },
    { key: 'daysOpen', label: 'Days Open', icon: Clock, getValue: (j) => calculateDaysOpen(j.created_at) },
  ],
  
  navigationMode: 'both', // Supports both journey and sections
  
  journeySteps: [
    { id: 'intake', label: 'Intake', isComplete: (j) => j.status !== 'draft', isCurrent: (j) => j.status === 'draft' },
    { id: 'sourcing', label: 'Sourcing', isComplete: (j) => j.submissionCount > 0, isCurrent: (j) => j.status === 'open' },
    { id: 'screening', label: 'Screening', isComplete: (j) => hasInterviews(j), isCurrent: (j) => j.status === 'active' },
    { id: 'offer', label: 'Offer', isComplete: (j) => hasOffers(j), isCurrent: (j) => /* logic */ },
    { id: 'placement', label: 'Placement', isComplete: (j) => j.status === 'filled', isCurrent: (j) => /* logic */ },
  ],
  
  sections: [
    { id: 'overview', label: 'Overview', icon: FileText, component: JobOverviewSection },
    { id: 'requirements', label: 'Requirements', icon: ListChecks, component: JobRequirementsSection },
    { id: 'submissions', label: 'Submissions', icon: Users, count: (j) => j.submissionCount, component: JobSubmissionsSection },
    { id: 'pipeline', label: 'Pipeline', icon: Workflow, component: JobPipelineSection },
    { id: 'interviews', label: 'Interviews', icon: Calendar, component: JobInterviewsSection },
    { id: 'offers', label: 'Offers', icon: FileCheck, component: JobOffersSection },
    { id: 'activities', label: 'Activities', icon: Activity, component: JobActivitiesSection },
    { id: 'documents', label: 'Documents', icon: Folder, component: JobDocumentsSection },
    { id: 'notes', label: 'Notes', icon: StickyNote, component: JobNotesSection },
  ],
  
  quickActions: [
    { id: 'updateStatus', label: 'Update Status', icon: RefreshCw },
    { id: 'addCandidate', label: 'Add Candidate', icon: UserPlus },
    { id: 'closeJob', label: 'Close Job', icon: XCircle, variant: 'destructive', isVisible: (j) => j.status !== 'filled' },
  ],
};

export const jobIntakeWizardConfig: WizardConfig<JobIntake> = {
  title: 'Job Intake',
  description: 'Create a new job requisition',
  
  steps: [
    {
      id: 'basic',
      label: 'Basic Info',
      description: 'Job title, type, and account',
      icon: FileText,
      fields: [
        { key: 'title', label: 'Job Title', type: 'text', required: true },
        { key: 'account_id', label: 'Account', type: 'select', required: true },
        { key: 'job_type', label: 'Job Type', type: 'select', required: true, options: JOB_TYPE_OPTIONS },
        { key: 'positions_count', label: 'Positions', type: 'number', required: true },
      ],
      validation: jobBasicInfoSchema,
    },
    {
      id: 'requirements',
      label: 'Requirements',
      description: 'Skills and experience',
      icon: ListChecks,
      fields: [
        { key: 'required_skills', label: 'Required Skills', type: 'skills', required: true },
        { key: 'nice_to_have_skills', label: 'Nice to Have', type: 'skills' },
        { key: 'min_experience_years', label: 'Min Experience', type: 'number' },
        { key: 'max_experience_years', label: 'Max Experience', type: 'number' },
        { key: 'visa_requirements', label: 'Visa Requirements', type: 'multi-select', options: VISA_OPTIONS },
      ],
      validation: jobRequirementsSchema,
    },
    // ... more steps
  ],
  
  reviewStep: {
    title: 'Review & Submit',
    sections: [
      { label: 'Basic Info', fields: ['title', 'account_id', 'job_type', 'positions_count'] },
      { label: 'Requirements', fields: ['required_skills', 'min_experience_years', 'visa_requirements'] },
      { label: 'Compensation', fields: ['rate_min', 'rate_max', 'rate_type'] },
    ],
  },
  
  submitLabel: 'Create Job',
  saveDraftLabel: 'Save as Draft',
};
```

---

## **File Structure**

```
src/
├── components/
│   └── pcf/                           # Core PCF Components
│       ├── list-view/
│       │   ├── EntityListView.tsx     # Main ListView PCF
│       │   ├── ListHeader.tsx         # PanelSet.Header
│       │   ├── ListStats.tsx          # PanelSet.Stats
│       │   ├── ListFilters.tsx        # PanelSet.Filters
│       │   ├── ListTable.tsx          # ListView (table)
│       │   ├── ListEmptyState.tsx
│       │   └── index.ts
│       ├── detail-view/
│       │   ├── EntityDetailView.tsx   # Main DetailView PCF
│       │   ├── DetailHeader.tsx       # PanelSet.Header
│       │   ├── DetailSummary.tsx      # PanelSet.Summary
│       │   ├── SectionNavigation.tsx  # Section tabs/sidebar
│       │   ├── JourneyNavigation.tsx  # Journey steps sidebar
│       │   ├── SectionContent.tsx     # Content renderer
│       │   └── index.ts
│       ├── wizard/
│       │   ├── EntityWizard.tsx       # Multi-step Wizard PCF
│       │   ├── WizardProgress.tsx     # Step indicator
│       │   ├── WizardStep.tsx         # Step container
│       │   ├── WizardReview.tsx       # Review step
│       │   └── index.ts
│       ├── form/
│       │   ├── EntityForm.tsx         # Single-step Form PCF
│       │   ├── FormSection.tsx
│       │   ├── FormField.tsx          # Universal field renderer
│       │   └── index.ts
│       └── shared/
│           ├── StatusBadge.tsx        # Reusable status badge
│           ├── EntityIcon.tsx         # Entity type icons
│           ├── QuickActionBar.tsx     # Quick actions toolbar
│           ├── InlinePanel.tsx        # Inline panel container
│           └── index.ts
├── configs/
│   └── entities/                      # Entity Configurations
│       ├── jobs.config.ts
│       ├── accounts.config.ts
│       ├── leads.config.ts
│       ├── deals.config.ts
│       ├── campaigns.config.ts
│       ├── candidates.config.ts
│       ├── contacts.config.ts
│       ├── submissions.config.ts
│       ├── vendors.config.ts
│       ├── interviews.config.ts
│       ├── placements.config.ts
│       └── index.ts
└── app/employee/
    └── [module]/
        └── [entity]/
            ├── page.tsx               # Uses <EntityListView config={...} />
            └── [id]/
                └── page.tsx           # Uses <EntityDetailView config={...} />
```

---

## **Implementation Phases**

### **Phase 1: Core PCF Framework (1-2 weeks)**
1. Build `EntityListView` with all sub-components
2. Build `EntityDetailView` with section/journey support
3. Build `EntityWizard` and `EntityForm`
4. Build shared widgets (StatusBadge, FormField, etc.)

### **Phase 2: Entity Configurations (1 week)**
1. Create configuration files for all 12 entity types
2. Define field types, validation schemas, section components
3. Map existing tRPC procedures to config API paths

### **Phase 3: Migration (2-3 weeks)**
1. Replace `JobsListClient` → `<EntityListView config={jobsListConfig}>`
2. Replace `LeadsListClient` → `<EntityListView config={leadsListConfig}>`
3. Continue for all entities...
4. Update page.tsx files to use new PCF components

### **Phase 4: Polish & Optimization**
1. Add animations/transitions
2. Optimize bundle size (lazy loading sections)
3. Add keyboard navigation
4. Add accessibility features

---