-- Current sql file was generated after introspecting the database
-- If you want to run this migration please uncomment this code before executing migrations
/*
CREATE TYPE "public"."activity_direction" AS ENUM('inbound', 'outbound');--> statement-breakpoint
CREATE TYPE "public"."activity_outcome" AS ENUM('positive', 'neutral', 'negative');--> statement-breakpoint
CREATE TYPE "public"."activity_priority" AS ENUM('low', 'medium', 'high', 'urgent');--> statement-breakpoint
CREATE TYPE "public"."activity_status" AS ENUM('scheduled', 'open', 'in_progress', 'completed', 'skipped', 'cancelled');--> statement-breakpoint
CREATE TYPE "public"."activity_type_enum" AS ENUM('email', 'call', 'meeting', 'note', 'linkedin_message', 'task', 'follow_up', 'reminder');--> statement-breakpoint
CREATE TYPE "public"."approval_status" AS ENUM('pending', 'approved', 'rejected', 'delegated', 'escalated');--> statement-breakpoint
CREATE TYPE "public"."bench_marketing_status" AS ENUM('draft', 'active', 'paused', 'archived');--> statement-breakpoint
CREATE TYPE "public"."bench_status" AS ENUM('onboarding', 'available', 'marketing', 'interviewing', 'placed', 'inactive');--> statement-breakpoint
CREATE TYPE "public"."bench_type" AS ENUM('w2_internal', 'w2_vendor', '1099', 'c2c');--> statement-breakpoint
CREATE TYPE "public"."benefit_status" AS ENUM('pending', 'active', 'terminated');--> statement-breakpoint
CREATE TYPE "public"."benefit_type" AS ENUM('health', 'dental', 'vision', '401k', 'life', 'disability', 'hsa', 'fsa');--> statement-breakpoint
CREATE TYPE "public"."company_category" AS ENUM('client', 'vendor', 'partner', 'prospect');--> statement-breakpoint
CREATE TYPE "public"."company_note_type" AS ENUM('general', 'meeting', 'call', 'strategy', 'warning', 'opportunity', 'competitive_intel');--> statement-breakpoint
CREATE TYPE "public"."company_relationship_category" AS ENUM('parent_child', 'msp_client', 'prime_sub', 'referral_partner', 'competitor', 'affiliate', 'merger_acquisition');--> statement-breakpoint
CREATE TYPE "public"."company_relationship_type" AS ENUM('direct_client', 'msp_client', 'prime_vendor', 'sub_vendor', 'implementation_partner', 'referral_partner', 'competitor');--> statement-breakpoint
CREATE TYPE "public"."company_segment" AS ENUM('enterprise', 'mid_market', 'smb', 'startup');--> statement-breakpoint
CREATE TYPE "public"."company_status" AS ENUM('active', 'inactive', 'on_hold', 'churned', 'do_not_use', 'pending_approval');--> statement-breakpoint
CREATE TYPE "public"."company_team_role" AS ENUM('owner', 'account_manager', 'recruiter', 'sales', 'coordinator', 'executive_sponsor', 'viewer');--> statement-breakpoint
CREATE TYPE "public"."company_tier" AS ENUM('strategic', 'preferred', 'standard', 'transactional');--> statement-breakpoint
CREATE TYPE "public"."company_vendor_type" AS ENUM('direct_client', 'prime_vendor', 'sub_vendor', 'msp', 'vms_provider', 'talent_supplier', 'referral_source');--> statement-breakpoint
CREATE TYPE "public"."compliance_applies_to" AS ENUM('all', 'fte', 'contractor');--> statement-breakpoint
CREATE TYPE "public"."compliance_frequency" AS ENUM('once', 'annual', 'quarterly', 'monthly');--> statement-breakpoint
CREATE TYPE "public"."compliance_item_status" AS ENUM('pending', 'received', 'under_review', 'verified', 'expiring', 'expired', 'rejected', 'waived');--> statement-breakpoint
CREATE TYPE "public"."compliance_priority" AS ENUM('critical', 'high', 'medium', 'low');--> statement-breakpoint
CREATE TYPE "public"."compliance_status" AS ENUM('pending', 'completed', 'overdue', 'exempt');--> statement-breakpoint
CREATE TYPE "public"."compliance_type" AS ENUM('federal', 'state', 'local');--> statement-breakpoint
CREATE TYPE "public"."contact_decision_authority" AS ENUM('decision_maker', 'influencer', 'champion', 'gatekeeper', 'end_user', 'budget_holder', 'technical_evaluator', 'procurement');--> statement-breakpoint
CREATE TYPE "public"."contract_status" AS ENUM('draft', 'in_review', 'pending_signature', 'active', 'expired', 'terminated', 'superseded');--> statement-breakpoint
CREATE TYPE "public"."contract_type" AS ENUM('msa', 'sow', 'nda', 'amendment', 'addendum', 'rate_agreement', 'referral_agreement', 'subcontract', 'other');--> statement-breakpoint
CREATE TYPE "public"."coverage_level" AS ENUM('employee', 'employee_spouse', 'employee_children', 'family');--> statement-breakpoint
CREATE TYPE "public"."document_status" AS ENUM('pending', 'approved', 'expired', 'rejected');--> statement-breakpoint
CREATE TYPE "public"."document_type" AS ENUM('offer_letter', 'contract', 'i9', 'w4', 'tax_form', 'nda', 'handbook_ack', 'performance_review', 'termination', 'other');--> statement-breakpoint
CREATE TYPE "public"."employment_status" AS ENUM('onboarding', 'active', 'on_leave', 'terminated');--> statement-breakpoint
CREATE TYPE "public"."employment_type" AS ENUM('fte', 'contractor', 'intern', 'part_time');--> statement-breakpoint
CREATE TYPE "public"."enrollment_status" AS ENUM('pending', 'active', 'completed', 'dropped', 'expired');--> statement-breakpoint
CREATE TYPE "public"."event_category" AS ENUM('security', 'data', 'system', 'integration', 'workflow');--> statement-breakpoint
CREATE TYPE "public"."event_severity" AS ENUM('debug', 'info', 'warning', 'error', 'critical');--> statement-breakpoint
CREATE TYPE "public"."feedback_type" AS ENUM('strength', 'improvement', 'comment');--> statement-breakpoint
CREATE TYPE "public"."goal_status" AS ENUM('not_started', 'in_progress', 'completed', 'cancelled');--> statement-breakpoint
CREATE TYPE "public"."graduate_candidate_status" AS ENUM('pending_review', 'bench_candidate', 'placed', 'opted_out', 'not_qualified');--> statement-breakpoint
CREATE TYPE "public"."history_change_type" AS ENUM('status_change', 'stage_change', 'owner_change', 'assignment_change', 'score_change', 'priority_change', 'category_change', 'workflow_step', 'custom');--> statement-breakpoint
CREATE TYPE "public"."i9_status" AS ENUM('pending', 'section1_complete', 'completed', 'expired');--> statement-breakpoint
CREATE TYPE "public"."immigration_case_status" AS ENUM('not_started', 'in_progress', 'rfe', 'approved', 'denied', 'withdrawn');--> statement-breakpoint
CREATE TYPE "public"."immigration_case_type" AS ENUM('h1b_transfer', 'h1b_extension', 'h1b_amendment', 'gc_perm', 'gc_i140', 'gc_i485', 'opt_extension', 'tn_renewal', 'l1_extension');--> statement-breakpoint
CREATE TYPE "public"."invoice_status" AS ENUM('draft', 'pending_approval', 'approved', 'sent', 'viewed', 'partially_paid', 'paid', 'overdue', 'disputed', 'void', 'written_off');--> statement-breakpoint
CREATE TYPE "public"."invoice_type" AS ENUM('standard', 'fixed_fee', 'retainer', 'milestone', 'credit_note', 'final');--> statement-breakpoint
CREATE TYPE "public"."job_order_priority" AS ENUM('low', 'medium', 'high', 'urgent');--> statement-breakpoint
CREATE TYPE "public"."job_order_source" AS ENUM('email', 'portal', 'call', 'referral');--> statement-breakpoint
CREATE TYPE "public"."job_order_status" AS ENUM('new', 'working', 'filled', 'closed', 'on_hold');--> statement-breakpoint
CREATE TYPE "public"."leaderboard_scope" AS ENUM('org', 'department', 'course');--> statement-breakpoint
CREATE TYPE "public"."leaderboard_type" AS ENUM('weekly', 'monthly', 'all_time');--> statement-breakpoint
CREATE TYPE "public"."marketing_status" AS ENUM('draft', 'active', 'paused', 'archived');--> statement-breakpoint
CREATE TYPE "public"."metric_period_type" AS ENUM('daily', 'weekly', 'monthly', 'quarterly', 'yearly');--> statement-breakpoint
CREATE TYPE "public"."note_type" AS ENUM('general', 'meeting', 'call', 'strategy', 'warning', 'opportunity', 'competitive_intel', 'internal');--> statement-breakpoint
CREATE TYPE "public"."note_visibility" AS ENUM('private', 'team', 'organization');--> statement-breakpoint
CREATE TYPE "public"."onboarding_status" AS ENUM('not_started', 'in_progress', 'completed', 'cancelled');--> statement-breakpoint
CREATE TYPE "public"."organization_tier" AS ENUM('starter', 'growth', 'enterprise');--> statement-breakpoint
CREATE TYPE "public"."path_status" AS ENUM('draft', 'published', 'archived');--> statement-breakpoint
CREATE TYPE "public"."pay_period_status" AS ENUM('upcoming', 'active', 'processing', 'completed', 'void');--> statement-breakpoint
CREATE TYPE "public"."pay_run_status" AS ENUM('draft', 'calculating', 'pending_approval', 'approved', 'submitted', 'processing', 'completed', 'void');--> statement-breakpoint
CREATE TYPE "public"."pay_run_type" AS ENUM('regular', 'off_cycle', 'bonus', 'final', 'correction');--> statement-breakpoint
CREATE TYPE "public"."pay_type" AS ENUM('w2', '1099', 'corp_to_corp');--> statement-breakpoint
CREATE TYPE "public"."performance_goal_category" AS ENUM('business', 'development', 'behavioral');--> statement-breakpoint
CREATE TYPE "public"."pod_member_role" AS ENUM('senior', 'junior');--> statement-breakpoint
CREATE TYPE "public"."rate_card_status" AS ENUM('draft', 'pending_approval', 'active', 'expired', 'superseded');--> statement-breakpoint
CREATE TYPE "public"."rate_card_type" AS ENUM('standard', 'msp', 'vms', 'preferred', 'custom');--> statement-breakpoint
CREATE TYPE "public"."rate_unit" AS ENUM('hourly', 'daily', 'weekly', 'monthly', 'annual', 'fixed', 'retainer', 'project');--> statement-breakpoint
CREATE TYPE "public"."relationship" AS ENUM('spouse', 'child', 'domestic_partner', 'other');--> statement-breakpoint
CREATE TYPE "public"."salary_type" AS ENUM('hourly', 'annual');--> statement-breakpoint
CREATE TYPE "public"."signatory_status" AS ENUM('pending', 'viewed', 'signed', 'declined', 'expired');--> statement-breakpoint
CREATE TYPE "public"."skill_category" AS ENUM('programming_language', 'framework', 'library', 'tool', 'platform', 'database', 'cloud', 'methodology', 'soft_skill', 'domain', 'certification_skill');--> statement-breakpoint
CREATE TYPE "public"."skill_domain" AS ENUM('technology', 'business', 'creative', 'healthcare', 'finance', 'legal', 'general');--> statement-breakpoint
CREATE TYPE "public"."skill_level" AS ENUM('beginner', 'intermediate', 'advanced');--> statement-breakpoint
CREATE TYPE "public"."streak_type_enum" AS ENUM('daily_login', 'daily_learning', 'weekly_completion');--> statement-breakpoint
CREATE TYPE "public"."task_category" AS ENUM('paperwork', 'it_setup', 'training', 'orientation', 'other');--> statement-breakpoint
CREATE TYPE "public"."task_status" AS ENUM('pending', 'completed', 'skipped');--> statement-breakpoint
CREATE TYPE "public"."time_off_status" AS ENUM('pending', 'approved', 'denied', 'cancelled');--> statement-breakpoint
CREATE TYPE "public"."time_off_type" AS ENUM('pto', 'sick', 'personal', 'bereavement', 'jury_duty', 'parental', 'unpaid');--> statement-breakpoint
CREATE TYPE "public"."timesheet_period_type" AS ENUM('weekly', 'bi_weekly', 'semi_monthly', 'monthly');--> statement-breakpoint
CREATE TYPE "public"."timesheet_status" AS ENUM('draft', 'submitted', 'pending_client_approval', 'client_approved', 'client_rejected', 'pending_internal_approval', 'internal_approved', 'internal_rejected', 'approved', 'processed', 'void');--> statement-breakpoint
CREATE TYPE "public"."vendor_tier" AS ENUM('preferred', 'standard', 'new');--> statement-breakpoint
CREATE TYPE "public"."vendor_type" AS ENUM('direct_client', 'prime_vendor', 'sub_vendor', 'msp', 'vms');--> statement-breakpoint
CREATE TYPE "public"."verification_method" AS ENUM('self_reported', 'assessment', 'endorsement', 'certification', 'interview', 'resume_parsed');--> statement-breakpoint
CREATE TYPE "public"."visa_alert_level" AS ENUM('green', 'yellow', 'orange', 'red', 'black');--> statement-breakpoint
CREATE TYPE "public"."visa_type" AS ENUM('usc', 'green_card', 'gc_ead', 'h1b', 'h1b_transfer', 'h4_ead', 'l1a', 'l1b', 'l2_ead', 'opt', 'opt_stem', 'cpt', 'tn', 'e3', 'o1', 'canada_citizen', 'canada_pr', 'canada_owp', 'canada_cwp', 'canada_pgwp', 'canada_lmia');--> statement-breakpoint
CREATE TYPE "public"."work_mode" AS ENUM('on_site', 'remote', 'hybrid');--> statement-breakpoint
CREATE TYPE "public"."worker_type" AS ENUM('employee', 'consultant', 'contractor');--> statement-breakpoint
CREATE SEQUENCE "public"."escalation_number_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 1000 CACHE 1;--> statement-breakpoint
CREATE SEQUENCE "public"."activity_number_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 1 CACHE 1;--> statement-breakpoint
CREATE SEQUENCE "public"."audit_logs_event_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 1 CACHE 1;--> statement-breakpoint
CREATE TABLE "badge_progress" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"badge_id" uuid NOT NULL,
	"current_value" integer DEFAULT 0,
	"target_value" integer NOT NULL,
	"last_updated" timestamp with time zone DEFAULT now(),
	CONSTRAINT "badge_progress_user_id_badge_id_key" UNIQUE("user_id","badge_id")
);
--> statement-breakpoint
ALTER TABLE "badge_progress" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "badge_trigger_events" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"trigger_type" text NOT NULL,
	"event_data" jsonb DEFAULT '{}'::jsonb,
	"processed" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "badge_trigger_events" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "payment_transactions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"enrollment_id" uuid,
	"stripe_payment_intent_id" text,
	"stripe_invoice_id" text,
	"stripe_customer_id" text,
	"amount" numeric(10, 2) NOT NULL,
	"currency" text DEFAULT 'usd',
	"status" text NOT NULL,
	"payment_method_type" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "payment_transactions_status_check" CHECK (status = ANY (ARRAY['succeeded'::text, 'pending'::text, 'failed'::text, 'refunded'::text]))
);
--> statement-breakpoint
ALTER TABLE "payment_transactions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "commissions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"deal_id" uuid NOT NULL,
	"placement_id" uuid,
	"user_id" uuid NOT NULL,
	"deal_value" numeric(12, 2) NOT NULL,
	"gross_margin" numeric(12, 2),
	"margin_percentage" numeric(5, 2) DEFAULT '20.00',
	"commission_percentage" numeric(5, 2) DEFAULT '5.00',
	"projected_commission" numeric(12, 2) NOT NULL,
	"actual_commission" numeric(12, 2),
	"commission_type" text DEFAULT 'deal_close' NOT NULL,
	"status" text DEFAULT 'pending' NOT NULL,
	"payment_schedule" text DEFAULT 'monthly',
	"payment_period_start" date,
	"payment_period_end" date,
	"activated_at" timestamp with time zone,
	"paid_at" timestamp with time zone,
	"cancelled_at" timestamp with time zone,
	"cancelled_reason" text,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "commissions_commission_type_check" CHECK (commission_type = ANY (ARRAY['deal_close'::text, 'placement'::text, 'renewal'::text, 'expansion'::text])),
	CONSTRAINT "commissions_payment_schedule_check" CHECK (payment_schedule = ANY (ARRAY['one_time'::text, 'monthly'::text, 'quarterly'::text])),
	CONSTRAINT "commissions_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'active'::text, 'paid'::text, 'cancelled'::text, 'clawback'::text]))
);
--> statement-breakpoint
ALTER TABLE "commissions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "commission_payments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"commission_id" uuid NOT NULL,
	"amount" numeric(12, 2) NOT NULL,
	"payment_date" date NOT NULL,
	"payment_method" text,
	"reference_number" text,
	"period_start" date,
	"period_end" date,
	"period_label" text,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
ALTER TABLE "commission_payments" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "productivity_reports" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"date" date NOT NULL,
	"summary" text NOT NULL,
	"productive_hours" double precision NOT NULL,
	"top_activities" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"insights" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"recommendations" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "productivity_reports_user_id_date_key" UNIQUE("user_id","date")
);
--> statement-breakpoint
ALTER TABLE "productivity_reports" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "leads" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"lead_type" text DEFAULT 'company' NOT NULL,
	"company_name" text,
	"industry" text,
	"company_size" text,
	"first_name" text,
	"last_name" text,
	"title" text,
	"email" text,
	"phone" text,
	"linkedin_url" text,
	"status" text DEFAULT 'new' NOT NULL,
	"estimated_value" numeric(12, 2),
	"source" text,
	"source_campaign_id" uuid,
	"owner_id" uuid,
	"last_contacted_at" timestamp with time zone,
	"last_response_at" timestamp with time zone,
	"engagement_score" integer,
	"converted_to_deal_id" uuid,
	"converted_to_account_id" uuid,
	"converted_at" timestamp with time zone,
	"lost_reason" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	"company_type" text,
	"website" text,
	"tier" text,
	"company_description" text,
	"decision_authority" text,
	"preferred_contact_method" text DEFAULT 'email',
	"account_id" uuid,
	"notes" text,
	"search_vector" "tsvector",
	"bant_budget" integer DEFAULT 0,
	"bant_authority" integer DEFAULT 0,
	"bant_need" integer DEFAULT 0,
	"bant_timeline" integer DEFAULT 0,
	"bant_budget_notes" text,
	"bant_authority_notes" text,
	"bant_need_notes" text,
	"bant_timeline_notes" text,
	"bant_total_score" integer GENERATED ALWAYS AS ((((COALESCE(bant_budget, 0) + COALESCE(bant_authority, 0)) + COALESCE(bant_need, 0)) + COALESCE(bant_timeline, 0))) STORED,
	"budget_status" text,
	"estimated_monthly_spend" numeric(12, 2),
	"authority_level" text,
	"business_need" text,
	"urgency" text,
	"target_start_date" date,
	"positions_count" integer DEFAULT 1,
	"skills_needed" text[],
	"contract_types" text[],
	"qualification_result" text,
	"qualification_notes" text,
	"qualified_at" timestamp with time zone,
	"qualified_by" uuid,
	"campaign_id" uuid,
	"campaign_prospect_id" uuid,
	"cross_pillar_type" text,
	"target_pillar" text,
	"handoff_notes" text,
	"interest_level" text,
	"hiring_needs" text,
	"pain_points" text,
	"budget_notes" text,
	"authority_status" text,
	"authority_notes" text,
	"need_status" text,
	"need_notes" text,
	"timeline_status" text,
	"timeline_notes" text,
	"next_action" text,
	"next_action_date" date,
	"lead_score" integer,
	"contact_id" uuid,
	"company_id" uuid,
	"converted_to_company_id" uuid,
	CONSTRAINT "leads_authority_level_check" CHECK (authority_level = ANY (ARRAY['decision_maker'::text, 'influencer'::text, 'gatekeeper'::text, 'no_authority'::text])),
	CONSTRAINT "leads_bant_authority_check" CHECK ((bant_authority >= 0) AND (bant_authority <= 25)),
	CONSTRAINT "leads_bant_budget_check" CHECK ((bant_budget >= 0) AND (bant_budget <= 25)),
	CONSTRAINT "leads_bant_need_check" CHECK ((bant_need >= 0) AND (bant_need <= 25)),
	CONSTRAINT "leads_bant_timeline_check" CHECK ((bant_timeline >= 0) AND (bant_timeline <= 25)),
	CONSTRAINT "leads_budget_status_check" CHECK (budget_status = ANY (ARRAY['confirmed'::text, 'likely'::text, 'unclear'::text, 'no_budget'::text])),
	CONSTRAINT "leads_engagement_score_check" CHECK ((engagement_score >= 0) AND (engagement_score <= 100)),
	CONSTRAINT "leads_lead_score_check" CHECK ((lead_score >= 0) AND (lead_score <= 100)),
	CONSTRAINT "leads_positions_count_check" CHECK ((positions_count >= 1) AND (positions_count <= 100)),
	CONSTRAINT "leads_qualification_result_check" CHECK (qualification_result = ANY (ARRAY['qualified_convert'::text, 'qualified_nurture'::text, 'not_qualified'::text])),
	CONSTRAINT "leads_urgency_check" CHECK (urgency = ANY (ARRAY['immediate'::text, 'high'::text, 'medium'::text, 'low'::text]))
);
--> statement-breakpoint
ALTER TABLE "leads" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "generated_resumes" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"target_role" text NOT NULL,
	"resume_text" text NOT NULL,
	"resume_pdf_path" text,
	"quality_score" integer,
	"ats_keywords" text[],
	"has_quantified_achievements" boolean DEFAULT false,
	"has_action_verbs" boolean DEFAULT false,
	"length_appropriate" boolean DEFAULT false,
	"no_typos" boolean DEFAULT false,
	"student_feedback" text,
	"interview_count" integer DEFAULT 0,
	"placement_achieved" boolean DEFAULT false,
	"model_used" text,
	"tokens_used" integer,
	"cost_usd" numeric(10, 6),
	"generation_latency_ms" integer,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "generated_resumes_quality_score_check" CHECK ((quality_score >= 0) AND (quality_score <= 100))
);
--> statement-breakpoint
ALTER TABLE "generated_resumes" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "requisition_embeddings" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"requisition_id" uuid NOT NULL,
	"embedding" vector(1536),
	"description" text NOT NULL,
	"required_skills" text[],
	"nice_to_have_skills" text[],
	"experience_level" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "requisition_embeddings_org_id_requisition_id_key" UNIQUE("org_id","requisition_id"),
	CONSTRAINT "requisition_embeddings_experience_level_check" CHECK (experience_level = ANY (ARRAY['entry'::text, 'mid'::text, 'senior'::text]))
);
--> statement-breakpoint
ALTER TABLE "requisition_embeddings" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "resume_matches" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"requisition_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"match_score" integer,
	"reasoning" text,
	"skills_matched" text[],
	"skills_missing" text[],
	"skills_score" integer,
	"experience_score" integer,
	"project_score" integer,
	"availability_score" integer,
	"recruiter_feedback" text,
	"is_relevant" boolean,
	"submitted" boolean DEFAULT false,
	"interview_scheduled" boolean DEFAULT false,
	"placement_achieved" boolean DEFAULT false,
	"model_used" text,
	"tokens_used" integer,
	"cost_usd" numeric(10, 6),
	"search_latency_ms" integer,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "resume_matches_availability_score_check" CHECK ((availability_score >= 0) AND (availability_score <= 100)),
	CONSTRAINT "resume_matches_experience_score_check" CHECK ((experience_score >= 0) AND (experience_score <= 100)),
	CONSTRAINT "resume_matches_match_score_check" CHECK ((match_score >= 0) AND (match_score <= 100)),
	CONSTRAINT "resume_matches_project_score_check" CHECK ((project_score >= 0) AND (project_score <= 100)),
	CONSTRAINT "resume_matches_skills_score_check" CHECK ((skills_score >= 0) AND (skills_score <= 100))
);
--> statement-breakpoint
ALTER TABLE "resume_matches" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "employee_twin_interactions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"twin_role" text NOT NULL,
	"interaction_type" text NOT NULL,
	"prompt" text,
	"response" text NOT NULL,
	"context" jsonb DEFAULT '{}'::jsonb,
	"model_used" text DEFAULT 'gpt-4o-mini',
	"tokens_used" integer,
	"cost_usd" double precision,
	"latency_ms" integer,
	"was_helpful" boolean,
	"user_feedback" text,
	"dismissed" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "employee_twin_interactions_interaction_type_check" CHECK (interaction_type = ANY (ARRAY['morning_briefing'::text, 'suggestion'::text, 'question'::text])),
	CONSTRAINT "employee_twin_interactions_twin_role_check" CHECK (twin_role = ANY (ARRAY['ceo'::text, 'admin'::text, 'recruiter'::text, 'bench_sales'::text, 'talent_acquisition'::text, 'hr'::text, 'immigration'::text, 'trainer'::text]))
);
--> statement-breakpoint
ALTER TABLE "employee_twin_interactions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_embeddings" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"embedding" vector(1536),
	"resume_text" text NOT NULL,
	"skills" text[],
	"experience_level" text,
	"availability" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"contact_id" uuid,
	CONSTRAINT "candidate_embeddings_org_id_candidate_id_key" UNIQUE("org_id","candidate_id"),
	CONSTRAINT "candidate_embeddings_availability_check" CHECK (availability = ANY (ARRAY['immediate'::text, '2-weeks'::text, '1-month'::text])),
	CONSTRAINT "candidate_embeddings_experience_level_check" CHECK (experience_level = ANY (ARRAY['entry'::text, 'mid'::text, 'senior'::text]))
);
--> statement-breakpoint
ALTER TABLE "candidate_embeddings" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "lead_sourcing_credits" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"lead_id" uuid NOT NULL,
	"sourced_by" uuid NOT NULL,
	"source_pillar" text NOT NULL,
	"target_pillar" text NOT NULL,
	"assigned_to" uuid,
	"credit_points" integer DEFAULT 10,
	"bonus_points" integer DEFAULT 0,
	"status" text DEFAULT 'pending',
	"converted_at" timestamp with time zone,
	"conversion_value" numeric(12, 2),
	"commission_earned" numeric(12, 2),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "lead_sourcing_credits" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "roles" (
	"id" uuid PRIMARY KEY DEFAULT uuid_generate_v4() NOT NULL,
	"name" text NOT NULL,
	"display_name" text NOT NULL,
	"description" text,
	"parent_role_id" uuid,
	"hierarchy_level" integer DEFAULT 0,
	"is_system_role" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"color_code" text DEFAULT '#6366f1',
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	"updated_by" uuid,
	"display_order" integer DEFAULT 0,
	CONSTRAINT "roles_name_key" UNIQUE("name"),
	CONSTRAINT "valid_role_name" CHECK (name ~ '^[a-z_]+$'::text)
);
--> statement-breakpoint
ALTER TABLE "roles" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "twin_preferences" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"enable_morning_briefing" boolean DEFAULT true,
	"morning_briefing_time" time DEFAULT '09:00:00',
	"enable_proactive_suggestions" boolean DEFAULT true,
	"suggestion_frequency" integer DEFAULT 3,
	"notify_via_ui" boolean DEFAULT true,
	"notify_via_slack" boolean DEFAULT false,
	"notify_via_email" boolean DEFAULT false,
	"use_productivity_data" boolean DEFAULT true,
	"use_activity_data" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "twin_preferences_user_id_key" UNIQUE("user_id")
);
--> statement-breakpoint
ALTER TABLE "twin_preferences" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "content_assets" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"filename" text NOT NULL,
	"storage_path" text NOT NULL,
	"file_type" text NOT NULL,
	"mime_type" text NOT NULL,
	"file_size_bytes" bigint NOT NULL,
	"topic_id" uuid,
	"lesson_id" uuid,
	"cdn_url" text,
	"is_public" boolean DEFAULT false,
	"replaced_by" uuid,
	"is_current" boolean DEFAULT true,
	"uploaded_by" uuid,
	"uploaded_at" timestamp with time zone DEFAULT now(),
	"searchable_content" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "content_assets_storage_path_key" UNIQUE("storage_path"),
	CONSTRAINT "content_assets_file_size_bytes_check" CHECK (file_size_bytes > 0),
	CONSTRAINT "content_assets_file_type_check" CHECK (file_type = ANY (ARRAY['video'::text, 'pdf'::text, 'image'::text, 'document'::text, 'other'::text]))
);
--> statement-breakpoint
ALTER TABLE "content_assets" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "video_progress" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"topic_id" uuid NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"last_position_seconds" integer DEFAULT 0 NOT NULL,
	"total_watch_time_seconds" integer DEFAULT 0 NOT NULL,
	"video_duration_seconds" integer,
	"completion_percentage" integer GENERATED ALWAYS AS (
CASE
    WHEN (video_duration_seconds > 0) THEN LEAST(100, ((last_position_seconds * 100) / video_duration_seconds))
    ELSE 0
END) STORED,
	"video_url" text,
	"video_provider" text,
	"session_count" integer DEFAULT 1 NOT NULL,
	"last_watched_at" timestamp with time zone DEFAULT now(),
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "video_progress_user_id_topic_id_key" UNIQUE("user_id","topic_id"),
	CONSTRAINT "valid_duration" CHECK ((video_duration_seconds IS NULL) OR (video_duration_seconds > 0)),
	CONSTRAINT "valid_position" CHECK (last_position_seconds >= 0),
	CONSTRAINT "valid_provider" CHECK (video_provider = ANY (ARRAY['vimeo'::text, 'youtube'::text, 'direct'::text, 's3'::text])),
	CONSTRAINT "valid_watch_time" CHECK (total_watch_time_seconds >= 0)
);
--> statement-breakpoint
ALTER TABLE "video_progress" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "audit_log_retention_policy" (
	"id" uuid PRIMARY KEY DEFAULT uuid_generate_v4() NOT NULL,
	"table_name" text NOT NULL,
	"retention_months" integer DEFAULT 6 NOT NULL,
	"archive_after_months" integer,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "audit_log_retention_policy_table_name_key" UNIQUE("table_name"),
	CONSTRAINT "valid_archive" CHECK ((archive_after_months IS NULL) OR (archive_after_months < retention_months)),
	CONSTRAINT "valid_retention" CHECK (retention_months > 0)
);
--> statement-breakpoint
ALTER TABLE "audit_log_retention_policy" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "project_timeline" (
	"id" uuid PRIMARY KEY DEFAULT uuid_generate_v4() NOT NULL,
	"session_id" varchar(50) NOT NULL,
	"session_date" timestamp with time zone DEFAULT now() NOT NULL,
	"agent_type" varchar(50),
	"agent_model" varchar(100),
	"duration" varchar(50),
	"conversation_summary" text NOT NULL,
	"user_intent" text,
	"actions_taken" jsonb DEFAULT '{"blocked":[],"completed":[],"inProgress":[]}'::jsonb,
	"files_changed" jsonb DEFAULT '{"created":[],"deleted":[],"modified":[]}'::jsonb,
	"decisions" jsonb DEFAULT '[]'::jsonb,
	"assumptions" jsonb DEFAULT '[]'::jsonb,
	"results" jsonb DEFAULT '{"status":"success","metrics":{},"summary":"","artifacts":[]}'::jsonb,
	"future_notes" jsonb DEFAULT '[]'::jsonb,
	"related_commits" text[],
	"related_prs" text[],
	"related_docs" text[],
	"tags" text[],
	"ai_generated_summary" text,
	"key_learnings" text[],
	"search_vector" "tsvector",
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"deleted_at" timestamp with time zone,
	"is_archived" boolean DEFAULT false,
	"org_id" uuid NOT NULL
);
--> statement-breakpoint
ALTER TABLE "project_timeline" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "session_metadata" (
	"id" uuid PRIMARY KEY DEFAULT uuid_generate_v4() NOT NULL,
	"session_id" varchar(50) NOT NULL,
	"started_at" timestamp with time zone NOT NULL,
	"ended_at" timestamp with time zone,
	"duration" varchar(50),
	"branch" varchar(100),
	"commit_hash" varchar(40),
	"environment" varchar(20),
	"files_modified" integer DEFAULT 0,
	"lines_added" integer DEFAULT 0,
	"lines_removed" integer DEFAULT 0,
	"commands_executed" integer DEFAULT 0,
	"overall_goal" text,
	"successfully_completed" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"org_id" uuid NOT NULL,
	CONSTRAINT "session_metadata_session_id_key" UNIQUE("session_id")
);
--> statement-breakpoint
ALTER TABLE "session_metadata" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "campaign_documents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"campaign_id" uuid NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"document_type" text DEFAULT 'attachment' NOT NULL,
	"category" text,
	"file_url" text,
	"file_name" text,
	"file_size" integer,
	"mime_type" text,
	"usage_count" integer DEFAULT 0,
	"last_used_at" timestamp with time zone,
	"template_variables" jsonb,
	"uploaded_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "campaign_documents" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "event_delivery_log" (
	"id" uuid PRIMARY KEY DEFAULT uuid_generate_v4() NOT NULL,
	"event_id" uuid NOT NULL,
	"subscription_id" uuid NOT NULL,
	"attempted_at" timestamp with time zone DEFAULT now() NOT NULL,
	"status" text NOT NULL,
	"response_code" integer,
	"response_body" text,
	"error_message" text,
	"duration_ms" integer,
	"org_id" uuid NOT NULL,
	CONSTRAINT "valid_delivery_status" CHECK (status = ANY (ARRAY['success'::text, 'failure'::text, 'timeout'::text, 'skipped'::text]))
);
--> statement-breakpoint
ALTER TABLE "event_delivery_log" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "onboarding_checklist" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"completed_profile" boolean DEFAULT false,
	"completed_profile_at" timestamp with time zone,
	"enrolled_first_course" boolean DEFAULT false,
	"enrolled_first_course_at" timestamp with time zone,
	"watched_first_video" boolean DEFAULT false,
	"watched_first_video_at" timestamp with time zone,
	"completed_first_quiz" boolean DEFAULT false,
	"completed_first_quiz_at" timestamp with time zone,
	"joined_community" boolean DEFAULT false,
	"joined_community_at" timestamp with time zone,
	"connected_payment_method" boolean DEFAULT false,
	"connected_payment_method_at" timestamp with time zone,
	"set_learning_goals" boolean DEFAULT false,
	"set_learning_goals_at" timestamp with time zone,
	"completed_orientation" boolean DEFAULT false,
	"completed_orientation_at" timestamp with time zone,
	"total_steps" integer GENERATED ALWAYS AS (8) STORED,
	"completed_steps" integer GENERATED ALWAYS AS ((((((((
CASE
    WHEN completed_profile THEN 1
    ELSE 0
END +
CASE
    WHEN enrolled_first_course THEN 1
    ELSE 0
END) +
CASE
    WHEN watched_first_video THEN 1
    ELSE 0
END) +
CASE
    WHEN completed_first_quiz THEN 1
    ELSE 0
END) +
CASE
    WHEN joined_community THEN 1
    ELSE 0
END) +
CASE
    WHEN connected_payment_method THEN 1
    ELSE 0
END) +
CASE
    WHEN set_learning_goals THEN 1
    ELSE 0
END) +
CASE
    WHEN completed_orientation THEN 1
    ELSE 0
END)) STORED,
	"completion_percentage" integer GENERATED ALWAYS AS (round(((((((((((
CASE
    WHEN completed_profile THEN 1
    ELSE 0
END +
CASE
    WHEN enrolled_first_course THEN 1
    ELSE 0
END) +
CASE
    WHEN watched_first_video THEN 1
    ELSE 0
END) +
CASE
    WHEN completed_first_quiz THEN 1
    ELSE 0
END) +
CASE
    WHEN joined_community THEN 1
    ELSE 0
END) +
CASE
    WHEN connected_payment_method THEN 1
    ELSE 0
END) +
CASE
    WHEN set_learning_goals THEN 1
    ELSE 0
END) +
CASE
    WHEN completed_orientation THEN 1
    ELSE 0
END))::numeric / (8)::numeric) * (100)::numeric))) STORED,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"completed_at" timestamp with time zone,
	CONSTRAINT "unique_checklist_per_user" UNIQUE("user_id")
);
--> statement-breakpoint
ALTER TABLE "onboarding_checklist" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_test" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "courses" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"slug" text NOT NULL,
	"title" text NOT NULL,
	"subtitle" text,
	"description" text NOT NULL,
	"total_modules" integer DEFAULT 0 NOT NULL,
	"total_topics" integer DEFAULT 0 NOT NULL,
	"estimated_duration_weeks" integer NOT NULL,
	"price_monthly" numeric(10, 2),
	"price_one_time" numeric(10, 2),
	"is_included_in_all_access" boolean DEFAULT true,
	"prerequisite_course_ids" uuid[],
	"skill_level" text,
	"thumbnail_url" text,
	"promo_video_url" text,
	"is_published" boolean DEFAULT false,
	"is_featured" boolean DEFAULT false,
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"deleted_at" timestamp with time zone,
	CONSTRAINT "courses_slug_key" UNIQUE("slug"),
	CONSTRAINT "courses_skill_level_check" CHECK (skill_level = ANY (ARRAY['beginner'::text, 'intermediate'::text, 'advanced'::text]))
);
--> statement-breakpoint
CREATE TABLE "course_modules" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"course_id" uuid NOT NULL,
	"slug" text NOT NULL,
	"title" text NOT NULL,
	"description" text,
	"module_number" integer NOT NULL,
	"estimated_duration_hours" integer,
	"prerequisite_module_ids" uuid[],
	"is_published" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "unique_course_module_number" UNIQUE("course_id","module_number"),
	CONSTRAINT "unique_course_module_slug" UNIQUE("course_id","slug")
);
--> statement-breakpoint
CREATE TABLE "module_topics" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"module_id" uuid NOT NULL,
	"slug" text NOT NULL,
	"title" text NOT NULL,
	"description" text,
	"topic_number" integer NOT NULL,
	"estimated_duration_minutes" integer,
	"content_type" text NOT NULL,
	"prerequisite_topic_ids" uuid[],
	"is_published" boolean DEFAULT false,
	"is_required" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "unique_module_topic_number" UNIQUE("module_id","topic_number"),
	CONSTRAINT "unique_module_topic_slug" UNIQUE("module_id","slug"),
	CONSTRAINT "module_topics_content_type_check" CHECK (content_type = ANY (ARRAY['video'::text, 'reading'::text, 'quiz'::text, 'lab'::text, 'project'::text]))
);
--> statement-breakpoint
CREATE TABLE "ai_conversations" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"agent_type" text NOT NULL,
	"messages" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "ai_conversations" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_embeddings" (
	"id" text PRIMARY KEY NOT NULL,
	"content" text NOT NULL,
	"embedding" vector(1536) NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "ai_embeddings" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_patterns" (
	"id" text PRIMARY KEY NOT NULL,
	"user_id" uuid NOT NULL,
	"pattern_type" text NOT NULL,
	"description" text NOT NULL,
	"occurrence_count" integer DEFAULT 1 NOT NULL,
	"first_seen" timestamp with time zone DEFAULT now() NOT NULL,
	"last_seen" timestamp with time zone DEFAULT now() NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "ai_patterns" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_cost_tracking" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid,
	"provider" text NOT NULL,
	"model" text NOT NULL,
	"input_tokens" integer DEFAULT 0 NOT NULL,
	"output_tokens" integer DEFAULT 0 NOT NULL,
	"cost_usd" numeric(10, 6) DEFAULT '0.00' NOT NULL,
	"latency_ms" integer DEFAULT 0 NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "ai_cost_tracking_cost_positive" CHECK (cost_usd >= (0)::numeric),
	CONSTRAINT "ai_cost_tracking_latency_positive" CHECK (latency_ms >= 0),
	CONSTRAINT "ai_cost_tracking_provider_check" CHECK (provider = ANY (ARRAY['openai'::text, 'anthropic'::text])),
	CONSTRAINT "ai_cost_tracking_tokens_positive" CHECK ((input_tokens >= 0) AND (output_tokens >= 0))
);
--> statement-breakpoint
ALTER TABLE "ai_cost_tracking" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_prompts" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"version" integer DEFAULT 1 NOT NULL,
	"category" text NOT NULL,
	"content" text NOT NULL,
	"description" text,
	"variables" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"is_active" boolean DEFAULT true NOT NULL,
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "ai_prompts_name_version_unique" UNIQUE("name","version"),
	CONSTRAINT "ai_prompts_name_check" CHECK (name ~ '^[a-z0-9_]+$'::text),
	CONSTRAINT "ai_prompts_version_positive" CHECK (version > 0)
);
--> statement-breakpoint
ALTER TABLE "ai_prompts" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "student_progress" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"student_id" uuid NOT NULL,
	"current_module" text NOT NULL,
	"completed_modules" text[] DEFAULT '{""}' NOT NULL,
	"struggle_areas" text[] DEFAULT '{""}' NOT NULL,
	"mastery_score" integer DEFAULT 0 NOT NULL,
	"total_interactions" integer DEFAULT 0 NOT NULL,
	"helpful_interactions" integer DEFAULT 0 NOT NULL,
	"last_activity_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "student_progress_student_id_key" UNIQUE("student_id"),
	CONSTRAINT "student_progress_mastery_score_check" CHECK ((mastery_score >= 0) AND (mastery_score <= 100))
);
--> statement-breakpoint
ALTER TABLE "student_progress" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_agent_interactions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid,
	"agent_name" text NOT NULL,
	"interaction_type" text NOT NULL,
	"input" text,
	"output" text,
	"model_used" text,
	"tokens_used" integer DEFAULT 0,
	"cost_usd" numeric(10, 6) DEFAULT '0.00',
	"latency_ms" integer DEFAULT 0,
	"success" boolean DEFAULT true NOT NULL,
	"error_message" text,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "ai_agent_interactions_cost_positive" CHECK (cost_usd >= (0)::numeric),
	CONSTRAINT "ai_agent_interactions_latency_positive" CHECK (latency_ms >= 0),
	CONSTRAINT "ai_agent_interactions_tokens_positive" CHECK (tokens_used >= 0)
);
--> statement-breakpoint
ALTER TABLE "ai_agent_interactions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "guru_interactions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"student_id" uuid NOT NULL,
	"agent_type" text NOT NULL,
	"conversation_id" text,
	"input" jsonb NOT NULL,
	"output" jsonb NOT NULL,
	"was_helpful" boolean,
	"user_feedback" text,
	"model_used" text NOT NULL,
	"tokens_used" integer DEFAULT 0 NOT NULL,
	"cost_usd" numeric(10, 6) DEFAULT '0' NOT NULL,
	"latency_ms" integer DEFAULT 0 NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "guru_interactions_agent_type_check" CHECK (agent_type = ANY (ARRAY['code_mentor'::text, 'resume_builder'::text, 'project_planner'::text, 'interview_coach'::text])),
	CONSTRAINT "guru_interactions_cost_check" CHECK (cost_usd >= (0)::numeric),
	CONSTRAINT "guru_interactions_tokens_check" CHECK (tokens_used >= 0)
);
--> statement-breakpoint
ALTER TABLE "guru_interactions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "resume_versions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"student_id" uuid NOT NULL,
	"version" integer DEFAULT 1 NOT NULL,
	"format" text NOT NULL,
	"content" jsonb NOT NULL,
	"ats_score" integer DEFAULT 0 NOT NULL,
	"keyword_matches" text[] DEFAULT '{""}' NOT NULL,
	"target_job_description" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "resume_versions_student_id_version_key" UNIQUE("student_id","version"),
	CONSTRAINT "resume_versions_ats_score_check" CHECK ((ats_score >= 0) AND (ats_score <= 100)),
	CONSTRAINT "resume_versions_format_check" CHECK (format = ANY (ARRAY['pdf'::text, 'docx'::text, 'linkedin'::text, 'json'::text]))
);
--> statement-breakpoint
ALTER TABLE "resume_versions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "interview_sessions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"student_id" uuid NOT NULL,
	"interview_type" text NOT NULL,
	"guidewire_module" text,
	"questions" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"average_score" numeric(4, 2) DEFAULT '0' NOT NULL,
	"started_at" timestamp with time zone DEFAULT now() NOT NULL,
	"completed_at" timestamp with time zone,
	"duration" integer,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "interview_sessions_average_score_check" CHECK ((average_score >= (0)::numeric) AND (average_score <= (10)::numeric)),
	CONSTRAINT "interview_sessions_interview_type_check" CHECK (interview_type = ANY (ARRAY['technical'::text, 'behavioral'::text, 'mixed'::text]))
);
--> statement-breakpoint
ALTER TABLE "interview_sessions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "employee_screenshots" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"filename" text NOT NULL,
	"file_size" integer NOT NULL,
	"storage_bucket" text DEFAULT 'employee-screenshots',
	"captured_at" timestamp with time zone NOT NULL,
	"machine_name" text,
	"os_type" text,
	"active_window_title" text,
	"analyzed" boolean DEFAULT false,
	"activity_category" text,
	"confidence" double precision,
	"analyzed_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "employee_screenshots" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "topic_lessons" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"topic_id" uuid NOT NULL,
	"title" text NOT NULL,
	"lesson_number" integer NOT NULL,
	"content_type" text NOT NULL,
	"content_url" text,
	"content_markdown" text,
	"duration_seconds" integer,
	"lab_environment_template" text,
	"lab_instructions_url" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "unique_topic_lesson_number" UNIQUE("topic_id","lesson_number"),
	CONSTRAINT "topic_lessons_content_type_check" CHECK (content_type = ANY (ARRAY['video'::text, 'markdown'::text, 'pdf'::text, 'quiz'::text, 'lab'::text, 'external_link'::text]))
);
--> statement-breakpoint
CREATE TABLE "topic_completions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"course_id" uuid NOT NULL,
	"module_id" uuid NOT NULL,
	"topic_id" uuid NOT NULL,
	"completed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"time_spent_seconds" integer DEFAULT 0,
	"xp_earned" integer DEFAULT 0 NOT NULL,
	"completion_source" text DEFAULT 'manual',
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "unique_user_topic_completion" UNIQUE("user_id","topic_id"),
	CONSTRAINT "topic_completions_completion_source_check" CHECK (completion_source = ANY (ARRAY['manual'::text, 'auto'::text, 'admin_override'::text])),
	CONSTRAINT "valid_time_spent" CHECK (time_spent_seconds >= 0),
	CONSTRAINT "valid_xp" CHECK (xp_earned >= 0)
);
--> statement-breakpoint
ALTER TABLE "topic_completions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "xp_transactions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"amount" integer NOT NULL,
	"transaction_type" text NOT NULL,
	"reference_type" text,
	"reference_id" uuid,
	"description" text,
	"awarded_at" timestamp with time zone DEFAULT now() NOT NULL,
	"awarded_by" uuid,
	"created_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "xp_transactions_reference_type_check" CHECK (reference_type = ANY (ARRAY['topic_completion'::text, 'enrollment'::text, 'achievement'::text, 'admin_action'::text])),
	CONSTRAINT "xp_transactions_transaction_type_check" CHECK (transaction_type = ANY (ARRAY['topic_completion'::text, 'quiz_passed'::text, 'lab_completed'::text, 'project_submitted'::text, 'bonus_achievement'::text, 'penalty'::text, 'adjustment'::text]))
);
--> statement-breakpoint
ALTER TABLE "xp_transactions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "reading_progress" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"topic_id" uuid NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"scroll_percentage" integer DEFAULT 0 NOT NULL,
	"last_scroll_position" integer DEFAULT 0,
	"total_reading_time_seconds" integer DEFAULT 0 NOT NULL,
	"current_page" integer,
	"total_pages" integer,
	"content_type" text,
	"content_length" integer,
	"session_count" integer DEFAULT 1 NOT NULL,
	"last_read_at" timestamp with time zone DEFAULT now(),
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "reading_progress_user_id_topic_id_key" UNIQUE("user_id","topic_id"),
	CONSTRAINT "valid_content_type" CHECK (content_type = ANY (ARRAY['markdown'::text, 'pdf'::text, 'html'::text])),
	CONSTRAINT "valid_page" CHECK ((current_page IS NULL) OR (current_page > 0)),
	CONSTRAINT "valid_reading_time" CHECK (total_reading_time_seconds >= 0),
	CONSTRAINT "valid_scroll_percentage" CHECK ((scroll_percentage >= 0) AND (scroll_percentage <= 100)),
	CONSTRAINT "valid_scroll_position" CHECK (last_scroll_position >= 0)
);
--> statement-breakpoint
ALTER TABLE "reading_progress" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "lab_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"github_template_url" text NOT NULL,
	"difficulty_level" text,
	"time_limit_minutes" integer DEFAULT 120,
	"auto_grading_enabled" boolean DEFAULT false,
	"github_actions_workflow" text,
	"required_skills" text[],
	"estimated_duration_minutes" integer,
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"is_active" boolean DEFAULT true,
	CONSTRAINT "lab_templates_github_template_url_key" UNIQUE("github_template_url"),
	CONSTRAINT "lab_templates_difficulty_level_check" CHECK (difficulty_level = ANY (ARRAY['beginner'::text, 'intermediate'::text, 'advanced'::text]))
);
--> statement-breakpoint
ALTER TABLE "lab_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "lab_instances" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"topic_id" uuid NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"lab_template_id" uuid,
	"forked_repo_url" text NOT NULL,
	"forked_repo_name" text,
	"original_template_url" text NOT NULL,
	"status" text DEFAULT 'active',
	"started_at" timestamp with time zone DEFAULT now(),
	"expires_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"time_spent_seconds" integer DEFAULT 0,
	"last_activity_at" timestamp with time zone DEFAULT now(),
	"github_username" text,
	"provisioning_metadata" jsonb,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "lab_instances_status_check" CHECK (status = ANY (ARRAY['active'::text, 'submitted'::text, 'expired'::text, 'abandoned'::text, 'completed'::text])),
	CONSTRAINT "valid_time_spent" CHECK (time_spent_seconds >= 0)
);
--> statement-breakpoint
ALTER TABLE "lab_instances" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "lab_submissions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"topic_id" uuid NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"lab_instance_id" uuid NOT NULL,
	"repository_url" text NOT NULL,
	"commit_sha" text,
	"branch_name" text DEFAULT 'main',
	"submitted_at" timestamp with time zone DEFAULT now(),
	"status" text DEFAULT 'pending',
	"auto_grade_result" jsonb,
	"auto_grade_score" numeric(5, 2),
	"auto_graded_at" timestamp with time zone,
	"manual_grade_score" numeric(5, 2),
	"rubric_scores" jsonb,
	"graded_by" uuid,
	"graded_at" timestamp with time zone,
	"feedback" text,
	"final_score" numeric(5, 2),
	"passed" boolean,
	"attempt_number" integer DEFAULT 1,
	"previous_submission_id" uuid,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "lab_submissions_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'grading'::text, 'auto_graded'::text, 'manual_review'::text, 'passed'::text, 'failed'::text])),
	CONSTRAINT "valid_auto_score" CHECK ((auto_grade_score IS NULL) OR ((auto_grade_score >= (0)::numeric) AND (auto_grade_score <= (100)::numeric))),
	CONSTRAINT "valid_final_score" CHECK ((final_score IS NULL) OR ((final_score >= (0)::numeric) AND (final_score <= (100)::numeric))),
	CONSTRAINT "valid_manual_score" CHECK ((manual_grade_score IS NULL) OR ((manual_grade_score >= (0)::numeric) AND (manual_grade_score <= (100)::numeric)))
);
--> statement-breakpoint
ALTER TABLE "lab_submissions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "capstone_submissions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"course_id" uuid NOT NULL,
	"repository_url" text NOT NULL,
	"demo_video_url" text,
	"description" text,
	"submitted_at" timestamp with time zone DEFAULT now(),
	"revision_count" integer DEFAULT 0,
	"status" text DEFAULT 'pending',
	"graded_by" uuid,
	"graded_at" timestamp with time zone,
	"grade" numeric(5, 2),
	"feedback" text,
	"rubric_scores" jsonb,
	"peer_review_count" integer DEFAULT 0,
	"avg_peer_rating" numeric(3, 2),
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "capstone_submissions_enrollment_id_revision_count_key" UNIQUE("enrollment_id","revision_count"),
	CONSTRAINT "capstone_submissions_avg_peer_rating_check" CHECK ((avg_peer_rating >= (0)::numeric) AND (avg_peer_rating <= (5)::numeric)),
	CONSTRAINT "capstone_submissions_grade_check" CHECK ((grade >= (0)::numeric) AND (grade <= (100)::numeric)),
	CONSTRAINT "capstone_submissions_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'peer_review'::text, 'trainer_review'::text, 'passed'::text, 'failed'::text, 'revision_requested'::text]))
);
--> statement-breakpoint
ALTER TABLE "capstone_submissions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "twin_events" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"source_user_id" uuid NOT NULL,
	"source_role" text NOT NULL,
	"target_role" text,
	"event_type" text NOT NULL,
	"payload" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"priority" text DEFAULT 'medium' NOT NULL,
	"processed" boolean DEFAULT false NOT NULL,
	"processed_at" timestamp with time zone,
	"processed_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"expires_at" timestamp with time zone DEFAULT (now() + '7 days'::interval),
	CONSTRAINT "twin_events_event_type_check" CHECK (event_type = ANY (ARRAY['placement_complete'::text, 'bench_ending'::text, 'training_graduate'::text, 'deal_closed'::text, 'escalation'::text, 'approval_needed'::text, 'milestone_reached'::text, 'cross_sell_opportunity'::text, 'custom'::text])),
	CONSTRAINT "twin_events_priority_check" CHECK (priority = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text, 'critical'::text])),
	CONSTRAINT "twin_events_source_role_check" CHECK (source_role = ANY (ARRAY['ceo'::text, 'admin'::text, 'recruiter'::text, 'bench_sales'::text, 'talent_acquisition'::text, 'hr'::text, 'immigration'::text, 'trainer'::text])),
	CONSTRAINT "twin_events_target_role_check" CHECK ((target_role IS NULL) OR (target_role = ANY (ARRAY['ceo'::text, 'admin'::text, 'recruiter'::text, 'bench_sales'::text, 'talent_acquisition'::text, 'hr'::text, 'immigration'::text, 'trainer'::text])))
);
--> statement-breakpoint
ALTER TABLE "twin_events" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "twin_conversations" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"initiator_user_id" uuid,
	"initiator_role" text NOT NULL,
	"responder_role" text NOT NULL,
	"question" text NOT NULL,
	"response" text,
	"tokens_used" integer,
	"cost_usd" numeric(10, 6),
	"latency_ms" integer,
	"model_used" text DEFAULT 'gpt-4o-mini',
	"context" jsonb DEFAULT '{}'::jsonb,
	"status" text DEFAULT 'completed',
	"error_message" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "twin_conversations_initiator_role_check" CHECK (initiator_role = ANY (ARRAY['ceo'::text, 'admin'::text, 'recruiter'::text, 'bench_sales'::text, 'talent_acquisition'::text, 'hr'::text, 'immigration'::text, 'trainer'::text, 'organization'::text])),
	CONSTRAINT "twin_conversations_responder_role_check" CHECK (responder_role = ANY (ARRAY['ceo'::text, 'admin'::text, 'recruiter'::text, 'bench_sales'::text, 'talent_acquisition'::text, 'hr'::text, 'immigration'::text, 'trainer'::text, 'organization'::text])),
	CONSTRAINT "twin_conversations_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'completed'::text, 'failed'::text]))
);
--> statement-breakpoint
ALTER TABLE "twin_conversations" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "quiz_questions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"topic_id" uuid,
	"created_by" uuid NOT NULL,
	"question_text" text NOT NULL,
	"question_type" text NOT NULL,
	"options" jsonb NOT NULL,
	"correct_answers" jsonb NOT NULL,
	"explanation" text,
	"difficulty" text DEFAULT 'medium' NOT NULL,
	"points" integer DEFAULT 1 NOT NULL,
	"code_language" text,
	"is_public" boolean DEFAULT false NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "quiz_questions_difficulty_check" CHECK (difficulty = ANY (ARRAY['easy'::text, 'medium'::text, 'hard'::text])),
	CONSTRAINT "quiz_questions_points_check" CHECK (points > 0),
	CONSTRAINT "quiz_questions_question_text_check" CHECK (length(question_text) >= 10),
	CONSTRAINT "quiz_questions_question_type_check" CHECK (question_type = ANY (ARRAY['multiple_choice_single'::text, 'multiple_choice_multiple'::text, 'true_false'::text, 'code'::text]))
);
--> statement-breakpoint
ALTER TABLE "quiz_questions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "quiz_settings" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"topic_id" uuid NOT NULL,
	"randomize_questions" boolean DEFAULT false NOT NULL,
	"randomize_options" boolean DEFAULT false NOT NULL,
	"passing_threshold" integer DEFAULT 70 NOT NULL,
	"show_correct_answers" boolean DEFAULT true NOT NULL,
	"time_limit_minutes" integer,
	"max_attempts" integer,
	"allow_review" boolean DEFAULT true NOT NULL,
	"xp_reward" integer DEFAULT 10 NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "quiz_settings_topic_id_key" UNIQUE("topic_id"),
	CONSTRAINT "quiz_settings_max_attempts_check" CHECK (max_attempts > 0),
	CONSTRAINT "quiz_settings_passing_threshold_check" CHECK ((passing_threshold >= 0) AND (passing_threshold <= 100)),
	CONSTRAINT "quiz_settings_time_limit_minutes_check" CHECK (time_limit_minutes > 0),
	CONSTRAINT "quiz_settings_xp_reward_check" CHECK (xp_reward >= 0)
);
--> statement-breakpoint
ALTER TABLE "quiz_settings" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "org_context_cache" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"context_type" text NOT NULL,
	"data" jsonb NOT NULL,
	"expires_at" timestamp with time zone DEFAULT (now() + '24:00:00'::interval) NOT NULL,
	"refresh_triggered_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "org_context_cache_org_id_context_type_key" UNIQUE("org_id","context_type"),
	CONSTRAINT "org_context_cache_context_type_check" CHECK (context_type = ANY (ARRAY['priorities'::text, 'metrics'::text, 'pillar_health'::text, 'cross_pollination'::text, 'announcements'::text, 'goals'::text]))
);
--> statement-breakpoint
ALTER TABLE "org_context_cache" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "org_standups" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"standup_date" date DEFAULT CURRENT_DATE NOT NULL,
	"generated_by" text DEFAULT 'organization_twin' NOT NULL,
	"report" jsonb NOT NULL,
	"pillar_summaries" jsonb DEFAULT '{}'::jsonb,
	"cross_pollination_insights" jsonb DEFAULT '[]'::jsonb,
	"escalations" jsonb DEFAULT '[]'::jsonb,
	"blockers" jsonb DEFAULT '[]'::jsonb,
	"organism_health_score" numeric(5, 2),
	"tokens_used" integer,
	"cost_usd" numeric(10, 6),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "org_standups_org_id_standup_date_key" UNIQUE("org_id","standup_date")
);
--> statement-breakpoint
ALTER TABLE "org_standups" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "peer_reviews" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"submission_id" uuid NOT NULL,
	"reviewer_id" uuid NOT NULL,
	"rating" integer NOT NULL,
	"comments" text NOT NULL,
	"strengths" text,
	"improvements" text,
	"reviewed_at" timestamp with time zone DEFAULT now(),
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "peer_reviews_submission_id_reviewer_id_key" UNIQUE("submission_id","reviewer_id"),
	CONSTRAINT "peer_reviews_rating_check" CHECK ((rating >= 1) AND (rating <= 5))
);
--> statement-breakpoint
ALTER TABLE "peer_reviews" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_mentor_chats" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"topic_id" uuid,
	"course_id" uuid,
	"question" text NOT NULL,
	"response" text NOT NULL,
	"conversation_context" jsonb DEFAULT '[]'::jsonb,
	"tokens_used" integer DEFAULT 0 NOT NULL,
	"response_time_ms" integer DEFAULT 0 NOT NULL,
	"model" text DEFAULT 'gpt-4o-mini' NOT NULL,
	"cost_usd" numeric(10, 6) DEFAULT '0',
	"student_rating" integer,
	"student_feedback" text,
	"flagged_for_review" boolean DEFAULT false,
	"escalated_to_trainer" boolean DEFAULT false,
	"escalation_reason" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"rated_at" timestamp with time zone,
	"escalated_at" timestamp with time zone,
	"prompt_variant_id" uuid,
	"question_hash" text GENERATED ALWAYS AS (md5(lower(TRIM(BOTH FROM question)))) STORED,
	CONSTRAINT "ai_mentor_chats_student_rating_check" CHECK ((student_rating >= 1) AND (student_rating <= 5))
);
--> statement-breakpoint
ALTER TABLE "ai_mentor_chats" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "sequence_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"channel" text NOT NULL,
	"steps" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"settings" jsonb DEFAULT '{}'::jsonb,
	"is_active" boolean DEFAULT true,
	"usage_count" integer DEFAULT 0,
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"deleted_at" timestamp with time zone,
	CONSTRAINT "sequence_templates_channel_check" CHECK (channel = ANY (ARRAY['email'::text, 'linkedin'::text, 'phone'::text, 'sms'::text])),
	CONSTRAINT "sequence_templates_name_length" CHECK (char_length(name) <= 255)
);
--> statement-breakpoint
ALTER TABLE "sequence_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_mentor_rate_limits" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"hourly_count" integer DEFAULT 0 NOT NULL,
	"daily_count" integer DEFAULT 0 NOT NULL,
	"monthly_count" integer DEFAULT 0 NOT NULL,
	"hourly_reset_at" timestamp with time zone DEFAULT (now() + '01:00:00'::interval) NOT NULL,
	"daily_reset_at" timestamp with time zone DEFAULT (now() + '1 day'::interval) NOT NULL,
	"monthly_reset_at" timestamp with time zone DEFAULT (now() + '1 mon'::interval) NOT NULL,
	"monthly_cost_usd" numeric(10, 4) DEFAULT '0',
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "ai_mentor_rate_limits_user_id_key" UNIQUE("user_id")
);
--> statement-breakpoint
ALTER TABLE "ai_mentor_rate_limits" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_mentor_sessions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"topic_id" uuid,
	"course_id" uuid,
	"title" text,
	"message_count" integer DEFAULT 0 NOT NULL,
	"total_tokens" integer DEFAULT 0 NOT NULL,
	"total_cost_usd" numeric(10, 6) DEFAULT '0',
	"started_at" timestamp with time zone DEFAULT now(),
	"last_message_at" timestamp with time zone DEFAULT now(),
	"ended_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "ai_mentor_sessions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "permission_overrides" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"permission_id" uuid NOT NULL,
	"granted" boolean NOT NULL,
	"scope_override" varchar(50),
	"reason" text NOT NULL,
	"expires_at" timestamp with time zone,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"revoked_at" timestamp with time zone,
	"revoked_by" uuid,
	CONSTRAINT "permission_overrides_valid_scope" CHECK ((scope_override IS NULL) OR ((scope_override)::text = ANY ((ARRAY['own'::character varying, 'own_raci'::character varying, 'own_ra'::character varying, 'team'::character varying, 'region'::character varying, 'org'::character varying, 'draft_only'::character varying])::text[])))
);
--> statement-breakpoint
ALTER TABLE "permission_overrides" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "campaign_sequences" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"campaign_id" uuid NOT NULL,
	"sequence_template_id" uuid NOT NULL,
	"org_id" uuid NOT NULL,
	"is_active" boolean DEFAULT true,
	"enrolled_count" integer DEFAULT 0,
	"completed_count" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "campaign_sequences_unique" UNIQUE("campaign_id","sequence_template_id")
);
--> statement-breakpoint
ALTER TABLE "campaign_sequences" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "api_tokens" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" varchar(100) NOT NULL,
	"token_hash" varchar(255) NOT NULL,
	"token_prefix" varchar(10) NOT NULL,
	"scopes" text[] DEFAULT '{""}' NOT NULL,
	"expires_at" timestamp with time zone,
	"last_used_at" timestamp with time zone,
	"last_used_ip" "inet",
	"usage_count" integer DEFAULT 0,
	"rate_limit_per_hour" integer DEFAULT 1000,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"revoked_at" timestamp with time zone,
	"revoked_by" uuid
);
--> statement-breakpoint
ALTER TABLE "api_tokens" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "bulk_update_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"update_type" varchar(50) NOT NULL,
	"affected_user_ids" uuid[] NOT NULL,
	"changes" jsonb NOT NULL,
	"previous_state" jsonb NOT NULL,
	"reason" text NOT NULL,
	"applied_by" uuid NOT NULL,
	"applied_at" timestamp with time zone DEFAULT now() NOT NULL,
	"rolled_back_at" timestamp with time zone,
	"rolled_back_by" uuid,
	CONSTRAINT "bulk_update_history_valid_type" CHECK ((update_type)::text = ANY ((ARRAY['enable_feature'::character varying, 'disable_feature'::character varying, 'change_scope'::character varying, 'add_permission'::character varying, 'remove_permission'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "bulk_update_history" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "role_permissions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"role_id" uuid NOT NULL,
	"permission_id" uuid NOT NULL,
	"scope_condition" varchar(50) DEFAULT 'own',
	"granted" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"granted_by" uuid,
	CONSTRAINT "role_permissions_role_id_permission_id_key" UNIQUE("role_id","permission_id"),
	CONSTRAINT "role_permissions_valid_scope" CHECK ((scope_condition)::text = ANY ((ARRAY['own'::character varying, 'own_raci'::character varying, 'own_ra'::character varying, 'team'::character varying, 'region'::character varying, 'org'::character varying, 'draft_only'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "role_permissions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "permissions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"code" varchar(100) NOT NULL,
	"name" varchar(100) NOT NULL,
	"description" text,
	"object_type" varchar(50) NOT NULL,
	"action" varchar(20) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "permissions_code_key" UNIQUE("code"),
	CONSTRAINT "permissions_valid_action" CHECK ((action)::text = ANY ((ARRAY['create'::character varying, 'read'::character varying, 'update'::character varying, 'delete'::character varying, 'approve'::character varying, 'reject'::character varying, 'export'::character varying, 'import'::character varying, 'manage'::character varying, 'assign'::character varying, 'send'::character varying, 'issue'::character varying, 'view'::character varying, 'use'::character varying, 'access'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "permissions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_question_patterns" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"pattern_hash" text NOT NULL,
	"canonical_question" text NOT NULL,
	"category" text,
	"topic_id" uuid,
	"occurrence_count" integer DEFAULT 1,
	"unique_students" integer DEFAULT 1,
	"avg_response_quality" numeric(3, 2),
	"escalation_rate" numeric(5, 4),
	"first_seen" timestamp with time zone DEFAULT now(),
	"last_seen" timestamp with time zone DEFAULT now(),
	CONSTRAINT "ai_question_patterns_pattern_hash_key" UNIQUE("pattern_hash")
);
--> statement-breakpoint
ALTER TABLE "ai_question_patterns" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "feature_flag_roles" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"feature_flag_id" uuid NOT NULL,
	"role_id" uuid NOT NULL,
	"enabled" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "feature_flag_roles_feature_flag_id_role_id_key" UNIQUE("feature_flag_id","role_id")
);
--> statement-breakpoint
ALTER TABLE "feature_flag_roles" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_prompt_variants" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"variant_name" text NOT NULL,
	"system_prompt" text NOT NULL,
	"is_active" boolean DEFAULT false,
	"traffic_percentage" integer DEFAULT 0,
	"total_uses" integer DEFAULT 0,
	"avg_rating" numeric(3, 2),
	"avg_response_time_ms" integer,
	"avg_tokens_used" integer,
	"escalation_count" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now(),
	"deactivated_at" timestamp with time zone,
	CONSTRAINT "ai_prompt_variants_variant_name_key" UNIQUE("variant_name"),
	CONSTRAINT "ai_prompt_variants_traffic_percentage_check" CHECK ((traffic_percentage >= 0) AND (traffic_percentage <= 100))
);
--> statement-breakpoint
ALTER TABLE "ai_prompt_variants" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "badges" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"slug" text NOT NULL,
	"name" text NOT NULL,
	"description" text NOT NULL,
	"icon_url" text,
	"xp_reward" integer DEFAULT 50,
	"rarity" text NOT NULL,
	"display_order" integer DEFAULT 0,
	"is_hidden" boolean DEFAULT false,
	"trigger_type" text NOT NULL,
	"trigger_threshold" integer DEFAULT 1,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "badges_slug_key" UNIQUE("slug"),
	CONSTRAINT "badges_rarity_check" CHECK (rarity = ANY (ARRAY['common'::text, 'rare'::text, 'epic'::text, 'legendary'::text])),
	CONSTRAINT "badges_trigger_type_check" CHECK (trigger_type = ANY (ARRAY['first_video'::text, 'first_quiz'::text, 'first_lab'::text, 'quiz_streak'::text, 'perfect_quiz'::text, 'lab_completion'::text, 'course_completion'::text, 'ai_mentor_usage'::text, 'help_others'::text, 'speed_demon'::text, 'night_owl'::text, 'early_bird'::text, 'consistency'::text, 'achievement_hunter'::text])),
	CONSTRAINT "badges_xp_reward_check" CHECK (xp_reward >= 0)
);
--> statement-breakpoint
ALTER TABLE "badges" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "user_badges" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"badge_id" uuid NOT NULL,
	"earned_at" timestamp with time zone DEFAULT now(),
	"progress_value" integer DEFAULT 0,
	"is_new" boolean DEFAULT true,
	"viewed_at" timestamp with time zone,
	"shared_at" timestamp with time zone,
	"share_count" integer DEFAULT 0,
	CONSTRAINT "user_badges_user_id_badge_id_key" UNIQUE("user_id","badge_id")
);
--> statement-breakpoint
ALTER TABLE "user_badges" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "system_settings" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"key" varchar(100) NOT NULL,
	"value" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"category" varchar(50) NOT NULL,
	"data_type" varchar(20) DEFAULT 'string' NOT NULL,
	"description" text,
	"default_value" jsonb,
	"constraints" jsonb,
	"is_sensitive" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"updated_by" uuid,
	CONSTRAINT "system_settings_key_key" UNIQUE("key")
);
--> statement-breakpoint
CREATE TABLE "workflow_states" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"workflow_id" uuid NOT NULL,
	"name" text NOT NULL,
	"display_name" text NOT NULL,
	"description" text,
	"state_order" integer NOT NULL,
	"is_initial" boolean DEFAULT false NOT NULL,
	"is_terminal" boolean DEFAULT false NOT NULL,
	"actions" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "unique_state_name_per_workflow" UNIQUE("workflow_id","name"),
	CONSTRAINT "unique_state_order_per_workflow" UNIQUE("workflow_id","state_order")
);
--> statement-breakpoint
ALTER TABLE "workflow_states" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workflow_transitions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"workflow_id" uuid NOT NULL,
	"from_state_id" uuid NOT NULL,
	"to_state_id" uuid NOT NULL,
	"action" text NOT NULL,
	"display_name" text NOT NULL,
	"required_permission" text,
	"conditions" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"auto_transition" boolean DEFAULT false NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "unique_transition_action" UNIQUE("workflow_id","from_state_id","action"),
	CONSTRAINT "no_self_transition" CHECK (from_state_id <> to_state_id)
);
--> statement-breakpoint
ALTER TABLE "workflow_transitions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workflow_instances" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"workflow_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"current_state_id" uuid NOT NULL,
	"started_at" timestamp with time zone DEFAULT now() NOT NULL,
	"completed_at" timestamp with time zone,
	"cancelled_at" timestamp with time zone,
	"status" text DEFAULT 'active' NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"version" integer DEFAULT 0 NOT NULL,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "unique_entity_workflow" UNIQUE("org_id","workflow_id","entity_type","entity_id"),
	CONSTRAINT "valid_status" CHECK (status = ANY (ARRAY['active'::text, 'completed'::text, 'cancelled'::text, 'failed'::text]))
);
--> statement-breakpoint
ALTER TABLE "workflow_instances" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workflow_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"workflow_instance_id" uuid NOT NULL,
	"from_state_id" uuid,
	"to_state_id" uuid NOT NULL,
	"action" text NOT NULL,
	"performed_by" uuid NOT NULL,
	"notes" text,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "workflow_history" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "file_uploads" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"bucket" text NOT NULL,
	"file_path" text NOT NULL,
	"file_name" text NOT NULL,
	"file_size" integer NOT NULL,
	"mime_type" text NOT NULL,
	"entity_type" text,
	"entity_id" uuid,
	"uploaded_by" uuid NOT NULL,
	"uploaded_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	CONSTRAINT "unique_file_path" UNIQUE("bucket","file_path"),
	CONSTRAINT "valid_bucket" CHECK (bucket = ANY (ARRAY['avatars'::text, 'resumes'::text, 'documents'::text, 'attachments'::text, 'course-materials'::text]))
);
--> statement-breakpoint
ALTER TABLE "file_uploads" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "document_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"template_type" text NOT NULL,
	"category" text NOT NULL,
	"template_content" text NOT NULL,
	"variables" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"sample_data" jsonb DEFAULT '{}'::jsonb,
	"is_active" boolean DEFAULT true NOT NULL,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "unique_template_name_per_org" UNIQUE("org_id","name"),
	CONSTRAINT "valid_template_type" CHECK (template_type = ANY (ARRAY['pdf'::text, 'docx'::text, 'html'::text]))
);
--> statement-breakpoint
ALTER TABLE "document_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "generated_documents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"template_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"file_path" text NOT NULL,
	"file_name" text NOT NULL,
	"file_size" integer NOT NULL,
	"mime_type" text NOT NULL,
	"generated_by" uuid NOT NULL,
	"generated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	CONSTRAINT "valid_mime_type" CHECK (mime_type = ANY (ARRAY['application/pdf'::text, 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'::text]))
);
--> statement-breakpoint
ALTER TABLE "generated_documents" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workflows" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"entity_type" text NOT NULL,
	"initial_state_id" uuid,
	"version" integer DEFAULT 1 NOT NULL,
	"is_active" boolean DEFAULT true NOT NULL,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"definition" jsonb DEFAULT '{}'::jsonb,
	CONSTRAINT "unique_workflow_name_per_org" UNIQUE("org_id","name","version")
);
--> statement-breakpoint
ALTER TABLE "workflows" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "email_logs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"template_id" uuid,
	"to_email" text NOT NULL,
	"cc_email" text[],
	"bcc_email" text[],
	"subject" text NOT NULL,
	"status" text DEFAULT 'pending' NOT NULL,
	"resend_id" text,
	"error_message" text,
	"sent_at" timestamp with time zone,
	"opened_at" timestamp with time zone,
	"clicked_at" timestamp with time zone,
	"metadata" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "valid_email_status" CHECK (status = ANY (ARRAY['pending'::text, 'sent'::text, 'failed'::text, 'bounced'::text, 'opened'::text, 'clicked'::text]))
);
--> statement-breakpoint
ALTER TABLE "email_logs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "background_jobs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"job_type" text NOT NULL,
	"payload" jsonb NOT NULL,
	"status" text DEFAULT 'pending' NOT NULL,
	"attempts" integer DEFAULT 0 NOT NULL,
	"max_attempts" integer DEFAULT 3 NOT NULL,
	"error_message" text,
	"result" jsonb,
	"priority" integer DEFAULT 5 NOT NULL,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "valid_job_status" CHECK (status = ANY (ARRAY['pending'::text, 'processing'::text, 'completed'::text, 'failed'::text])),
	CONSTRAINT "valid_job_type" CHECK (job_type = ANY (ARRAY['generate_document'::text, 'send_email'::text, 'send_bulk_email'::text, 'import_data'::text, 'export_data'::text])),
	CONSTRAINT "valid_priority" CHECK ((priority >= 1) AND (priority <= 10))
);
--> statement-breakpoint
ALTER TABLE "background_jobs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "pricing_plans" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"slug" text NOT NULL,
	"plan_type" text NOT NULL,
	"price_monthly" numeric(10, 2),
	"price_annual" numeric(10, 2),
	"price_one_time" numeric(10, 2),
	"stripe_price_id_monthly" text,
	"stripe_price_id_annual" text,
	"stripe_price_id_one_time" text,
	"stripe_product_id" text,
	"features" jsonb DEFAULT '[]'::jsonb,
	"max_courses" integer,
	"max_users" integer,
	"display_order" integer DEFAULT 0,
	"is_featured" boolean DEFAULT false,
	"badge_text" text,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"deleted_at" timestamp with time zone,
	CONSTRAINT "pricing_plans_name_key" UNIQUE("name"),
	CONSTRAINT "pricing_plans_slug_key" UNIQUE("slug"),
	CONSTRAINT "pricing_plans_plan_type_check" CHECK (plan_type = ANY (ARRAY['per_course'::text, 'all_access'::text, 'team'::text, 'enterprise'::text]))
);
--> statement-breakpoint
ALTER TABLE "pricing_plans" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "discount_codes" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"code" text NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"discount_type" text NOT NULL,
	"discount_value" numeric(10, 2) NOT NULL,
	"max_uses" integer,
	"uses_count" integer DEFAULT 0,
	"max_uses_per_user" integer DEFAULT 1,
	"valid_from" timestamp with time zone DEFAULT now(),
	"valid_until" timestamp with time zone,
	"applicable_plan_types" text[],
	"applicable_course_ids" uuid[],
	"minimum_purchase_amount" numeric(10, 2),
	"stripe_coupon_id" text,
	"stripe_promotion_code_id" text,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "discount_codes_code_key" UNIQUE("code"),
	CONSTRAINT "discount_codes_discount_type_check" CHECK (discount_type = ANY (ARRAY['percentage'::text, 'fixed'::text])),
	CONSTRAINT "discount_codes_discount_value_check" CHECK (discount_value > (0)::numeric),
	CONSTRAINT "discount_codes_uses_count_check" CHECK (uses_count >= 0)
);
--> statement-breakpoint
ALTER TABLE "discount_codes" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "student_interventions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"student_id" uuid NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"course_id" uuid NOT NULL,
	"risk_level" text NOT NULL,
	"risk_reasons" text[] NOT NULL,
	"intervention_type" text,
	"assigned_trainer_id" uuid,
	"assigned_at" timestamp with time zone,
	"status" text DEFAULT 'pending' NOT NULL,
	"notes" text,
	"trainer_notes" text,
	"resolution_notes" text,
	"outcome" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"resolved_at" timestamp with time zone,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "student_interventions_intervention_type_check" CHECK (intervention_type = ANY (ARRAY['automated_email'::text, 'trainer_notification'::text, 'one_on_one_scheduled'::text, 'mentor_assigned'::text, 'resource_recommended'::text, 'deadline_extended'::text, 'other'::text])),
	CONSTRAINT "student_interventions_outcome_check" CHECK (outcome = ANY (ARRAY['student_improved'::text, 'student_completed'::text, 'student_dropped'::text, 'false_positive'::text, 'needs_escalation'::text])),
	CONSTRAINT "student_interventions_risk_level_check" CHECK (risk_level = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text])),
	CONSTRAINT "student_interventions_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'resolved'::text, 'escalated'::text, 'dismissed'::text])),
	CONSTRAINT "valid_assignment" CHECK (((assigned_trainer_id IS NULL) AND (assigned_at IS NULL)) OR ((assigned_trainer_id IS NOT NULL) AND (assigned_at IS NOT NULL))),
	CONSTRAINT "valid_resolution" CHECK (((status <> 'resolved'::text) AND (resolved_at IS NULL)) OR ((status = 'resolved'::text) AND (resolved_at IS NOT NULL)))
);
--> statement-breakpoint
ALTER TABLE "student_interventions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "student_enrollments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"course_id" uuid NOT NULL,
	"status" text DEFAULT 'pending' NOT NULL,
	"enrolled_at" timestamp with time zone DEFAULT now(),
	"starts_at" timestamp with time zone,
	"expires_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"dropped_at" timestamp with time zone,
	"payment_id" text,
	"payment_amount" numeric(10, 2),
	"payment_type" text,
	"current_module_id" uuid,
	"current_topic_id" uuid,
	"completion_percentage" integer DEFAULT 0,
	"enrollment_source" text,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"is_at_risk" boolean DEFAULT false,
	"at_risk_since" timestamp with time zone,
	"risk_level" text,
	"risk_reasons" text[],
	CONSTRAINT "unique_user_course_enrollment" UNIQUE("user_id","course_id"),
	CONSTRAINT "student_enrollments_completion_percentage_check" CHECK ((completion_percentage >= 0) AND (completion_percentage <= 100)),
	CONSTRAINT "student_enrollments_payment_type_check" CHECK (payment_type = ANY (ARRAY['subscription'::text, 'one_time'::text, 'free'::text, 'scholarship'::text])),
	CONSTRAINT "student_enrollments_risk_level_check" CHECK (risk_level = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text])),
	CONSTRAINT "student_enrollments_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'active'::text, 'completed'::text, 'dropped'::text, 'expired'::text])),
	CONSTRAINT "valid_dates" CHECK (((completed_at IS NULL) OR (completed_at >= enrolled_at)) AND ((dropped_at IS NULL) OR (dropped_at >= enrolled_at)))
);
--> statement-breakpoint
ALTER TABLE "student_enrollments" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "discount_code_usage" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"discount_code_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"enrollment_id" uuid,
	"original_amount" numeric(10, 2) NOT NULL,
	"discount_amount" numeric(10, 2) NOT NULL,
	"final_amount" numeric(10, 2) NOT NULL,
	"stripe_payment_intent_id" text,
	"used_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "discount_code_usage" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "course_pricing" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"course_id" uuid NOT NULL,
	"price_monthly" numeric(10, 2),
	"price_annual" numeric(10, 2),
	"price_one_time" numeric(10, 2),
	"stripe_price_id_monthly" text,
	"stripe_price_id_annual" text,
	"stripe_price_id_one_time" text,
	"stripe_product_id" text,
	"early_bird_price" numeric(10, 2),
	"early_bird_valid_until" timestamp with time zone,
	"scholarship_available" boolean DEFAULT false,
	"scholarship_criteria" text,
	"team_discount_percentage" numeric(5, 2),
	"min_team_size" integer DEFAULT 5,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "course_pricing_course_id_key" UNIQUE("course_id")
);
--> statement-breakpoint
ALTER TABLE "course_pricing" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "organization_settings" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"key" varchar(100) NOT NULL,
	"value" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"category" varchar(50) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"updated_by" uuid,
	CONSTRAINT "organization_settings_org_id_key_key" UNIQUE("org_id","key")
);
--> statement-breakpoint
ALTER TABLE "organization_settings" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_lead_data" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"contact_id" uuid NOT NULL,
	"lead_score" integer,
	"lead_status" text DEFAULT 'new',
	"qualification_status" text,
	"budget_confirmed" boolean DEFAULT false,
	"authority_confirmed" boolean DEFAULT false,
	"need_confirmed" boolean DEFAULT false,
	"timeline_confirmed" boolean DEFAULT false,
	"estimated_value" numeric(12, 2),
	"estimated_close_date" date,
	"converted_to_deal_id" uuid,
	"converted_to_account_id" uuid,
	"converted_at" timestamp with time zone,
	"lost_reason" text,
	"source_campaign_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "contact_lead_data_contact_id_key" UNIQUE("contact_id"),
	CONSTRAINT "contact_lead_data_lead_score_check" CHECK ((lead_score >= 0) AND (lead_score <= 100)),
	CONSTRAINT "contact_lead_data_lead_status_check" CHECK (lead_status = ANY (ARRAY['new'::text, 'warm'::text, 'hot'::text, 'cold'::text, 'qualified'::text, 'unqualified'::text, 'converted'::text, 'lost'::text])),
	CONSTRAINT "contact_lead_data_qualification_status_check" CHECK (qualification_status = ANY (ARRAY['unqualified'::text, 'marketing_qualified'::text, 'sales_qualified'::text, 'opportunity'::text]))
);
--> statement-breakpoint
ALTER TABLE "contact_lead_data" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "comments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"content" text NOT NULL,
	"parent_comment_id" uuid,
	"reply_count" integer DEFAULT 0,
	"author_id" uuid NOT NULL,
	"mentioned_user_ids" uuid[],
	"reactions" jsonb DEFAULT '{}'::jsonb,
	"is_deleted" boolean DEFAULT false,
	"deleted_at" timestamp with time zone,
	"deleted_by" uuid,
	"is_edited" boolean DEFAULT false,
	"edited_at" timestamp with time zone,
	"original_content" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "comments" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "lead_tasks" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"lead_id" uuid NOT NULL,
	"title" text NOT NULL,
	"description" text,
	"due_date" date NOT NULL,
	"priority" text DEFAULT 'medium' NOT NULL,
	"completed" boolean DEFAULT false NOT NULL,
	"completed_at" timestamp with time zone,
	"completed_by" uuid,
	"assigned_to" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "lead_tasks_priority_check" CHECK (priority = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text]))
);
--> statement-breakpoint
ALTER TABLE "lead_tasks" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "notifications" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"notification_type" text NOT NULL,
	"title" text NOT NULL,
	"message" text NOT NULL,
	"entity_type" text,
	"entity_id" uuid,
	"channels" text[] DEFAULT '{"RAY['in_app'::tex"}',
	"email_sent_at" timestamp with time zone,
	"email_error" text,
	"slack_sent_at" timestamp with time zone,
	"slack_error" text,
	"is_read" boolean DEFAULT false,
	"read_at" timestamp with time zone,
	"is_archived" boolean DEFAULT false,
	"archived_at" timestamp with time zone,
	"priority" text DEFAULT 'normal',
	"action_url" text,
	"action_label" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "notifications" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "tasks" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"title" text NOT NULL,
	"description" text,
	"entity_type" text,
	"entity_id" uuid,
	"assigned_to" uuid,
	"created_by" uuid NOT NULL,
	"status" text DEFAULT 'todo' NOT NULL,
	"priority" text DEFAULT 'medium',
	"due_date" date,
	"completed_at" timestamp with time zone,
	"completed_by" uuid,
	"is_recurring" boolean DEFAULT false,
	"recurrence_pattern" text,
	"parent_task_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "tasks" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "organization_branding" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"asset_type" varchar(50) NOT NULL,
	"storage_path" text NOT NULL,
	"file_name" text NOT NULL,
	"file_size" integer,
	"mime_type" varchar(100),
	"width" integer,
	"height" integer,
	"created_at" timestamp with time zone DEFAULT now(),
	"uploaded_by" uuid,
	CONSTRAINT "organization_branding_org_id_asset_type_key" UNIQUE("org_id","asset_type")
);
--> statement-breakpoint
ALTER TABLE "organization_branding" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_contracts" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"contract_type" "contract_type" NOT NULL,
	"contract_number" varchar(50),
	"name" text NOT NULL,
	"description" text,
	"status" "contract_status" DEFAULT 'draft',
	"effective_date" date,
	"expiration_date" date,
	"signed_date" date,
	"terminated_date" date,
	"auto_renews" boolean DEFAULT false,
	"renewal_term_months" integer,
	"renewal_notice_days" integer DEFAULT 30,
	"contract_value" numeric(15, 2),
	"currency" varchar(3) DEFAULT 'USD',
	"our_signatory_id" uuid,
	"their_signatory_name" text,
	"their_signatory_title" text,
	"their_signatory_email" text,
	"document_url" text,
	"document_storage_key" text,
	"terms" jsonb DEFAULT '{}'::jsonb,
	"parent_contract_id" uuid,
	"expiration_alert_sent" boolean DEFAULT false,
	"expiration_alert_date" date,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "company_contracts" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_rate_cards" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"name" text NOT NULL,
	"version" integer DEFAULT 1,
	"effective_start_date" date NOT NULL,
	"effective_end_date" date,
	"status" "rate_card_status" DEFAULT 'draft',
	"currency" varchar(3) DEFAULT 'USD',
	"applicable_regions" text[],
	"msp_program_id" uuid,
	"msp_tier" integer,
	"default_markup_percentage" numeric(5, 2),
	"max_markup_percentage" numeric(5, 2),
	"min_margin_percentage" numeric(5, 2),
	"overtime_multiplier" numeric(3, 2) DEFAULT '1.5',
	"double_time_multiplier" numeric(3, 2) DEFAULT '2.0',
	"direct_hire_fee_percentage" numeric(5, 2) DEFAULT '20.00',
	"guarantee_period_days" integer DEFAULT 90,
	"cth_conversion_fee_percentage" numeric(5, 2),
	"cth_hours_credit" integer DEFAULT 0,
	"per_diem_rate" numeric(8, 2),
	"mileage_rate" numeric(5, 3),
	"expense_markup_percentage" numeric(5, 2) DEFAULT '0',
	"notes" text,
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "company_rate_cards" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_rate_card_items" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"rate_card_id" uuid NOT NULL,
	"job_category" text NOT NULL,
	"job_level" text,
	"job_family" text,
	"min_pay_rate" numeric(10, 2),
	"max_pay_rate" numeric(10, 2),
	"target_pay_rate" numeric(10, 2),
	"min_bill_rate" numeric(10, 2),
	"max_bill_rate" numeric(10, 2),
	"standard_bill_rate" numeric(10, 2),
	"target_margin_percentage" numeric(5, 2),
	"min_margin_percentage" numeric(5, 2),
	"rate_type" varchar(20) DEFAULT 'hourly',
	"overtime_multiplier" numeric(3, 2),
	"sort_order" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "company_rate_card_items" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_compliance_requirements" (
	"company_id" uuid PRIMARY KEY NOT NULL,
	"org_id" uuid NOT NULL,
	"general_liability_required" boolean DEFAULT false,
	"general_liability_minimum" text,
	"professional_liability_required" boolean DEFAULT false,
	"professional_liability_minimum" text,
	"workers_comp_required" boolean DEFAULT true,
	"cyber_liability_required" boolean DEFAULT false,
	"cyber_liability_minimum" text,
	"umbrella_required" boolean DEFAULT false,
	"umbrella_minimum" text,
	"coi_on_file" boolean DEFAULT false,
	"coi_expiration_date" date,
	"coi_document_url" text,
	"client_named_on_coi" boolean DEFAULT false,
	"background_check_required" boolean DEFAULT false,
	"background_check_level" varchar(50),
	"background_check_vendor" varchar(50),
	"background_check_max_age_days" integer DEFAULT 365,
	"drug_test_required" boolean DEFAULT false,
	"drug_test_type" varchar(20),
	"drug_test_frequency" varchar(20),
	"security_clearance_required" boolean DEFAULT false,
	"security_clearance_level" varchar(50),
	"citizenship_required" varchar(50),
	"hipaa_training_required" boolean DEFAULT false,
	"sox_compliance_required" boolean DEFAULT false,
	"pci_compliance_required" boolean DEFAULT false,
	"fedramp_required" boolean DEFAULT false,
	"w9_required" boolean DEFAULT true,
	"nda_required" boolean DEFAULT false,
	"non_compete_required" boolean DEFAULT false,
	"i9_verification_method" varchar(20) DEFAULT 'standard',
	"work_authorization_types" text[],
	"soc2_attestation_required" boolean DEFAULT false,
	"gdpr_compliance_required" boolean DEFAULT false,
	"ccpa_compliance_required" boolean DEFAULT false,
	"data_retention_years" integer DEFAULT 7,
	"data_handling_instructions" text,
	"safety_training_required" boolean DEFAULT false,
	"safety_certifications" text[],
	"ppe_requirements" text[],
	"custom_requirements" jsonb DEFAULT '{}'::jsonb,
	"updated_at" timestamp with time zone DEFAULT now(),
	"updated_by" uuid
);
--> statement-breakpoint
ALTER TABLE "company_compliance_requirements" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_health_scores" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"score_date" date DEFAULT CURRENT_DATE NOT NULL,
	"overall_score" integer,
	"overall_grade" char(1),
	"health_status" varchar(20),
	"engagement_score" integer,
	"days_since_last_contact" integer,
	"days_since_last_job" integer,
	"response_rate_percentage" numeric(5, 2),
	"meetings_last_90d" integer,
	"financial_score" integer,
	"revenue_trend" varchar(10),
	"revenue_vs_target_percentage" numeric(5, 2),
	"payment_timeliness_score" integer,
	"outstanding_ar_amount" numeric(12, 2),
	"relationship_score" integer,
	"nps_score" integer,
	"satisfaction_score" numeric(3, 1),
	"escalations_last_90d" integer,
	"decision_maker_turnover" boolean DEFAULT false,
	"opportunity_score" integer,
	"active_jobs_count" integer,
	"pipeline_value" numeric(12, 2),
	"expansion_potential" varchar(20),
	"risk_factors" jsonb DEFAULT '[]'::jsonb,
	"recommended_actions" jsonb DEFAULT '[]'::jsonb,
	"calculated_at" timestamp with time zone DEFAULT now(),
	"calculated_by" varchar(50) DEFAULT 'system',
	CONSTRAINT "company_health_scores_engagement_score_check" CHECK ((engagement_score >= 0) AND (engagement_score <= 30)),
	CONSTRAINT "company_health_scores_financial_score_check" CHECK ((financial_score >= 0) AND (financial_score <= 30)),
	CONSTRAINT "company_health_scores_opportunity_score_check" CHECK ((opportunity_score >= 0) AND (opportunity_score <= 20)),
	CONSTRAINT "company_health_scores_overall_grade_check" CHECK (overall_grade = ANY (ARRAY['A'::bpchar, 'B'::bpchar, 'C'::bpchar, 'D'::bpchar, 'F'::bpchar])),
	CONSTRAINT "company_health_scores_overall_score_check" CHECK ((overall_score >= 0) AND (overall_score <= 100)),
	CONSTRAINT "company_health_scores_relationship_score_check" CHECK ((relationship_score >= 0) AND (relationship_score <= 20))
);
--> statement-breakpoint
ALTER TABLE "company_health_scores" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_metrics" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"period_type" "metric_period_type" NOT NULL,
	"period_start" date NOT NULL,
	"period_end" date NOT NULL,
	"jobs_posted" integer DEFAULT 0,
	"jobs_filled" integer DEFAULT 0,
	"jobs_cancelled" integer DEFAULT 0,
	"fill_rate" numeric(5, 2),
	"avg_time_to_fill_days" integer,
	"submissions_sent" integer DEFAULT 0,
	"submissions_accepted" integer DEFAULT 0,
	"submissions_rejected" integer DEFAULT 0,
	"submission_to_interview_rate" numeric(5, 2),
	"interviews_scheduled" integer DEFAULT 0,
	"interviews_completed" integer DEFAULT 0,
	"interviews_cancelled" integer DEFAULT 0,
	"interview_to_offer_rate" numeric(5, 2),
	"placements_started" integer DEFAULT 0,
	"placements_ended" integer DEFAULT 0,
	"placements_active_eop" integer DEFAULT 0,
	"avg_placement_duration_days" integer,
	"gross_revenue" numeric(15, 2) DEFAULT '0',
	"net_revenue" numeric(15, 2) DEFAULT '0',
	"gross_margin" numeric(15, 2) DEFAULT '0',
	"gross_margin_percentage" numeric(5, 2),
	"revenue_per_placement" numeric(12, 2),
	"activities_logged" integer DEFAULT 0,
	"emails_sent" integer DEFAULT 0,
	"calls_made" integer DEFAULT 0,
	"meetings_held" integer DEFAULT 0,
	"engagement_score" integer,
	"performance_score" integer,
	"created_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "company_metrics_company_id_period_type_period_start_key" UNIQUE("company_id","period_type","period_start")
);
--> statement-breakpoint
ALTER TABLE "company_metrics" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_revenue" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"revenue_type" varchar(50) NOT NULL,
	"placement_id" uuid,
	"job_id" uuid,
	"invoice_id" uuid,
	"revenue_date" date NOT NULL,
	"period_start" date,
	"period_end" date,
	"gross_revenue" numeric(12, 2) NOT NULL,
	"cost" numeric(12, 2) DEFAULT '0',
	"gross_margin" numeric(12, 2),
	"margin_percentage" numeric(5, 2),
	"currency" varchar(3) DEFAULT 'USD',
	"billing_company_id" uuid,
	"end_client_company_id" uuid,
	"job_category" text,
	"job_level" text,
	"work_location_state" text,
	"contract_type" varchar(20),
	"created_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "company_revenue" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "activity_log" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"activity_type" text NOT NULL,
	"subject" text,
	"body" text,
	"direction" text,
	"performed_by" uuid,
	"poc_id" uuid,
	"activity_date" timestamp with time zone DEFAULT now() NOT NULL,
	"duration_minutes" integer,
	"outcome" text,
	"next_action" text,
	"next_action_date" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "activity_log" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "engagement_tracking" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"campaign_contact_id" uuid NOT NULL,
	"event_type" text NOT NULL,
	"event_data" jsonb,
	"event_timestamp" timestamp with time zone DEFAULT now() NOT NULL,
	"tracking_id" text,
	"user_agent" text,
	"ip_address" "inet",
	"clicked_url" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "engagement_tracking" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "employee_metadata" (
	"user_id" uuid PRIMARY KEY NOT NULL,
	"employment_type" text DEFAULT 'full_time',
	"employee_id_number" text,
	"bonus_target" numeric(12, 2),
	"commission_plan" text,
	"equity_shares" integer,
	"pod_id" uuid,
	"pod_role" text,
	"kpi_targets" jsonb,
	"monthly_placement_target" integer,
	"work_schedule" text DEFAULT 'standard',
	"weekly_hours" integer DEFAULT 40,
	"benefits_eligible" boolean DEFAULT true,
	"benefits_start_date" date,
	"emergency_contact_name" text,
	"emergency_contact_phone" text,
	"emergency_contact_relationship" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "employee_metadata_employee_id_number_key" UNIQUE("employee_id_number")
);
--> statement-breakpoint
ALTER TABLE "employee_metadata" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_skills" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"candidate_id" uuid NOT NULL,
	"skill_id" uuid NOT NULL,
	"proficiency_level" text DEFAULT 'intermediate',
	"years_of_experience" numeric(4, 1),
	"is_certified" boolean DEFAULT false,
	"certification_name" text,
	"last_used_date" date,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"skill_name" text,
	"certification_expiry" date,
	"is_primary" boolean DEFAULT false,
	"source" text,
	"contact_id" uuid,
	CONSTRAINT "candidate_skills_candidate_id_skill_id_key" UNIQUE("candidate_id","skill_id")
);
--> statement-breakpoint
ALTER TABLE "candidate_skills" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "pods" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"pod_type" text NOT NULL,
	"senior_member_id" uuid,
	"junior_member_id" uuid,
	"sprint_duration_weeks" integer DEFAULT 2,
	"placements_per_sprint_target" integer DEFAULT 2,
	"total_placements" integer DEFAULT 0,
	"current_sprint_placements" integer DEFAULT 0,
	"current_sprint_start_date" date,
	"average_placements_per_sprint" numeric(5, 2),
	"is_active" boolean DEFAULT true,
	"formed_date" date,
	"dissolved_date" date,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"region_id" uuid,
	"status" text DEFAULT 'active',
	"deleted_at" timestamp with time zone,
	"manager_id" uuid,
	"description" text,
	"sprint_start_day" text DEFAULT 'monday',
	"send_sprint_summary" boolean DEFAULT true,
	"send_midpoint_check" boolean DEFAULT true,
	"alert_if_below_target" boolean DEFAULT true,
	CONSTRAINT "pods_pod_type_check" CHECK (pod_type = ANY (ARRAY['recruiting'::text, 'bench_sales'::text, 'ta'::text, 'hr'::text, 'mixed'::text])),
	CONSTRAINT "pods_sprint_start_day_check" CHECK (sprint_start_day = ANY (ARRAY['monday'::text, 'tuesday'::text, 'wednesday'::text, 'thursday'::text, 'friday'::text, 'saturday'::text, 'sunday'::text]))
);
--> statement-breakpoint
ALTER TABLE "pods" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "user_session_context" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"active_role" text NOT NULL,
	"session_started_at" timestamp with time zone DEFAULT now() NOT NULL,
	"session_ended_at" timestamp with time zone,
	"duration_seconds" integer GENERATED ALWAYS AS (
CASE
    WHEN (session_ended_at IS NOT NULL) THEN (EXTRACT(epoch FROM (session_ended_at - session_started_at)))::integer
    ELSE NULL::integer
END) STORED
);
--> statement-breakpoint
ALTER TABLE "user_session_context" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "pod_managers" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"pod_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"is_primary" boolean DEFAULT true,
	"assigned_at" timestamp with time zone DEFAULT now() NOT NULL,
	"assigned_by" uuid,
	"removed_at" timestamp with time zone,
	"removed_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "pod_managers" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "lead_strategies" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"lead_id" uuid NOT NULL,
	"strategy_notes" text,
	"talking_points" jsonb DEFAULT '[]'::jsonb,
	"value_proposition" text,
	"differentiators" jsonb DEFAULT '[]'::jsonb,
	"objections" jsonb DEFAULT '[]'::jsonb,
	"stakeholders" jsonb DEFAULT '[]'::jsonb,
	"competitors" jsonb DEFAULT '[]'::jsonb,
	"win_themes" jsonb DEFAULT '[]'::jsonb,
	"pain_points" jsonb DEFAULT '[]'::jsonb,
	"meeting_agenda" jsonb DEFAULT '[]'::jsonb,
	"questions_to_ask" jsonb DEFAULT '[]'::jsonb,
	"desired_outcomes" jsonb DEFAULT '[]'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_by" uuid,
	CONSTRAINT "lead_strategies_lead_id_key" UNIQUE("lead_id")
);
--> statement-breakpoint
ALTER TABLE "lead_strategies" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "talking_point_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"category" text,
	"talking_points" jsonb DEFAULT '[]'::jsonb,
	"is_default" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
ALTER TABLE "talking_point_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "payroll_items" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"payroll_run_id" uuid NOT NULL,
	"employee_id" uuid NOT NULL,
	"base_salary" numeric(10, 2),
	"commission" numeric(10, 2),
	"bonus" numeric(10, 2),
	"overtime_hours" numeric(5, 2),
	"overtime_pay" numeric(10, 2),
	"other_earnings" numeric(10, 2),
	"gross_pay" numeric(10, 2) NOT NULL,
	"taxes_withheld" numeric(10, 2),
	"benefits_deductions" numeric(10, 2),
	"other_deductions" numeric(10, 2),
	"net_pay" numeric(10, 2) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "payroll_items_payroll_run_id_employee_id_key" UNIQUE("payroll_run_id","employee_id")
);
--> statement-breakpoint
ALTER TABLE "payroll_items" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "time_attendance" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"employee_id" uuid NOT NULL,
	"date" date NOT NULL,
	"regular_hours" numeric(5, 2) DEFAULT '0',
	"overtime_hours" numeric(5, 2) DEFAULT '0',
	"pto_hours" numeric(5, 2) DEFAULT '0',
	"sick_hours" numeric(5, 2) DEFAULT '0',
	"holiday_hours" numeric(5, 2) DEFAULT '0',
	"total_hours" numeric(5, 2) GENERATED ALWAYS AS (((((regular_hours + overtime_hours) + pto_hours) + sick_hours) + holiday_hours)) STORED,
	"status" text DEFAULT 'draft' NOT NULL,
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"rejection_reason" text,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "time_attendance_employee_id_date_key" UNIQUE("employee_id","date")
);
--> statement-breakpoint
ALTER TABLE "time_attendance" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "payroll_runs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"period_start_date" date NOT NULL,
	"period_end_date" date NOT NULL,
	"pay_date" date NOT NULL,
	"status" text DEFAULT 'draft' NOT NULL,
	"employee_count" integer DEFAULT 0 NOT NULL,
	"total_gross_pay" numeric(12, 2) DEFAULT '0',
	"total_taxes" numeric(12, 2) DEFAULT '0',
	"total_net_pay" numeric(12, 2) DEFAULT '0',
	"gusto_payroll_id" text,
	"processed_at" timestamp with time zone,
	"processing_error" text,
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
ALTER TABLE "payroll_runs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "performance_reviews" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"employee_id" uuid NOT NULL,
	"reviewer_id" uuid NOT NULL,
	"review_cycle" text NOT NULL,
	"review_type" text DEFAULT 'annual',
	"period_start_date" date NOT NULL,
	"period_end_date" date NOT NULL,
	"overall_rating" integer,
	"quality_of_work" integer,
	"communication" integer,
	"teamwork" integer,
	"initiative" integer,
	"reliability" integer,
	"goals_achieved" jsonb,
	"goals_next_period" jsonb,
	"strengths" text,
	"areas_for_improvement" text,
	"manager_comments" text,
	"employee_self_assessment" text,
	"employee_comments" text,
	"status" text DEFAULT 'draft' NOT NULL,
	"scheduled_date" date,
	"completed_at" timestamp with time zone,
	"employee_acknowledged_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "performance_reviews_communication_check" CHECK ((communication >= 1) AND (communication <= 5)),
	CONSTRAINT "performance_reviews_initiative_check" CHECK ((initiative >= 1) AND (initiative <= 5)),
	CONSTRAINT "performance_reviews_overall_rating_check" CHECK ((overall_rating >= 1) AND (overall_rating <= 5)),
	CONSTRAINT "performance_reviews_quality_of_work_check" CHECK ((quality_of_work >= 1) AND (quality_of_work <= 5)),
	CONSTRAINT "performance_reviews_reliability_check" CHECK ((reliability >= 1) AND (reliability <= 5)),
	CONSTRAINT "performance_reviews_teamwork_check" CHECK ((teamwork >= 1) AND (teamwork <= 5))
);
--> statement-breakpoint
ALTER TABLE "performance_reviews" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "import_jobs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"file_name" varchar(255) NOT NULL,
	"file_path" text NOT NULL,
	"file_size_bytes" integer,
	"field_mapping" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"import_options" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"total_rows" integer,
	"processed_rows" integer DEFAULT 0,
	"success_rows" integer DEFAULT 0,
	"error_rows" integer DEFAULT 0,
	"warning_rows" integer DEFAULT 0,
	"status" varchar(20) DEFAULT 'pending' NOT NULL,
	"error_message" text,
	"error_log" jsonb DEFAULT '[]'::jsonb,
	"warnings_log" jsonb DEFAULT '[]'::jsonb,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "import_jobs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "export_jobs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"export_name" varchar(255),
	"filters" jsonb DEFAULT '{}'::jsonb,
	"columns" text[] NOT NULL,
	"format" varchar(20) DEFAULT 'csv' NOT NULL,
	"include_headers" boolean DEFAULT true,
	"is_scheduled" boolean DEFAULT false,
	"schedule_cron" varchar(100),
	"schedule_name" varchar(255),
	"last_run_at" timestamp with time zone,
	"next_run_at" timestamp with time zone,
	"file_path" text,
	"file_size_bytes" integer,
	"record_count" integer,
	"status" varchar(20) DEFAULT 'pending' NOT NULL,
	"error_message" text,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"expires_at" timestamp with time zone,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "export_jobs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "gdpr_requests" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"request_number" varchar(50) NOT NULL,
	"request_type" varchar(30) NOT NULL,
	"subject_email" varchar(255) NOT NULL,
	"subject_name" varchar(255),
	"subject_phone" varchar(50),
	"verification_method" varchar(50),
	"verified_at" timestamp with time zone,
	"data_found" jsonb DEFAULT '{}'::jsonb,
	"tables_scanned" text[],
	"total_records_found" integer DEFAULT 0,
	"status" varchar(20) DEFAULT 'pending' NOT NULL,
	"action_taken" varchar(50),
	"export_file_path" text,
	"anonymized_fields" jsonb DEFAULT '[]'::jsonb,
	"notes" text,
	"due_date" date NOT NULL,
	"compliance_notes" text,
	"processed_by" uuid,
	"processed_at" timestamp with time zone,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "gdpr_requests" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "duplicate_records" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"record_id_1" uuid NOT NULL,
	"record_id_2" uuid NOT NULL,
	"confidence_score" numeric(5, 4) NOT NULL,
	"match_fields" text[] NOT NULL,
	"match_details" jsonb DEFAULT '{}'::jsonb,
	"status" varchar(20) DEFAULT 'pending' NOT NULL,
	"merged_into_id" uuid,
	"dismissed_reason" text,
	"detected_at" timestamp with time zone DEFAULT now() NOT NULL,
	"reviewed_by" uuid,
	"reviewed_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "unique_duplicate_pair" UNIQUE("org_id","entity_type","record_id_1","record_id_2"),
	CONSTRAINT "ordered_record_ids" CHECK (record_id_1 < record_id_2)
);
--> statement-breakpoint
ALTER TABLE "duplicate_records" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "duplicate_rules" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"rule_name" varchar(100) NOT NULL,
	"is_active" boolean DEFAULT true,
	"match_fields" text[] NOT NULL,
	"match_type" varchar(20) DEFAULT 'exact' NOT NULL,
	"fuzzy_threshold" numeric(3, 2) DEFAULT '0.85',
	"auto_merge_threshold" numeric(5, 4),
	"auto_merge_enabled" boolean DEFAULT false,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "unique_rule_name" UNIQUE("org_id","entity_type","rule_name")
);
--> statement-breakpoint
ALTER TABLE "duplicate_rules" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "archived_records" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"original_id" uuid NOT NULL,
	"original_data" jsonb NOT NULL,
	"archive_reason" varchar(100),
	"archived_by" uuid NOT NULL,
	"archived_at" timestamp with time zone DEFAULT now() NOT NULL,
	"restored_at" timestamp with time zone,
	"restored_by" uuid,
	"permanently_deleted_at" timestamp with time zone,
	"deleted_by" uuid,
	CONSTRAINT "unique_archived_record" UNIQUE("org_id","entity_type","original_id")
);
--> statement-breakpoint
ALTER TABLE "archived_records" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "retention_policies" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"policy_name" varchar(100) NOT NULL,
	"is_active" boolean DEFAULT true,
	"retention_days" integer NOT NULL,
	"archive_after_days" integer,
	"delete_after_archive_days" integer,
	"status_filter" text[],
	"additional_conditions" jsonb DEFAULT '{}'::jsonb,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "unique_retention_policy" UNIQUE("org_id","entity_type","policy_name")
);
--> statement-breakpoint
ALTER TABLE "retention_policies" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_resumes" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"version" integer DEFAULT 1 NOT NULL,
	"is_latest" boolean DEFAULT true NOT NULL,
	"previous_version_id" uuid,
	"bucket" text DEFAULT 'resumes' NOT NULL,
	"file_path" text NOT NULL,
	"file_name" text NOT NULL,
	"file_size" integer NOT NULL,
	"mime_type" text NOT NULL,
	"resume_type" text DEFAULT 'master',
	"title" text,
	"notes" text,
	"parsed_content" text,
	"parsed_skills" text[],
	"parsed_experience" text,
	"ai_summary" text,
	"submission_write_up" text,
	"uploaded_by" uuid NOT NULL,
	"uploaded_at" timestamp with time zone DEFAULT now() NOT NULL,
	"is_archived" boolean DEFAULT false,
	"archived_at" timestamp with time zone,
	"archived_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_resumes" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "user_profiles" (
	"id" uuid PRIMARY KEY DEFAULT uuid_generate_v4() NOT NULL,
	"auth_id" uuid,
	"email" text NOT NULL,
	"full_name" text NOT NULL,
	"avatar_url" text,
	"phone" text,
	"timezone" text DEFAULT 'America/New_York',
	"locale" text DEFAULT 'en-US',
	"student_enrollment_date" timestamp with time zone,
	"student_course_id" uuid,
	"student_current_module" text,
	"student_course_progress" jsonb DEFAULT '{}'::jsonb,
	"student_graduation_date" timestamp with time zone,
	"student_certificates" jsonb DEFAULT '[]'::jsonb,
	"employee_hire_date" timestamp with time zone,
	"employee_department" text,
	"employee_position" text,
	"employee_salary" numeric(10, 2),
	"employee_status" text,
	"employee_manager_id" uuid,
	"employee_performance_rating" numeric(3, 2),
	"candidate_status" text,
	"candidate_resume_url" text,
	"candidate_skills" text[],
	"candidate_experience_years" integer,
	"candidate_current_visa" text,
	"candidate_visa_expiry" timestamp with time zone,
	"candidate_hourly_rate" numeric(10, 2),
	"candidate_bench_start_date" timestamp with time zone,
	"candidate_availability" text,
	"candidate_location" text,
	"candidate_willing_to_relocate" boolean DEFAULT false,
	"client_company_name" text,
	"client_industry" text,
	"client_tier" text,
	"client_contract_start_date" timestamp with time zone,
	"client_contract_end_date" timestamp with time zone,
	"client_payment_terms" integer DEFAULT 30,
	"client_preferred_markup_percentage" numeric(5, 2),
	"recruiter_territory" text,
	"recruiter_specialization" text[],
	"recruiter_monthly_placement_target" integer DEFAULT 2,
	"recruiter_pod_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone,
	"is_active" boolean DEFAULT true,
	"search_vector" "tsvector",
	"org_id" uuid NOT NULL,
	"leaderboard_visible" boolean DEFAULT true,
	"first_name" text,
	"last_name" text,
	"middle_name" text,
	"preferred_name" text,
	"date_of_birth" date,
	"gender" text,
	"nationality" text,
	"email_secondary" text,
	"phone_home" text,
	"phone_work" text,
	"preferred_contact_method" text,
	"preferred_call_time" text,
	"do_not_contact" boolean DEFAULT false,
	"do_not_email" boolean DEFAULT false,
	"do_not_text" boolean DEFAULT false,
	"linkedin_url" text,
	"github_url" text,
	"portfolio_url" text,
	"personal_website" text,
	"emergency_contact_name" text,
	"emergency_contact_relationship" text,
	"emergency_contact_phone" text,
	"emergency_contact_email" text,
	"lead_source" text,
	"lead_source_detail" text,
	"marketing_status" text,
	"is_on_hotlist" boolean DEFAULT false,
	"hotlist_added_at" timestamp with time zone,
	"hotlist_added_by" uuid,
	"hotlist_notes" text,
	"current_employment_status" text,
	"notice_period_days" integer,
	"earliest_start_date" date,
	"preferred_employment_type" text[],
	"preferred_locations" text[],
	"relocation_assistance_required" boolean DEFAULT false,
	"relocation_notes" text,
	"desired_salary_annual" numeric(12, 2),
	"desired_salary_currency" text DEFAULT 'USD',
	"minimum_hourly_rate" numeric(10, 2),
	"minimum_annual_salary" numeric(12, 2),
	"benefits_required" text[],
	"compensation_notes" text,
	"languages" jsonb DEFAULT '[]'::jsonb,
	"recruiter_rating" integer,
	"recruiter_rating_notes" text,
	"profile_completeness_score" integer DEFAULT 0,
	"last_profile_update" timestamp with time zone,
	"last_activity_date" timestamp with time zone,
	"last_contacted_at" timestamp with time zone,
	"last_contacted_by" uuid,
	"professional_headline" text,
	"professional_summary" text,
	"career_objectives" text,
	"tags" text[],
	"categories" text[],
	"employee_role" text,
	"stripe_customer_id" text,
	"title" text,
	"total_placements" integer DEFAULT 0,
	"manager_id" uuid,
	"two_factor_enabled" boolean DEFAULT false,
	"password_changed_at" timestamp with time zone,
	"start_date" date,
	"last_login_at" timestamp with time zone,
	"role_id" uuid,
	"status" text DEFAULT 'active',
	CONSTRAINT "user_profiles_auth_id_key" UNIQUE("auth_id"),
	CONSTRAINT "user_profiles_email_key" UNIQUE("email"),
	CONSTRAINT "user_profiles_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'active'::text, 'suspended'::text, 'deactivated'::text])),
	CONSTRAINT "valid_candidate_availability" CHECK ((candidate_availability IS NULL) OR (candidate_availability = ANY (ARRAY['immediate'::text, '2_weeks'::text, '1_month'::text]))),
	CONSTRAINT "valid_candidate_status" CHECK ((candidate_status IS NULL) OR (candidate_status = ANY (ARRAY['active'::text, 'placed'::text, 'bench'::text, 'inactive'::text, 'blacklisted'::text]))),
	CONSTRAINT "valid_client_tier" CHECK ((client_tier IS NULL) OR (client_tier = ANY (ARRAY['preferred'::text, 'strategic'::text, 'exclusive'::text]))),
	CONSTRAINT "valid_email" CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}$'::text),
	CONSTRAINT "valid_employee_status" CHECK ((employee_status IS NULL) OR (employee_status = ANY (ARRAY['active'::text, 'on_leave'::text, 'terminated'::text]))),
	CONSTRAINT "valid_phone" CHECK ((phone IS NULL) OR (phone ~* '^\+?[1-9]\d{1,14}$'::text))
);
--> statement-breakpoint
ALTER TABLE "user_profiles" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_background_checks" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"submission_id" uuid,
	"placement_id" uuid,
	"provider" text,
	"provider_reference_id" text,
	"provider_order_id" text,
	"package_name" text,
	"package_type" text,
	"status" text DEFAULT 'not_started' NOT NULL,
	"overall_result" text,
	"requested_at" timestamp with time zone,
	"requested_by" uuid,
	"initiated_at" timestamp with time zone,
	"estimated_completion" date,
	"completed_at" timestamp with time zone,
	"expires_at" timestamp with time zone,
	"valid_for_months" integer DEFAULT 12,
	"checks" jsonb DEFAULT '{}'::jsonb,
	"adjudication_status" text,
	"adjudication_notes" text,
	"adjudicated_by" uuid,
	"adjudicated_at" timestamp with time zone,
	"adverse_action_required" boolean DEFAULT false,
	"pre_adverse_sent_at" timestamp with time zone,
	"pre_adverse_response_deadline" date,
	"final_adverse_sent_at" timestamp with time zone,
	"adverse_action_notes" text,
	"consent_form_file_id" uuid,
	"consent_signed_at" timestamp with time zone,
	"consent_ip_address" text,
	"consent_user_agent" text,
	"authorization_form_file_id" uuid,
	"report_file_id" uuid,
	"report_received_at" timestamp with time zone,
	"cost" numeric(10, 2),
	"cost_currency" text DEFAULT 'USD',
	"billed_to" text,
	"notes" text,
	"internal_notes" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"updated_by" uuid,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_background_checks" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_certifications" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"certification_type" text NOT NULL,
	"name" text NOT NULL,
	"acronym" text,
	"issuing_organization" text,
	"credential_id" text,
	"credential_url" text,
	"issue_date" date,
	"expiry_date" date,
	"is_lifetime" boolean DEFAULT false,
	"requires_renewal" boolean DEFAULT false,
	"renewal_period_months" integer,
	"cpe_credits_required" integer,
	"license_type" text,
	"license_number" text,
	"license_state" text,
	"license_country" text,
	"license_jurisdiction" text,
	"clearance_level" text,
	"clearance_status" text,
	"clearance_granted_date" date,
	"investigation_type" text,
	"polygraph_type" text,
	"polygraph_date" date,
	"sap_access" boolean DEFAULT false,
	"sci_access" boolean DEFAULT false,
	"is_verified" boolean DEFAULT false,
	"verified_at" timestamp with time zone,
	"verified_by" uuid,
	"verification_method" text,
	"verification_notes" text,
	"document_file_id" uuid,
	"display_order" integer DEFAULT 0,
	"is_featured" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"updated_by" uuid,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_certifications" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_compliance_documents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"placement_id" uuid,
	"submission_id" uuid,
	"document_type" text NOT NULL,
	"document_name" text NOT NULL,
	"document_description" text,
	"document_category" text,
	"status" text DEFAULT 'required' NOT NULL,
	"required_by" date,
	"requested_at" timestamp with time zone,
	"submitted_at" timestamp with time zone,
	"reviewed_at" timestamp with time zone,
	"reviewed_by" uuid,
	"approved_at" timestamp with time zone,
	"approved_by" uuid,
	"rejected_at" timestamp with time zone,
	"rejected_by" uuid,
	"rejection_reason" text,
	"effective_date" date,
	"expires_at" date,
	"file_id" uuid,
	"file_url" text,
	"file_name" text,
	"file_size" integer,
	"file_mime_type" text,
	"requires_signature" boolean DEFAULT true,
	"is_signed" boolean DEFAULT false,
	"signed_at" timestamp with time zone,
	"signer_name" text,
	"signer_email" text,
	"signature_ip" text,
	"signature_user_agent" text,
	"signature_method" text,
	"signature_envelope_id" text,
	"version" integer DEFAULT 1,
	"previous_version_id" uuid,
	"is_current_version" boolean DEFAULT true,
	"client_id" uuid,
	"client_name" text,
	"notes" text,
	"internal_notes" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"updated_by" uuid,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_compliance_documents" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "object_owners" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"role" text NOT NULL,
	"permission" text DEFAULT 'view' NOT NULL,
	"is_primary" boolean DEFAULT false,
	"assigned_at" timestamp with time zone DEFAULT now() NOT NULL,
	"assigned_by" uuid,
	"assignment_type" text DEFAULT 'auto',
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "object_owners_entity_type_entity_id_user_id_key" UNIQUE("entity_type","entity_id","user_id"),
	CONSTRAINT "object_owners_assignment_type_check" CHECK (assignment_type = ANY (ARRAY['auto'::text, 'manual'::text])),
	CONSTRAINT "object_owners_entity_type_check" CHECK (entity_type = ANY (ARRAY['campaign'::text, 'lead'::text, 'deal'::text, 'account'::text, 'job'::text, 'job_order'::text, 'submission'::text, 'contact'::text, 'external_job'::text])),
	CONSTRAINT "object_owners_permission_check" CHECK (permission = ANY (ARRAY['edit'::text, 'view'::text])),
	CONSTRAINT "object_owners_role_check" CHECK (role = ANY (ARRAY['responsible'::text, 'accountable'::text, 'consulted'::text, 'informed'::text]))
);
--> statement-breakpoint
ALTER TABLE "object_owners" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_education" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"degree_type" text,
	"degree_name" text,
	"field_of_study" text,
	"minor" text,
	"concentration" text,
	"institution_name" text NOT NULL,
	"institution_type" text,
	"institution_city" text,
	"institution_state" text,
	"institution_country" text,
	"country_code" text,
	"start_date" date,
	"end_date" date,
	"expected_graduation" date,
	"is_current" boolean DEFAULT false,
	"gpa" numeric(4, 2),
	"gpa_scale" numeric(3, 1) DEFAULT '4.0',
	"class_rank" text,
	"honors" text,
	"thesis_title" text,
	"dissertation_title" text,
	"is_verified" boolean DEFAULT false,
	"verified_at" timestamp with time zone,
	"verified_by" uuid,
	"verification_method" text,
	"verification_notes" text,
	"transcript_file_id" uuid,
	"diploma_file_id" uuid,
	"display_order" integer DEFAULT 0,
	"is_highest_degree" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"updated_by" uuid,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_education" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_references" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"reference_name" text NOT NULL,
	"reference_title" text,
	"reference_company" text,
	"relationship_type" text,
	"relationship_description" text,
	"years_known" integer,
	"worked_together_from" date,
	"worked_together_to" date,
	"email" text,
	"phone" text,
	"linkedin_url" text,
	"preferred_contact_method" text,
	"best_time_to_contact" text,
	"status" text DEFAULT 'pending',
	"contact_attempts" integer DEFAULT 0,
	"last_contact_attempt" timestamp with time zone,
	"contacted_at" timestamp with time zone,
	"contacted_by" uuid,
	"completed_at" timestamp with time zone,
	"rating" integer,
	"overall_impression" text,
	"would_rehire" boolean,
	"would_work_with_again" boolean,
	"feedback_summary" text,
	"strengths" text[],
	"areas_for_improvement" text[],
	"questionnaire_responses" jsonb,
	"verification_notes" text,
	"internal_notes" text,
	"reference_consent_given" boolean DEFAULT false,
	"consent_date" timestamp with time zone,
	"display_order" integer DEFAULT 0,
	"is_primary" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"updated_by" uuid,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_references" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_work_authorizations" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"authorization_type" text NOT NULL,
	"visa_type" text,
	"country_code" text NOT NULL,
	"status" text DEFAULT 'active' NOT NULL,
	"issue_date" date,
	"expiry_date" date,
	"receipt_number" text,
	"requires_sponsorship" boolean DEFAULT false,
	"current_sponsor" text,
	"is_transferable" boolean DEFAULT true,
	"transfer_in_progress" boolean DEFAULT false,
	"cap_exempt" boolean DEFAULT false,
	"lottery_selected" boolean,
	"lottery_year" integer,
	"ead_category" text,
	"ead_card_number" text,
	"ead_expiry" date,
	"i9_completed" boolean DEFAULT false,
	"i9_completed_at" timestamp with time zone,
	"i9_expiry_date" date,
	"i9_section_2_completed" boolean DEFAULT false,
	"i9_document_list" text,
	"i9_document_details" jsonb,
	"e_verify_status" text,
	"e_verify_case_number" text,
	"e_verify_completion_date" date,
	"passport_country" text,
	"passport_number_encrypted" text,
	"passport_issue_date" date,
	"passport_expiry_date" date,
	"has_valid_visa_stamp" boolean DEFAULT false,
	"visa_stamp_expiry" date,
	"documents" jsonb DEFAULT '[]'::jsonb,
	"notes" text,
	"is_primary" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"updated_by" uuid,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_work_authorizations" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "regions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"code" text,
	"country" text,
	"timezone" text DEFAULT 'America/New_York',
	"manager_id" uuid,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "regions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "pod_members" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"pod_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"role" text NOT NULL,
	"joined_at" timestamp with time zone DEFAULT now() NOT NULL,
	"left_at" timestamp with time zone,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "pod_members_pod_id_user_id_key" UNIQUE("pod_id","user_id"),
	CONSTRAINT "pod_members_role_check" CHECK (role = ANY (ARRAY['senior'::text, 'junior'::text]))
);
--> statement-breakpoint
ALTER TABLE "pod_members" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "job_skills" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"job_id" uuid NOT NULL,
	"skill_id" uuid NOT NULL,
	"importance" text DEFAULT 'required' NOT NULL,
	"min_years" numeric(4, 1),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "job_skills_job_id_skill_id_key" UNIQUE("job_id","skill_id")
);
--> statement-breakpoint
CREATE TABLE "system_roles" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"code" text NOT NULL,
	"name" text NOT NULL,
	"display_name" text NOT NULL,
	"description" text,
	"category" text NOT NULL,
	"hierarchy_level" integer DEFAULT 0,
	"is_system_role" boolean DEFAULT true,
	"is_active" boolean DEFAULT true,
	"color_code" text DEFAULT '#6366f1',
	"icon_name" text,
	"pod_type" text,
	"default_permissions" text[],
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "system_roles_code_key" UNIQUE("code"),
	CONSTRAINT "system_roles_category_check" CHECK (category = ANY (ARRAY['pod_ic'::text, 'pod_manager'::text, 'leadership'::text, 'executive'::text, 'portal'::text, 'admin'::text])),
	CONSTRAINT "system_roles_pod_type_check" CHECK ((pod_type IS NULL) OR (pod_type = ANY (ARRAY['recruiting'::text, 'bench_sales'::text, 'ta'::text])))
);
--> statement-breakpoint
ALTER TABLE "system_roles" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "job_requirements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"job_id" uuid NOT NULL,
	"requirement" text NOT NULL,
	"type" text DEFAULT 'must_have' NOT NULL,
	"sequence" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
CREATE TABLE "job_rates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"job_id" uuid NOT NULL,
	"bill_rate_min" numeric(10, 2),
	"bill_rate_max" numeric(10, 2),
	"pay_rate_min" numeric(10, 2),
	"pay_rate_max" numeric(10, 2),
	"currency" text DEFAULT 'USD',
	"rate_type" text DEFAULT 'hourly',
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
CREATE TABLE "job_assignments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"job_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"role" text DEFAULT 'secondary' NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "job_assignments_job_id_user_id_key" UNIQUE("job_id","user_id")
);
--> statement-breakpoint
CREATE TABLE "job_screening_questions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"job_id" uuid NOT NULL,
	"question" text NOT NULL,
	"type" text DEFAULT 'text' NOT NULL,
	"options" jsonb,
	"is_required" boolean DEFAULT false,
	"sequence" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
CREATE TABLE "candidate_documents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"type" text NOT NULL,
	"file_url" text NOT NULL,
	"file_name" text NOT NULL,
	"version" integer DEFAULT 1,
	"is_primary" boolean DEFAULT false,
	"uploaded_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"contact_id" uuid
);
--> statement-breakpoint
CREATE TABLE "candidate_profiles" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"summary" text,
	"total_experience_years" numeric(4, 1),
	"highest_education" text,
	"linkedin_url" text,
	"github_url" text,
	"portfolio_url" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"contact_id" uuid,
	CONSTRAINT "candidate_profiles_candidate_id_key" UNIQUE("candidate_id")
);
--> statement-breakpoint
CREATE TABLE "candidate_preferences" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"preferred_job_types" text[],
	"preferred_work_modes" text[],
	"preferred_industries" text[],
	"min_rate" numeric(10, 2),
	"max_commute_miles" integer,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"contact_id" uuid,
	CONSTRAINT "candidate_preferences_candidate_id_key" UNIQUE("candidate_id")
);
--> statement-breakpoint
CREATE TABLE "candidate_availability" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"available_from" date,
	"notice_period_days" integer,
	"preferred_rate_min" numeric(10, 2),
	"preferred_rate_max" numeric(10, 2),
	"currency" text DEFAULT 'USD',
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"contact_id" uuid,
	CONSTRAINT "candidate_availability_candidate_id_key" UNIQUE("candidate_id")
);
--> statement-breakpoint
CREATE TABLE "submission_rates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"submission_id" uuid NOT NULL,
	"bill_rate" numeric(10, 2),
	"pay_rate" numeric(10, 2),
	"margin_percent" numeric(5, 2),
	"margin_amount" numeric(10, 2),
	"currency" text DEFAULT 'USD',
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "submission_rates_submission_id_key" UNIQUE("submission_id")
);
--> statement-breakpoint
CREATE TABLE "submission_screening_answers" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"submission_id" uuid NOT NULL,
	"question_id" uuid NOT NULL,
	"answer" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "submission_screening_answers_submission_id_question_id_key" UNIQUE("submission_id","question_id")
);
--> statement-breakpoint
CREATE TABLE "submission_notes" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"submission_id" uuid NOT NULL,
	"note" text NOT NULL,
	"is_client_visible" boolean DEFAULT false,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
CREATE TABLE "marketing_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"format_type" text NOT NULL,
	"template_content" text NOT NULL,
	"placeholders" jsonb,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "hotlist_consultants" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"hotlist_id" uuid NOT NULL,
	"consultant_id" uuid NOT NULL,
	"position_order" integer,
	"notes" text,
	"added_at" timestamp with time zone DEFAULT now() NOT NULL,
	"added_by" uuid,
	CONSTRAINT "hotlist_consultants_hotlist_id_consultant_id_key" UNIQUE("hotlist_id","consultant_id")
);
--> statement-breakpoint
CREATE TABLE "events" (
	"id" uuid PRIMARY KEY DEFAULT uuid_generate_v4() NOT NULL,
	"event_type" text NOT NULL,
	"event_category" text NOT NULL,
	"aggregate_id" uuid,
	"payload" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"user_id" uuid,
	"user_email" text,
	"status" text DEFAULT 'pending',
	"retry_count" integer DEFAULT 0,
	"max_retries" integer DEFAULT 3,
	"next_retry_at" timestamp with time zone,
	"error_message" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"processed_at" timestamp with time zone,
	"failed_at" timestamp with time zone,
	"event_version" integer DEFAULT 1,
	"org_id" uuid NOT NULL,
	"severity" text DEFAULT 'info',
	"entity_type" text,
	"entity_id" uuid,
	"actor_type" text DEFAULT 'user',
	"actor_id" uuid,
	"event_data" jsonb DEFAULT '{}'::jsonb,
	"related_entities" jsonb DEFAULT '[]'::jsonb,
	"correlation_id" text,
	"causation_id" text,
	"parent_event_id" uuid,
	"occurred_at" timestamp with time zone DEFAULT now(),
	"idempotency_key" text,
	CONSTRAINT "valid_event_status" CHECK (status = ANY (ARRAY['pending'::text, 'processing'::text, 'completed'::text, 'failed'::text, 'dead_letter'::text])),
	CONSTRAINT "valid_max_retries" CHECK (max_retries >= 0),
	CONSTRAINT "valid_retry_count" CHECK (retry_count >= 0)
);
--> statement-breakpoint
ALTER TABLE "events" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "event_subscriptions" (
	"id" uuid PRIMARY KEY DEFAULT uuid_generate_v4() NOT NULL,
	"subscriber_name" text NOT NULL,
	"event_pattern" text NOT NULL,
	"handler_function" text,
	"webhook_url" text,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"last_triggered_at" timestamp with time zone,
	"org_id" uuid NOT NULL,
	"failure_count" integer DEFAULT 0,
	"consecutive_failures" integer DEFAULT 0,
	"last_failure_at" timestamp with time zone,
	"last_failure_message" text,
	"auto_disabled_at" timestamp with time zone,
	"user_id" uuid,
	"channel" text DEFAULT 'email' NOT NULL,
	"frequency" text DEFAULT 'immediate',
	"digest" boolean DEFAULT false,
	"filter_criteria" jsonb DEFAULT '{}'::jsonb,
	CONSTRAINT "valid_handler" CHECK ((handler_function IS NOT NULL) OR (webhook_url IS NOT NULL))
);
--> statement-breakpoint
ALTER TABLE "event_subscriptions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "skill_aliases" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"skill_id" uuid NOT NULL,
	"alias" text NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
CREATE TABLE "submission_status_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"submission_id" uuid NOT NULL,
	"from_status" text,
	"to_status" text NOT NULL,
	"reason" text,
	"changed_by" uuid NOT NULL,
	"changed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "interview_feedback" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"interview_id" uuid NOT NULL,
	"submitted_by" uuid NOT NULL,
	"rating" integer,
	"recommendation" text,
	"strengths" text,
	"weaknesses" text,
	"notes" text,
	"submitted_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
CREATE TABLE "interview_reminders" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"interview_id" uuid NOT NULL,
	"reminder_type" text NOT NULL,
	"sent_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "offer_terms" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"offer_id" uuid NOT NULL,
	"term_type" text NOT NULL,
	"value" text,
	"description" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
CREATE TABLE "placement_timesheets" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"placement_id" uuid NOT NULL,
	"week_ending" date NOT NULL,
	"regular_hours" numeric(5, 2) DEFAULT '0',
	"overtime_hours" numeric(5, 2) DEFAULT '0',
	"status" text DEFAULT 'draft' NOT NULL,
	"submitted_at" timestamp with time zone,
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
CREATE TABLE "consultant_visa_details" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"consultant_id" uuid NOT NULL,
	"visa_type" "visa_type" NOT NULL,
	"visa_start_date" date,
	"visa_expiry_date" date,
	"lca_status" text,
	"employer_of_record" text,
	"grace_period_ends" date,
	"alert_level" "visa_alert_level" DEFAULT 'green',
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "consultant_work_authorization" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"consultant_id" uuid NOT NULL,
	"auth_type" text NOT NULL,
	"start_date" date,
	"end_date" date,
	"document_url" text,
	"document_file_id" uuid,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "consultant_availability" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"consultant_id" uuid NOT NULL,
	"available_from" date NOT NULL,
	"notice_period_days" integer DEFAULT 0,
	"blackout_dates" jsonb,
	"travel_restrictions" text,
	"relocation_assistance_needed" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "consultant_rates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"consultant_id" uuid NOT NULL,
	"rate_type" text DEFAULT 'hourly' NOT NULL,
	"min_rate" numeric(10, 2) NOT NULL,
	"target_rate" numeric(10, 2) NOT NULL,
	"max_rate" numeric(10, 2),
	"currency" text DEFAULT 'USD' NOT NULL,
	"effective_from" date NOT NULL,
	"effective_to" date,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "marketing_profiles" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"consultant_id" uuid NOT NULL,
	"headline" text NOT NULL,
	"summary" text,
	"highlights" text[],
	"target_roles" text[],
	"target_industries" text[],
	"version" integer DEFAULT 1 NOT NULL,
	"status" "marketing_status" DEFAULT 'draft' NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "marketing_formats" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"profile_id" uuid NOT NULL,
	"format_type" text NOT NULL,
	"content" text,
	"file_url" text,
	"file_id" uuid,
	"version" integer DEFAULT 1 NOT NULL,
	"is_default" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "vendor_relationships" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"vendor_id" uuid NOT NULL,
	"related_entity_type" text NOT NULL,
	"related_entity_id" uuid NOT NULL,
	"relationship_type" text NOT NULL,
	"strength" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "vendor_blacklist" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"vendor_id" uuid NOT NULL,
	"reason" text NOT NULL,
	"review_date" date,
	"blacklisted_at" timestamp with time zone DEFAULT now() NOT NULL,
	"blacklisted_by" uuid
);
--> statement-breakpoint
CREATE TABLE "company_team" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"role" "company_team_role" NOT NULL,
	"is_primary" boolean DEFAULT false,
	"region" text,
	"job_categories" text[],
	"assigned_at" timestamp with time zone DEFAULT now(),
	"assigned_by" uuid,
	"removed_at" timestamp with time zone,
	"removed_by" uuid,
	"notify_on_new_job" boolean DEFAULT true,
	"notify_on_placement" boolean DEFAULT true,
	"notify_on_activity" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "company_team" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_contacts" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"job_title" text,
	"department" text,
	"role_description" text,
	"decision_authority" "contact_decision_authority",
	"influence_level" integer,
	"is_primary" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"relationship_strength" integer,
	"last_contact_date" date,
	"preferred_contact_method" varchar(20),
	"started_at" date,
	"left_at" date,
	"left_reason" text,
	"vendor_company_id" uuid,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	CONSTRAINT "company_contacts_influence_level_check" CHECK ((influence_level >= 1) AND (influence_level <= 5)),
	CONSTRAINT "company_contacts_relationship_strength_check" CHECK ((relationship_strength >= 1) AND (relationship_strength <= 5))
);
--> statement-breakpoint
ALTER TABLE "company_contacts" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_relationships" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_a_id" uuid NOT NULL,
	"company_b_id" uuid NOT NULL,
	"relationship_category" "company_relationship_category" NOT NULL,
	"relationship_direction" varchar(10) NOT NULL,
	"relationship_label_a_to_b" text,
	"relationship_label_b_to_a" text,
	"is_active" boolean DEFAULT true,
	"started_date" date,
	"ended_date" date,
	"details" jsonb DEFAULT '{}'::jsonb,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "company_relationships_check" CHECK (company_a_id <> company_b_id)
);
--> statement-breakpoint
ALTER TABLE "company_relationships" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "immigration_timelines" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"case_id" uuid NOT NULL,
	"milestone" text NOT NULL,
	"target_date" date,
	"actual_date" date,
	"status" text DEFAULT 'pending' NOT NULL,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "immigration_attorneys" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"firm" text,
	"email" text,
	"phone" text,
	"specialization" text[],
	"rating" numeric(3, 1),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "immigration_attorneys_rating_check" CHECK ((rating >= 1.0) AND (rating <= 5.0))
);
--> statement-breakpoint
CREATE TABLE "immigration_documents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"case_id" uuid NOT NULL,
	"document_type" text NOT NULL,
	"file_url" text,
	"file_id" uuid,
	"file_name" text,
	"issue_date" date,
	"expiry_date" date,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "immigration_alerts" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"consultant_id" uuid NOT NULL,
	"alert_type" text NOT NULL,
	"entity_id" uuid,
	"alert_date" date NOT NULL,
	"severity" text NOT NULL,
	"message" text NOT NULL,
	"acknowledged_by" uuid,
	"acknowledged_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "company_addresses" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"address_id" uuid NOT NULL,
	"address_type" varchar(30) NOT NULL,
	"is_primary" boolean DEFAULT false,
	"label" text,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "company_addresses" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_notes" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"note_type" "company_note_type" DEFAULT 'general',
	"title" text,
	"content" text NOT NULL,
	"is_pinned" boolean DEFAULT false,
	"is_private" boolean DEFAULT false,
	"related_contact_id" uuid,
	"related_job_id" uuid,
	"related_deal_id" uuid,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "company_notes" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "external_job_order_submissions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"order_id" uuid NOT NULL,
	"consultant_id" uuid NOT NULL,
	"status" text DEFAULT 'submitted' NOT NULL,
	"submitted_rate" numeric(10, 2),
	"submitted_at" timestamp with time zone DEFAULT now() NOT NULL,
	"client_response_at" timestamp with time zone,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "job_order_submissions_order_id_consultant_id_key" UNIQUE("order_id","consultant_id")
);
--> statement-breakpoint
CREATE TABLE "_migration_candidate_mapping" (
	"user_profile_id" uuid PRIMARY KEY NOT NULL,
	"contact_id" uuid NOT NULL,
	"migrated_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
CREATE TABLE "company_preferences" (
	"company_id" uuid PRIMARY KEY NOT NULL,
	"org_id" uuid NOT NULL,
	"preferred_skills" text[],
	"excluded_skills" text[],
	"required_certifications" text[],
	"min_years_experience" integer,
	"max_years_experience" integer,
	"preferred_experience_levels" text[],
	"degree_required" boolean DEFAULT false,
	"preferred_degree_levels" text[],
	"preferred_universities" text[],
	"visa_types_accepted" text[],
	"requires_us_citizen" boolean DEFAULT false,
	"work_mode_preference" varchar(20),
	"office_locations" text[],
	"remote_states_allowed" text[],
	"relocation_assistance" boolean DEFAULT false,
	"rate_range_min" numeric(10, 2),
	"rate_range_max" numeric(10, 2),
	"rate_type" varchar(20) DEFAULT 'hourly',
	"typical_start_timeline_days" integer,
	"interview_format_preference" text[],
	"decision_timeline_days" integer,
	"preferred_submission_format" varchar(50),
	"submission_limit_per_job" integer,
	"feedback_commitment" varchar(50),
	"custom_preferences" jsonb DEFAULT '{}'::jsonb,
	"special_instructions" text,
	"updated_at" timestamp with time zone DEFAULT now(),
	"updated_by" uuid
);
--> statement-breakpoint
ALTER TABLE "company_preferences" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_tags" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_id" uuid NOT NULL,
	"tag_name" text NOT NULL,
	"tag_category" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid
);
--> statement-breakpoint
ALTER TABLE "company_tags" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "benefit_plan_options" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"plan_id" uuid NOT NULL,
	"option_name" text NOT NULL,
	"coverage_level" "coverage_level" NOT NULL,
	"employer_contribution" numeric(10, 2),
	"employee_contribution" numeric(10, 2),
	"description" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "_migration_lead_mapping" (
	"lead_id" uuid PRIMARY KEY NOT NULL,
	"contact_id" uuid NOT NULL,
	"migrated_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
CREATE TABLE "integrations" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"type" varchar(50) NOT NULL,
	"provider" varchar(50) NOT NULL,
	"name" varchar(100) NOT NULL,
	"description" text,
	"config" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"status" varchar(20) DEFAULT 'inactive' NOT NULL,
	"is_primary" boolean DEFAULT false,
	"last_health_check" timestamp with time zone,
	"last_sync" timestamp with time zone,
	"health_status" varchar(20) DEFAULT 'unknown',
	"error_message" text,
	"error_count" integer DEFAULT 0,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "integrations" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "integration_health_logs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"integration_id" uuid NOT NULL,
	"check_type" varchar(50) DEFAULT 'manual' NOT NULL,
	"status" varchar(20) NOT NULL,
	"response_time_ms" integer,
	"error_message" text,
	"error_code" varchar(50),
	"details" jsonb DEFAULT '{}'::jsonb,
	"checked_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "integration_health_logs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "integration_types" (
	"id" varchar(50) PRIMARY KEY NOT NULL,
	"name" varchar(100) NOT NULL,
	"description" text,
	"category" varchar(50) NOT NULL,
	"icon" varchar(50),
	"config_schema" jsonb,
	"providers" jsonb DEFAULT '[]'::jsonb,
	"is_active" boolean DEFAULT true,
	"sort_order" integer DEFAULT 0
);
--> statement-breakpoint
ALTER TABLE "integration_types" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "external_job_orders" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"vendor_id" uuid,
	"client_name" text,
	"title" text NOT NULL,
	"description" text,
	"location" text,
	"work_mode" text,
	"rate_type" text DEFAULT 'hourly',
	"bill_rate" numeric(10, 2),
	"duration_months" integer,
	"positions" integer DEFAULT 1,
	"status" "job_order_status" DEFAULT 'new' NOT NULL,
	"priority" "job_order_priority" DEFAULT 'medium',
	"received_at" timestamp with time zone DEFAULT now() NOT NULL,
	"response_due_at" timestamp with time zone,
	"source" "job_order_source" DEFAULT 'email',
	"original_source_url" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	"vendor_company_id" uuid
);
--> statement-breakpoint
ALTER TABLE "external_job_orders" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "deal_stages_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"deal_id" uuid NOT NULL,
	"stage" text NOT NULL,
	"previous_stage" text,
	"entered_at" timestamp with time zone DEFAULT now() NOT NULL,
	"exited_at" timestamp with time zone,
	"duration_days" integer,
	"notes" text,
	"reason" text,
	"changed_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "deal_stages_history" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "deal_stakeholders" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"deal_id" uuid NOT NULL,
	"contact_id" uuid,
	"name" text,
	"title" text,
	"email" text,
	"role" text NOT NULL,
	"influence_level" text,
	"sentiment" text,
	"engagement_notes" text,
	"is_active" boolean DEFAULT true,
	"is_primary" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "deal_stakeholders" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "lead_scores" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"lead_id" uuid NOT NULL,
	"score" integer DEFAULT 0 NOT NULL,
	"factors" jsonb,
	"budget_score" integer DEFAULT 0,
	"authority_score" integer DEFAULT 0,
	"need_score" integer DEFAULT 0,
	"timeline_score" integer DEFAULT 0,
	"engagement_score" integer DEFAULT 0,
	"fit_score" integer DEFAULT 0,
	"calculated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"calculated_by" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "lead_scores" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "lead_qualification" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"lead_id" uuid NOT NULL,
	"has_budget" boolean,
	"budget_amount" numeric(12, 2),
	"budget_timeframe" text,
	"budget_notes" text,
	"decision_maker" text,
	"decision_process" text,
	"other_stakeholders" text,
	"authority_notes" text,
	"need_identified" boolean,
	"need_urgency" text,
	"pain_points" text[],
	"current_solution" text,
	"need_notes" text,
	"timeline" text,
	"decision_date" timestamp with time zone,
	"project_start_date" timestamp with time zone,
	"timeline_notes" text,
	"qualified_by" uuid,
	"qualified_at" timestamp with time zone,
	"qualification_status" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "lead_qualification" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_work_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"company_name" text NOT NULL,
	"company_industry" text,
	"company_size" text,
	"job_title" text NOT NULL,
	"department" text,
	"employment_type" text,
	"employment_basis" text,
	"location_city" text,
	"location_state" text,
	"location_country" text,
	"country_code" text,
	"is_remote" boolean DEFAULT false,
	"remote_type" text,
	"start_date" date NOT NULL,
	"end_date" date,
	"is_current" boolean DEFAULT false,
	"description" text,
	"responsibilities" text[],
	"achievements" text[],
	"skills_used" text[],
	"tools_used" text[],
	"projects" text[],
	"salary_amount" numeric(12, 2),
	"salary_currency" text DEFAULT 'USD',
	"salary_type" text,
	"supervisor_name" text,
	"supervisor_title" text,
	"supervisor_email" text,
	"supervisor_phone" text,
	"hr_contact_name" text,
	"hr_contact_email" text,
	"hr_contact_phone" text,
	"is_verified" boolean DEFAULT false,
	"verified_at" timestamp with time zone,
	"verified_by" uuid,
	"verification_method" text,
	"verification_notes" text,
	"reason_for_leaving" text,
	"is_rehire_eligible" boolean,
	"rehire_notes" text,
	"display_order" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"updated_by" uuid,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_work_history" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "lead_touchpoints" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"lead_id" uuid NOT NULL,
	"touchpoint_type" text NOT NULL,
	"direction" text DEFAULT 'outbound' NOT NULL,
	"subject" text,
	"notes" text,
	"outcome" text,
	"next_steps" text,
	"next_follow_up_date" timestamp with time zone,
	"duration_minutes" integer,
	"campaign_id" uuid,
	"template_used" text,
	"created_by" uuid,
	"touchpoint_date" timestamp with time zone DEFAULT now() NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "lead_touchpoints" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "deal_competitors" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"deal_id" uuid NOT NULL,
	"competitor_name" text NOT NULL,
	"competitor_website" text,
	"strengths" text,
	"weaknesses" text,
	"our_differentiators" text,
	"pricing" text,
	"status" text DEFAULT 'active',
	"threat_level" text,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "deal_competitors" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "deal_products" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"deal_id" uuid NOT NULL,
	"product_type" text NOT NULL,
	"product_name" text,
	"description" text,
	"quantity" integer DEFAULT 1,
	"unit_price" numeric(12, 2),
	"total_value" numeric(12, 2),
	"discount" numeric(5, 2),
	"currency" text DEFAULT 'USD',
	"duration_months" integer,
	"start_date" timestamp with time zone,
	"end_date" timestamp with time zone,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "deal_products" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "employees" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"employee_number" text,
	"status" "employment_status" DEFAULT 'onboarding' NOT NULL,
	"employment_type" "employment_type" DEFAULT 'fte' NOT NULL,
	"hire_date" date NOT NULL,
	"termination_date" date,
	"termination_reason" text,
	"department" text,
	"job_title" text,
	"manager_id" uuid,
	"location" text,
	"work_mode" "work_mode" DEFAULT 'on_site',
	"salary_type" "salary_type" DEFAULT 'annual' NOT NULL,
	"salary_amount" numeric(12, 2),
	"currency" text DEFAULT 'USD',
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "employees_user_id_key" UNIQUE("user_id"),
	CONSTRAINT "employees_employee_number_key" UNIQUE("employee_number")
);
--> statement-breakpoint
CREATE TABLE "employee_profiles" (
	"employee_id" uuid PRIMARY KEY NOT NULL,
	"date_of_birth" date,
	"ssn_encrypted" text,
	"address_street" text,
	"address_city" text,
	"address_state" text,
	"address_country" text DEFAULT 'USA',
	"address_postal" text,
	"emergency_contact_name" text,
	"emergency_contact_phone" text,
	"emergency_contact_relationship" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "employee_documents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"employee_id" uuid NOT NULL,
	"document_type" "document_type" NOT NULL,
	"file_name" text NOT NULL,
	"file_url" text NOT NULL,
	"issue_date" date,
	"expiry_date" date,
	"status" "document_status" DEFAULT 'pending' NOT NULL,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "employee_time_off" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"employee_id" uuid NOT NULL,
	"type" time_off_type NOT NULL,
	"status" time_off_status DEFAULT 'pending' NOT NULL,
	"start_date" date NOT NULL,
	"end_date" date NOT NULL,
	"hours" numeric(5, 2) NOT NULL,
	"reason" text,
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"denial_reason" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "benefit_plans" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"type" "benefit_type" NOT NULL,
	"provider" text,
	"status" text DEFAULT 'active' NOT NULL,
	"effective_date" date,
	"termination_date" date,
	"description" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "employee_benefits" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"employee_id" uuid NOT NULL,
	"plan_option_id" uuid NOT NULL,
	"status" "benefit_status" DEFAULT 'pending' NOT NULL,
	"enrollment_date" date,
	"coverage_start" date,
	"coverage_end" date,
	"dependents_count" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "benefit_dependents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"employee_benefit_id" uuid NOT NULL,
	"name" text NOT NULL,
	"relationship" "relationship" NOT NULL,
	"date_of_birth" date,
	"ssn_encrypted" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "raci_change_log" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"object_owner_id" uuid,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"change_type" text NOT NULL,
	"previous_role" text,
	"new_role" text,
	"previous_user_id" uuid,
	"new_user_id" uuid,
	"previous_permission" text,
	"new_permission" text,
	"changed_by" uuid,
	"reason" text,
	"changed_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "raci_change_log_change_type_check" CHECK (change_type = ANY (ARRAY['assigned'::text, 'role_changed'::text, 'permission_changed'::text, 'removed'::text, 'transferred'::text]))
);
--> statement-breakpoint
ALTER TABLE "raci_change_log" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "employee_compliance" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"employee_id" uuid NOT NULL,
	"requirement_id" uuid NOT NULL,
	"status" "compliance_status" DEFAULT 'pending' NOT NULL,
	"due_date" date,
	"completed_at" timestamp with time zone,
	"document_url" text,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "i9_records" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"employee_id" uuid NOT NULL,
	"section1_completed_at" timestamp with time zone,
	"section2_completed_at" timestamp with time zone,
	"list_a_document" text,
	"list_b_document" text,
	"list_c_document" text,
	"authorized_rep_name" text,
	"authorized_rep_title" text,
	"reverification_date" date,
	"status" "i9_status" DEFAULT 'pending' NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "i9_records_employee_id_key" UNIQUE("employee_id")
);
--> statement-breakpoint
CREATE TABLE "legacy_compliance_requirements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"type" "compliance_type" NOT NULL,
	"jurisdiction" text,
	"applies_to" "compliance_applies_to" DEFAULT 'all' NOT NULL,
	"frequency" "compliance_frequency" NOT NULL,
	"description" text,
	"document_template_url" text,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "performance_goals" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"employee_id" uuid NOT NULL,
	"review_id" uuid,
	"goal" text NOT NULL,
	"category" "performance_goal_category" NOT NULL,
	"weight_percent" integer,
	"status" "goal_status" DEFAULT 'not_started' NOT NULL,
	"rating" integer,
	"comments" text,
	"start_date" date,
	"target_date" date,
	"completed_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "performance_goals_rating_check" CHECK ((rating >= 1) AND (rating <= 5))
);
--> statement-breakpoint
CREATE TABLE "performance_feedback" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"review_id" uuid NOT NULL,
	"feedback_type" "feedback_type" NOT NULL,
	"content" text NOT NULL,
	"category" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "pattern_checklist_items" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"pattern_id" uuid NOT NULL,
	"item_text" text NOT NULL,
	"order_index" integer DEFAULT 0,
	"is_required" boolean DEFAULT false,
	"auto_complete_condition" jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "activity_pattern_successors" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"pattern_id" uuid NOT NULL,
	"successor_pattern_id" uuid NOT NULL,
	"condition_type" text DEFAULT 'always',
	"condition_field" text,
	"condition_value" text,
	"condition_expression" jsonb,
	"delay_days" integer DEFAULT 0,
	"order_index" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "activity_pattern_successors_pattern_id_successor_pattern_id_key" UNIQUE("pattern_id","successor_pattern_id")
);
--> statement-breakpoint
CREATE TABLE "workplan_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"code" text NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"entity_type" text NOT NULL,
	"trigger_event" text DEFAULT 'manual',
	"trigger_status" text,
	"trigger_field" text,
	"trigger_condition" jsonb,
	"completion_criteria" text DEFAULT 'all_required',
	"is_system" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"version" integer DEFAULT 1,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "workplan_templates_org_id_code_key" UNIQUE("org_id","code")
);
--> statement-breakpoint
ALTER TABLE "workplan_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workplan_phases" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"template_id" uuid NOT NULL,
	"phase_name" text NOT NULL,
	"phase_code" text NOT NULL,
	"description" text,
	"order_index" integer DEFAULT 0,
	"completion_criteria" text DEFAULT 'all_required',
	"auto_advance" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "workplan_phases_template_id_phase_code_key" UNIQUE("template_id","phase_code")
);
--> statement-breakpoint
CREATE TABLE "workplan_instances" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"template_id" uuid,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"template_code" text,
	"template_name" text,
	"status" text DEFAULT 'active',
	"total_activities" integer DEFAULT 0,
	"completed_activities" integer DEFAULT 0,
	"skipped_activities" integer DEFAULT 0,
	"current_phase" text,
	"started_at" timestamp with time zone DEFAULT now(),
	"paused_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"canceled_at" timestamp with time zone,
	"outcome" text,
	"outcome_notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"progress_percentage" integer GENERATED ALWAYS AS (
CASE
    WHEN (total_activities > 0) THEN (((completed_activities + skipped_activities) * 100) / total_activities)
    ELSE 0
END) STORED
);
--> statement-breakpoint
ALTER TABLE "workplan_instances" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workplan_template_activities" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"template_id" uuid NOT NULL,
	"pattern_id" uuid NOT NULL,
	"order_index" integer DEFAULT 0 NOT NULL,
	"phase" text,
	"is_required" boolean DEFAULT true,
	"skip_condition" jsonb,
	"can_run_parallel" boolean DEFAULT false,
	"depends_on_activity_ids" uuid[],
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "workplan_template_activities_template_id_pattern_id_key" UNIQUE("template_id","pattern_id")
);
--> statement-breakpoint
CREATE TABLE "activity_participants" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"activity_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"role" text NOT NULL,
	"permission" text DEFAULT 'view',
	"is_primary" boolean DEFAULT false,
	"notify_on_update" boolean DEFAULT true,
	"added_at" timestamp with time zone DEFAULT now() NOT NULL,
	"added_by" uuid,
	CONSTRAINT "activity_participants_activity_id_user_id_key" UNIQUE("activity_id","user_id")
);
--> statement-breakpoint
CREATE TABLE "activity_field_values" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"activity_id" uuid NOT NULL,
	"field_id" uuid NOT NULL,
	"field_value" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "activity_field_values_activity_id_field_id_key" UNIQUE("activity_id","field_id")
);
--> statement-breakpoint
CREATE TABLE "activity_checklist_items" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"activity_id" uuid NOT NULL,
	"pattern_checklist_item_id" uuid,
	"item_text" text NOT NULL,
	"order_index" integer DEFAULT 0,
	"is_completed" boolean DEFAULT false,
	"completed_at" timestamp with time zone,
	"completed_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "activity_comments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"activity_id" uuid NOT NULL,
	"comment_text" text NOT NULL,
	"comment_type" text DEFAULT 'comment',
	"parent_comment_id" uuid,
	"mentioned_users" uuid[],
	"is_internal" boolean DEFAULT false,
	"deleted_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_by" uuid
);
--> statement-breakpoint
CREATE TABLE "activity_attachments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"activity_id" uuid NOT NULL,
	"file_name" text NOT NULL,
	"file_size" integer,
	"file_type" text,
	"file_url" text NOT NULL,
	"storage_key" text,
	"description" text,
	"deleted_at" timestamp with time zone,
	"uploaded_at" timestamp with time zone DEFAULT now() NOT NULL,
	"uploaded_by" uuid NOT NULL
);
--> statement-breakpoint
CREATE TABLE "activity_reminders" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"activity_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"remind_at" timestamp with time zone NOT NULL,
	"reminder_type" text DEFAULT 'relative',
	"relative_days" integer,
	"relative_hours" integer,
	"channel" text DEFAULT 'email',
	"is_sent" boolean DEFAULT false,
	"sent_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "pod_sprint_metrics" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"pod_id" uuid NOT NULL,
	"sprint_number" integer NOT NULL,
	"sprint_start_date" date NOT NULL,
	"sprint_end_date" date NOT NULL,
	"placements_target" integer DEFAULT 2,
	"placements_stretch_target" integer DEFAULT 3,
	"submissions_target" integer DEFAULT 20,
	"submissions_stretch_target" integer DEFAULT 30,
	"client_meetings_target" integer DEFAULT 5,
	"new_candidates_target" integer DEFAULT 30,
	"placements_actual" integer DEFAULT 0,
	"submissions_actual" integer DEFAULT 0,
	"client_meetings_actual" integer DEFAULT 0,
	"new_candidates_actual" integer DEFAULT 0,
	"target_achievement_pct" numeric(5, 2) GENERATED ALWAYS AS (
CASE
    WHEN (placements_target > 0) THEN round((((placements_actual)::numeric / (placements_target)::numeric) * (100)::numeric), 2)
    ELSE (0)::numeric
END) STORED,
	"status" text DEFAULT 'active',
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "pod_sprint_metrics_pod_id_sprint_number_key" UNIQUE("pod_id","sprint_number"),
	CONSTRAINT "pod_sprint_metrics_status_check" CHECK (status = ANY (ARRAY['active'::text, 'completed'::text, 'cancelled'::text]))
);
--> statement-breakpoint
ALTER TABLE "pod_sprint_metrics" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "activity_time_entries" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"activity_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"start_time" timestamp with time zone NOT NULL,
	"end_time" timestamp with time zone,
	"duration_minutes" integer,
	"description" text,
	"is_billable" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "activity_dependencies" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"activity_id" uuid NOT NULL,
	"depends_on_activity_id" uuid NOT NULL,
	"dependency_type" text DEFAULT 'finish_to_start',
	"lag_days" integer DEFAULT 0,
	"is_strict" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "activity_dependencies_activity_id_depends_on_activity_id_key" UNIQUE("activity_id","depends_on_activity_id")
);
--> statement-breakpoint
CREATE TABLE "activity_auto_rules" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"rule_name" text NOT NULL,
	"rule_code" text NOT NULL,
	"description" text,
	"event_type" text NOT NULL,
	"event_category" text NOT NULL,
	"entity_type" text NOT NULL,
	"condition" jsonb,
	"activity_pattern_id" uuid NOT NULL,
	"delay_days" integer DEFAULT 0,
	"delay_hours" integer DEFAULT 0,
	"assign_to_field" text,
	"assign_to_user_id" uuid,
	"assign_to_group_id" uuid,
	"is_active" boolean DEFAULT true,
	"priority" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "activity_auto_rules_org_id_rule_code_key" UNIQUE("org_id","rule_code")
);
--> statement-breakpoint
CREATE TABLE "activity_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"activity_id" uuid NOT NULL,
	"action" text NOT NULL,
	"field_changed" text,
	"old_value" text,
	"new_value" text,
	"changed_by" uuid,
	"changed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"notes" text
);
--> statement-breakpoint
CREATE TABLE "work_queues" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"queue_name" text NOT NULL,
	"queue_code" text NOT NULL,
	"description" text,
	"queue_type" text DEFAULT 'activity',
	"entity_type" text,
	"assigned_to_group_id" uuid,
	"assignment_strategy" text DEFAULT 'round_robin',
	"filter_criteria" jsonb,
	"sort_order" text DEFAULT 'priority_desc',
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "work_queues_org_id_queue_code_key" UNIQUE("org_id","queue_code")
);
--> statement-breakpoint
CREATE TABLE "addresses" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"address_type" text NOT NULL,
	"address_line_1" text,
	"address_line_2" text,
	"address_line_3" text,
	"city" text,
	"state_province" text,
	"postal_code" text,
	"country_code" text DEFAULT 'US' NOT NULL,
	"county" text,
	"latitude" numeric(10, 7),
	"longitude" numeric(10, 7),
	"is_verified" boolean DEFAULT false,
	"verified_at" timestamp with time zone,
	"verification_source" text,
	"is_primary" boolean DEFAULT false,
	"effective_from" date,
	"effective_to" date,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	"updated_by" uuid,
	CONSTRAINT "addresses_address_type_check" CHECK (address_type = ANY (ARRAY['current'::text, 'permanent'::text, 'mailing'::text, 'work'::text, 'billing'::text, 'shipping'::text, 'headquarters'::text, 'office'::text, 'job_location'::text, 'meeting'::text, 'first_day'::text])),
	CONSTRAINT "addresses_entity_type_check" CHECK (entity_type = ANY (ARRAY['candidate'::text, 'account'::text, 'contact'::text, 'vendor'::text, 'organization'::text, 'lead'::text, 'job'::text, 'interview'::text, 'employee'::text, 'placement'::text]))
);
--> statement-breakpoint
ALTER TABLE "addresses" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "queue_items" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"queue_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"priority" integer DEFAULT 0,
	"order_index" integer DEFAULT 0,
	"assigned_to" uuid,
	"assigned_at" timestamp with time zone,
	"status" text DEFAULT 'queued',
	"enqueued_at" timestamp with time zone DEFAULT now() NOT NULL,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"removed_at" timestamp with time zone,
	"metadata" jsonb,
	CONSTRAINT "queue_items_queue_id_entity_type_entity_id_key" UNIQUE("queue_id","entity_type","entity_id")
);
--> statement-breakpoint
CREATE TABLE "sla_instances" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"sla_definition_id" uuid NOT NULL,
	"activity_id" uuid NOT NULL,
	"start_time" timestamp with time zone NOT NULL,
	"target_time" timestamp with time zone NOT NULL,
	"warning_time" timestamp with time zone,
	"critical_time" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"status" text DEFAULT 'active',
	"paused_at" timestamp with time zone,
	"resumed_at" timestamp with time zone,
	"breach_duration" integer,
	"is_breached" boolean DEFAULT false,
	"breached_at" timestamp with time zone,
	"escalation_sent" boolean DEFAULT false,
	"escalation_sent_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "sla_instances" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "bulk_activity_jobs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"job_name" text NOT NULL,
	"job_type" text NOT NULL,
	"activity_pattern_id" uuid,
	"target_entity_type" text,
	"target_entity_ids" uuid[],
	"target_criteria" jsonb,
	"operation" jsonb NOT NULL,
	"status" text DEFAULT 'pending',
	"total_items" integer DEFAULT 0,
	"processed_items" integer DEFAULT 0,
	"failed_items" integer DEFAULT 0,
	"error_log" jsonb,
	"result_summary" jsonb,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"canceled_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid NOT NULL
);
--> statement-breakpoint
CREATE TABLE "activity_metrics" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"metric_date" timestamp with time zone NOT NULL,
	"entity_type" text,
	"activity_type" text,
	"activity_category" text,
	"user_id" uuid,
	"pod_id" uuid,
	"total_activities" integer DEFAULT 0,
	"created_activities" integer DEFAULT 0,
	"completed_activities" integer DEFAULT 0,
	"overdue_activities" integer DEFAULT 0,
	"completion_rate" numeric(5, 2),
	"avg_completion_time_hours" numeric(10, 2),
	"sla_met_count" integer DEFAULT 0,
	"sla_breached_count" integer DEFAULT 0,
	"sla_compliance_rate" numeric(5, 2),
	"total_time_minutes" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "team_metrics" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"pod_id" uuid NOT NULL,
	"metric_date" timestamp with time zone NOT NULL,
	"metric_period" text DEFAULT 'day',
	"total_activities" integer DEFAULT 0,
	"completed_activities" integer DEFAULT 0,
	"avg_response_time_hours" numeric(10, 2),
	"avg_resolution_time_hours" numeric(10, 2),
	"total_active_members" integer DEFAULT 0,
	"avg_activities_per_member" numeric(10, 2),
	"sla_compliance_rate" numeric(5, 2),
	"activities_created_per_day" numeric(10, 2),
	"activities_completed_per_day" numeric(10, 2),
	"escalation_count" integer DEFAULT 0,
	"reassignment_count" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "team_metrics_pod_id_metric_date_metric_period_key" UNIQUE("pod_id","metric_date","metric_period")
);
--> statement-breakpoint
CREATE TABLE "learning_paths" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"slug" text NOT NULL,
	"title" text NOT NULL,
	"description" text NOT NULL,
	"category" text,
	"difficulty" "skill_level" DEFAULT 'beginner' NOT NULL,
	"duration_estimate_hours" integer,
	"status" "path_status" DEFAULT 'draft' NOT NULL,
	"thumbnail_url" text,
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "learning_paths_slug_key" UNIQUE("slug")
);
--> statement-breakpoint
CREATE TABLE "learning_path_courses" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"path_id" uuid NOT NULL,
	"course_id" uuid NOT NULL,
	"sequence" integer NOT NULL,
	"is_required" boolean DEFAULT true NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "learning_path_courses_path_id_course_id_key" UNIQUE("path_id","course_id")
);
--> statement-breakpoint
CREATE TABLE "path_enrollments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"path_id" uuid NOT NULL,
	"status" "enrollment_status" DEFAULT 'pending' NOT NULL,
	"enrolled_at" timestamp with time zone DEFAULT now() NOT NULL,
	"completed_at" timestamp with time zone,
	"progress_percent" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "path_enrollments_user_id_path_id_key" UNIQUE("user_id","path_id"),
	CONSTRAINT "path_enrollments_progress_percent_check" CHECK ((progress_percent >= 0) AND (progress_percent <= 100))
);
--> statement-breakpoint
CREATE TABLE "certificates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"template_id" uuid,
	"certificate_number" text NOT NULL,
	"issued_at" timestamp with time zone DEFAULT now() NOT NULL,
	"expiry_date" timestamp with time zone,
	"pdf_url" text,
	"verification_code" text NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "certificates_certificate_number_key" UNIQUE("certificate_number"),
	CONSTRAINT "certificates_verification_code_key" UNIQUE("verification_code")
);
--> statement-breakpoint
CREATE TABLE "certificate_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"design_template" text NOT NULL,
	"fields" jsonb,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "user_levels" (
	"user_id" uuid PRIMARY KEY NOT NULL,
	"current_level" integer DEFAULT 1 NOT NULL,
	"current_xp" integer DEFAULT 0 NOT NULL,
	"xp_to_next_level" integer DEFAULT 100 NOT NULL,
	"level_up_at" timestamp with time zone,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "user_achievements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"achievement_id" uuid NOT NULL,
	"unlocked_at" timestamp with time zone DEFAULT now() NOT NULL,
	"progress" jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "user_achievements_user_id_achievement_id_key" UNIQUE("user_id","achievement_id")
);
--> statement-breakpoint
CREATE TABLE "achievements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"slug" text NOT NULL,
	"name" text NOT NULL,
	"description" text NOT NULL,
	"category" text NOT NULL,
	"badge_url" text,
	"xp_reward" integer DEFAULT 0 NOT NULL,
	"criteria" jsonb NOT NULL,
	"is_secret" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "achievements_slug_key" UNIQUE("slug")
);
--> statement-breakpoint
CREATE TABLE "learning_streaks" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"streak_type" "streak_type_enum" NOT NULL,
	"current_count" integer DEFAULT 0 NOT NULL,
	"longest_count" integer DEFAULT 0 NOT NULL,
	"last_activity_date" timestamp with time zone,
	"streak_started_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "learning_streaks_user_id_streak_type_key" UNIQUE("user_id","streak_type")
);
--> statement-breakpoint
CREATE TABLE "leaderboards" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"type" "leaderboard_type" NOT NULL,
	"scope" "leaderboard_scope" NOT NULL,
	"period_start" timestamp with time zone NOT NULL,
	"period_end" timestamp with time zone NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "leaderboard_entries" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"leaderboard_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"rank" integer NOT NULL,
	"xp_earned" integer DEFAULT 0 NOT NULL,
	"courses_completed" integer DEFAULT 0 NOT NULL,
	"lessons_completed" integer DEFAULT 0 NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "leaderboard_entries_leaderboard_id_user_id_key" UNIQUE("leaderboard_id","user_id")
);
--> statement-breakpoint
CREATE TABLE "level_definitions" (
	"level" integer PRIMARY KEY NOT NULL,
	"xp_required" integer NOT NULL,
	"title" text NOT NULL,
	"badge_url" text,
	"perks" jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "login_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid,
	"org_id" uuid NOT NULL,
	"email" varchar(255) NOT NULL,
	"success" boolean NOT NULL,
	"ip_address" "inet",
	"user_agent" text,
	"failure_reason" varchar(100),
	"device_info" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "login_history" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "user_invitations" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"email" varchar(255) NOT NULL,
	"first_name" varchar(100),
	"last_name" varchar(100),
	"role_id" uuid NOT NULL,
	"pod_id" uuid,
	"manager_id" uuid,
	"token" varchar(255) NOT NULL,
	"invited_by" uuid NOT NULL,
	"expires_at" timestamp with time zone NOT NULL,
	"accepted_at" timestamp with time zone,
	"cancelled_at" timestamp with time zone,
	"require_two_factor" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "user_invitations_token_key" UNIQUE("token")
);
--> statement-breakpoint
ALTER TABLE "user_invitations" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "webhooks" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" varchar(100) NOT NULL,
	"description" text,
	"url" text NOT NULL,
	"secret" varchar(64) NOT NULL,
	"events" text[] DEFAULT '{""}' NOT NULL,
	"headers" jsonb DEFAULT '{}'::jsonb,
	"status" varchar(20) DEFAULT 'active' NOT NULL,
	"consecutive_failures" integer DEFAULT 0,
	"last_triggered_at" timestamp with time zone,
	"last_success_at" timestamp with time zone,
	"last_failure_at" timestamp with time zone,
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "webhooks" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "webhook_deliveries" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"webhook_id" uuid NOT NULL,
	"event_type" varchar(100) NOT NULL,
	"event_id" uuid,
	"payload" jsonb NOT NULL,
	"request_url" text NOT NULL,
	"request_headers" jsonb NOT NULL,
	"request_body" text NOT NULL,
	"response_status" integer,
	"response_headers" jsonb,
	"response_body" text,
	"duration_ms" integer,
	"attempt_number" integer DEFAULT 1,
	"max_attempts" integer DEFAULT 3,
	"status" varchar(20) DEFAULT 'pending' NOT NULL,
	"error_message" text,
	"error_code" varchar(50),
	"next_retry_at" timestamp with time zone,
	"delivered_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "webhook_deliveries" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "integration_retry_config" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"max_retries" integer DEFAULT 3 NOT NULL,
	"retry_strategy" varchar(20) DEFAULT 'exponential' NOT NULL,
	"base_delay_seconds" integer DEFAULT 5 NOT NULL,
	"max_delay_seconds" integer DEFAULT 300 NOT NULL,
	"enable_jitter" boolean DEFAULT true,
	"enable_dlq" boolean DEFAULT true,
	"dlq_retention_days" integer DEFAULT 30,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "integration_retry_config_org_id_key" UNIQUE("org_id")
);
--> statement-breakpoint
ALTER TABLE "integration_retry_config" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "integration_oauth_tokens" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"integration_id" uuid NOT NULL,
	"user_id" uuid,
	"provider" varchar(50) NOT NULL,
	"access_token" text NOT NULL,
	"refresh_token" text,
	"token_type" varchar(20) DEFAULT 'Bearer',
	"scope" text,
	"expires_at" timestamp with time zone,
	"refresh_expires_at" timestamp with time zone,
	"account_id" varchar(255),
	"account_email" varchar(255),
	"raw_token_response" jsonb,
	"last_refreshed_at" timestamp with time zone,
	"last_used_at" timestamp with time zone,
	"status" varchar(20) DEFAULT 'active',
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "integration_oauth_tokens" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "integration_failover_config" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"integration_type" varchar(50) NOT NULL,
	"primary_integration_id" uuid NOT NULL,
	"backup_integration_id" uuid,
	"failover_threshold" integer DEFAULT 3,
	"auto_failover" boolean DEFAULT true,
	"auto_recovery" boolean DEFAULT false,
	"recovery_check_interval_minutes" integer DEFAULT 30,
	"current_active" varchar(20) DEFAULT 'primary',
	"last_failover_at" timestamp with time zone,
	"last_recovery_at" timestamp with time zone,
	"failover_count" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "integration_failover_config_org_id_integration_type_key" UNIQUE("org_id","integration_type")
);
--> statement-breakpoint
ALTER TABLE "integration_failover_config" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "activities" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"activity_type" text NOT NULL,
	"status" text DEFAULT 'open' NOT NULL,
	"priority" text DEFAULT 'medium' NOT NULL,
	"subject" text,
	"body" text,
	"direction" text,
	"scheduled_at" timestamp with time zone,
	"due_date" timestamp with time zone DEFAULT now(),
	"escalation_date" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"skipped_at" timestamp with time zone,
	"duration_minutes" integer,
	"outcome" text,
	"assigned_to" uuid,
	"performed_by" uuid,
	"poc_id" uuid,
	"parent_activity_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"pattern_code" text,
	"pattern_id" uuid,
	"workplan_instance_id" uuid,
	"description" text,
	"category" text,
	"instructions" text,
	"checklist" jsonb,
	"checklist_progress" jsonb,
	"assigned_group" uuid,
	"assigned_at" timestamp with time zone,
	"started_at" timestamp with time zone,
	"scheduled_for" timestamp with time zone,
	"outcome_notes" text,
	"auto_created" boolean DEFAULT false,
	"auto_completed" boolean DEFAULT false,
	"predecessor_activity_id" uuid,
	"escalation_count" integer DEFAULT 0,
	"last_escalated_at" timestamp with time zone,
	"reminder_sent_at" timestamp with time zone,
	"reminder_count" integer DEFAULT 0,
	"deleted_at" timestamp with time zone,
	"updated_by" uuid,
	"activity_number" text,
	"secondary_entity_type" text,
	"secondary_entity_id" uuid,
	"follow_up_required" boolean DEFAULT false,
	"follow_up_date" timestamp with time zone,
	"follow_up_activity_id" uuid,
	"tags" text[],
	"custom_fields" jsonb DEFAULT '{}'::jsonb,
	"points_earned" numeric(5, 2) DEFAULT '0',
	"related_contact_id" uuid,
	"related_deal_id" uuid,
	"related_campaign_id" uuid,
	"next_steps" text,
	"next_follow_up_date" timestamp with time zone,
	CONSTRAINT "uq_activities_org_activity_number" UNIQUE("org_id","activity_number")
);
--> statement-breakpoint
ALTER TABLE "activities" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "external_job_order_requirements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"order_id" uuid NOT NULL,
	"requirement" text NOT NULL,
	"type" text NOT NULL,
	"priority" integer DEFAULT 1,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "external_job_order_skills" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"order_id" uuid NOT NULL,
	"skill_name" text NOT NULL,
	"years_required" numeric(4, 1),
	"proficiency_required" integer,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "job_order_skills_proficiency_required_check" CHECK ((proficiency_required >= 1) AND (proficiency_required <= 5))
);
--> statement-breakpoint
CREATE TABLE "external_job_order_notes" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"order_id" uuid NOT NULL,
	"note" text NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
CREATE TABLE "skills" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"category" text,
	"parent_skill_id" uuid,
	"description" text,
	"is_verified" boolean DEFAULT false,
	"usage_count" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"canonical_name" varchar(100),
	"skill_level" integer DEFAULT 2,
	"hierarchy_path" text,
	"aliases" jsonb DEFAULT '[]'::jsonb,
	"related_skills" uuid[],
	"version" varchar(20),
	"is_latest_version" boolean DEFAULT true,
	"demand_score" numeric(5, 2) DEFAULT '0',
	"trending" boolean DEFAULT false,
	"trending_direction" varchar(10),
	"embedding" vector(1536),
	"deprecated" boolean DEFAULT false,
	"deprecated_successor_id" uuid,
	"org_id" uuid,
	"search_vector" "tsvector",
	"domain" varchar(50) DEFAULT 'technology',
	CONSTRAINT "skills_name_key" UNIQUE("name")
);
--> statement-breakpoint
ALTER TABLE "skills" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "bench_consultants" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"status" "bench_status" DEFAULT 'available' NOT NULL,
	"bench_start_date" date NOT NULL,
	"visa_type" "visa_type",
	"visa_expiry_date" date,
	"work_auth_status" text,
	"min_acceptable_rate" numeric(10, 2),
	"target_rate" numeric(10, 2),
	"currency" text DEFAULT 'USD',
	"willing_relocate" boolean DEFAULT false,
	"preferred_locations" text[],
	"marketing_status" "marketing_status" DEFAULT 'draft',
	"bench_sales_rep_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	"contact_id" uuid,
	CONSTRAINT "bench_consultants_candidate_id_key" UNIQUE("candidate_id")
);
--> statement-breakpoint
ALTER TABLE "bench_consultants" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "approval_workflows" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"entity_type" text NOT NULL,
	"approval_levels" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"auto_approve_condition" text,
	"escalation_days" integer DEFAULT 3,
	"escalation_role" text,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
ALTER TABLE "approval_workflows" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "approval_steps" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"instance_id" uuid NOT NULL,
	"level" integer NOT NULL,
	"approver_role" text,
	"approver_id" uuid,
	"status" text DEFAULT 'pending' NOT NULL,
	"decided_by" uuid,
	"decided_at" timestamp with time zone,
	"decision" text,
	"decision_notes" text,
	"reminder_sent_at" timestamp with time zone,
	"reminder_count" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "approval_steps" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "approval_instances" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"workflow_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"current_level" integer DEFAULT 1,
	"status" text DEFAULT 'pending' NOT NULL,
	"requested_by" uuid NOT NULL,
	"requested_at" timestamp with time zone DEFAULT now() NOT NULL,
	"request_notes" text,
	"request_data" jsonb DEFAULT '{}'::jsonb,
	"resolved_by" uuid,
	"resolved_at" timestamp with time zone,
	"resolution_notes" text,
	"is_escalated" boolean DEFAULT false,
	"escalated_at" timestamp with time zone,
	"escalated_to" uuid,
	"expires_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "approval_instances" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "placement_credits" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"pod_id" uuid NOT NULL,
	"sprint_number" integer NOT NULL,
	"sprint_start_date" date NOT NULL,
	"sprint_end_date" date NOT NULL,
	"placement_id" uuid NOT NULL,
	"placement_date" date NOT NULL,
	"credit_amount" numeric(4, 2) DEFAULT '1.0' NOT NULL,
	"senior_rec_id" uuid,
	"junior_rec_id" uuid,
	"bill_rate" numeric(10, 2),
	"pay_rate" numeric(10, 2),
	"margin_percentage" numeric(5, 2),
	"estimated_revenue" numeric(14, 2),
	"source_pillar" text DEFAULT 'recruiting' NOT NULL,
	"original_lead_id" uuid,
	"original_campaign_id" uuid,
	"original_graduate_id" uuid,
	"is_verified" boolean DEFAULT false,
	"verified_at" timestamp with time zone,
	"verified_by" uuid,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid
);
--> statement-breakpoint
ALTER TABLE "placement_credits" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "graduate_candidates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"graduated_at" timestamp with time zone NOT NULL,
	"course_id" uuid,
	"final_grade" text,
	"gpa_equivalent" integer,
	"project_score" integer,
	"assessment_score" integer,
	"job_readiness_score" integer,
	"technical_skills_score" integer,
	"soft_skills_score" integer,
	"status" "graduate_candidate_status" DEFAULT 'pending_review' NOT NULL,
	"status_changed_at" timestamp with time zone,
	"status_changed_by" uuid,
	"assigned_recruiter_id" uuid,
	"assigned_at" timestamp with time zone,
	"bench_candidate_id" uuid,
	"recruiter_notes" text,
	"opt_out_reason" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "graduate_candidates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "quiz_attempts" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"user_id" uuid NOT NULL,
	"topic_id" uuid NOT NULL,
	"enrollment_id" uuid NOT NULL,
	"attempt_number" integer DEFAULT 1 NOT NULL,
	"started_at" timestamp with time zone DEFAULT now() NOT NULL,
	"submitted_at" timestamp with time zone,
	"time_taken_seconds" integer,
	"answers" jsonb,
	"total_questions" integer NOT NULL,
	"correct_answers" integer,
	"score" numeric(5, 2),
	"passed" boolean,
	"xp_earned" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "quiz_attempts_attempt_number_check" CHECK (attempt_number > 0),
	CONSTRAINT "quiz_attempts_correct_answers_check" CHECK (correct_answers >= 0),
	CONSTRAINT "quiz_attempts_score_check" CHECK ((score >= (0)::numeric) AND (score <= (100)::numeric)),
	CONSTRAINT "quiz_attempts_total_questions_check" CHECK (total_questions > 0)
);
--> statement-breakpoint
ALTER TABLE "quiz_attempts" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "ai_mentor_escalations" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"chat_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"topic_id" uuid,
	"reason" text NOT NULL,
	"confidence" numeric(3, 2),
	"auto_detected" boolean DEFAULT true,
	"triggers" jsonb DEFAULT '{}'::jsonb,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"assigned_to" uuid,
	"assigned_at" timestamp with time zone,
	"status" text DEFAULT 'pending',
	"resolved_by" uuid,
	"resolved_at" timestamp with time zone,
	"resolution_notes" text,
	"resolution_time_minutes" integer,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "ai_mentor_escalations_confidence_check" CHECK ((confidence >= (0)::numeric) AND (confidence <= (1)::numeric)),
	CONSTRAINT "ai_mentor_escalations_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'resolved'::text, 'dismissed'::text]))
);
--> statement-breakpoint
ALTER TABLE "ai_mentor_escalations" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "trainer_responses" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"escalation_id" uuid NOT NULL,
	"trainer_id" uuid NOT NULL,
	"message" text NOT NULL,
	"is_internal_note" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "trainer_responses" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "escalation_notifications" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"escalation_id" uuid NOT NULL,
	"notification_type" text NOT NULL,
	"recipient_id" uuid,
	"recipient_email" text,
	"recipient_slack_id" text,
	"sent_at" timestamp with time zone,
	"delivered_at" timestamp with time zone,
	"error_message" text,
	"created_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "escalation_notifications_notification_type_check" CHECK (notification_type = ANY (ARRAY['slack'::text, 'email'::text, 'in_app'::text]))
);
--> statement-breakpoint
ALTER TABLE "escalation_notifications" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "entity_skills" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"skill_id" uuid NOT NULL,
	"skill_name_override" varchar(100),
	"proficiency_level" integer,
	"years_experience" numeric(4, 1),
	"last_used_date" date,
	"is_primary" boolean DEFAULT false,
	"is_required" boolean,
	"min_proficiency_required" integer,
	"is_verified" boolean DEFAULT false,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"verification_method" varchar(50) DEFAULT 'self_reported',
	"confidence_score" numeric(3, 2),
	"source" varchar(50),
	"source_context" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "entity_skills_proficiency_level_check" CHECK ((proficiency_level >= 1) AND (proficiency_level <= 5))
);
--> statement-breakpoint
ALTER TABLE "entity_skills" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "certifications" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"certification_name" varchar(200) NOT NULL,
	"issuing_organization" varchar(200),
	"credential_id" varchar(100),
	"verification_url" varchar(500),
	"skill_id" uuid,
	"issue_date" date,
	"expiry_date" date,
	"is_active" boolean DEFAULT true,
	"renewal_required" boolean DEFAULT false,
	"renewal_period_months" integer,
	"renewal_reminder_sent_at" timestamp with time zone,
	"is_verified" boolean DEFAULT false,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"certificate_document_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "certifications" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_bench_data" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"bench_start_date" date NOT NULL,
	"bench_type" "bench_type",
	"bench_status" text DEFAULT 'available',
	"visa_type" text,
	"visa_expiry_date" date,
	"work_auth_status" text,
	"visa_notes" text,
	"min_acceptable_rate" numeric(10, 2),
	"target_rate" numeric(10, 2),
	"max_rate" numeric(10, 2),
	"currency" text DEFAULT 'USD',
	"bill_rate" numeric(10, 2),
	"pay_rate" numeric(10, 2),
	"markup_percentage" numeric(5, 2),
	"cost_per_day" numeric(10, 2),
	"willing_to_relocate" boolean DEFAULT false,
	"preferred_locations" text[],
	"work_preference" text,
	"marketing_status" "bench_marketing_status" DEFAULT 'draft',
	"marketing_started_at" timestamp with time zone,
	"marketing_notes" text,
	"bench_sales_rep_id" uuid,
	"vendor_id" uuid,
	"vendor_contact_id" uuid,
	"vendor_terms" text,
	"target_end_date" date,
	"max_bench_days" integer,
	"total_placements" integer DEFAULT 0,
	"last_placement_end" date,
	"utilization_rate" numeric(5, 2),
	"days_on_bench" integer,
	"primary_skills" text[],
	"years_of_experience" numeric(4, 1),
	"certifications" text[],
	"legacy_bench_consultant_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "contact_bench_data_contact_id_key" UNIQUE("contact_id"),
	CONSTRAINT "contact_bench_data_bench_status_check" CHECK (bench_status = ANY (ARRAY['onboarding'::text, 'available'::text, 'marketing'::text, 'interviewing'::text, 'placed'::text, 'inactive'::text])),
	CONSTRAINT "contact_bench_data_work_preference_check" CHECK (work_preference = ANY (ARRAY['remote'::text, 'hybrid'::text, 'onsite'::text, 'flexible'::text]))
);
--> statement-breakpoint
ALTER TABLE "contact_bench_data" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "submission_feedback" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"submission_id" uuid NOT NULL,
	"feedback_type" varchar(50) NOT NULL,
	"feedback_source" varchar(50) NOT NULL,
	"provided_by_user_id" uuid,
	"provided_by_contact_id" uuid,
	"overall_rating" integer,
	"recommendation" varchar(50),
	"feedback_text" text,
	"criteria_scores" jsonb,
	"interview_id" uuid,
	"interview_round" integer,
	"is_visible_to_client" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"deleted_at" timestamp with time zone,
	CONSTRAINT "submission_feedback_feedback_source_check" CHECK ((feedback_source)::text = ANY ((ARRAY['internal'::character varying, 'client'::character varying, 'vendor'::character varying, 'reference'::character varying])::text[])),
	CONSTRAINT "submission_feedback_feedback_type_check" CHECK ((feedback_type)::text = ANY ((ARRAY['screening'::character varying, 'technical'::character varying, 'client'::character varying, 'reference'::character varying, 'final'::character varying])::text[])),
	CONSTRAINT "submission_feedback_overall_rating_check" CHECK ((overall_rating IS NULL) OR ((overall_rating >= 1) AND (overall_rating <= 5))),
	CONSTRAINT "submission_feedback_recommendation_check" CHECK ((recommendation IS NULL) OR ((recommendation)::text = ANY ((ARRAY['strong_hire'::character varying, 'hire'::character varying, 'neutral'::character varying, 'no_hire'::character varying, 'strong_no_hire'::character varying])::text[])))
);
--> statement-breakpoint
ALTER TABLE "submission_feedback" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "submission_rtr" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"submission_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"rtr_type" varchar(50) DEFAULT 'standard',
	"obtained_at" timestamp with time zone DEFAULT now(),
	"expires_at" timestamp with time zone,
	"validity_hours" integer DEFAULT 72,
	"document_id" uuid,
	"status" varchar(50) DEFAULT 'active',
	"revoked_at" timestamp with time zone,
	"revoked_reason" text,
	"created_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	CONSTRAINT "submission_rtr_rtr_type_check" CHECK ((rtr_type)::text = ANY ((ARRAY['standard'::character varying, 'exclusive'::character varying, 'non_exclusive'::character varying, 'verbal'::character varying, 'written'::character varying])::text[])),
	CONSTRAINT "submission_rtr_status_check" CHECK ((status)::text = ANY ((ARRAY['active'::character varying, 'expired'::character varying, 'revoked'::character varying, 'renewed'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "submission_rtr" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "entity_type_registry" (
	"entity_type" varchar(50) PRIMARY KEY NOT NULL,
	"table_name" varchar(100) NOT NULL,
	"id_column" varchar(50) DEFAULT 'id',
	"display_name_column" varchar(50) DEFAULT 'name',
	"display_name" varchar(100) NOT NULL,
	"url_pattern" varchar(200),
	"icon_name" varchar(50),
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
CREATE TABLE "skill_endorsements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_skill_id" uuid NOT NULL,
	"endorser_id" uuid NOT NULL,
	"endorser_relationship" varchar(50),
	"endorsement_level" varchar(20),
	"comment" text,
	"is_verified" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "skill_endorsements" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "audit_logs_2025_11" (
	"id" uuid DEFAULT uuid_generate_v4(),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"table_name" text NOT NULL,
	"action" text NOT NULL,
	"record_id" uuid,
	"user_id" uuid,
	"user_email" text,
	"user_ip_address" "inet",
	"user_agent" text,
	"old_values" jsonb,
	"new_values" jsonb,
	"changed_fields" text[],
	"request_id" text,
	"session_id" text,
	"request_path" text,
	"request_method" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"severity" text DEFAULT 'info',
	"org_id" uuid,
	"entity_type" text,
	"entity_id" uuid,
	"actor_type" text DEFAULT 'user',
	"actor_id" uuid,
	"correlation_id" text,
	"parent_audit_id" uuid,
	"is_compliance_relevant" boolean DEFAULT false,
	"retention_category" text,
	"result" text DEFAULT 'SUCCESS',
	"event_id" bigint DEFAULT nextval('audit_logs_event_id_seq'::regclass) NOT NULL,
	"ip_address" "inet",
	"response_code" integer,
	"response_time_ms" integer,
	"object_name" text,
	CONSTRAINT "audit_logs_result_check" CHECK (result = ANY (ARRAY['SUCCESS'::text, 'FAILURE'::text])),
	CONSTRAINT "valid_action" CHECK (action = ANY (ARRAY['INSERT'::text, 'UPDATE'::text, 'DELETE'::text, 'LOGIN'::text, 'LOGOUT'::text, 'APPROVE'::text, 'REJECT'::text, 'EXPORT'::text, 'IMPORT'::text, 'CUSTOM'::text])),
	CONSTRAINT "valid_severity" CHECK (severity = ANY (ARRAY['debug'::text, 'info'::text, 'warning'::text, 'error'::text, 'critical'::text]))
);
--> statement-breakpoint
CREATE TABLE "audit_logs_2025_12" (
	"id" uuid DEFAULT uuid_generate_v4(),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"table_name" text NOT NULL,
	"action" text NOT NULL,
	"record_id" uuid,
	"user_id" uuid,
	"user_email" text,
	"user_ip_address" "inet",
	"user_agent" text,
	"old_values" jsonb,
	"new_values" jsonb,
	"changed_fields" text[],
	"request_id" text,
	"session_id" text,
	"request_path" text,
	"request_method" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"severity" text DEFAULT 'info',
	"org_id" uuid,
	"entity_type" text,
	"entity_id" uuid,
	"actor_type" text DEFAULT 'user',
	"actor_id" uuid,
	"correlation_id" text,
	"parent_audit_id" uuid,
	"is_compliance_relevant" boolean DEFAULT false,
	"retention_category" text,
	"result" text DEFAULT 'SUCCESS',
	"event_id" bigint DEFAULT nextval('audit_logs_event_id_seq'::regclass) NOT NULL,
	"ip_address" "inet",
	"response_code" integer,
	"response_time_ms" integer,
	"object_name" text,
	CONSTRAINT "audit_logs_result_check" CHECK (result = ANY (ARRAY['SUCCESS'::text, 'FAILURE'::text])),
	CONSTRAINT "valid_action" CHECK (action = ANY (ARRAY['INSERT'::text, 'UPDATE'::text, 'DELETE'::text, 'LOGIN'::text, 'LOGOUT'::text, 'APPROVE'::text, 'REJECT'::text, 'EXPORT'::text, 'IMPORT'::text, 'CUSTOM'::text])),
	CONSTRAINT "valid_severity" CHECK (severity = ANY (ARRAY['debug'::text, 'info'::text, 'warning'::text, 'error'::text, 'critical'::text]))
);
--> statement-breakpoint
CREATE TABLE "audit_logs_2026_01" (
	"id" uuid DEFAULT uuid_generate_v4(),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"table_name" text NOT NULL,
	"action" text NOT NULL,
	"record_id" uuid,
	"user_id" uuid,
	"user_email" text,
	"user_ip_address" "inet",
	"user_agent" text,
	"old_values" jsonb,
	"new_values" jsonb,
	"changed_fields" text[],
	"request_id" text,
	"session_id" text,
	"request_path" text,
	"request_method" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"severity" text DEFAULT 'info',
	"org_id" uuid,
	"entity_type" text,
	"entity_id" uuid,
	"actor_type" text DEFAULT 'user',
	"actor_id" uuid,
	"correlation_id" text,
	"parent_audit_id" uuid,
	"is_compliance_relevant" boolean DEFAULT false,
	"retention_category" text,
	"result" text DEFAULT 'SUCCESS',
	"event_id" bigint DEFAULT nextval('audit_logs_event_id_seq'::regclass) NOT NULL,
	"ip_address" "inet",
	"response_code" integer,
	"response_time_ms" integer,
	"object_name" text,
	CONSTRAINT "audit_logs_result_check" CHECK (result = ANY (ARRAY['SUCCESS'::text, 'FAILURE'::text])),
	CONSTRAINT "valid_action" CHECK (action = ANY (ARRAY['INSERT'::text, 'UPDATE'::text, 'DELETE'::text, 'LOGIN'::text, 'LOGOUT'::text, 'APPROVE'::text, 'REJECT'::text, 'EXPORT'::text, 'IMPORT'::text, 'CUSTOM'::text])),
	CONSTRAINT "valid_severity" CHECK (severity = ANY (ARRAY['debug'::text, 'info'::text, 'warning'::text, 'error'::text, 'critical'::text]))
);
--> statement-breakpoint
CREATE TABLE "audit_logs_2026_02" (
	"id" uuid DEFAULT uuid_generate_v4(),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"table_name" text NOT NULL,
	"action" text NOT NULL,
	"record_id" uuid,
	"user_id" uuid,
	"user_email" text,
	"user_ip_address" "inet",
	"user_agent" text,
	"old_values" jsonb,
	"new_values" jsonb,
	"changed_fields" text[],
	"request_id" text,
	"session_id" text,
	"request_path" text,
	"request_method" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"severity" text DEFAULT 'info',
	"org_id" uuid,
	"entity_type" text,
	"entity_id" uuid,
	"actor_type" text DEFAULT 'user',
	"actor_id" uuid,
	"correlation_id" text,
	"parent_audit_id" uuid,
	"is_compliance_relevant" boolean DEFAULT false,
	"retention_category" text,
	"result" text DEFAULT 'SUCCESS',
	"event_id" bigint DEFAULT nextval('audit_logs_event_id_seq'::regclass) NOT NULL,
	"ip_address" "inet",
	"response_code" integer,
	"response_time_ms" integer,
	"object_name" text,
	CONSTRAINT "audit_logs_result_check" CHECK (result = ANY (ARRAY['SUCCESS'::text, 'FAILURE'::text])),
	CONSTRAINT "valid_action" CHECK (action = ANY (ARRAY['INSERT'::text, 'UPDATE'::text, 'DELETE'::text, 'LOGIN'::text, 'LOGOUT'::text, 'APPROVE'::text, 'REJECT'::text, 'EXPORT'::text, 'IMPORT'::text, 'CUSTOM'::text])),
	CONSTRAINT "valid_severity" CHECK (severity = ANY (ARRAY['debug'::text, 'info'::text, 'warning'::text, 'error'::text, 'critical'::text]))
);
--> statement-breakpoint
CREATE TABLE "security_alerts" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"alert_type" text NOT NULL,
	"severity" text NOT NULL,
	"title" text NOT NULL,
	"description" text,
	"related_user_id" uuid,
	"related_user_email" text,
	"related_events" jsonb DEFAULT '[]'::jsonb,
	"status" text DEFAULT 'open',
	"assigned_to" uuid,
	"resolved_at" timestamp with time zone,
	"resolution_notes" text,
	"risk_level" text,
	"risk_indicators" jsonb DEFAULT '{}'::jsonb,
	"recommended_actions" jsonb DEFAULT '[]'::jsonb,
	"actions_taken" jsonb DEFAULT '[]'::jsonb,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "security_alerts_risk_level_check" CHECK (risk_level = ANY (ARRAY['LOW'::text, 'LOW_MEDIUM'::text, 'MEDIUM'::text, 'MEDIUM_HIGH'::text, 'HIGH'::text])),
	CONSTRAINT "security_alerts_severity_check" CHECK (severity = ANY (ARRAY['LOW'::text, 'MEDIUM'::text, 'HIGH'::text, 'CRITICAL'::text])),
	CONSTRAINT "security_alerts_status_check" CHECK (status = ANY (ARRAY['open'::text, 'investigating'::text, 'resolved'::text, 'dismissed'::text]))
);
--> statement-breakpoint
ALTER TABLE "security_alerts" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "alert_rules" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"event_type" text NOT NULL,
	"result_condition" text DEFAULT 'ANY',
	"threshold_count" integer DEFAULT 5 NOT NULL,
	"time_window_minutes" integer DEFAULT 10 NOT NULL,
	"object_type" text,
	"additional_conditions" jsonb DEFAULT '{}'::jsonb,
	"severity" text NOT NULL,
	"notification_channels" jsonb DEFAULT '{"dashboard":true}'::jsonb,
	"auto_action" text,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	CONSTRAINT "unique_alert_rule_name_per_org" UNIQUE("org_id","name"),
	CONSTRAINT "alert_rules_auto_action_check" CHECK (auto_action = ANY (ARRAY['none'::text, 'lock_account'::text, 'block_ip'::text, 'require_2fa'::text, 'notify_manager'::text])),
	CONSTRAINT "alert_rules_result_condition_check" CHECK (result_condition = ANY (ARRAY['ANY'::text, 'SUCCESS'::text, 'FAILURE'::text])),
	CONSTRAINT "alert_rules_severity_check" CHECK (severity = ANY (ARRAY['LOW'::text, 'MEDIUM'::text, 'HIGH'::text, 'CRITICAL'::text]))
);
--> statement-breakpoint
ALTER TABLE "alert_rules" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "email_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"subject" text NOT NULL,
	"body_html" text NOT NULL,
	"body_text" text,
	"category" text NOT NULL,
	"variables" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"is_active" boolean DEFAULT true NOT NULL,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"slug" text NOT NULL,
	"preview_text" text,
	"from_name" text DEFAULT '{{company_name}}' NOT NULL,
	"from_email" text DEFAULT 'noreply@{{company_domain}}' NOT NULL,
	"reply_to" text,
	"variables_used" text[] DEFAULT '{""}',
	"notes" text,
	"status" text DEFAULT 'draft' NOT NULL,
	"version" integer DEFAULT 1 NOT NULL,
	"updated_by" uuid,
	"archived_at" timestamp with time zone,
	CONSTRAINT "unique_email_template_name" UNIQUE("org_id","name"),
	CONSTRAINT "email_templates_org_id_slug_version_key" UNIQUE("org_id","slug","version"),
	CONSTRAINT "email_templates_category_check" CHECK (category = ANY (ARRAY['user'::text, 'candidate'::text, 'client'::text, 'internal'::text, 'system'::text, 'marketing'::text])),
	CONSTRAINT "email_templates_status_check" CHECK (status = ANY (ARRAY['draft'::text, 'active'::text, 'disabled'::text, 'archived'::text]))
);
--> statement-breakpoint
ALTER TABLE "email_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "email_sends" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"template_id" uuid,
	"recipient_email" text NOT NULL,
	"recipient_name" text,
	"subject" text NOT NULL,
	"from_email" text NOT NULL,
	"from_name" text,
	"status" text DEFAULT 'queued' NOT NULL,
	"resend_id" text,
	"variables_data" jsonb,
	"sent_at" timestamp with time zone,
	"delivered_at" timestamp with time zone,
	"opened_at" timestamp with time zone,
	"clicked_at" timestamp with time zone,
	"bounced_at" timestamp with time zone,
	"error_message" text,
	"entity_type" text,
	"entity_id" uuid,
	"triggered_by" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "email_sends_status_check" CHECK (status = ANY (ARRAY['queued'::text, 'sent'::text, 'delivered'::text, 'opened'::text, 'clicked'::text, 'bounced'::text, 'failed'::text, 'spam'::text])),
	CONSTRAINT "email_sends_triggered_by_check" CHECK (triggered_by = ANY (ARRAY['workflow'::text, 'manual'::text, 'system'::text, 'test'::text]))
);
--> statement-breakpoint
ALTER TABLE "email_sends" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "email_senders" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"email" text NOT NULL,
	"name" text NOT NULL,
	"is_default" boolean DEFAULT false,
	"is_verified" boolean DEFAULT false,
	"verified_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "email_senders_org_id_email_key" UNIQUE("org_id","email")
);
--> statement-breakpoint
ALTER TABLE "email_senders" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "incidents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"incident_number" text NOT NULL,
	"title" text NOT NULL,
	"description" text,
	"severity" text NOT NULL,
	"status" text DEFAULT 'open' NOT NULL,
	"impact" text,
	"root_cause" text,
	"resolution" text,
	"started_at" timestamp with time zone NOT NULL,
	"detected_at" timestamp with time zone,
	"resolved_at" timestamp with time zone,
	"incident_commander" uuid,
	"created_by" uuid,
	"updated_by" uuid,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "incidents_org_id_incident_number_key" UNIQUE("org_id","incident_number"),
	CONSTRAINT "incidents_severity_check" CHECK (severity = ANY (ARRAY['P0'::text, 'P1'::text, 'P2'::text, 'P3'::text])),
	CONSTRAINT "incidents_status_check" CHECK (status = ANY (ARRAY['open'::text, 'investigating'::text, 'identified'::text, 'monitoring'::text, 'resolved'::text]))
);
--> statement-breakpoint
ALTER TABLE "incidents" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "incident_timeline" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"incident_id" uuid NOT NULL,
	"event_type" text NOT NULL,
	"description" text NOT NULL,
	"performed_by" uuid,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "incident_timeline_event_type_check" CHECK (event_type = ANY (ARRAY['detection'::text, 'notification'::text, 'escalation'::text, 'action'::text, 'update'::text, 'resolution'::text]))
);
--> statement-breakpoint
ALTER TABLE "incident_timeline" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "incident_notifications" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"incident_id" uuid NOT NULL,
	"notification_type" text NOT NULL,
	"recipient" text NOT NULL,
	"subject" text,
	"body" text NOT NULL,
	"status" text DEFAULT 'pending',
	"sent_at" timestamp with time zone,
	"delivered_at" timestamp with time zone,
	"error_message" text,
	"sent_by" uuid,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "incident_notifications_notification_type_check" CHECK (notification_type = ANY (ARRAY['email'::text, 'sms'::text, 'slack'::text, 'status_page'::text, 'in_app'::text])),
	CONSTRAINT "incident_notifications_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'sent'::text, 'delivered'::text, 'failed'::text]))
);
--> statement-breakpoint
ALTER TABLE "incident_notifications" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "break_glass_access" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid,
	"accessed_by" text NOT NULL,
	"reason" text NOT NULL,
	"incident_id" uuid,
	"authorized_by" text NOT NULL,
	"actions_taken" text[] DEFAULT '{""}',
	"accessed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"ended_at" timestamp with time zone,
	"ip_address" "inet",
	"user_agent" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "break_glass_access" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "emergency_drills" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"drill_type" text NOT NULL,
	"title" text NOT NULL,
	"scenario" text NOT NULL,
	"participants" uuid[] DEFAULT '{""}',
	"scheduled_at" timestamp with time zone NOT NULL,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"status" text DEFAULT 'scheduled',
	"findings" text,
	"action_items" jsonb DEFAULT '[]'::jsonb,
	"created_by" uuid,
	"updated_by" uuid,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "emergency_drills_drill_type_check" CHECK (drill_type = ANY (ARRAY['tabletop'::text, 'simulated_outage'::text, 'security_breach'::text, 'backup_restore'::text])),
	CONSTRAINT "emergency_drills_status_check" CHECK (status = ANY (ARRAY['scheduled'::text, 'in_progress'::text, 'completed'::text, 'cancelled'::text]))
);
--> statement-breakpoint
ALTER TABLE "emergency_drills" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "sla_definitions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"sla_name" text NOT NULL,
	"sla_code" text NOT NULL,
	"description" text,
	"entity_type" text NOT NULL,
	"activity_type" text,
	"activity_category" text,
	"priority" text,
	"target_hours" integer NOT NULL,
	"warning_hours" integer,
	"critical_hours" integer,
	"use_business_hours" boolean DEFAULT false,
	"business_hours_start" text DEFAULT '09:00',
	"business_hours_end" text DEFAULT '17:00',
	"escalate_on_breach" boolean DEFAULT false,
	"escalate_to_user_id" uuid,
	"escalate_to_group_id" uuid,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"category" text,
	"start_event" text,
	"end_event" text,
	"target_value" integer,
	"target_unit" text DEFAULT 'business_hours',
	"conditions" jsonb DEFAULT '[]'::jsonb,
	"status" text DEFAULT 'draft',
	"pause_on_hold" boolean DEFAULT false,
	"apply_retroactive" boolean DEFAULT false,
	CONSTRAINT "sla_definitions_org_id_sla_code_key" UNIQUE("org_id","sla_code"),
	CONSTRAINT "sla_definitions_status_check" CHECK ((status IS NULL) OR (status = ANY (ARRAY['draft'::text, 'active'::text, 'disabled'::text]))),
	CONSTRAINT "sla_definitions_target_unit_check" CHECK ((target_unit IS NULL) OR (target_unit = ANY (ARRAY['minutes'::text, 'hours'::text, 'business_hours'::text, 'days'::text, 'business_days'::text, 'weeks'::text])))
);
--> statement-breakpoint
ALTER TABLE "sla_definitions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "sla_escalation_levels" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"sla_definition_id" uuid NOT NULL,
	"level_number" integer NOT NULL,
	"level_name" text NOT NULL,
	"trigger_percentage" integer NOT NULL,
	"notify_email" boolean DEFAULT true,
	"notify_slack" boolean DEFAULT false,
	"notify_sms" boolean DEFAULT false,
	"email_recipients" text[] DEFAULT '{""}',
	"slack_channel" text,
	"sms_recipients" text[] DEFAULT '{""}',
	"show_badge" boolean DEFAULT true,
	"badge_color" text DEFAULT 'yellow',
	"add_to_report" boolean DEFAULT false,
	"add_to_dashboard" boolean DEFAULT false,
	"create_task" boolean DEFAULT false,
	"task_assignee" text,
	"escalate_ownership" boolean DEFAULT false,
	"escalate_to" text,
	"block_actions" boolean DEFAULT false,
	"require_resolution_notes" boolean DEFAULT false,
	"flag_for_review" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "sla_escalation_levels_sla_definition_id_level_number_key" UNIQUE("sla_definition_id","level_number"),
	CONSTRAINT "sla_escalation_levels_level_number_check" CHECK ((level_number >= 1) AND (level_number <= 10)),
	CONSTRAINT "sla_escalation_levels_trigger_percentage_check" CHECK ((trigger_percentage >= 1) AND (trigger_percentage <= 500))
);
--> statement-breakpoint
ALTER TABLE "sla_escalation_levels" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "sla_events" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"sla_definition_id" uuid NOT NULL,
	"entity_type" text NOT NULL,
	"entity_id" uuid NOT NULL,
	"start_time" timestamp with time zone NOT NULL,
	"end_time" timestamp with time zone,
	"target_deadline" timestamp with time zone NOT NULL,
	"elapsed_minutes" integer DEFAULT 0,
	"current_percentage" numeric(6, 2) DEFAULT '0',
	"current_level" integer DEFAULT 0,
	"status" text DEFAULT 'pending' NOT NULL,
	"met_at" timestamp with time zone,
	"resolution_notes" text,
	"resolved_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "sla_events_sla_definition_id_entity_type_entity_id_key" UNIQUE("sla_definition_id","entity_type","entity_id"),
	CONSTRAINT "sla_events_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'warning'::text, 'breach'::text, 'critical'::text, 'met'::text, 'cancelled'::text]))
);
--> statement-breakpoint
ALTER TABLE "sla_events" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "sla_notifications" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"sla_event_id" uuid NOT NULL,
	"escalation_level" integer NOT NULL,
	"notification_type" text NOT NULL,
	"recipients" text[] NOT NULL,
	"sent_at" timestamp with time zone DEFAULT now(),
	"delivered_at" timestamp with time zone,
	"failed_at" timestamp with time zone,
	"error_message" text,
	"external_message_id" text,
	CONSTRAINT "sla_notifications_notification_type_check" CHECK (notification_type = ANY (ARRAY['email'::text, 'slack'::text, 'sms'::text, 'in_app'::text]))
);
--> statement-breakpoint
ALTER TABLE "sla_notifications" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "sla_scheduled_runs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"last_run_at" timestamp with time zone NOT NULL,
	"rules_checked" integer DEFAULT 0,
	"events_updated" integer DEFAULT 0,
	"notifications_sent" integer DEFAULT 0,
	"errors" text[],
	"run_duration_ms" integer,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "contacts" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"first_name" text,
	"last_name" text,
	"email" text,
	"phone" text,
	"mobile" text,
	"linkedin_url" text,
	"avatar_url" text,
	"title" text,
	"company_name" text,
	"company_id" uuid,
	"department" text,
	"timezone" text DEFAULT 'America/New_York',
	"preferred_contact_method" text DEFAULT 'email',
	"best_time_to_contact" text,
	"do_not_call_before" text,
	"do_not_call_after" text,
	"status" text DEFAULT 'active' NOT NULL,
	"source" text,
	"source_detail" text,
	"source_campaign_id" uuid,
	"user_profile_id" uuid,
	"last_contacted_at" timestamp with time zone,
	"last_response_at" timestamp with time zone,
	"total_interactions" integer DEFAULT 0,
	"engagement_score" integer DEFAULT 0,
	"twitter_url" text,
	"github_url" text,
	"decision_authority" text,
	"buying_role" text,
	"influence_level" text,
	"tags" text[],
	"notes" text,
	"internal_notes" text,
	"owner_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone,
	"search_vector" "tsvector",
	"relationship_notes" text,
	"is_primary" boolean DEFAULT false,
	"marketing_emails_opt_in" boolean DEFAULT true,
	"newsletter_opt_in" boolean DEFAULT true,
	"product_updates_opt_in" boolean DEFAULT true,
	"do_not_call" boolean DEFAULT false,
	"preferred_meeting_platform" text,
	"meeting_duration" integer DEFAULT 30,
	"communication_frequency" text,
	"types" text[] DEFAULT '{""}',
	"subtype" text DEFAULT 'general',
	"candidate_status" text,
	"candidate_resume_url" text,
	"candidate_skills" text[],
	"candidate_experience_years" integer,
	"candidate_current_visa" text,
	"candidate_visa_expiry" timestamp with time zone,
	"candidate_hourly_rate" numeric(10, 2),
	"candidate_bench_start_date" timestamp with time zone,
	"candidate_availability" text,
	"candidate_willing_to_relocate" boolean DEFAULT false,
	"candidate_preferred_locations" text[],
	"candidate_current_employment_status" text,
	"candidate_notice_period_days" integer,
	"candidate_earliest_start_date" date,
	"candidate_preferred_employment_type" text[],
	"candidate_desired_salary_annual" numeric(12, 2),
	"candidate_desired_salary_currency" text DEFAULT 'USD',
	"candidate_minimum_hourly_rate" numeric(10, 2),
	"candidate_minimum_annual_salary" numeric(12, 2),
	"candidate_benefits_required" text[],
	"candidate_compensation_notes" text,
	"candidate_professional_headline" text,
	"candidate_professional_summary" text,
	"candidate_career_objectives" text,
	"candidate_recruiter_rating" integer,
	"candidate_recruiter_rating_notes" text,
	"candidate_profile_completeness_score" integer DEFAULT 0,
	"candidate_is_on_hotlist" boolean DEFAULT false,
	"candidate_hotlist_added_at" timestamp with time zone,
	"candidate_hotlist_notes" text,
	"employee_id" uuid,
	"employee_department" text,
	"employee_hire_date" date,
	"employee_position" text,
	"employee_status" text,
	"lead_status" text,
	"lead_score" integer,
	"lead_source" text,
	"lead_estimated_value" numeric(12, 2),
	"lead_converted_to_deal_id" uuid,
	"lead_converted_to_account_id" uuid,
	"lead_converted_at" timestamp with time zone,
	"lead_lost_reason" text,
	"lead_bant_budget" integer DEFAULT 0,
	"lead_bant_authority" integer DEFAULT 0,
	"lead_bant_need" integer DEFAULT 0,
	"lead_bant_timeline" integer DEFAULT 0,
	"lead_bant_budget_notes" text,
	"lead_bant_authority_notes" text,
	"lead_bant_need_notes" text,
	"lead_bant_timeline_notes" text,
	"lead_bant_total_score" integer GENERATED ALWAYS AS ((((COALESCE(lead_bant_budget, 0) + COALESCE(lead_bant_authority, 0)) + COALESCE(lead_bant_need, 0)) + COALESCE(lead_bant_timeline, 0))) STORED,
	"lead_budget_status" text,
	"lead_estimated_monthly_spend" numeric(12, 2),
	"lead_authority_level" text,
	"lead_business_need" text,
	"lead_urgency" text,
	"lead_target_start_date" date,
	"lead_positions_count" integer DEFAULT 1,
	"lead_skills_needed" text[],
	"lead_contract_types" text[],
	"lead_qualification_result" text,
	"lead_qualification_notes" text,
	"lead_qualified_at" timestamp with time zone,
	"lead_qualified_by" uuid,
	"lead_interest_level" text,
	"lead_hiring_needs" text,
	"lead_pain_points" text,
	"lead_next_action" text,
	"lead_next_action_date" date,
	"prospect_primary_campaign_id" uuid,
	"prospect_current_sequence_step" integer,
	"prospect_sequence_status" text,
	"prospect_converted_to_lead_at" timestamp with time zone,
	"prospect_first_contacted_at" timestamp with time zone,
	"prospect_responded_at" timestamp with time zone,
	"prospect_response_type" text,
	"auth_id" uuid,
	"date_of_birth" date,
	"gender" text,
	"nationality" text,
	"languages" jsonb DEFAULT '[]'::jsonb,
	"middle_name" text,
	"preferred_name" text,
	"phone_home" text,
	"phone_work" text,
	"email_secondary" text,
	"emergency_contact_name" text,
	"emergency_contact_relationship" text,
	"emergency_contact_phone" text,
	"emergency_contact_email" text,
	"portfolio_url" text,
	"personal_website" text,
	"do_not_email" boolean DEFAULT false,
	"do_not_text" boolean DEFAULT false,
	"last_activity_date" timestamp with time zone,
	"last_contacted_by" uuid,
	"category" text NOT NULL,
	"contact_status" text DEFAULT 'active',
	"primary_address_id" uuid,
	"suffix" text,
	"pronouns" text,
	"photo_url" text,
	"secondary_email" text,
	"work_email" text,
	"work_phone" text,
	"home_phone" text,
	"current_company_id" uuid,
	"current_title" text,
	"current_department" text,
	"language" text DEFAULT 'en',
	"bench_type" text,
	"bench_status" text,
	"bench_vendor_id" uuid,
	"bench_vendor_contact_id" uuid,
	"bench_start_date" date,
	"bench_target_end_date" date,
	"bench_max_bench_days" integer,
	"bench_bill_rate" numeric(10, 2),
	"bench_pay_rate" numeric(10, 2),
	"bench_markup_percentage" numeric(5, 2),
	"bench_cost_per_day" numeric(10, 2),
	"bench_total_placements" integer DEFAULT 0,
	"bench_last_placement_end" date,
	"bench_utilization_rate" numeric(5, 2),
	"placed_status" text,
	"placed_client_id" uuid,
	"placed_job_id" uuid,
	"placed_start_date" date,
	"placed_end_date" date,
	"placed_extension_count" integer DEFAULT 0,
	"client_contact_company_id" uuid,
	"client_contact_role" text,
	"client_contact_decision_authority" boolean DEFAULT false,
	"client_contact_budget_authority" boolean DEFAULT false,
	"client_contact_contract_signer" boolean DEFAULT false,
	"client_contact_relationship_strength" integer,
	"client_contact_relationship_owner_id" uuid,
	"client_contact_first_meeting_date" date,
	"client_contact_last_meeting_date" date,
	"client_contact_meeting_cadence" text,
	"client_contact_preferred_vendors" text[],
	"client_contact_hiring_style" text,
	"client_contact_interview_style" text,
	"vendor_contact_company_id" uuid,
	"vendor_contact_role" text,
	"vendor_contact_specialty_areas" text[],
	"vendor_contact_response_rating" integer,
	"vendor_contact_quality_rating" integer,
	"referral_source_type" text,
	"referral_total_referrals" integer DEFAULT 0,
	"referral_successful_placements" integer DEFAULT 0,
	"referral_success_rate" numeric(5, 2),
	"referral_fee_percentage" numeric(5, 2),
	"referral_last_referral_date" date,
	"alumni_former_employee_id" uuid,
	"alumni_departure_date" date,
	"alumni_departure_reason" text,
	"alumni_rehire_eligible" boolean DEFAULT true,
	"alumni_current_employer" text,
	"alumni_last_contact_date" date,
	"candidate_hotlist_added_by" uuid,
	"candidate_hotlist_reason" text,
	"candidate_priority" integer DEFAULT 0,
	"candidate_do_not_submit_to" uuid[],
	"candidate_remote_preference" text,
	"candidate_years_experience" numeric(4, 1),
	"candidate_cover_letter_url" text,
	"candidate_resume_updated_at" timestamp with time zone,
	"lead_converted_to_type" text,
	"lead_converted_to_id" uuid,
	"company_name_legal" text,
	"company_dba_name" text,
	"company_trade_names" text[],
	"company_type" text,
	"company_structure" text,
	"industry_id" uuid,
	"industry_secondary_id" uuid,
	"naics_code" text,
	"sic_code" text,
	"employee_count" integer,
	"employee_count_range" text,
	"annual_revenue" numeric(15, 2),
	"annual_revenue_range" text,
	"founded_year" integer,
	"website_url" text,
	"company_linkedin_url" text,
	"company_twitter_url" text,
	"logo_url" text,
	"company_description" text,
	"parent_company_id" uuid,
	"ultimate_parent_id" uuid,
	"subsidiary_count" integer DEFAULT 0,
	"ein_tax_id_encrypted" text,
	"duns_number" text,
	"registration_state" text,
	"registration_country" text DEFAULT 'US',
	"company_lead_estimated_annual_value" numeric(12, 2),
	"company_lead_estimated_positions_per_year" integer,
	"company_lead_primary_hiring_needs" text[],
	"client_status" text,
	"client_tier" text,
	"client_segment" text,
	"client_prospect_date" date,
	"client_converted_date" date,
	"client_first_placement_date" date,
	"client_last_active_date" date,
	"client_dormant_since" date,
	"client_churned_date" date,
	"client_churn_reason" text,
	"client_contract_type" text,
	"client_contract_start_date" date,
	"client_contract_end_date" date,
	"client_contract_auto_renew" boolean DEFAULT false,
	"client_contract_url" text,
	"client_payment_terms" integer DEFAULT 30,
	"client_credit_limit" numeric(12, 2),
	"client_credit_status" text,
	"client_default_markup" numeric(5, 2),
	"client_default_bill_rate" numeric(10, 2),
	"client_uses_vms" boolean DEFAULT false,
	"client_vms_system" text,
	"client_vms_supplier_id" text,
	"client_msp_id" uuid,
	"client_team_lead_id" uuid,
	"client_recruiter_ids" uuid[],
	"client_open_positions_count" integer DEFAULT 0,
	"client_active_placements_count" integer DEFAULT 0,
	"client_total_placements_count" integer DEFAULT 0,
	"client_lifetime_revenue" numeric(15, 2) DEFAULT '0',
	"vendor_status" text,
	"vendor_tier" text,
	"vendor_type" text,
	"vendor_specialty_areas" text[],
	"vendor_geographic_coverage" text[],
	"vendor_resource_types" text[],
	"vendor_payment_terms" integer DEFAULT 30,
	"vendor_default_markup" numeric(5, 2),
	"vendor_referral_fee_percentage" numeric(5, 2),
	"vendor_approved_date" date,
	"vendor_approved_by" uuid,
	"vendor_last_review_date" date,
	"vendor_next_review_date" date,
	"vendor_insurance_verified" boolean DEFAULT false,
	"vendor_insurance_expiry_date" date,
	"vendor_w9_on_file" boolean DEFAULT false,
	"vendor_w9_received_date" date,
	"vendor_compliance_status" text,
	"vendor_background_check_compliant" boolean DEFAULT false,
	"vendor_drug_test_compliant" boolean DEFAULT false,
	"vendor_quality_rating" numeric(3, 2),
	"vendor_response_rating" numeric(3, 2),
	"vendor_fill_rate" numeric(5, 2),
	"vendor_submissions_count" integer DEFAULT 0,
	"vendor_placements_count" integer DEFAULT 0,
	"vendor_active_resources_count" integer DEFAULT 0,
	"msp_program_name" text,
	"msp_managed_clients" uuid[],
	"msp_our_tier_status" text,
	"msp_contract_start_date" date,
	"msp_contract_end_date" date,
	"msp_fee_percentage" numeric(5, 2),
	"vms_platform_name" text,
	"vms_integration_status" text,
	"agency_relationship" text,
	"agency_partnership_type" text,
	"agency_partnership_agreement" text,
	"agency_do_not_recruit_from" boolean DEFAULT false,
	"agency_specialty_areas" text[],
	"agency_geographic_focus" text[],
	"linked_company_id" uuid,
	"vendor_company_id" uuid,
	"source_company_id" uuid,
	"employer_company_id" uuid,
	CONSTRAINT "contacts_agency_relationship_check" CHECK ((agency_relationship IS NULL) OR (agency_relationship = ANY (ARRAY['partner'::text, 'competitor'::text, 'both'::text]))),
	CONSTRAINT "contacts_bench_type_check" CHECK ((bench_type IS NULL) OR (bench_type = ANY (ARRAY['w2_internal'::text, 'w2_vendor'::text, '1099'::text, 'c2c'::text]))),
	CONSTRAINT "contacts_candidate_availability_check" CHECK ((candidate_availability IS NULL) OR (candidate_availability = ANY (ARRAY['immediate'::text, '2_weeks'::text, '1_month'::text, '2_months'::text, '3_months'::text, 'not_available'::text]))),
	CONSTRAINT "contacts_candidate_remote_preference_check" CHECK ((candidate_remote_preference IS NULL) OR (candidate_remote_preference = ANY (ARRAY['remote'::text, 'hybrid'::text, 'onsite'::text, 'flexible'::text]))),
	CONSTRAINT "contacts_candidate_status_check" CHECK ((candidate_status IS NULL) OR (candidate_status = ANY (ARRAY['active'::text, 'passive'::text, 'placed'::text, 'bench'::text, 'inactive'::text, 'blacklisted'::text]))),
	CONSTRAINT "contacts_category_check" CHECK (category = ANY (ARRAY['person'::text, 'company'::text])),
	CONSTRAINT "contacts_category_subtype_consistency" CHECK (((category = 'person'::text) AND (subtype ~~ 'person_%'::text)) OR ((category = 'company'::text) AND (subtype ~~ 'company_%'::text))),
	CONSTRAINT "contacts_client_relationship_strength_check" CHECK ((client_contact_relationship_strength IS NULL) OR ((client_contact_relationship_strength >= 1) AND (client_contact_relationship_strength <= 10))),
	CONSTRAINT "contacts_client_status_check" CHECK ((client_status IS NULL) OR (client_status = ANY (ARRAY['active'::text, 'dormant'::text, 'former'::text, 'blacklisted'::text]))),
	CONSTRAINT "contacts_client_tier_check" CHECK ((client_tier IS NULL) OR (client_tier = ANY (ARRAY['enterprise'::text, 'strategic'::text, 'growth'::text, 'standard'::text, 'startup'::text]))),
	CONSTRAINT "contacts_company_status_check" CHECK ((category <> 'company'::text) OR (contact_status = ANY (ARRAY['active'::text, 'inactive'::text, 'pending'::text, 'dormant'::text, 'former'::text, 'blacklisted'::text, 'suspended'::text]))),
	CONSTRAINT "contacts_company_structure_check" CHECK ((company_structure IS NULL) OR (company_structure = ANY (ARRAY['public'::text, 'private'::text, 'subsidiary'::text, 'franchise'::text]))),
	CONSTRAINT "contacts_company_type_check" CHECK ((company_type IS NULL) OR (company_type = ANY (ARRAY['corporation'::text, 'llc'::text, 'partnership'::text, 'sole_prop'::text, 'nonprofit'::text]))),
	CONSTRAINT "contacts_employee_status_check" CHECK ((employee_status IS NULL) OR (employee_status = ANY (ARRAY['active'::text, 'on_leave'::text, 'terminated'::text]))),
	CONSTRAINT "contacts_lead_authority_level_check" CHECK ((lead_authority_level IS NULL) OR (lead_authority_level = ANY (ARRAY['decision_maker'::text, 'influencer'::text, 'gatekeeper'::text, 'no_authority'::text]))),
	CONSTRAINT "contacts_lead_bant_authority_check" CHECK ((lead_bant_authority IS NULL) OR ((lead_bant_authority >= 0) AND (lead_bant_authority <= 25))),
	CONSTRAINT "contacts_lead_bant_budget_check" CHECK ((lead_bant_budget IS NULL) OR ((lead_bant_budget >= 0) AND (lead_bant_budget <= 25))),
	CONSTRAINT "contacts_lead_bant_need_check" CHECK ((lead_bant_need IS NULL) OR ((lead_bant_need >= 0) AND (lead_bant_need <= 25))),
	CONSTRAINT "contacts_lead_bant_timeline_check" CHECK ((lead_bant_timeline IS NULL) OR ((lead_bant_timeline >= 0) AND (lead_bant_timeline <= 25))),
	CONSTRAINT "contacts_lead_qualification_result_check" CHECK ((lead_qualification_result IS NULL) OR (lead_qualification_result = ANY (ARRAY['qualified_convert'::text, 'qualified_nurture'::text, 'not_qualified'::text]))),
	CONSTRAINT "contacts_lead_score_check" CHECK ((lead_score IS NULL) OR ((lead_score >= 0) AND (lead_score <= 100))),
	CONSTRAINT "contacts_lead_status_check" CHECK ((lead_status IS NULL) OR (lead_status = ANY (ARRAY['new'::text, 'contacted'::text, 'warm'::text, 'hot'::text, 'cold'::text, 'qualified'::text, 'unqualified'::text, 'converted'::text, 'lost'::text, 'nurture'::text]))),
	CONSTRAINT "contacts_placed_status_check" CHECK ((placed_status IS NULL) OR (placed_status = ANY (ARRAY['active'::text, 'ending_soon'::text, 'extended'::text, 'completed'::text]))),
	CONSTRAINT "contacts_prospect_response_type_check" CHECK ((prospect_response_type IS NULL) OR (prospect_response_type = ANY (ARRAY['positive'::text, 'neutral'::text, 'negative'::text, 'auto_reply'::text, 'out_of_office'::text]))),
	CONSTRAINT "contacts_prospect_sequence_status_check" CHECK ((prospect_sequence_status IS NULL) OR (prospect_sequence_status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'paused'::text, 'completed'::text, 'stopped'::text]))),
	CONSTRAINT "contacts_subtype_check" CHECK (subtype = ANY (ARRAY['person_prospect'::text, 'person_lead'::text, 'person_candidate'::text, 'person_bench_internal'::text, 'person_bench_vendor'::text, 'person_placed'::text, 'person_client_contact'::text, 'person_hiring_manager'::text, 'person_hr_contact'::text, 'person_vendor_contact'::text, 'person_employee'::text, 'person_referral_source'::text, 'person_alumni'::text, 'company_prospect'::text, 'company_lead'::text, 'company_client'::text, 'company_vendor'::text, 'company_msp'::text, 'company_vms'::text, 'company_end_client'::text, 'company_agency'::text, 'company_institution'::text])),
	CONSTRAINT "contacts_vendor_quality_rating_check" CHECK ((vendor_contact_quality_rating IS NULL) OR ((vendor_contact_quality_rating >= 1) AND (vendor_contact_quality_rating <= 5))),
	CONSTRAINT "contacts_vendor_response_rating_check" CHECK ((vendor_contact_response_rating IS NULL) OR ((vendor_contact_response_rating >= 1) AND (vendor_contact_response_rating <= 5))),
	CONSTRAINT "contacts_vendor_status_check" CHECK ((vendor_status IS NULL) OR (vendor_status = ANY (ARRAY['pending'::text, 'approved'::text, 'preferred'::text, 'suspended'::text, 'blacklisted'::text]))),
	CONSTRAINT "contacts_vendor_tier_check" CHECK ((vendor_tier IS NULL) OR (vendor_tier = ANY (ARRAY['preferred'::text, 'approved'::text, 'probationary'::text, 'new'::text]))),
	CONSTRAINT "contacts_vms_integration_status_check" CHECK ((vms_integration_status IS NULL) OR (vms_integration_status = ANY (ARRAY['not_integrated'::text, 'pending'::text, 'active'::text, 'suspended'::text])))
);
--> statement-breakpoint
ALTER TABLE "contacts" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "activity_stats_daily" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"date" date NOT NULL,
	"pattern_id" uuid,
	"count" integer DEFAULT 0,
	"total_duration_minutes" integer DEFAULT 0,
	"total_points" numeric(10, 2) DEFAULT '0',
	"outcomes" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "activity_stats_daily_org_id_user_id_date_pattern_id_key" UNIQUE("org_id","user_id","date","pattern_id")
);
--> statement-breakpoint
ALTER TABLE "activity_stats_daily" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "notes" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"title" varchar(200),
	"content" text NOT NULL,
	"content_html" text,
	"content_plain" text,
	"note_type" "note_type" DEFAULT 'general',
	"parent_note_id" uuid,
	"thread_root_id" uuid,
	"reply_count" integer DEFAULT 0,
	"visibility" "note_visibility" DEFAULT 'team',
	"is_pinned" boolean DEFAULT false,
	"is_starred" boolean DEFAULT false,
	"pin_order" integer,
	"mentioned_user_ids" uuid[],
	"mentioned_contact_ids" uuid[],
	"tags" text[],
	"attachment_count" integer DEFAULT 0,
	"search_vector" "tsvector",
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid NOT NULL,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "notes_content_not_empty" CHECK ((content IS NOT NULL) AND (content <> ''::text))
);
--> statement-breakpoint
ALTER TABLE "notes" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "activity_patterns" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"code" text NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"target_days" integer DEFAULT 1,
	"escalation_days" integer,
	"default_assignee" text DEFAULT 'owner',
	"assignee_group_id" uuid,
	"assignee_user_id" uuid,
	"priority" text DEFAULT 'normal',
	"auto_complete" boolean DEFAULT false,
	"auto_complete_condition" jsonb,
	"auto_action" text,
	"auto_action_config" jsonb,
	"category" text,
	"entity_type" text NOT NULL,
	"instructions" text,
	"checklist" jsonb,
	"is_system" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"icon" text DEFAULT '',
	"color" text DEFAULT 'blue',
	"display_order" integer DEFAULT 100,
	"show_in_timeline" boolean DEFAULT true,
	"outcomes" jsonb DEFAULT '[]'::jsonb,
	"points" numeric(5, 2) DEFAULT '0',
	"point_multipliers" jsonb DEFAULT '[]'::jsonb,
	"auto_log_integrations" text[] DEFAULT '{""}',
	"followup_rules" jsonb DEFAULT '[]'::jsonb,
	"field_dependencies" jsonb DEFAULT '[]'::jsonb,
	"created_by" uuid,
	CONSTRAINT "activity_patterns_org_id_code_key" UNIQUE("org_id","code")
);
--> statement-breakpoint
CREATE TABLE "pattern_fields" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"pattern_id" uuid NOT NULL,
	"field_name" text NOT NULL,
	"field_label" text NOT NULL,
	"field_type" text NOT NULL,
	"is_required" boolean DEFAULT false,
	"default_value" text,
	"validation_rules" jsonb,
	"order_index" integer DEFAULT 0,
	"placeholder" text,
	"help_text" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"options" jsonb DEFAULT '[]'::jsonb,
	CONSTRAINT "pattern_fields_pattern_id_field_name_key" UNIQUE("pattern_id","field_name")
);
--> statement-breakpoint
CREATE TABLE "feature_flag_usage" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"feature_flag_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"session_id" text,
	"checked_at" timestamp with time zone DEFAULT now(),
	"was_enabled" boolean NOT NULL,
	"context" jsonb DEFAULT '{}'::jsonb
);
--> statement-breakpoint
ALTER TABLE "feature_flag_usage" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "feature_flag_feedback" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"feature_flag_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"rating" integer,
	"feedback_text" text,
	"submitted_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "feature_flag_feedback_rating_check" CHECK ((rating >= 1) AND (rating <= 5))
);
--> statement-breakpoint
ALTER TABLE "feature_flag_feedback" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "feature_flag_categories" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"name" text NOT NULL,
	"display_order" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "feature_flag_categories_org_id_name_key" UNIQUE("org_id","name")
);
--> statement-breakpoint
ALTER TABLE "feature_flag_categories" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "feature_flags" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"key" varchar(100) NOT NULL,
	"name" varchar(100) NOT NULL,
	"description" text,
	"default_enabled" boolean DEFAULT false,
	"is_global" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"state" text DEFAULT 'disabled' NOT NULL,
	"rollout_strategy" text DEFAULT 'none' NOT NULL,
	"rollout_percentage" integer DEFAULT 0,
	"enabled_users" uuid[] DEFAULT '{""}',
	"enabled_pods" uuid[] DEFAULT '{""}',
	"enabled_roles" uuid[] DEFAULT '{""}',
	"category" text,
	"show_in_nav" boolean DEFAULT true,
	"show_new_badge" boolean DEFAULT false,
	"show_beta_badge" boolean DEFAULT false,
	"log_usage" boolean DEFAULT true,
	"show_feedback_prompt" boolean DEFAULT false,
	"rollout_schedule" jsonb DEFAULT '[]'::jsonb,
	"safeguards" jsonb DEFAULT '{}'::jsonb,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_by" uuid,
	"updated_by" uuid,
	CONSTRAINT "feature_flags_org_id_code_key" UNIQUE("org_id","key"),
	CONSTRAINT "feature_flags_rollout_percentage_check" CHECK ((rollout_percentage >= 0) AND (rollout_percentage <= 100)),
	CONSTRAINT "feature_flags_rollout_strategy_check" CHECK (rollout_strategy = ANY (ARRAY['all'::text, 'roles'::text, 'users'::text, 'percentage'::text, 'pods'::text, 'none'::text])),
	CONSTRAINT "feature_flags_state_check" CHECK (state = ANY (ARRAY['enabled'::text, 'disabled'::text, 'beta'::text, 'internal'::text, 'percentage'::text, 'coming_soon'::text]))
);
--> statement-breakpoint
ALTER TABLE "feature_flags" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "job_status_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"job_id" uuid NOT NULL,
	"previous_status" text,
	"new_status" text NOT NULL,
	"changed_by" uuid NOT NULL,
	"changed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"reason" text,
	"notes" text,
	"is_system_triggered" boolean DEFAULT false,
	"expected_reactivation_date" date,
	"actual_reactivation_date" date,
	"hold_duration_days" integer,
	"days_to_fill" integer,
	"positions_filled_count" integer,
	"candidates_affected_count" integer,
	"interviews_cancelled_count" integer,
	"offers_withdrawn_count" integer,
	"reopen_approved_by" uuid,
	"reopen_approval_date" timestamp with time zone,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "job_status_history" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "organizations" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"name" text NOT NULL,
	"slug" text NOT NULL,
	"legal_name" text,
	"email" text,
	"phone" text,
	"website" text,
	"billing_email" text,
	"tax_id" text,
	"subscription_tier" text DEFAULT 'free' NOT NULL,
	"subscription_status" text DEFAULT 'active' NOT NULL,
	"max_users" integer DEFAULT 5,
	"max_candidates" integer DEFAULT 100,
	"max_storage_gb" integer DEFAULT 10,
	"features" jsonb DEFAULT '{}'::jsonb,
	"settings" jsonb DEFAULT '{}'::jsonb,
	"status" text DEFAULT 'active' NOT NULL,
	"onboarding_completed" boolean DEFAULT false,
	"onboarding_step" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"timezone" text DEFAULT 'America/New_York',
	"locale" text DEFAULT 'en-US',
	"logo_url" text,
	"favicon_url" text,
	"plan" text DEFAULT 'free',
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"stripe_coupon_id" text,
	"stripe_customer_id" text,
	"tier" text DEFAULT 'starter',
	"industry" text,
	"health_score" integer,
	"business_hours_start" time DEFAULT '09:00:00',
	"business_hours_end" time DEFAULT '17:00:00',
	"business_timezone" text DEFAULT 'America/New_York',
	"holiday_calendar" jsonb DEFAULT '[]'::jsonb,
	"company_size" text,
	"founded_year" integer,
	"primary_color" text DEFAULT '#000000',
	"secondary_color" text DEFAULT '#B76E79',
	"background_color" text DEFAULT '#FDFBF7',
	"text_color" text DEFAULT '#171717',
	"date_format" text DEFAULT 'MM/DD/YYYY',
	"time_format" text DEFAULT '12h',
	"week_start" text DEFAULT 'sunday',
	"currency" text DEFAULT 'USD',
	"number_format" text DEFAULT '1,234.56',
	"fiscal_year_start" integer DEFAULT 1,
	"reporting_period" text DEFAULT 'quarterly',
	"sprint_alignment" boolean DEFAULT true,
	"business_hours" jsonb DEFAULT '{"friday":{"end":"17:00","open":true,"start":"09:00","break_minutes":60},"monday":{"end":"17:00","open":true,"start":"09:00","break_minutes":60},"sunday":{"open":false},"tuesday":{"end":"17:00","open":true,"start":"09:00","break_minutes":60},"saturday":{"open":false},"thursday":{"end":"17:00","open":true,"start":"09:00","break_minutes":60},"wednesday":{"end":"17:00","open":true,"start":"09:00","break_minutes":60}}'::jsonb,
	"custom_holidays" jsonb DEFAULT '[]'::jsonb,
	"default_values" jsonb DEFAULT '{"job_type":"contract","job_status":"draft","work_location":"hybrid","follow_up_days":3,"candidate_source":"direct_application","auto_parse_resume":true,"submission_status":"pending_review","auto_create_followup":true,"auto_send_client_email":false,"candidate_availability":"2_weeks","email_signature_location":"below","include_company_disclaimer":true}'::jsonb,
	"contact_info" jsonb DEFAULT '{"fax":null,"hr_email":null,"main_phone":null,"linkedin_url":null,"billing_email":null,"general_email":null,"support_email":null,"twitter_handle":null}'::jsonb,
	CONSTRAINT "organizations_slug_key" UNIQUE("slug"),
	CONSTRAINT "chk_background_color" CHECK ((background_color IS NULL) OR (background_color ~ '^#[0-9A-Fa-f]{6}$'::text)),
	CONSTRAINT "chk_fiscal_year_start" CHECK ((fiscal_year_start >= 1) AND (fiscal_year_start <= 12)),
	CONSTRAINT "chk_primary_color" CHECK ((primary_color IS NULL) OR (primary_color ~ '^#[0-9A-Fa-f]{6}$'::text)),
	CONSTRAINT "chk_secondary_color" CHECK ((secondary_color IS NULL) OR (secondary_color ~ '^#[0-9A-Fa-f]{6}$'::text)),
	CONSTRAINT "chk_text_color" CHECK ((text_color IS NULL) OR (text_color ~ '^#[0-9A-Fa-f]{6}$'::text))
);
--> statement-breakpoint
ALTER TABLE "organizations" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "saved_searches" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"entity_type" text DEFAULT 'candidate' NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"filters" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"is_default" boolean DEFAULT false,
	"is_shared" boolean DEFAULT false,
	"email_alerts" boolean DEFAULT false,
	"alert_frequency" text DEFAULT 'daily',
	"result_count" integer,
	"last_executed_at" timestamp with time zone,
	"execution_count" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "saved_searches_unique_name" UNIQUE("org_id","user_id","entity_type","name")
);
--> statement-breakpoint
ALTER TABLE "saved_searches" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_prepared_profiles" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"job_id" uuid,
	"template_type" text DEFAULT 'standard' NOT NULL,
	"summary" text,
	"key_highlights" text[],
	"skills_matrix" jsonb,
	"experience_summary" jsonb,
	"why_this_candidate" text,
	"education" jsonb,
	"status" text DEFAULT 'draft' NOT NULL,
	"finalized_at" timestamp with time zone,
	"finalized_by" uuid,
	"pdf_url" text,
	"docx_url" text,
	"last_exported_at" timestamp with time zone,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_prepared_profiles" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "candidate_screenings" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"job_id" uuid,
	"submission_id" uuid,
	"screener_id" uuid NOT NULL,
	"status" text DEFAULT 'in_progress' NOT NULL,
	"started_at" timestamp with time zone DEFAULT now() NOT NULL,
	"completed_at" timestamp with time zone,
	"duration_minutes" integer,
	"knockout_passed" boolean,
	"knockout_answers" jsonb DEFAULT '[]'::jsonb,
	"technical_scores" jsonb DEFAULT '{}'::jsonb,
	"technical_overall" numeric(3, 2),
	"project_discussion" jsonb,
	"soft_skills_scores" jsonb DEFAULT '{}'::jsonb,
	"soft_skills_overall" numeric(3, 2),
	"culture_fit_score" numeric(3, 2),
	"interest_level" text,
	"motivation_notes" jsonb,
	"overall_score" numeric(3, 2),
	"recommendation" text DEFAULT 'hold' NOT NULL,
	"strengths" text[],
	"concerns" text[],
	"interview_prep_notes" text,
	"compensation_discussion" jsonb,
	"next_steps" jsonb DEFAULT '[]'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"contact_id" uuid
);
--> statement-breakpoint
ALTER TABLE "candidate_screenings" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_relationships" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"source_contact_id" uuid NOT NULL,
	"target_contact_id" uuid NOT NULL,
	"relationship_type" text NOT NULL,
	"title_at_company" text,
	"department_at_company" text,
	"start_date" date,
	"end_date" date,
	"is_current" boolean DEFAULT false,
	"relationship_strength" integer,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "contact_relationships_unique" UNIQUE("source_contact_id","target_contact_id","relationship_type"),
	CONSTRAINT "contact_relationships_strength_check" CHECK ((relationship_strength IS NULL) OR ((relationship_strength >= 1) AND (relationship_strength <= 10))),
	CONSTRAINT "contact_relationships_type_check" CHECK (relationship_type = ANY (ARRAY['works_at'::text, 'worked_at'::text, 'owns'::text, 'founded'::text, 'board_member'::text, 'reports_to'::text, 'manages'::text, 'referred_by'::text, 'knows'::text, 'mentors'::text, 'spouse_of'::text]))
);
--> statement-breakpoint
ALTER TABLE "contact_relationships" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_roles" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"role_type" text NOT NULL,
	"role_status" text DEFAULT 'active' NOT NULL,
	"context_company_id" uuid,
	"context_details" jsonb DEFAULT '{}'::jsonb,
	"role_started_at" timestamp with time zone DEFAULT now(),
	"role_ended_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "contact_roles_status_check" CHECK (role_status = ANY (ARRAY['active'::text, 'inactive'::text, 'pending'::text, 'suspended'::text])),
	CONSTRAINT "contact_roles_type_check" CHECK (role_type = ANY (ARRAY['candidate'::text, 'employee'::text, 'client_contact'::text, 'hiring_manager'::text, 'hr_contact'::text, 'vendor_contact'::text, 'bench_internal'::text, 'bench_vendor'::text, 'placed'::text, 'referral_source'::text, 'alumni'::text]))
);
--> statement-breakpoint
ALTER TABLE "contact_roles" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "offers" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"submission_id" uuid NOT NULL,
	"job_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"offer_type" text DEFAULT 'contract',
	"rate" numeric(10, 2) NOT NULL,
	"rate_type" text DEFAULT 'hourly',
	"start_date" date,
	"end_date" date,
	"bonus" numeric(10, 2),
	"benefits" text,
	"relocation_assistance" boolean DEFAULT false,
	"sign_on_bonus" numeric(10, 2),
	"status" text DEFAULT 'draft' NOT NULL,
	"sent_at" timestamp with time zone,
	"expires_at" timestamp with time zone,
	"candidate_counter_offer" numeric(10, 2),
	"negotiation_notes" text,
	"accepted_at" timestamp with time zone,
	"declined_at" timestamp with time zone,
	"decline_reason" text,
	"offer_letter_file_id" uuid,
	"signed_offer_file_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"org_id" uuid NOT NULL,
	"pay_rate" numeric(10, 2),
	"bill_rate" numeric(10, 2),
	"overtime_rate" numeric(10, 2),
	"duration_months" integer,
	"employment_type" varchar(20) DEFAULT 'w2',
	"pto_days" integer,
	"sick_days" integer,
	"health_insurance" boolean DEFAULT false,
	"has_401k" boolean DEFAULT false,
	"work_location" varchar(20) DEFAULT 'remote',
	"standard_hours_per_week" integer DEFAULT 40,
	"internal_notes" text,
	"sent_by" uuid,
	"accepted_by" uuid,
	"withdrawn_at" timestamp with time zone,
	"withdrawal_reason" text,
	CONSTRAINT "offers_employment_type_check" CHECK ((employment_type)::text = ANY ((ARRAY['w2'::character varying, 'c2c'::character varying, '1099'::character varying])::text[])),
	CONSTRAINT "offers_work_location_check" CHECK ((work_location)::text = ANY ((ARRAY['remote'::character varying, 'onsite'::character varying, 'hybrid'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "offers" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "offer_negotiations" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"offer_id" uuid NOT NULL,
	"requested_by" text NOT NULL,
	"requested_changes" text,
	"status" text DEFAULT 'pending' NOT NULL,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"initiated_by" varchar(20),
	"original_terms" jsonb,
	"proposed_terms" jsonb,
	"counter_message" text,
	CONSTRAINT "offer_negotiations_initiated_by_check" CHECK ((initiated_by)::text = ANY ((ARRAY['candidate'::character varying, 'client'::character varying, 'recruiter'::character varying])::text[]))
);
--> statement-breakpoint
CREATE TABLE "offer_approvals" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"offer_id" uuid NOT NULL,
	"approver_id" uuid NOT NULL,
	"status" text DEFAULT 'pending' NOT NULL,
	"notes" text,
	"decided_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"approval_type" varchar(30),
	"requested_by" uuid,
	"request_notes" text,
	"proposed_changes" jsonb,
	"responded_at" timestamp with time zone,
	CONSTRAINT "offer_approvals_approval_type_check" CHECK ((approval_type)::text = ANY ((ARRAY['rate_change'::character varying, 'terms_change'::character varying, 'low_margin'::character varying, 'extension'::character varying])::text[]))
);
--> statement-breakpoint
CREATE TABLE "contact_skills" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"skill_id" uuid,
	"skill_name" text NOT NULL,
	"skill_category" text,
	"proficiency_level" integer DEFAULT 3,
	"years_experience" numeric(4, 1),
	"last_used_date" date,
	"is_primary" boolean DEFAULT false,
	"is_verified" boolean DEFAULT false,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"verification_method" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "contact_skills_proficiency_check" CHECK ((proficiency_level >= 1) AND (proficiency_level <= 5))
);
--> statement-breakpoint
ALTER TABLE "contact_skills" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_work_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"company_name" text NOT NULL,
	"company_contact_id" uuid,
	"title" text NOT NULL,
	"department" text,
	"employment_type" text,
	"start_date" date NOT NULL,
	"end_date" date,
	"is_current" boolean DEFAULT false,
	"description" text,
	"achievements" text[],
	"reason_for_leaving" text,
	"manager_name" text,
	"manager_contact" text,
	"location" text,
	"is_remote" boolean DEFAULT false,
	"is_verified" boolean DEFAULT false,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"display_order" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "contact_work_history" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_education" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"institution_name" text NOT NULL,
	"institution_type" text,
	"degree_type" text,
	"field_of_study" text,
	"major" text,
	"minor" text,
	"start_date" date,
	"end_date" date,
	"graduation_date" date,
	"is_completed" boolean DEFAULT false,
	"gpa" numeric(4, 2),
	"gpa_scale" numeric(3, 1) DEFAULT '4.0',
	"honors" text,
	"activities" text,
	"achievements" text[],
	"is_verified" boolean DEFAULT false,
	"verified_by" uuid,
	"display_order" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "contact_education" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_certifications" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"certification_name" text NOT NULL,
	"issuing_organization" text,
	"issue_date" date,
	"expiry_date" date,
	"is_active" boolean DEFAULT true,
	"credential_id" text,
	"verification_url" text,
	"renewal_required" boolean DEFAULT false,
	"renewal_reminder_sent_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "contact_certifications" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "placement_milestones" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"placement_id" uuid NOT NULL,
	"milestone_type" text NOT NULL,
	"due_date" date,
	"completed_at" timestamp with time zone,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"status" varchar(20) DEFAULT 'pending',
	"completed_date" date,
	CONSTRAINT "placement_milestones_status_check" CHECK ((status)::text = ANY ((ARRAY['pending'::character varying, 'completed'::character varying, 'skipped'::character varying])::text[]))
);
--> statement-breakpoint
CREATE TABLE "contact_rate_cards" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"client_id" uuid,
	"skill_id" uuid,
	"job_id" uuid,
	"bill_rate_hourly" numeric(10, 2),
	"pay_rate_hourly" numeric(10, 2),
	"markup_percentage" numeric(5, 2),
	"overtime_multiplier" numeric(3, 2) DEFAULT '1.5',
	"effective_date" date NOT NULL,
	"expiry_date" date,
	"is_active" boolean DEFAULT true,
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "contact_rate_cards" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "placement_extensions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"placement_id" uuid NOT NULL,
	"previous_end_date" date NOT NULL,
	"new_end_date" date NOT NULL,
	"reason" text,
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"original_end_date" date,
	"extension_months" integer,
	"new_pay_rate" numeric(10, 2),
	"new_bill_rate" numeric(10, 2),
	"notes" text
);
--> statement-breakpoint
CREATE TABLE "placement_rates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"placement_id" uuid NOT NULL,
	"bill_rate" numeric(10, 2) NOT NULL,
	"pay_rate" numeric(10, 2) NOT NULL,
	"margin_percent" numeric(5, 2),
	"effective_from" date NOT NULL,
	"effective_to" date,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"rate_type" varchar(20) DEFAULT 'regular',
	"effective_date" date,
	CONSTRAINT "placement_rates_rate_type_check" CHECK ((rate_type)::text = ANY ((ARRAY['regular'::character varying, 'overtime'::character varying, 'holiday'::character varying])::text[]))
);
--> statement-breakpoint
CREATE TABLE "contact_agreements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"agreement_type" text NOT NULL,
	"agreement_name" text,
	"effective_date" date,
	"expiry_date" date,
	"auto_renew" boolean DEFAULT false,
	"renewal_notice_days" integer DEFAULT 30,
	"status" text DEFAULT 'draft' NOT NULL,
	"document_url" text,
	"signed_document_url" text,
	"our_signer_id" uuid,
	"our_signed_at" timestamp with time zone,
	"their_signer_name" text,
	"their_signed_at" timestamp with time zone,
	"terms" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "contact_agreements_status_check" CHECK (status = ANY (ARRAY['draft'::text, 'pending'::text, 'active'::text, 'expired'::text, 'terminated'::text])),
	CONSTRAINT "contact_agreements_type_check" CHECK (agreement_type = ANY (ARRAY['msa'::text, 'nda'::text, 'sow'::text, 'rate_card'::text, 'sla'::text, 'vendor_agreement'::text, 'other'::text]))
);
--> statement-breakpoint
ALTER TABLE "contact_agreements" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_compliance" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"compliance_type" text NOT NULL,
	"status" text DEFAULT 'pending' NOT NULL,
	"document_url" text,
	"document_received_at" timestamp with time zone,
	"effective_date" date,
	"expiry_date" date,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"verification_notes" text,
	"policy_number" text,
	"coverage_amount" numeric(15, 2),
	"insurance_carrier" text,
	"expiry_alert_sent_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "contact_compliance_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'received'::text, 'verified'::text, 'expiring'::text, 'expired'::text, 'rejected'::text])),
	CONSTRAINT "contact_compliance_type_check" CHECK (compliance_type = ANY (ARRAY['general_liability'::text, 'workers_comp'::text, 'e_o'::text, 'cyber'::text, 'w9'::text, 'coi'::text, 'background_check'::text, 'drug_test'::text, 'i9'::text, 'w4'::text, 'direct_deposit'::text]))
);
--> statement-breakpoint
ALTER TABLE "contact_compliance" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_communication_preferences" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"channel" text NOT NULL,
	"is_opted_in" boolean DEFAULT true,
	"opted_in_at" timestamp with time zone,
	"opted_out_at" timestamp with time zone,
	"consent_source" text,
	"frequency_preference" text,
	"content_preferences" text[],
	"bounce_count" integer DEFAULT 0,
	"last_bounce_at" timestamp with time zone,
	"complaint_count" integer DEFAULT 0,
	"last_complaint_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "contact_comm_prefs_unique" UNIQUE("contact_id","channel"),
	CONSTRAINT "contact_comm_prefs_channel_check" CHECK (channel = ANY (ARRAY['email'::text, 'phone'::text, 'sms'::text, 'linkedin'::text, 'whatsapp'::text, 'mail'::text]))
);
--> statement-breakpoint
ALTER TABLE "contact_communication_preferences" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contact_merge_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"survivor_contact_id" uuid NOT NULL,
	"merged_contact_id" uuid NOT NULL,
	"merged_at" timestamp with time zone DEFAULT now() NOT NULL,
	"merged_by" uuid,
	"field_selections" jsonb DEFAULT '{}'::jsonb,
	"merged_contact_snapshot" jsonb NOT NULL,
	"notes" text
);
--> statement-breakpoint
ALTER TABLE "contact_merge_history" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "note_reactions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"note_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"reaction" varchar(20) NOT NULL,
	"created_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "note_reactions_unique" UNIQUE("note_id","user_id","reaction")
);
--> statement-breakpoint
ALTER TABLE "note_reactions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "companies" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"company_number" varchar(50),
	"category" "company_category" NOT NULL,
	"relationship_type" "company_relationship_type" DEFAULT 'direct_client' NOT NULL,
	"segment" "company_segment",
	"tier" "company_tier" DEFAULT 'standard',
	"status" "company_status" DEFAULT 'active' NOT NULL,
	"name" text NOT NULL,
	"legal_name" text,
	"dba_name" text,
	"industry" text,
	"sub_industry" text,
	"sic_code" varchar(10),
	"naics_code" varchar(10),
	"employee_count" integer,
	"employee_range" varchar(20),
	"annual_revenue" numeric(15, 2),
	"revenue_range" varchar(20),
	"founded_year" integer,
	"ownership_type" varchar(50),
	"parent_company_id" uuid,
	"hierarchy_level" integer DEFAULT 0,
	"hierarchy_path" text,
	"is_headquarters" boolean DEFAULT true,
	"website" text,
	"phone" text,
	"linkedin_url" text,
	"headquarters_city" text,
	"headquarters_state" text,
	"headquarters_country" text DEFAULT 'USA',
	"timezone" text DEFAULT 'America/New_York',
	"owner_id" uuid,
	"account_manager_id" uuid,
	"pod_id" uuid,
	"primary_contact_id" uuid,
	"is_msp_program" boolean DEFAULT false,
	"msp_provider_id" uuid,
	"our_msp_tier" integer,
	"vms_platform" varchar(50),
	"vms_vendor_id" varchar(100),
	"vms_api_enabled" boolean DEFAULT false,
	"msa_status" varchar(20) DEFAULT 'none',
	"msa_effective_date" date,
	"msa_expiration_date" date,
	"msa_auto_renews" boolean DEFAULT false,
	"default_payment_terms" varchar(20) DEFAULT 'Net 30',
	"default_currency" varchar(3) DEFAULT 'USD',
	"default_markup_percentage" numeric(5, 2),
	"default_fee_percentage" numeric(5, 2),
	"credit_limit" numeric(12, 2),
	"credit_status" varchar(20) DEFAULT 'approved',
	"account_score" integer,
	"account_grade" char(1),
	"health_score" integer,
	"health_status" varchar(20) DEFAULT 'healthy',
	"churn_risk" integer,
	"nps_score" integer,
	"lifetime_revenue" numeric(15, 2) DEFAULT '0',
	"lifetime_placements" integer DEFAULT 0,
	"revenue_ytd" numeric(15, 2) DEFAULT '0',
	"placements_ytd" integer DEFAULT 0,
	"revenue_last_12m" numeric(15, 2) DEFAULT '0',
	"avg_margin_percentage" numeric(5, 2),
	"first_engagement_date" date,
	"last_job_date" date,
	"last_placement_date" date,
	"last_activity_date" timestamp with time zone,
	"last_contacted_date" timestamp with time zone,
	"next_scheduled_contact" date,
	"active_jobs_count" integer DEFAULT 0,
	"active_placements_count" integer DEFAULT 0,
	"total_contacts_count" integer DEFAULT 0,
	"source" varchar(50),
	"source_detail" text,
	"source_campaign_id" uuid,
	"referring_company_id" uuid,
	"referring_contact_id" uuid,
	"converted_from_lead_id" uuid,
	"preferred_contact_method" varchar(20) DEFAULT 'email',
	"submission_method" varchar(20) DEFAULT 'email',
	"invoice_delivery_method" varchar(20) DEFAULT 'email',
	"meeting_cadence" varchar(20),
	"is_strategic" boolean DEFAULT false,
	"requires_po" boolean DEFAULT false,
	"requires_approval_for_submission" boolean DEFAULT false,
	"allows_remote_work" boolean DEFAULT true,
	"onboarding_status" text DEFAULT 'pending',
	"onboarding_completed_at" timestamp with time zone,
	"onboarding_completed_by" uuid,
	"onboarding_data" jsonb DEFAULT '{}'::jsonb,
	"tags" text[],
	"custom_fields" jsonb DEFAULT '{}'::jsonb,
	"preferences" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone,
	"search_vector" "tsvector",
	"description" text,
	"industries" text[],
	CONSTRAINT "companies_account_grade_check" CHECK (account_grade = ANY (ARRAY['A'::bpchar, 'B'::bpchar, 'C'::bpchar, 'D'::bpchar])),
	CONSTRAINT "companies_account_score_check" CHECK ((account_score >= 0) AND (account_score <= 100)),
	CONSTRAINT "companies_churn_risk_check" CHECK ((churn_risk >= 0) AND (churn_risk <= 100)),
	CONSTRAINT "companies_health_score_check" CHECK ((health_score >= 0) AND (health_score <= 100)),
	CONSTRAINT "companies_nps_score_check" CHECK ((nps_score >= '-100'::integer) AND (nps_score <= 100)),
	CONSTRAINT "companies_our_msp_tier_check" CHECK ((our_msp_tier >= 1) AND (our_msp_tier <= 5)),
	CONSTRAINT "valid_hierarchy" CHECK ((parent_company_id IS NULL) OR (parent_company_id <> id)),
	CONSTRAINT "valid_msp_reference" CHECK ((msp_provider_id IS NULL) OR (msp_provider_id <> id))
);
--> statement-breakpoint
ALTER TABLE "companies" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "documents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"file_name" varchar(255) NOT NULL,
	"file_type" varchar(20),
	"mime_type" varchar(100),
	"file_size_bytes" bigint,
	"storage_provider" varchar(20) DEFAULT 'supabase',
	"storage_bucket" varchar(100),
	"storage_path" varchar(500) NOT NULL,
	"public_url" varchar(1000),
	"document_type" varchar(50) DEFAULT 'other' NOT NULL,
	"document_category" varchar(50) DEFAULT 'general',
	"description" text,
	"version" integer DEFAULT 1,
	"is_latest_version" boolean DEFAULT true,
	"previous_version_id" uuid,
	"version_notes" text,
	"processing_status" varchar(20) DEFAULT 'pending',
	"processed_at" timestamp with time zone,
	"ocr_text" text,
	"extracted_metadata" jsonb,
	"content_hash" varchar(64),
	"expires_at" timestamp with time zone,
	"expiry_alert_sent_at" timestamp with time zone,
	"expiry_alert_days_before" integer DEFAULT 30,
	"is_confidential" boolean DEFAULT false,
	"access_level" varchar(20) DEFAULT 'standard',
	"accessible_by_roles" text[],
	"tags" text[],
	"uploaded_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "documents_access_level_check" CHECK ((access_level)::text = ANY ((ARRAY['public'::character varying, 'standard'::character varying, 'confidential'::character varying, 'restricted'::character varying])::text[])),
	CONSTRAINT "documents_document_category_check" CHECK ((document_category)::text = ANY ((ARRAY['compliance'::character varying, 'legal'::character varying, 'marketing'::character varying, 'hr'::character varying, 'operational'::character varying, 'general'::character varying])::text[])),
	CONSTRAINT "documents_document_type_check" CHECK ((document_type)::text = ANY ((ARRAY['resume'::character varying, 'cover_letter'::character varying, 'id_document'::character varying, 'certification'::character varying, 'reference_letter'::character varying, 'background_check'::character varying, 'drug_test'::character varying, 'i9'::character varying, 'w4'::character varying, 'direct_deposit'::character varying, 'msa'::character varying, 'nda'::character varying, 'sow'::character varying, 'w9'::character varying, 'coi'::character varying, 'insurance'::character varying, 'contract'::character varying, 'job_description'::character varying, 'requirements'::character varying, 'scorecard'::character varying, 'other'::character varying, 'note_attachment'::character varying, 'email_attachment'::character varying])::text[])),
	CONSTRAINT "documents_processing_status_check" CHECK ((processing_status)::text = ANY ((ARRAY['pending'::character varying, 'processing'::character varying, 'completed'::character varying, 'failed'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "documents" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "meeting_notes" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"account_id" uuid NOT NULL,
	"contact_ids" uuid[],
	"meeting_type" text DEFAULT 'check_in' NOT NULL,
	"title" text NOT NULL,
	"description" text,
	"scheduled_at" timestamp with time zone,
	"started_at" timestamp with time zone,
	"ended_at" timestamp with time zone,
	"duration_minutes" integer,
	"location_type" text DEFAULT 'video',
	"location_details" text,
	"status" text DEFAULT 'scheduled' NOT NULL,
	"agenda" text,
	"discussion_notes" text,
	"key_takeaways" text[],
	"action_items" jsonb DEFAULT '[]'::jsonb,
	"next_meeting_scheduled" timestamp with time zone,
	"follow_up_notes" text,
	"client_satisfaction" text,
	"client_feedback" text,
	"related_job_ids" uuid[],
	"related_candidate_ids" uuid[],
	"related_escalation_id" uuid,
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "meeting_notes" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "escalations" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"escalation_number" text NOT NULL,
	"account_id" uuid NOT NULL,
	"escalation_type" text NOT NULL,
	"severity" text DEFAULT 'medium' NOT NULL,
	"issue_summary" text NOT NULL,
	"detailed_description" text NOT NULL,
	"related_entities" jsonb DEFAULT '[]'::jsonb,
	"client_impact" text[],
	"root_cause" text,
	"immediate_actions" text,
	"resolution_plan" text,
	"status" text DEFAULT 'open' NOT NULL,
	"sla_response_due" timestamp with time zone,
	"sla_resolution_due" timestamp with time zone,
	"sla_response_met" boolean,
	"sla_resolution_met" boolean,
	"created_by" uuid NOT NULL,
	"assigned_to" uuid,
	"escalated_to" uuid,
	"resolved_by" uuid,
	"resolved_at" timestamp with time zone,
	"resolution_summary" text,
	"resolution_actions" text,
	"time_to_resolve" interval,
	"client_satisfaction" text,
	"lessons_learned" text,
	"preventive_measures" text,
	"manager_notification_type" text,
	"manager_notified_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "escalations_escalation_number_key" UNIQUE("escalation_number")
);
--> statement-breakpoint
ALTER TABLE "escalations" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "escalation_updates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"escalation_id" uuid NOT NULL,
	"update_type" text NOT NULL,
	"content" text NOT NULL,
	"old_status" text,
	"new_status" text,
	"old_assignee_id" uuid,
	"new_assignee_id" uuid,
	"created_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"is_internal" boolean DEFAULT true
);
--> statement-breakpoint
ALTER TABLE "escalation_updates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "document_access_log" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"document_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"action" varchar(20) NOT NULL,
	"ip_address" "inet",
	"user_agent" text,
	"accessed_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "document_access_log" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_client_details" (
	"company_id" uuid PRIMARY KEY NOT NULL,
	"org_id" uuid NOT NULL,
	"billing_entity_name" text,
	"billing_email" text,
	"billing_phone" text,
	"billing_contact_id" uuid,
	"po_required" boolean DEFAULT false,
	"current_po_number" text,
	"po_expiration_date" date,
	"invoice_format" varchar(20) DEFAULT 'standard',
	"invoice_consolidation" varchar(20) DEFAULT 'per_placement',
	"invoice_due_reminder_days" integer DEFAULT 7,
	"billing_address_line_1" text,
	"billing_address_line_2" text,
	"billing_city" text,
	"billing_state" text,
	"billing_postal_code" text,
	"billing_country" text DEFAULT 'USA',
	"preferred_work_arrangements" text[],
	"preferred_contract_types" text[],
	"allows_contract_to_hire" boolean DEFAULT true,
	"cth_conversion_fee_percentage" numeric(5, 2),
	"cth_conversion_credit_days" integer DEFAULT 90,
	"responsiveness_rating" varchar(20),
	"feedback_quality_rating" varchar(20),
	"hiring_speed_rating" varchar(20),
	"preferred_experience_levels" text[],
	"typical_interview_rounds" integer,
	"avg_time_to_decision_days" integer,
	"interview_process_notes" text,
	"exclusive_supplier" boolean DEFAULT false,
	"exclusive_start_date" date,
	"exclusive_end_date" date,
	"known_competitors" text[],
	"wallet_share_percentage" numeric(5, 2),
	"qbr_frequency" varchar(20),
	"last_qbr_date" date,
	"next_qbr_date" date,
	"executive_sponsor_id" uuid,
	"legacy_billing_data" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"billing_frequency" varchar(20) DEFAULT 'monthly',
	CONSTRAINT "company_client_details_billing_frequency_check" CHECK ((billing_frequency)::text = ANY ((ARRAY['weekly'::character varying, 'biweekly'::character varying, 'monthly'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "company_client_details" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_vendor_details" (
	"company_id" uuid PRIMARY KEY NOT NULL,
	"org_id" uuid NOT NULL,
	"vendor_type" "company_vendor_type" DEFAULT 'prime_vendor' NOT NULL,
	"industry_focus" text[],
	"geographic_focus" text[],
	"skill_focus" text[],
	"vendor_manager_id" uuid,
	"onboarded_date" date,
	"last_job_order_date" date,
	"payment_terms_to_us" varchar(20) DEFAULT 'Net 60',
	"typical_markup_to_client" numeric(5, 2),
	"our_typical_margin" numeric(5, 2),
	"preferred_job_categories" text[],
	"excluded_job_categories" text[],
	"min_rate_hourly" numeric(10, 2),
	"max_rate_hourly" numeric(10, 2),
	"accepts_corp_to_corp" boolean DEFAULT true,
	"accepts_1099" boolean DEFAULT true,
	"total_job_orders" integer DEFAULT 0,
	"filled_job_orders" integer DEFAULT 0,
	"fill_rate" numeric(5, 2),
	"avg_time_to_fill_days" integer,
	"total_revenue_from_vendor" numeric(15, 2) DEFAULT '0',
	"job_order_delivery_method" varchar(20) DEFAULT 'email',
	"submission_format" varchar(20) DEFAULT 'email',
	"requires_right_to_represent" boolean DEFAULT true,
	"rtr_validity_hours" integer DEFAULT 24,
	"is_blacklisted" boolean DEFAULT false,
	"blacklist_reason" text,
	"blacklist_date" date,
	"has_payment_issues" boolean DEFAULT false,
	"payment_issue_notes" text,
	"supplies_talent" boolean DEFAULT false,
	"talent_categories" text[],
	"talent_specializations" text[],
	"bench_consultants_count" integer DEFAULT 0,
	"candidates_supplied_count" integer DEFAULT 0,
	"candidates_placed_count" integer DEFAULT 0,
	"talent_placement_rate" numeric(5, 2),
	"avg_talent_quality_score" numeric(3, 1),
	"legacy_terms_data" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "company_vendor_details" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "company_partner_details" (
	"company_id" uuid PRIMARY KEY NOT NULL,
	"org_id" uuid NOT NULL,
	"partnership_type" varchar(50),
	"partnership_tier" varchar(20),
	"partnership_start_date" date,
	"partnership_renewal_date" date,
	"referral_fee_percentage" numeric(5, 2),
	"referral_fee_flat" numeric(10, 2),
	"referral_tracking_period_days" integer DEFAULT 365,
	"total_referrals" integer DEFAULT 0,
	"successful_referrals" integer DEFAULT 0,
	"referral_conversion_rate" numeric(5, 2),
	"total_referral_revenue" numeric(15, 2) DEFAULT '0',
	"co_marketing_fund" numeric(10, 2),
	"co_marketing_activities" text[],
	"joint_case_studies" text[],
	"api_integration_enabled" boolean DEFAULT false,
	"integration_type" varchar(50),
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now()
);
--> statement-breakpoint
ALTER TABLE "company_partner_details" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "deals" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"lead_id" uuid,
	"account_id" uuid,
	"title" text NOT NULL,
	"description" text,
	"value" numeric(12, 2) NOT NULL,
	"stage" text DEFAULT 'discovery' NOT NULL,
	"probability" integer,
	"expected_close_date" date,
	"actual_close_date" date,
	"owner_id" uuid NOT NULL,
	"close_reason" text,
	"linked_job_ids" uuid[],
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	"name" text,
	"deal_type" text,
	"currency" text DEFAULT 'USD',
	"loss_reason" text,
	"competitor_won" text,
	"notes" text,
	"value_basis" text DEFAULT 'one_time',
	"weighted_value" numeric(12, 2) GENERATED ALWAYS AS (((value * (probability)::numeric) / 100.0)) STORED,
	"estimated_placements" integer,
	"avg_bill_rate" numeric(10, 2),
	"contract_length_months" integer,
	"hiring_needs" text,
	"roles_breakdown" jsonb,
	"services_required" text[],
	"competitors" text[],
	"competitive_advantage" text,
	"pod_manager_id" uuid,
	"secondary_owner_id" uuid,
	"next_action" text,
	"next_action_date" date,
	"health_status" text DEFAULT 'on_track',
	"last_activity_at" timestamp with time zone DEFAULT now(),
	"contract_signed_date" date,
	"contract_start_date" date,
	"contract_duration_months" integer,
	"contract_type" text,
	"payment_terms" text,
	"billing_frequency" text,
	"billing_contact" jsonb,
	"confirmed_roles" jsonb,
	"win_reason" text,
	"win_details" text,
	"competitors_beat" text[],
	"loss_reason_category" text,
	"loss_details" text,
	"competitor_price" numeric(10, 2),
	"future_potential" text,
	"reengagement_date" date,
	"lessons_learned" text,
	"created_account_id" uuid,
	"company_id" uuid,
	"lead_contact_id" uuid,
	CONSTRAINT "deals_billing_frequency_check" CHECK (billing_frequency = ANY (ARRAY['weekly'::text, 'biweekly'::text, 'monthly'::text])),
	CONSTRAINT "deals_contract_type_check" CHECK (contract_type = ANY (ARRAY['msa'::text, 'sow'::text, 'po'::text, 'email'::text])),
	CONSTRAINT "deals_future_potential_check" CHECK (future_potential = ANY (ARRAY['yes'::text, 'maybe'::text, 'no'::text])),
	CONSTRAINT "deals_health_status_check" CHECK (health_status = ANY (ARRAY['on_track'::text, 'slow'::text, 'stale'::text, 'urgent'::text, 'at_risk'::text])),
	CONSTRAINT "deals_loss_reason_category_check" CHECK (loss_reason_category = ANY (ARRAY['competitor'::text, 'no_budget'::text, 'project_cancelled'::text, 'hired_internally'::text, 'went_dark'::text, 'price_too_high'::text, 'requirements_changed'::text, 'other'::text])),
	CONSTRAINT "deals_payment_terms_check" CHECK (payment_terms = ANY (ARRAY['net_15'::text, 'net_30'::text, 'net_45'::text, 'net_60'::text])),
	CONSTRAINT "deals_probability_check" CHECK ((probability >= 0) AND (probability <= 100)),
	CONSTRAINT "deals_value_basis_check" CHECK (value_basis = ANY (ARRAY['one_time'::text, 'annual'::text, 'monthly'::text])),
	CONSTRAINT "deals_win_reason_check" CHECK (win_reason = ANY (ARRAY['price_value'::text, 'expertise_speed'::text, 'relationship_trust'::text, 'candidate_quality'::text, 'response_time'::text, 'other'::text]))
);
--> statement-breakpoint
ALTER TABLE "deals" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "data_retention_policies" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"table_name" varchar(100) NOT NULL,
	"entity_type" varchar(50),
	"retention_days" integer NOT NULL,
	"archive_after_days" integer,
	"mask_pii_after_days" integer,
	"action_on_expiry" varchar(20) DEFAULT 'archive',
	"last_processed_at" timestamp with time zone,
	"processing_frequency" varchar(20) DEFAULT 'daily',
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "retention_policies_unique" UNIQUE("org_id","table_name","entity_type"),
	CONSTRAINT "retention_policies_action_check" CHECK ((action_on_expiry)::text = ANY ((ARRAY['archive'::character varying, 'delete'::character varying, 'anonymize'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "data_retention_policies" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "compliance_requirements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"requirement_code" varchar(50) NOT NULL,
	"requirement_name" varchar(200) NOT NULL,
	"description" text,
	"category" varchar(50) NOT NULL,
	"subcategory" varchar(50),
	"applies_to_entity_types" text[] DEFAULT '{"RAY['contact'::tex"}',
	"validity_period_days" integer,
	"renewal_lead_days" integer DEFAULT 30,
	"priority" "compliance_priority" DEFAULT 'medium',
	"is_blocking" boolean DEFAULT false,
	"requires_document" boolean DEFAULT true,
	"accepted_document_types" text[],
	"jurisdiction" varchar(50),
	"jurisdiction_region" varchar(100),
	"is_active" boolean DEFAULT true,
	"effective_from" date,
	"effective_until" date,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "compliance_requirements_code_unique" UNIQUE("org_id","requirement_code"),
	CONSTRAINT "compliance_requirements_category_check" CHECK ((category)::text = ANY ((ARRAY['background'::character varying, 'drug_test'::character varying, 'tax'::character varying, 'insurance'::character varying, 'certification'::character varying, 'legal'::character varying, 'immigration'::character varying, 'health'::character varying, 'training'::character varying, 'other'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "compliance_requirements" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "compliance_items" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"requirement_id" uuid,
	"compliance_type" varchar(100),
	"compliance_name" varchar(200),
	"status" "compliance_item_status" DEFAULT 'pending',
	"document_id" uuid,
	"document_url" varchar(500),
	"document_received_at" timestamp with time zone,
	"effective_date" date,
	"expiry_date" date,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"verification_method" varchar(50),
	"verification_notes" text,
	"rejection_reason" text,
	"waived_by" uuid,
	"waived_at" timestamp with time zone,
	"waiver_reason" text,
	"waiver_expires_at" date,
	"policy_number" varchar(100),
	"coverage_amount" numeric(12, 2),
	"insurance_carrier" varchar(200),
	"context_placement_id" uuid,
	"context_client_id" uuid,
	"expiry_alert_sent_at" timestamp with time zone,
	"expiry_alert_days_before" integer DEFAULT 30,
	"inherited_from_entity_type" varchar(50),
	"inherited_from_entity_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "compliance_items" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "entity_compliance_requirements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"requirement_id" uuid NOT NULL,
	"is_required" boolean DEFAULT true,
	"custom_validity_days" integer,
	"custom_lead_days" integer,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "entity_compliance_req_unique" UNIQUE("entity_type","entity_id","requirement_id")
);
--> statement-breakpoint
ALTER TABLE "entity_compliance_requirements" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contracts" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"secondary_entity_type" varchar(50),
	"secondary_entity_id" uuid,
	"contract_number" varchar(50),
	"contract_name" varchar(300) NOT NULL,
	"contract_type" "contract_type" NOT NULL,
	"category" varchar(50),
	"parent_contract_id" uuid,
	"status" "contract_status" DEFAULT 'draft',
	"effective_date" date,
	"expiry_date" date,
	"termination_date" date,
	"auto_renew" boolean DEFAULT false,
	"renewal_term_months" integer,
	"renewal_notice_days" integer DEFAULT 30,
	"max_renewals" integer,
	"renewals_count" integer DEFAULT 0,
	"contract_value" numeric(14, 2),
	"currency" varchar(3) DEFAULT 'USD',
	"terms" jsonb DEFAULT '{}'::jsonb,
	"document_id" uuid,
	"document_url" varchar(500),
	"signed_document_id" uuid,
	"signed_document_url" varchar(500),
	"template_id" uuid,
	"version" integer DEFAULT 1,
	"is_latest_version" boolean DEFAULT true,
	"previous_version_id" uuid,
	"esign_provider" varchar(50),
	"esign_envelope_id" varchar(200),
	"esign_status" varchar(50),
	"termination_reason" text,
	"terminated_by" uuid,
	"context_job_id" uuid,
	"context_placement_id" uuid,
	"owner_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "contracts_number_unique" UNIQUE("org_id","contract_number")
);
--> statement-breakpoint
ALTER TABLE "contracts" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contract_versions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"contract_id" uuid NOT NULL,
	"version_number" integer NOT NULL,
	"version_type" varchar(50) NOT NULL,
	"version_name" varchar(200),
	"change_summary" text,
	"changes_json" jsonb,
	"effective_date" date,
	"expiry_date" date,
	"contract_value" numeric(14, 2),
	"terms_snapshot" jsonb,
	"document_id" uuid,
	"document_url" varchar(500),
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "contract_versions_unique" UNIQUE("contract_id","version_number")
);
--> statement-breakpoint
ALTER TABLE "contract_versions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contract_parties" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contract_id" uuid NOT NULL,
	"party_type" varchar(50) NOT NULL,
	"party_role" varchar(50) NOT NULL,
	"user_id" uuid,
	"contact_id" uuid,
	"company_id" uuid,
	"party_name" varchar(200),
	"party_email" varchar(200),
	"party_title" varchar(100),
	"party_company" varchar(200),
	"signatory_status" "signatory_status" DEFAULT 'pending',
	"signature_requested_at" timestamp with time zone,
	"signed_at" timestamp with time zone,
	"signature_ip" varchar(45),
	"declined_reason" text,
	"esign_recipient_id" varchar(200),
	"signing_order" integer DEFAULT 1,
	"is_required" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "contract_parties" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contract_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"template_name" varchar(200) NOT NULL,
	"template_code" varchar(50),
	"contract_type" "contract_type" NOT NULL,
	"description" text,
	"template_content" text,
	"template_document_id" uuid,
	"available_variables" jsonb,
	"default_clauses" uuid[],
	"default_terms" jsonb,
	"default_renewal_months" integer,
	"default_notice_days" integer,
	"is_active" boolean DEFAULT true,
	"usage_count" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "contract_templates_code_unique" UNIQUE("org_id","template_code")
);
--> statement-breakpoint
ALTER TABLE "contract_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "contract_clauses" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"clause_name" varchar(200) NOT NULL,
	"clause_code" varchar(50),
	"category" varchar(50),
	"clause_text" text NOT NULL,
	"clause_version" integer DEFAULT 1,
	"legal_approved" boolean DEFAULT false,
	"legal_approved_by" uuid,
	"legal_approved_at" timestamp with time zone,
	"is_standard" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "contract_clauses" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "rate_approvals" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_rate_id" uuid NOT NULL,
	"approval_type" varchar(50) NOT NULL,
	"requested_by" uuid,
	"requested_at" timestamp with time zone DEFAULT now(),
	"justification" text,
	"proposed_bill_rate" numeric(10, 2),
	"proposed_pay_rate" numeric(10, 2),
	"proposed_margin_percentage" numeric(5, 2),
	"status" varchar(20) DEFAULT 'pending',
	"decided_by" uuid,
	"decided_at" timestamp with time zone,
	"decision_reason" text,
	"expires_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "rate_approvals_status_check" CHECK ((status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'expired'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "rate_approvals" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "rate_cards" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"rate_card_name" varchar(200) NOT NULL,
	"rate_card_code" varchar(50),
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"rate_card_type" "rate_card_type" DEFAULT 'standard',
	"currency" varchar(3) DEFAULT 'USD',
	"version" integer DEFAULT 1,
	"is_active" boolean DEFAULT true,
	"is_latest_version" boolean DEFAULT true,
	"previous_version_id" uuid,
	"effective_start_date" date NOT NULL,
	"effective_end_date" date,
	"approved_at" timestamp with time zone,
	"approved_by" uuid,
	"overtime_multiplier" numeric(4, 2) DEFAULT '1.5',
	"double_time_multiplier" numeric(4, 2) DEFAULT '2.0',
	"holiday_multiplier" numeric(4, 2) DEFAULT '1.5',
	"default_markup_percentage" numeric(5, 2),
	"min_margin_percentage" numeric(5, 2) DEFAULT '10.0',
	"target_margin_percentage" numeric(5, 2) DEFAULT '20.0',
	"msp_program_name" varchar(200),
	"msp_tier" varchar(50),
	"vms_platform" varchar(100),
	"vms_fee_percentage" numeric(5, 2),
	"direct_hire_fee_percentage" numeric(5, 2),
	"direct_hire_fee_flat" numeric(10, 2),
	"applicable_regions" text[],
	"applicable_job_categories" text[],
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "rate_cards_code_unique" UNIQUE("org_id","rate_card_code")
);
--> statement-breakpoint
ALTER TABLE "rate_cards" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "rate_card_items" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"rate_card_id" uuid NOT NULL,
	"job_category" varchar(100),
	"job_level" varchar(50),
	"job_family" varchar(100),
	"skill_id" uuid,
	"rate_unit" "rate_unit" DEFAULT 'hourly',
	"min_pay_rate" numeric(10, 2),
	"max_pay_rate" numeric(10, 2),
	"target_pay_rate" numeric(10, 2),
	"min_bill_rate" numeric(10, 2),
	"max_bill_rate" numeric(10, 2),
	"standard_bill_rate" numeric(10, 2),
	"calculated_markup" numeric(5, 2) GENERATED ALWAYS AS (
CASE
    WHEN ((target_pay_rate > (0)::numeric) AND (target_pay_rate IS NOT NULL)) THEN round((((standard_bill_rate - target_pay_rate) / target_pay_rate) * (100)::numeric), 2)
    ELSE NULL::numeric
END) STORED,
	"calculated_margin" numeric(5, 2) GENERATED ALWAYS AS (
CASE
    WHEN ((standard_bill_rate > (0)::numeric) AND (standard_bill_rate IS NOT NULL)) THEN round((((standard_bill_rate - target_pay_rate) / standard_bill_rate) * (100)::numeric), 2)
    ELSE NULL::numeric
END) STORED,
	"target_margin_percentage" numeric(5, 2),
	"min_margin_percentage" numeric(5, 2),
	"requires_certification" boolean DEFAULT false,
	"requires_clearance" boolean DEFAULT false,
	"clearance_level" varchar(50),
	"min_years_experience" integer,
	"notes" text,
	"display_order" integer DEFAULT 0,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "rate_card_items" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "entity_rates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"rate_card_id" uuid,
	"rate_card_item_id" uuid,
	"rate_unit" "rate_unit" DEFAULT 'hourly',
	"currency" varchar(3) DEFAULT 'USD',
	"bill_rate" numeric(10, 2) NOT NULL,
	"pay_rate" numeric(10, 2) NOT NULL,
	"gross_margin" numeric(10, 2) GENERATED ALWAYS AS ((bill_rate - pay_rate)) STORED,
	"margin_percentage" numeric(5, 2) GENERATED ALWAYS AS (
CASE
    WHEN (bill_rate > (0)::numeric) THEN round((((bill_rate - pay_rate) / bill_rate) * (100)::numeric), 2)
    ELSE (0)::numeric
END) STORED,
	"markup_percentage" numeric(5, 2) GENERATED ALWAYS AS (
CASE
    WHEN (pay_rate > (0)::numeric) THEN round((((bill_rate - pay_rate) / pay_rate) * (100)::numeric), 2)
    ELSE (0)::numeric
END) STORED,
	"ot_bill_rate" numeric(10, 2),
	"ot_pay_rate" numeric(10, 2),
	"dt_bill_rate" numeric(10, 2),
	"dt_pay_rate" numeric(10, 2),
	"effective_date" date NOT NULL,
	"end_date" date,
	"is_current" boolean DEFAULT true,
	"original_bill_rate" numeric(10, 2),
	"original_pay_rate" numeric(10, 2),
	"negotiated_by" uuid,
	"negotiation_notes" text,
	"requires_approval" boolean DEFAULT false,
	"approved_at" timestamp with time zone,
	"approved_by" uuid,
	"approval_notes" text,
	"context_job_id" uuid,
	"context_client_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone
);
--> statement-breakpoint
ALTER TABLE "entity_rates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "rate_change_history" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"entity_rate_id" uuid NOT NULL,
	"change_type" varchar(50) NOT NULL,
	"old_bill_rate" numeric(10, 2),
	"new_bill_rate" numeric(10, 2),
	"old_pay_rate" numeric(10, 2),
	"new_pay_rate" numeric(10, 2),
	"reason" text,
	"changed_by" uuid,
	"changed_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "rate_change_history_type_check" CHECK ((change_type)::text = ANY ((ARRAY['created'::character varying, 'updated'::character varying, 'approved'::character varying, 'rejected'::character varying, 'expired'::character varying, 'negotiated'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "rate_change_history" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "jobs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"deal_id" uuid,
	"title" text NOT NULL,
	"description" text,
	"job_type" text DEFAULT 'contract',
	"location" text,
	"is_remote" boolean DEFAULT false,
	"hybrid_days" integer,
	"rate_min" numeric(10, 2),
	"rate_max" numeric(10, 2),
	"rate_type" text DEFAULT 'hourly',
	"currency" text DEFAULT 'USD',
	"status" text DEFAULT 'draft' NOT NULL,
	"urgency" text DEFAULT 'medium',
	"positions_count" integer DEFAULT 1,
	"positions_filled" integer DEFAULT 0,
	"required_skills" text[],
	"nice_to_have_skills" text[],
	"min_experience_years" integer,
	"max_experience_years" integer,
	"visa_requirements" text[],
	"owner_id" uuid NOT NULL,
	"recruiter_ids" uuid[],
	"posted_date" date,
	"target_fill_date" date,
	"filled_date" date,
	"client_submission_instructions" text,
	"client_interview_process" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	"search_vector" "tsvector",
	"priority" text DEFAULT 'medium',
	"target_start_date" timestamp with time zone,
	"closed_at" timestamp with time zone,
	"closed_by" uuid,
	"closure_reason" text,
	"closure_note" text,
	"on_hold_reason" text,
	"expected_reactivation_date" date,
	"published_at" timestamp with time zone,
	"published_by" uuid,
	"days_to_fill" integer,
	"company_id" uuid,
	"client_company_id" uuid,
	"end_client_company_id" uuid,
	"vendor_company_id" uuid,
	"hiring_manager_contact_id" uuid,
	"hr_contact_id" uuid,
	"external_job_id" varchar(100),
	"priority_rank" integer DEFAULT 0,
	"sla_days" integer DEFAULT 30,
	"intake_completed_at" timestamp with time zone,
	"intake_completed_by" uuid,
	"fee_type" varchar(50) DEFAULT 'percentage',
	"fee_percentage" numeric(5, 2),
	"fee_flat_amount" numeric(10, 2),
	CONSTRAINT "jobs_fee_type_check" CHECK ((fee_type IS NULL) OR ((fee_type)::text = ANY ((ARRAY['percentage'::character varying, 'flat'::character varying, 'hourly_spread'::character varying])::text[])))
);
--> statement-breakpoint
ALTER TABLE "jobs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "submissions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"job_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"account_id" uuid,
	"status" text DEFAULT 'sourced' NOT NULL,
	"ai_match_score" integer,
	"recruiter_match_score" integer,
	"match_explanation" text,
	"submitted_rate" numeric(10, 2),
	"submitted_rate_type" text DEFAULT 'hourly',
	"submission_notes" text,
	"submitted_to_client_at" timestamp with time zone,
	"submitted_to_client_by" uuid,
	"client_resume_file_id" uuid,
	"client_profile_url" text,
	"interview_count" integer DEFAULT 0,
	"last_interview_date" timestamp with time zone,
	"interview_feedback" text,
	"offer_extended_at" timestamp with time zone,
	"offer_accepted_at" timestamp with time zone,
	"offer_declined_at" timestamp with time zone,
	"offer_decline_reason" text,
	"rejected_at" timestamp with time zone,
	"rejection_reason" text,
	"rejection_source" text,
	"owner_id" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	"vendor_submitted_at" timestamp with time zone,
	"vendor_submitted_by" uuid,
	"vendor_decision" text,
	"vendor_decision_at" timestamp with time zone,
	"vendor_decision_by" uuid,
	"vendor_notes" text,
	"vendor_screening_notes" text,
	"vendor_screening_completed_at" timestamp with time zone,
	"client_decision" text,
	"client_decision_at" timestamp with time zone,
	"client_decision_notes" text,
	"offer_id" uuid,
	"placement_id" uuid,
	"contact_id" uuid,
	"company_id" uuid,
	"submitted_by_company_id" uuid,
	"submitted_by_contact_id" uuid,
	"is_vendor_submission" boolean DEFAULT false,
	"rtr_obtained" boolean DEFAULT false,
	"rtr_obtained_at" timestamp with time zone,
	"rtr_expires_at" timestamp with time zone,
	"rtr_document_id" uuid,
	"rate_card_id" uuid,
	"rate_card_item_id" uuid,
	"negotiated_bill_rate" numeric(10, 2),
	"negotiated_pay_rate" numeric(10, 2),
	"rate_negotiation_notes" text,
	"status_entered_at" timestamp with time zone DEFAULT now(),
	"expected_decision_date" date,
	"submission_score" integer,
	"score_breakdown" jsonb,
	"rank_among_submissions" integer,
	"is_duplicate" boolean DEFAULT false,
	"duplicate_of_submission_id" uuid,
	CONSTRAINT "submissions_ai_match_score_check" CHECK ((ai_match_score >= 0) AND (ai_match_score <= 100)),
	CONSTRAINT "submissions_recruiter_match_score_check" CHECK ((recruiter_match_score >= 0) AND (recruiter_match_score <= 100)),
	CONSTRAINT "submissions_submission_score_check" CHECK ((submission_score IS NULL) OR ((submission_score >= 0) AND (submission_score <= 100)))
);
--> statement-breakpoint
ALTER TABLE "submissions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "interviews" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"submission_id" uuid NOT NULL,
	"job_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"round_number" integer DEFAULT 1 NOT NULL,
	"interview_type" text DEFAULT 'technical',
	"scheduled_at" timestamp with time zone,
	"duration_minutes" integer DEFAULT 60,
	"timezone" text DEFAULT 'America/New_York',
	"meeting_link" text,
	"meeting_location" text,
	"interviewer_names" text[],
	"interviewer_emails" text[],
	"scheduled_by" uuid,
	"status" text DEFAULT 'scheduled' NOT NULL,
	"cancellation_reason" text,
	"feedback" text,
	"rating" integer,
	"recommendation" text,
	"submitted_by" uuid,
	"feedback_submitted_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"org_id" uuid NOT NULL,
	"proposed_times" jsonb DEFAULT '[]'::jsonb,
	"confirmed_at" timestamp with time zone,
	"confirmed_by" uuid,
	"rescheduled_at" timestamp with time zone,
	"rescheduled_by" uuid,
	"reschedule_reason" text,
	"reschedule_count" integer DEFAULT 0,
	"cancelled_at" timestamp with time zone,
	"cancelled_by" uuid,
	"cancellation_notes" text,
	"prep_completed_at" timestamp with time zone,
	"prep_completed_by" uuid,
	"prep_notes" text,
	"prep_checklist" jsonb DEFAULT '[]'::jsonb,
	"prep_materials_sent_at" timestamp with time zone,
	"technical_rating" integer,
	"communication_rating" integer,
	"problem_solving_rating" integer,
	"culture_fit_rating" integer,
	"strengths" text,
	"concerns" text,
	"description" text,
	"internal_notes" text,
	"location" text,
	"candidate_experience" text,
	"candidate_interest_level" text,
	"candidate_feedback" text,
	"candidate_concerns" text,
	"attendance_status" text,
	"next_steps" text,
	"ics_uid" text,
	"ics_sequence" integer DEFAULT 0,
	"contact_id" uuid,
	"primary_interviewer_contact_id" uuid,
	"coordinator_contact_id" uuid,
	"scorecard_template_id" uuid,
	"scorecard_completed" boolean DEFAULT false,
	"scorecard_completed_at" timestamp with time zone,
	"hiring_decision" varchar(50),
	"decision_notes" text,
	"calendar_event_id" varchar(255),
	"is_panel" boolean DEFAULT false,
	CONSTRAINT "interviews_attendance_status_check" CHECK (attendance_status = ANY (ARRAY['attended'::text, 'no_show'::text, 'cancelled'::text, 'rescheduled'::text])),
	CONSTRAINT "interviews_candidate_experience_check" CHECK (candidate_experience = ANY (ARRAY['great'::text, 'good'::text, 'okay'::text, 'poor'::text])),
	CONSTRAINT "interviews_candidate_interest_level_check" CHECK (candidate_interest_level = ANY (ARRAY['very_high'::text, 'high'::text, 'medium'::text, 'low'::text, 'withdrawn'::text])),
	CONSTRAINT "interviews_communication_rating_check" CHECK ((communication_rating >= 1) AND (communication_rating <= 5)),
	CONSTRAINT "interviews_culture_fit_rating_check" CHECK ((culture_fit_rating >= 1) AND (culture_fit_rating <= 5)),
	CONSTRAINT "interviews_hiring_decision_check" CHECK ((hiring_decision IS NULL) OR ((hiring_decision)::text = ANY ((ARRAY['strong_hire'::character varying, 'hire'::character varying, 'neutral'::character varying, 'no_hire'::character varying, 'strong_no_hire'::character varying])::text[]))),
	CONSTRAINT "interviews_next_steps_check" CHECK (next_steps = ANY (ARRAY['schedule_next_round'::text, 'extend_offer'::text, 'reject'::text, 'on_hold'::text])),
	CONSTRAINT "interviews_problem_solving_rating_check" CHECK ((problem_solving_rating >= 1) AND (problem_solving_rating <= 5)),
	CONSTRAINT "interviews_rating_check" CHECK ((rating >= 1) AND (rating <= 5)),
	CONSTRAINT "interviews_technical_rating_check" CHECK ((technical_rating >= 1) AND (technical_rating <= 5))
);
--> statement-breakpoint
ALTER TABLE "interviews" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "interview_participants" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"interview_id" uuid NOT NULL,
	"participant_type" text NOT NULL,
	"user_id" uuid,
	"external_name" text,
	"external_email" text,
	"is_required" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"contact_id" uuid,
	"role" varchar(50) DEFAULT 'interviewer',
	"is_confirmed" boolean DEFAULT false,
	"confirmed_at" timestamp with time zone,
	"feedback_submitted" boolean DEFAULT false,
	"feedback_submitted_at" timestamp with time zone,
	"overall_rating" integer,
	"recommendation" varchar(50),
	"feedback_notes" text,
	"calendar_synced" boolean DEFAULT false,
	"calendar_event_id" varchar(255),
	CONSTRAINT "interview_participants_overall_rating_check" CHECK ((overall_rating IS NULL) OR ((overall_rating >= 1) AND (overall_rating <= 5))),
	CONSTRAINT "interview_participants_recommendation_check" CHECK ((recommendation IS NULL) OR ((recommendation)::text = ANY ((ARRAY['strong_hire'::character varying, 'hire'::character varying, 'neutral'::character varying, 'no_hire'::character varying, 'strong_no_hire'::character varying])::text[]))),
	CONSTRAINT "interview_participants_role_check" CHECK ((role IS NULL) OR ((role)::text = ANY ((ARRAY['lead_interviewer'::character varying, 'interviewer'::character varying, 'shadow'::character varying, 'observer'::character varying, 'note_taker'::character varying, 'hiring_manager'::character varying])::text[])))
);
--> statement-breakpoint
ALTER TABLE "interview_participants" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "interview_scorecards" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"interview_id" uuid NOT NULL,
	"participant_id" uuid,
	"submitted_by" uuid NOT NULL,
	"overall_rating" integer NOT NULL,
	"recommendation" varchar(50) NOT NULL,
	"criteria_scores" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"strengths" text[],
	"concerns" text[],
	"additional_notes" text,
	"questions_asked" jsonb,
	"would_work_with" boolean,
	"would_recommend_for_different_role" boolean DEFAULT false,
	"alternative_role_notes" text,
	"is_submitted" boolean DEFAULT false,
	"submitted_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"deleted_at" timestamp with time zone,
	CONSTRAINT "interview_scorecards_overall_rating_check" CHECK ((overall_rating >= 1) AND (overall_rating <= 5)),
	CONSTRAINT "interview_scorecards_recommendation_check" CHECK ((recommendation)::text = ANY ((ARRAY['strong_hire'::character varying, 'hire'::character varying, 'neutral'::character varying, 'no_hire'::character varying, 'strong_no_hire'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "interview_scorecards" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "scorecard_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" varchar(255) NOT NULL,
	"description" text,
	"interview_type" varchar(50),
	"job_category" varchar(100),
	"criteria" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"rating_scale" integer DEFAULT 5,
	"rating_labels" jsonb,
	"required_questions" jsonb,
	"is_default" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"deleted_at" timestamp with time zone,
	CONSTRAINT "scorecard_templates_rating_scale_check" CHECK (rating_scale = ANY (ARRAY[3, 4, 5, 10]))
);
--> statement-breakpoint
ALTER TABLE "scorecard_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "placements" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"submission_id" uuid NOT NULL,
	"offer_id" uuid,
	"job_id" uuid NOT NULL,
	"candidate_id" uuid NOT NULL,
	"placement_type" text DEFAULT 'contract',
	"start_date" date NOT NULL,
	"end_date" date,
	"bill_rate" numeric(10, 2) NOT NULL,
	"pay_rate" numeric(10, 2) NOT NULL,
	"markup_percentage" numeric(5, 2) GENERATED ALWAYS AS (round((((bill_rate - pay_rate) / pay_rate) * (100)::numeric), 2)) STORED,
	"status" text DEFAULT 'active' NOT NULL,
	"end_reason" text,
	"actual_end_date" date,
	"total_revenue" numeric(12, 2),
	"total_paid" numeric(12, 2),
	"onboarding_status" text DEFAULT 'pending',
	"onboarding_completed_at" timestamp with time zone,
	"performance_rating" integer,
	"extension_count" integer DEFAULT 0,
	"recruiter_id" uuid NOT NULL,
	"account_manager_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"health_status" varchar(20) DEFAULT 'healthy',
	"next_check_in_date" date,
	"last_check_in_date" date,
	"last_check_in_by" uuid,
	"rate_type" varchar(20) DEFAULT 'hourly',
	"employment_type" varchar(20) DEFAULT 'w2',
	"work_location" varchar(20) DEFAULT 'remote',
	"work_schedule" varchar(100),
	"timezone" varchar(50) DEFAULT 'America/New_York',
	"onboarding_format" varchar(20) DEFAULT 'virtual',
	"first_day_meeting_link" text,
	"first_day_location" text,
	"hiring_manager_name" varchar(100),
	"hiring_manager_email" varchar(200),
	"hiring_manager_phone" varchar(30),
	"hr_contact_name" varchar(100),
	"hr_contact_email" varchar(200),
	"paperwork_complete" boolean DEFAULT false,
	"background_check_status" varchar(20),
	"i9_complete" boolean DEFAULT false,
	"nda_signed" boolean DEFAULT false,
	"equipment_ordered" boolean DEFAULT false,
	"equipment_notes" text,
	"internal_notes" text,
	"deleted_at" timestamp with time zone,
	"contact_id" uuid,
	"company_id" uuid,
	"billing_company_id" uuid,
	"end_client_company_id" uuid,
	"client_company_id" uuid,
	"vendor_company_id" uuid,
	"client_manager_contact_id" uuid,
	"hr_contact_id" uuid,
	"reporting_manager_contact_id" uuid,
	"contract_id" uuid,
	"rate_card_id" uuid,
	"rate_card_item_id" uuid,
	"has_change_orders" boolean DEFAULT false,
	"active_change_order_id" uuid,
	"change_order_count" integer DEFAULT 0,
	"original_end_date" date,
	"original_bill_rate" numeric(10, 2),
	"approval_status" varchar(50) DEFAULT 'pending',
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"expected_hours_per_week" numeric(5, 2) DEFAULT '40',
	"overtime_eligible" boolean DEFAULT true,
	"expenses_allowed" boolean DEFAULT true,
	"expense_budget" numeric(10, 2),
	"compliance_status" varchar(50) DEFAULT 'pending',
	"compliance_cleared_at" timestamp with time zone,
	"compliance_expires_at" timestamp with time zone,
	"work_arrangement" varchar(50) DEFAULT 'onsite',
	"hybrid_days_per_week" integer,
	"work_address_id" uuid,
	CONSTRAINT "placements_approval_status_check" CHECK ((approval_status IS NULL) OR ((approval_status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'expired'::character varying])::text[]))),
	CONSTRAINT "placements_background_check_status_check" CHECK ((background_check_status)::text = ANY ((ARRAY['pending'::character varying, 'passed'::character varying, 'failed'::character varying, 'waived'::character varying])::text[])),
	CONSTRAINT "placements_compliance_status_check" CHECK ((compliance_status IS NULL) OR ((compliance_status)::text = ANY ((ARRAY['pending'::character varying, 'in_progress'::character varying, 'complete'::character varying, 'expired'::character varying, 'blocked'::character varying])::text[]))),
	CONSTRAINT "placements_health_status_check" CHECK ((health_status)::text = ANY ((ARRAY['healthy'::character varying, 'at_risk'::character varying, 'critical'::character varying])::text[])),
	CONSTRAINT "placements_onboarding_format_check" CHECK ((onboarding_format)::text = ANY ((ARRAY['virtual'::character varying, 'in_person'::character varying, 'hybrid'::character varying])::text[])),
	CONSTRAINT "placements_performance_rating_check" CHECK ((performance_rating >= 1) AND (performance_rating <= 5)),
	CONSTRAINT "placements_work_arrangement_check" CHECK ((work_arrangement IS NULL) OR ((work_arrangement)::text = ANY ((ARRAY['onsite'::character varying, 'remote'::character varying, 'hybrid'::character varying])::text[])))
);
--> statement-breakpoint
ALTER TABLE "placements" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "placement_vendors" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"placement_id" uuid NOT NULL,
	"vendor_company_id" uuid NOT NULL,
	"vendor_type" varchar(50) NOT NULL,
	"position_in_chain" integer DEFAULT 1 NOT NULL,
	"bill_rate" numeric(10, 2),
	"pay_rate" numeric(10, 2),
	"markup_percentage" numeric(5, 2),
	"margin_amount" numeric(10, 2),
	"vendor_contact_id" uuid,
	"vendor_contract_id" uuid,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "placement_vendors_vendor_type_check" CHECK ((vendor_type)::text = ANY ((ARRAY['primary'::character varying, 'sub_vendor'::character varying, 'end_client'::character varying, 'implementation_partner'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "placement_vendors" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "placement_change_orders" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"placement_id" uuid NOT NULL,
	"change_type" varchar(50) NOT NULL,
	"original_end_date" date,
	"original_bill_rate" numeric(10, 2),
	"original_pay_rate" numeric(10, 2),
	"original_hours_per_week" numeric(5, 2),
	"new_end_date" date,
	"new_bill_rate" numeric(10, 2),
	"new_pay_rate" numeric(10, 2),
	"new_hours_per_week" numeric(5, 2),
	"effective_date" date NOT NULL,
	"reason" text,
	"notes" text,
	"status" varchar(50) DEFAULT 'pending',
	"requested_by" uuid,
	"requested_at" timestamp with time zone DEFAULT now(),
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"applied_at" timestamp with time zone,
	"document_id" uuid,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "placement_change_orders_change_type_check" CHECK ((change_type)::text = ANY ((ARRAY['extension'::character varying, 'rate_change'::character varying, 'hours_change'::character varying, 'role_change'::character varying, 'location_change'::character varying, 'other'::character varying])::text[])),
	CONSTRAINT "placement_change_orders_status_check" CHECK ((status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'applied'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "placement_change_orders" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "placement_checkins" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"placement_id" uuid NOT NULL,
	"checkin_type" varchar(20) NOT NULL,
	"checkin_date" date NOT NULL,
	"candidate_contact_method" varchar(20),
	"candidate_response_status" varchar(20),
	"candidate_overall_satisfaction" varchar(20),
	"candidate_role_satisfaction" varchar(20),
	"candidate_team_relationship" varchar(20),
	"candidate_workload" varchar(20),
	"candidate_payment_status" varchar(20),
	"candidate_extension_interest" varchar(30),
	"candidate_sentiment" varchar(20),
	"candidate_concerns" text,
	"candidate_notes" text,
	"client_contact_method" varchar(20),
	"client_contact_id" uuid,
	"client_performance_rating" varchar(20),
	"client_team_integration" varchar(20),
	"client_work_quality" varchar(20),
	"client_communication" varchar(20),
	"client_extension_interest" varchar(20),
	"client_satisfaction" varchar(20),
	"client_concerns" text,
	"client_notes" text,
	"overall_health" varchar(20) NOT NULL,
	"risk_factors" text[],
	"action_items" jsonb DEFAULT '[]'::jsonb,
	"next_checkin_date" date,
	"follow_up_required" varchar(20),
	"escalated_to" uuid,
	"conducted_by" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"completed_at" timestamp with time zone,
	"completed_by" uuid,
	"follow_up_date" date,
	"health_score" integer,
	"health_assessment" varchar(50),
	CONSTRAINT "placement_checkins_candidate_contact_method_check" CHECK ((candidate_contact_method)::text = ANY ((ARRAY['phone'::character varying, 'video'::character varying, 'in_person'::character varying, 'email'::character varying])::text[])),
	CONSTRAINT "placement_checkins_candidate_extension_interest_check" CHECK ((candidate_extension_interest)::text = ANY ((ARRAY['definitely_interested'::character varying, 'probably_interested'::character varying, 'unsure'::character varying, 'not_interested'::character varying, 'too_early'::character varying])::text[])),
	CONSTRAINT "placement_checkins_candidate_overall_satisfaction_check" CHECK ((candidate_overall_satisfaction)::text = ANY ((ARRAY['excellent'::character varying, 'good'::character varying, 'fair'::character varying, 'poor'::character varying])::text[])),
	CONSTRAINT "placement_checkins_candidate_payment_status_check" CHECK ((candidate_payment_status)::text = ANY ((ARRAY['no_issues'::character varying, 'minor_delay'::character varying, 'major_issue'::character varying])::text[])),
	CONSTRAINT "placement_checkins_candidate_response_status_check" CHECK ((candidate_response_status)::text = ANY ((ARRAY['completed'::character varying, 'scheduled'::character varying, 'left_message'::character varying, 'no_response'::character varying])::text[])),
	CONSTRAINT "placement_checkins_candidate_role_satisfaction_check" CHECK ((candidate_role_satisfaction)::text = ANY ((ARRAY['very_satisfied'::character varying, 'satisfied'::character varying, 'neutral'::character varying, 'unsatisfied'::character varying])::text[])),
	CONSTRAINT "placement_checkins_candidate_sentiment_check" CHECK ((candidate_sentiment)::text = ANY ((ARRAY['very_positive'::character varying, 'positive'::character varying, 'neutral'::character varying, 'negative'::character varying])::text[])),
	CONSTRAINT "placement_checkins_candidate_team_relationship_check" CHECK ((candidate_team_relationship)::text = ANY ((ARRAY['excellent'::character varying, 'good'::character varying, 'fair'::character varying, 'poor'::character varying])::text[])),
	CONSTRAINT "placement_checkins_candidate_workload_check" CHECK ((candidate_workload)::text = ANY ((ARRAY['just_right'::character varying, 'a_bit_much'::character varying, 'too_much'::character varying, 'too_little'::character varying])::text[])),
	CONSTRAINT "placement_checkins_checkin_type_check" CHECK ((checkin_type)::text = ANY ((ARRAY['7_day'::character varying, '30_day'::character varying, '60_day'::character varying, '90_day'::character varying, 'ad_hoc'::character varying])::text[])),
	CONSTRAINT "placement_checkins_client_communication_check" CHECK ((client_communication)::text = ANY ((ARRAY['excellent'::character varying, 'good'::character varying, 'fair'::character varying, 'poor'::character varying])::text[])),
	CONSTRAINT "placement_checkins_client_contact_method_check" CHECK ((client_contact_method)::text = ANY ((ARRAY['phone'::character varying, 'video'::character varying, 'in_person'::character varying, 'email'::character varying])::text[])),
	CONSTRAINT "placement_checkins_client_extension_interest_check" CHECK ((client_extension_interest)::text = ANY ((ARRAY['definitely'::character varying, 'probably'::character varying, 'unsure'::character varying, 'probably_not'::character varying])::text[])),
	CONSTRAINT "placement_checkins_client_performance_rating_check" CHECK ((client_performance_rating)::text = ANY ((ARRAY['exceeds'::character varying, 'meets'::character varying, 'below'::character varying, 'not_meeting'::character varying])::text[])),
	CONSTRAINT "placement_checkins_client_satisfaction_check" CHECK ((client_satisfaction)::text = ANY ((ARRAY['very_satisfied'::character varying, 'satisfied'::character varying, 'neutral'::character varying, 'unsatisfied'::character varying])::text[])),
	CONSTRAINT "placement_checkins_client_team_integration_check" CHECK ((client_team_integration)::text = ANY ((ARRAY['excellent'::character varying, 'good'::character varying, 'fair'::character varying, 'poor'::character varying])::text[])),
	CONSTRAINT "placement_checkins_client_work_quality_check" CHECK ((client_work_quality)::text = ANY ((ARRAY['excellent'::character varying, 'good'::character varying, 'fair'::character varying, 'poor'::character varying])::text[])),
	CONSTRAINT "placement_checkins_follow_up_required_check" CHECK ((follow_up_required)::text = ANY ((ARRAY['none'::character varying, 'scheduled'::character varying, 'escalate'::character varying])::text[])),
	CONSTRAINT "placement_checkins_health_assessment_check" CHECK ((health_assessment IS NULL) OR ((health_assessment)::text = ANY ((ARRAY['healthy'::character varying, 'minor_concerns'::character varying, 'at_risk'::character varying, 'critical'::character varying])::text[]))),
	CONSTRAINT "placement_checkins_health_score_check" CHECK ((health_score IS NULL) OR ((health_score >= 0) AND (health_score <= 100))),
	CONSTRAINT "placement_checkins_overall_health_check" CHECK ((overall_health)::text = ANY ((ARRAY['excellent'::character varying, 'good'::character varying, 'at_risk'::character varying, 'critical'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "placement_checkins" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "onboarding_tasks" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"onboarding_id" uuid NOT NULL,
	"task_name" text NOT NULL,
	"category" "task_category" DEFAULT 'other' NOT NULL,
	"description" text,
	"is_required" boolean DEFAULT true,
	"due_days_from_start" integer,
	"status" "task_status" DEFAULT 'pending' NOT NULL,
	"completed_at" timestamp with time zone,
	"completed_by" uuid,
	"notes" text,
	"sort_order" integer DEFAULT 0 NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"org_id" uuid,
	"assigned_to" uuid,
	"due_date" date,
	"compliance_item_id" uuid,
	"document_id" uuid,
	"skip_reason" text
);
--> statement-breakpoint
CREATE TABLE "employee_onboarding" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"employee_id" uuid NOT NULL,
	"checklist_template_id" uuid,
	"status" "onboarding_status" DEFAULT 'not_started' NOT NULL,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"assigned_to" uuid,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"org_id" uuid,
	"contact_id" uuid
);
--> statement-breakpoint
CREATE TABLE "onboarding_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" varchar(200) NOT NULL,
	"description" text,
	"employee_type" varchar(50),
	"department" varchar(100),
	"is_default" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"created_by" uuid,
	"updated_by" uuid
);
--> statement-breakpoint
ALTER TABLE "onboarding_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "onboarding_template_tasks" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"template_id" uuid NOT NULL,
	"task_name" varchar(200) NOT NULL,
	"description" text,
	"category" "task_category" DEFAULT 'other' NOT NULL,
	"due_offset_days" integer DEFAULT 0,
	"is_required" boolean DEFAULT true,
	"sort_order" integer DEFAULT 0,
	"assignee_role" varchar(100),
	"compliance_requirement_id" uuid,
	"document_template_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "onboarding_template_tasks" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "timesheet_entries" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"timesheet_id" uuid NOT NULL,
	"work_date" date NOT NULL,
	"regular_hours" numeric(4, 2) DEFAULT '0',
	"overtime_hours" numeric(4, 2) DEFAULT '0',
	"double_time_hours" numeric(4, 2) DEFAULT '0',
	"pto_hours" numeric(4, 2) DEFAULT '0',
	"holiday_hours" numeric(4, 2) DEFAULT '0',
	"start_time" time,
	"end_time" time,
	"break_minutes" integer DEFAULT 0,
	"project_id" uuid,
	"task_code" text,
	"cost_center" text,
	"is_billable" boolean DEFAULT true,
	"bill_rate" numeric(10, 2),
	"pay_rate" numeric(10, 2),
	"billable_amount" numeric(10, 2) DEFAULT '0',
	"payable_amount" numeric(10, 2) DEFAULT '0',
	"description" text,
	"internal_notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "timesheet_entries_date_unique" UNIQUE("timesheet_id","work_date")
);
--> statement-breakpoint
CREATE TABLE "timesheet_approvals" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"timesheet_id" uuid NOT NULL,
	"approval_level" integer NOT NULL,
	"approver_type" text NOT NULL,
	"approver_id" uuid,
	"status" "approval_status" DEFAULT 'pending' NOT NULL,
	"decision_at" timestamp with time zone,
	"comments" text,
	"delegated_from" uuid,
	"delegated_reason" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "timesheet_approvals_level_unique" UNIQUE("timesheet_id","approval_level")
);
--> statement-breakpoint
CREATE TABLE "timesheet_expenses" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"timesheet_id" uuid NOT NULL,
	"expense_date" date NOT NULL,
	"category" text NOT NULL,
	"description" text NOT NULL,
	"amount" numeric(10, 2) NOT NULL,
	"is_billable" boolean DEFAULT true,
	"is_reimbursable" boolean DEFAULT true,
	"receipt_url" text,
	"receipt_verified" boolean DEFAULT false,
	"verified_by" uuid,
	"verified_at" timestamp with time zone,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "timesheet_expenses_category_check" CHECK (category = ANY (ARRAY['travel'::text, 'lodging'::text, 'meals'::text, 'mileage'::text, 'parking'::text, 'equipment'::text, 'supplies'::text, 'communication'::text, 'other'::text]))
);
--> statement-breakpoint
CREATE TABLE "invoice_line_items" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"invoice_id" uuid NOT NULL,
	"timesheet_id" uuid,
	"timesheet_entry_id" uuid,
	"placement_id" uuid,
	"line_number" integer NOT NULL,
	"description" text NOT NULL,
	"service_start_date" date,
	"service_end_date" date,
	"quantity" numeric(10, 2) NOT NULL,
	"unit_type" text DEFAULT 'hours',
	"unit_rate" numeric(10, 2) NOT NULL,
	"subtotal" numeric(12, 2) DEFAULT '0',
	"discount_amount" numeric(12, 2) DEFAULT '0',
	"tax_rate" numeric(5, 2) DEFAULT '0',
	"tax_amount" numeric(12, 2) DEFAULT '0',
	"total_amount" numeric(12, 2) NOT NULL,
	"gl_code" text,
	"cost_center" text,
	"project_code" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "pay_items" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"pay_run_id" uuid NOT NULL,
	"worker_type" "worker_type" NOT NULL,
	"worker_id" uuid NOT NULL,
	"contact_id" uuid,
	"pay_type" "pay_type" NOT NULL,
	"timesheet_ids" uuid[],
	"regular_hours" numeric(6, 2) DEFAULT '0',
	"overtime_hours" numeric(6, 2) DEFAULT '0',
	"double_time_hours" numeric(6, 2) DEFAULT '0',
	"pto_hours" numeric(6, 2) DEFAULT '0',
	"holiday_hours" numeric(6, 2) DEFAULT '0',
	"total_hours" numeric(6, 2) DEFAULT '0',
	"regular_rate" numeric(10, 2),
	"overtime_rate" numeric(10, 2),
	"double_time_rate" numeric(10, 2),
	"regular_earnings" numeric(12, 2) DEFAULT '0',
	"overtime_earnings" numeric(12, 2) DEFAULT '0',
	"double_time_earnings" numeric(12, 2) DEFAULT '0',
	"pto_earnings" numeric(12, 2) DEFAULT '0',
	"holiday_earnings" numeric(12, 2) DEFAULT '0',
	"bonus_earnings" numeric(12, 2) DEFAULT '0',
	"other_earnings" numeric(12, 2) DEFAULT '0',
	"gross_pay" numeric(12, 2) NOT NULL,
	"federal_income_tax" numeric(10, 2) DEFAULT '0',
	"state_income_tax" numeric(10, 2) DEFAULT '0',
	"local_income_tax" numeric(10, 2) DEFAULT '0',
	"social_security_tax" numeric(10, 2) DEFAULT '0',
	"medicare_tax" numeric(10, 2) DEFAULT '0',
	"total_employee_taxes" numeric(10, 2) DEFAULT '0',
	"employer_social_security" numeric(10, 2) DEFAULT '0',
	"employer_medicare" numeric(10, 2) DEFAULT '0',
	"employer_futa" numeric(10, 2) DEFAULT '0',
	"employer_suta" numeric(10, 2) DEFAULT '0',
	"total_employer_taxes" numeric(10, 2) DEFAULT '0',
	"pre_tax_deductions" numeric(10, 2) DEFAULT '0',
	"post_tax_deductions" numeric(10, 2) DEFAULT '0',
	"garnishments" numeric(10, 2) DEFAULT '0',
	"total_deductions" numeric(10, 2) DEFAULT '0',
	"net_pay" numeric(12, 2) NOT NULL,
	"payment_method" text DEFAULT 'direct_deposit',
	"bank_account_last4" text,
	"check_number" text,
	"status" text DEFAULT 'pending',
	"ytd_gross" numeric(14, 2),
	"ytd_federal_tax" numeric(14, 2),
	"ytd_state_tax" numeric(14, 2),
	"ytd_social_security" numeric(14, 2),
	"ytd_medicare" numeric(14, 2),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "pay_item_earnings" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"pay_item_id" uuid NOT NULL,
	"earning_type" text NOT NULL,
	"earning_code" text,
	"description" text,
	"hours" numeric(6, 2),
	"rate" numeric(10, 2),
	"amount" numeric(12, 2) NOT NULL,
	"is_taxable" boolean DEFAULT true,
	"is_subject_to_fica" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "pay_item_deductions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"pay_item_id" uuid NOT NULL,
	"deduction_type" text NOT NULL,
	"deduction_code" text,
	"description" text,
	"calculation_method" text,
	"calculation_base" text,
	"percentage" numeric(5, 2),
	"flat_amount" numeric(10, 2),
	"employee_amount" numeric(10, 2) NOT NULL,
	"employer_amount" numeric(10, 2) DEFAULT '0',
	"is_pre_tax" boolean DEFAULT false,
	"reduces_federal_tax" boolean DEFAULT false,
	"reduces_state_tax" boolean DEFAULT false,
	"reduces_fica" boolean DEFAULT false,
	"annual_limit" numeric(12, 2),
	"ytd_amount" numeric(12, 2),
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "pay_stubs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"pay_item_id" uuid NOT NULL,
	"pdf_url" text,
	"generated_at" timestamp with time zone,
	"emailed_to" text,
	"emailed_at" timestamp with time zone,
	"viewed_at" timestamp with time zone,
	"access_token" text,
	"access_expires_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "pay_stubs_access_token_key" UNIQUE("access_token")
);
--> statement-breakpoint
CREATE TABLE "timesheets" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"placement_id" uuid NOT NULL,
	"period_start" date NOT NULL,
	"period_end" date NOT NULL,
	"period_type" timesheet_period_type DEFAULT 'weekly' NOT NULL,
	"total_regular_hours" numeric(6, 2) DEFAULT '0',
	"total_overtime_hours" numeric(6, 2) DEFAULT '0',
	"total_double_time_hours" numeric(6, 2) DEFAULT '0',
	"total_pto_hours" numeric(6, 2) DEFAULT '0',
	"total_holiday_hours" numeric(6, 2) DEFAULT '0',
	"total_billable_amount" numeric(12, 2) DEFAULT '0',
	"total_payable_amount" numeric(12, 2) DEFAULT '0',
	"rate_snapshot" jsonb,
	"status" timesheet_status DEFAULT 'draft' NOT NULL,
	"submitted_at" timestamp with time zone,
	"submitted_by" uuid,
	"client_approval_status" "approval_status" DEFAULT 'pending',
	"client_approved_at" timestamp with time zone,
	"client_approved_by" uuid,
	"client_approval_notes" text,
	"internal_approval_status" "approval_status" DEFAULT 'pending',
	"internal_approved_at" timestamp with time zone,
	"internal_approved_by" uuid,
	"internal_approval_notes" text,
	"processed_at" timestamp with time zone,
	"processed_by" uuid,
	"invoice_id" uuid,
	"payroll_run_id" uuid,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "timesheets_period_unique" UNIQUE("placement_id","period_start","period_end")
);
--> statement-breakpoint
ALTER TABLE "timesheets" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "timesheet_approval_workflows" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"approval_levels" jsonb DEFAULT '[]'::jsonb NOT NULL,
	"auto_approve_under_hours" numeric(4, 2),
	"auto_approve_if_matches_schedule" boolean DEFAULT false,
	"escalation_hours" integer DEFAULT 48,
	"escalation_to" uuid,
	"is_default" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "timesheet_approval_workflows" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "timesheet_adjustments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"original_timesheet_id" uuid NOT NULL,
	"adjustment_timesheet_id" uuid,
	"adjustment_type" text NOT NULL,
	"reason" text NOT NULL,
	"hours_delta" numeric(6, 2),
	"amount_delta" numeric(12, 2),
	"requested_by" uuid NOT NULL,
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"status" text DEFAULT 'pending',
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "timesheet_adjustments_adjustment_type_check" CHECK (adjustment_type = ANY (ARRAY['correction'::text, 'addition'::text, 'void'::text])),
	CONSTRAINT "timesheet_adjustments_status_check" CHECK (status = ANY (ARRAY['pending'::text, 'approved'::text, 'rejected'::text]))
);
--> statement-breakpoint
ALTER TABLE "timesheet_adjustments" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "timesheet_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"period_type" timesheet_period_type DEFAULT 'weekly' NOT NULL,
	"default_hours_per_day" numeric(4, 2) DEFAULT '8',
	"default_days_per_week" integer DEFAULT 5,
	"default_entries" jsonb DEFAULT '[]'::jsonb,
	"is_default" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "timesheet_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "invoices" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"invoice_number" text NOT NULL,
	"reference_number" text,
	"company_id" uuid,
	"billing_contact_id" uuid,
	"invoice_type" "invoice_type" DEFAULT 'standard' NOT NULL,
	"invoice_date" date NOT NULL,
	"due_date" date NOT NULL,
	"currency" text DEFAULT 'USD' NOT NULL,
	"exchange_rate" numeric(10, 6) DEFAULT '1',
	"subtotal" numeric(12, 2) DEFAULT '0' NOT NULL,
	"discount_amount" numeric(12, 2) DEFAULT '0',
	"discount_percentage" numeric(5, 2),
	"tax_amount" numeric(12, 2) DEFAULT '0',
	"total_amount" numeric(12, 2) DEFAULT '0' NOT NULL,
	"amount_paid" numeric(12, 2) DEFAULT '0',
	"balance_due" numeric(12, 2) DEFAULT '0',
	"status" "invoice_status" DEFAULT 'draft' NOT NULL,
	"sent_at" timestamp with time zone,
	"sent_to" text[],
	"viewed_at" timestamp with time zone,
	"payment_terms_id" uuid,
	"payment_instructions" text,
	"aging_bucket" text,
	"last_reminder_sent" timestamp with time zone,
	"reminder_count" integer DEFAULT 0,
	"is_disputed" boolean DEFAULT false,
	"dispute_reason" text,
	"dispute_opened_at" timestamp with time zone,
	"dispute_resolved_at" timestamp with time zone,
	"written_off_amount" numeric(12, 2) DEFAULT '0',
	"written_off_at" timestamp with time zone,
	"written_off_reason" text,
	"internal_notes" text,
	"client_notes" text,
	"terms_and_conditions" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"updated_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "invoices_number_unique" UNIQUE("org_id","invoice_number")
);
--> statement-breakpoint
ALTER TABLE "invoices" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "invoice_payments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"invoice_id" uuid NOT NULL,
	"payment_date" date NOT NULL,
	"amount" numeric(12, 2) NOT NULL,
	"payment_method" text NOT NULL,
	"reference_number" text,
	"bank_reference" text,
	"matched_to_line_items" jsonb,
	"deposit_date" date,
	"deposit_account" text,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "invoice_payments_payment_method_check" CHECK (payment_method = ANY (ARRAY['check'::text, 'ach'::text, 'wire'::text, 'credit_card'::text, 'other'::text]))
);
--> statement-breakpoint
ALTER TABLE "invoice_payments" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "payment_terms" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"days_until_due" integer DEFAULT 30 NOT NULL,
	"early_payment_discount_percent" numeric(5, 2),
	"early_payment_discount_days" integer,
	"late_fee_percent" numeric(5, 2),
	"late_fee_flat" numeric(10, 2),
	"late_fee_grace_days" integer DEFAULT 0,
	"is_default" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "payment_terms" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "invoice_batches" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"batch_number" text NOT NULL,
	"batch_date" date NOT NULL,
	"invoice_count" integer DEFAULT 0,
	"total_amount" numeric(14, 2) DEFAULT '0',
	"status" text DEFAULT 'draft',
	"generated_at" timestamp with time zone,
	"sent_at" timestamp with time zone,
	"include_accounts" uuid[],
	"exclude_accounts" uuid[],
	"cutoff_date" date,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	CONSTRAINT "invoice_batches_status_check" CHECK (status = ANY (ARRAY['draft'::text, 'processing'::text, 'sent'::text, 'completed'::text]))
);
--> statement-breakpoint
ALTER TABLE "invoice_batches" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "invoice_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"header_html" text,
	"footer_html" text,
	"line_item_format" text,
	"logo_url" text,
	"primary_color" text,
	"font_family" text,
	"default_payment_terms_id" uuid,
	"default_notes" text,
	"default_terms_and_conditions" text,
	"is_default" boolean DEFAULT false,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "invoice_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "pay_periods" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"period_number" integer NOT NULL,
	"year" integer NOT NULL,
	"period_start" date NOT NULL,
	"period_end" date NOT NULL,
	"pay_date" date NOT NULL,
	"period_type" timesheet_period_type NOT NULL,
	"status" "pay_period_status" DEFAULT 'upcoming' NOT NULL,
	"timesheet_cutoff" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "pay_periods_unique" UNIQUE("org_id","period_number","year")
);
--> statement-breakpoint
ALTER TABLE "pay_periods" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "pay_runs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"pay_period_id" uuid NOT NULL,
	"run_number" text NOT NULL,
	"run_type" "pay_run_type" DEFAULT 'regular' NOT NULL,
	"check_date" date NOT NULL,
	"direct_deposit_date" date,
	"total_gross" numeric(14, 2) DEFAULT '0',
	"total_employer_taxes" numeric(14, 2) DEFAULT '0',
	"total_employee_taxes" numeric(14, 2) DEFAULT '0',
	"total_deductions" numeric(14, 2) DEFAULT '0',
	"total_net" numeric(14, 2) DEFAULT '0',
	"total_employer_cost" numeric(14, 2) DEFAULT '0',
	"employee_count" integer DEFAULT 0,
	"consultant_count" integer DEFAULT 0,
	"contractor_count" integer DEFAULT 0,
	"status" "pay_run_status" DEFAULT 'draft' NOT NULL,
	"calculated_at" timestamp with time zone,
	"approved_at" timestamp with time zone,
	"approved_by" uuid,
	"submitted_at" timestamp with time zone,
	"processed_at" timestamp with time zone,
	"payroll_provider" text,
	"external_run_id" text,
	"notes" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	CONSTRAINT "pay_runs_number_unique" UNIQUE("org_id","run_number")
);
--> statement-breakpoint
ALTER TABLE "pay_runs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "worker_tax_setup" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"federal_filing_status" text,
	"federal_allowances" integer DEFAULT 0,
	"additional_federal_withholding" numeric(10, 2) DEFAULT '0',
	"federal_exempt" boolean DEFAULT false,
	"work_state" text NOT NULL,
	"state_filing_status" text,
	"state_allowances" integer DEFAULT 0,
	"additional_state_withholding" numeric(10, 2) DEFAULT '0',
	"state_exempt" boolean DEFAULT false,
	"resident_state" text,
	"resident_state_filing_status" text,
	"local_tax_jurisdiction" text,
	"local_tax_rate" numeric(5, 4),
	"fica_exempt" boolean DEFAULT false,
	"w4_form_date" date,
	"w4_multiple_jobs" boolean DEFAULT false,
	"w4_dependents_credit" numeric(10, 2) DEFAULT '0',
	"w4_other_income" numeric(10, 2) DEFAULT '0',
	"w4_deductions" numeric(10, 2) DEFAULT '0',
	"effective_date" date NOT NULL,
	"end_date" date,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "worker_tax_setup" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "worker_benefits" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"benefit_plan_id" uuid NOT NULL,
	"enrollment_date" date NOT NULL,
	"termination_date" date,
	"coverage_level" text,
	"employee_contribution" numeric(10, 2) NOT NULL,
	"employer_contribution" numeric(10, 2) NOT NULL,
	"contribution_frequency" text DEFAULT 'per_pay_period',
	"annual_election" numeric(10, 2),
	"ytd_contribution" numeric(10, 2) DEFAULT '0',
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "worker_benefits" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "worker_garnishments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"garnishment_type" text NOT NULL,
	"case_number" text,
	"issuing_agency" text,
	"calculation_type" text NOT NULL,
	"amount" numeric(10, 2),
	"percentage" numeric(5, 2),
	"maximum_percentage" numeric(5, 2),
	"total_amount_owed" numeric(12, 2),
	"amount_paid" numeric(12, 2) DEFAULT '0',
	"priority" integer DEFAULT 1,
	"start_date" date NOT NULL,
	"end_date" date,
	"is_active" boolean DEFAULT true,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "worker_garnishments_calculation_type_check" CHECK (calculation_type = ANY (ARRAY['flat'::text, 'percentage'::text, 'percentage_after_taxes'::text])),
	CONSTRAINT "worker_garnishments_garnishment_type_check" CHECK (garnishment_type = ANY (ARRAY['child_support'::text, 'tax_levy'::text, 'creditor'::text, 'student_loan'::text, 'bankruptcy'::text, 'other'::text]))
);
--> statement-breakpoint
ALTER TABLE "worker_garnishments" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "tax_documents" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"document_type" text NOT NULL,
	"tax_year" integer NOT NULL,
	"worker_type" "worker_type" NOT NULL,
	"worker_id" uuid NOT NULL,
	"contact_id" uuid,
	"document_data" jsonb NOT NULL,
	"pdf_url" text,
	"generated_at" timestamp with time zone,
	"filed_with_irs" boolean DEFAULT false,
	"filed_at" timestamp with time zone,
	"irs_confirmation" text,
	"is_corrected" boolean DEFAULT false,
	"corrects_document_id" uuid,
	"correction_reason" text,
	"mailed_at" timestamp with time zone,
	"mailing_address" jsonb,
	"emailed_at" timestamp with time zone,
	"viewed_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "tax_documents_unique" UNIQUE("org_id","document_type","tax_year","worker_id"),
	CONSTRAINT "tax_documents_document_type_check" CHECK (document_type = ANY (ARRAY['w2'::text, '1099_nec'::text, '1099_misc'::text]))
);
--> statement-breakpoint
ALTER TABLE "tax_documents" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workflow_executions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"instance_id" uuid NOT NULL,
	"status" varchar(50) DEFAULT 'pending' NOT NULL,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"paused_at" timestamp with time zone,
	"triggered_by" uuid,
	"trigger_type" varchar(50),
	"trigger_event" jsonb,
	"current_step_index" integer DEFAULT 0,
	"total_steps" integer DEFAULT 0,
	"error_message" text,
	"error_stack" text,
	"retry_count" integer DEFAULT 0,
	"max_retries" integer DEFAULT 3,
	"next_retry_at" timestamp with time zone,
	"execution_context" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "workflow_executions_status_check" CHECK ((status)::text = ANY ((ARRAY['pending'::character varying, 'running'::character varying, 'completed'::character varying, 'failed'::character varying, 'cancelled'::character varying, 'paused'::character varying])::text[])),
	CONSTRAINT "workflow_executions_trigger_type_check" CHECK ((trigger_type)::text = ANY ((ARRAY['manual'::character varying, 'automatic'::character varying, 'scheduled'::character varying, 'event'::character varying, 'api'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "workflow_executions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workflow_steps" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"execution_id" uuid NOT NULL,
	"state_id" uuid,
	"transition_id" uuid,
	"step_type" varchar(50) NOT NULL,
	"step_name" varchar(255),
	"step_config" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"position" integer NOT NULL,
	"status" varchar(50) DEFAULT 'pending' NOT NULL,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"wait_until" timestamp with time zone,
	"wait_condition" jsonb,
	"result" jsonb,
	"error_message" text,
	"created_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "workflow_steps_status_check" CHECK ((status)::text = ANY ((ARRAY['pending'::character varying, 'running'::character varying, 'completed'::character varying, 'failed'::character varying, 'skipped'::character varying, 'waiting'::character varying])::text[])),
	CONSTRAINT "workflow_steps_step_type_check" CHECK ((step_type)::text = ANY ((ARRAY['state'::character varying, 'transition'::character varying, 'action'::character varying, 'condition'::character varying, 'wait'::character varying, 'approval'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "workflow_steps" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workflow_actions" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"execution_id" uuid NOT NULL,
	"step_id" uuid,
	"action_type" varchar(50) NOT NULL,
	"action_config" jsonb NOT NULL,
	"status" varchar(50) DEFAULT 'pending' NOT NULL,
	"scheduled_at" timestamp with time zone,
	"started_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"result" jsonb,
	"error_message" text,
	"error_code" varchar(50),
	"retry_count" integer DEFAULT 0,
	"max_retries" integer DEFAULT 3,
	"created_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "workflow_actions_action_type_check" CHECK ((action_type)::text = ANY ((ARRAY['send_email'::character varying, 'send_notification'::character varying, 'create_task'::character varying, 'create_activity'::character varying, 'update_field'::character varying, 'webhook'::character varying, 'wait'::character varying, 'condition'::character varying, 'assign'::character varying, 'escalate'::character varying, 'create_document'::character varying, 'update_status'::character varying, 'add_note'::character varying, 'trigger_workflow'::character varying])::text[])),
	CONSTRAINT "workflow_actions_status_check" CHECK ((status)::text = ANY ((ARRAY['pending'::character varying, 'running'::character varying, 'completed'::character varying, 'failed'::character varying, 'skipped'::character varying, 'cancelled'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "workflow_actions" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workflow_approvals" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"execution_id" uuid NOT NULL,
	"step_id" uuid,
	"approver_id" uuid NOT NULL,
	"approver_type" varchar(50),
	"approver_role" varchar(100),
	"status" varchar(50) DEFAULT 'pending' NOT NULL,
	"requested_at" timestamp with time zone DEFAULT now(),
	"due_at" timestamp with time zone,
	"responded_at" timestamp with time zone,
	"response_notes" text,
	"delegated_to" uuid,
	"delegated_at" timestamp with time zone,
	"delegation_reason" text,
	"escalated_to" uuid,
	"escalated_at" timestamp with time zone,
	"escalation_reason" text,
	"escalation_level" integer DEFAULT 0,
	"sequence_order" integer DEFAULT 1,
	"is_parallel" boolean DEFAULT false,
	"approval_context" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "workflow_approvals_approver_type_check" CHECK ((approver_type)::text = ANY ((ARRAY['user'::character varying, 'role'::character varying, 'manager'::character varying, 'owner'::character varying, 'pod_lead'::character varying])::text[])),
	CONSTRAINT "workflow_approvals_status_check" CHECK ((status)::text = ANY ((ARRAY['pending'::character varying, 'approved'::character varying, 'rejected'::character varying, 'delegated'::character varying, 'escalated'::character varying, 'expired'::character varying, 'cancelled'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "workflow_approvals" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "workflow_execution_logs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"execution_id" uuid NOT NULL,
	"step_id" uuid,
	"action_id" uuid,
	"level" varchar(20) DEFAULT 'info' NOT NULL,
	"message" text NOT NULL,
	"data" jsonb,
	"source" varchar(100),
	"occurred_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "workflow_execution_logs_level_check" CHECK ((level)::text = ANY ((ARRAY['debug'::character varying, 'info'::character varying, 'warning'::character varying, 'error'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "workflow_execution_logs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "notification_preferences" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"user_id" uuid NOT NULL,
	"category" varchar(100) NOT NULL,
	"channels" jsonb DEFAULT '["in_app"]'::jsonb,
	"frequency" varchar(50) DEFAULT 'immediate',
	"digest_time" time DEFAULT '09:00:00',
	"digest_day" varchar(10) DEFAULT 'monday',
	"quiet_hours_enabled" boolean DEFAULT false,
	"quiet_hours_start" time DEFAULT '22:00:00',
	"quiet_hours_end" time DEFAULT '08:00:00',
	"quiet_hours_timezone" varchar(50) DEFAULT 'America/New_York',
	"dnd_enabled" boolean DEFAULT false,
	"dnd_until" timestamp with time zone,
	"sound_enabled" boolean DEFAULT true,
	"email_unsubscribed" boolean DEFAULT false,
	"email_unsubscribed_at" timestamp with time zone,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "unique_user_category" UNIQUE("user_id","category"),
	CONSTRAINT "notification_preferences_frequency_check" CHECK ((frequency)::text = ANY ((ARRAY['immediate'::character varying, 'hourly_digest'::character varying, 'daily_digest'::character varying, 'weekly_digest'::character varying, 'never'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "notification_preferences" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "notification_templates" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"name" varchar(100) NOT NULL,
	"slug" varchar(100) NOT NULL,
	"description" text,
	"category" varchar(100) NOT NULL,
	"title_template" varchar(500) NOT NULL,
	"message_template" text NOT NULL,
	"default_type" varchar(50) DEFAULT 'info',
	"default_priority" varchar(20) DEFAULT 'normal',
	"action_url_template" text,
	"action_label" varchar(100),
	"email_subject_template" varchar(500),
	"email_body_template" text,
	"email_body_text_template" text,
	"sms_template" varchar(500),
	"push_title_template" varchar(100),
	"push_body_template" varchar(255),
	"push_image_url" text,
	"default_channels" jsonb DEFAULT '["in_app"]'::jsonb,
	"variables" jsonb DEFAULT '[]'::jsonb,
	"conditions" jsonb DEFAULT '{}'::jsonb,
	"is_active" boolean DEFAULT true,
	"is_system" boolean DEFAULT false,
	"version" integer DEFAULT 1,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	"created_by" uuid,
	CONSTRAINT "notification_templates_default_priority_check" CHECK ((default_priority)::text = ANY ((ARRAY['low'::character varying, 'normal'::character varying, 'high'::character varying, 'urgent'::character varying])::text[])),
	CONSTRAINT "notification_templates_default_type_check" CHECK ((default_type)::text = ANY ((ARRAY['info'::character varying, 'success'::character varying, 'warning'::character varying, 'error'::character varying, 'action_required'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "notification_templates" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "campaigns" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"name" text NOT NULL,
	"description" text,
	"campaign_type" text DEFAULT 'talent_sourcing' NOT NULL,
	"channel" text DEFAULT 'email' NOT NULL,
	"status" text DEFAULT 'draft' NOT NULL,
	"target_audience" text,
	"target_locations" text[],
	"target_skills" text[],
	"target_company_sizes" text[],
	"is_ab_test" boolean DEFAULT false,
	"variant_a_template_id" uuid,
	"variant_b_template_id" uuid,
	"ab_split_percentage" integer DEFAULT 50,
	"target_contacts_count" integer,
	"target_response_rate" numeric(5, 2),
	"target_conversion_count" integer,
	"contacts_reached" integer DEFAULT 0,
	"emails_sent" integer DEFAULT 0,
	"linkedin_messages_sent" integer DEFAULT 0,
	"responses_received" integer DEFAULT 0,
	"conversions" integer DEFAULT 0,
	"response_rate" numeric(5, 2) GENERATED ALWAYS AS (
CASE
    WHEN (emails_sent > 0) THEN round((((responses_received)::numeric / (emails_sent)::numeric) * (100)::numeric), 2)
    ELSE (0)::numeric
END) STORED,
	"start_date" date,
	"end_date" date,
	"owner_id" uuid NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"created_by" uuid,
	"deleted_at" timestamp with time zone,
	"goal" text,
	"target_criteria" jsonb DEFAULT '{}'::jsonb,
	"channels" text[] DEFAULT '{""}',
	"sequences" jsonb DEFAULT '{}'::jsonb,
	"budget_total" numeric(12, 2) DEFAULT '0',
	"budget_currency" text DEFAULT 'USD',
	"target_leads" integer DEFAULT 0,
	"target_meetings" integer DEFAULT 0,
	"target_revenue" numeric(12, 2) DEFAULT '0',
	"compliance_settings" jsonb DEFAULT '{"casl":true,"gdpr":true,"canSpam":true,"includeUnsubscribe":true}'::jsonb,
	"approved_by" uuid,
	"approved_at" timestamp with time zone,
	"rejection_reason" text,
	"approval_status" text DEFAULT 'not_required',
	"ab_test_config" jsonb,
	"budget_spent" numeric(12, 2) DEFAULT '0',
	"leads_generated" integer DEFAULT 0,
	"meetings_booked" integer DEFAULT 0,
	"revenue_generated" numeric(12, 2) DEFAULT '0',
	"audience_size" integer DEFAULT 0,
	"prospects_contacted" integer DEFAULT 0,
	"prospects_opened" integer DEFAULT 0,
	"prospects_clicked" integer DEFAULT 0,
	"prospects_responded" integer DEFAULT 0,
	"search_vector" "tsvector",
	"sequence_template_ids" uuid[] DEFAULT '{""}',
	"updated_by" uuid,
	"send_window_start" time DEFAULT '09:00:00',
	"send_window_end" time DEFAULT '17:00:00',
	"send_days" text[] DEFAULT '{"RAY['mon'::text","'tue'::text","'wed'::text","'thu'::text","'fri'::tex"}',
	"timezone" text DEFAULT 'America/New_York',
	"total_sent" integer DEFAULT 0,
	"total_completed" integer DEFAULT 0,
	"total_active" integer DEFAULT 0,
	"total_bounced" integer DEFAULT 0,
	"total_unsubscribed" integer DEFAULT 0
);
--> statement-breakpoint
ALTER TABLE "campaigns" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "campaign_enrollments" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"campaign_id" uuid NOT NULL,
	"contact_id" uuid NOT NULL,
	"primary_channel" text,
	"sequence_step" integer DEFAULT 0,
	"sequence_status" text DEFAULT 'pending',
	"stop_reason" text,
	"first_contacted_at" timestamp with time zone,
	"last_contacted_at" timestamp with time zone,
	"opened_at" timestamp with time zone,
	"clicked_at" timestamp with time zone,
	"responded_at" timestamp with time zone,
	"response_type" text,
	"response_text" text,
	"converted_to_lead_at" timestamp with time zone,
	"converted_lead_id" uuid,
	"meeting_booked_at" timestamp with time zone,
	"meeting_scheduled_for" timestamp with time zone,
	"engagement_score" integer DEFAULT 0,
	"status" text DEFAULT 'enrolled',
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	"current_step" integer DEFAULT 0,
	"next_step_at" timestamp with time zone,
	"steps_completed" integer DEFAULT 0,
	"last_step_at" timestamp with time zone,
	"ab_variant" text,
	"emails_sent" integer DEFAULT 0,
	"linkedin_sent" integer DEFAULT 0,
	"calls_made" integer DEFAULT 0,
	"sms_sent" integer DEFAULT 0,
	"error_count" integer DEFAULT 0,
	"last_error" text,
	"last_error_at" timestamp with time zone,
	CONSTRAINT "campaign_enrollments_campaign_id_contact_id_key" UNIQUE("campaign_id","contact_id"),
	CONSTRAINT "campaign_enrollments_engagement_score_check" CHECK ((engagement_score >= 0) AND (engagement_score <= 100)),
	CONSTRAINT "campaign_enrollments_primary_channel_check" CHECK (primary_channel = ANY (ARRAY['email'::text, 'linkedin'::text, 'phone'::text, 'sms'::text])),
	CONSTRAINT "campaign_enrollments_response_type_check" CHECK ((response_type IS NULL) OR (response_type = ANY (ARRAY['positive'::text, 'neutral'::text, 'negative'::text, 'auto_reply'::text, 'out_of_office'::text]))),
	CONSTRAINT "campaign_enrollments_sequence_status_check" CHECK (sequence_status = ANY (ARRAY['pending'::text, 'in_progress'::text, 'stopped'::text, 'completed'::text, 'paused'::text])),
	CONSTRAINT "campaign_enrollments_status_check" CHECK (status = ANY (ARRAY['enrolled'::text, 'contacted'::text, 'engaged'::text, 'responded'::text, 'converted'::text, 'unsubscribed'::text, 'bounced'::text, 'stopped'::text]))
);
--> statement-breakpoint
ALTER TABLE "campaign_enrollments" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "campaign_sequence_logs" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"campaign_id" uuid NOT NULL,
	"channel" text NOT NULL,
	"step_number" integer NOT NULL,
	"action_type" text NOT NULL,
	"action_at" timestamp with time zone DEFAULT now() NOT NULL,
	"subject" text,
	"content_preview" text,
	"link_clicked" text,
	"call_duration_seconds" integer,
	"call_outcome" text,
	"response_text" text,
	"sentiment" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"enrollment_id" uuid,
	"sequence_id" uuid,
	"ab_variant" text,
	"scheduled_at" timestamp with time zone,
	"sent_at" timestamp with time zone,
	"template_id" uuid,
	"variables_used" jsonb,
	"error_message" text,
	"status" text DEFAULT 'pending',
	CONSTRAINT "campaign_sequence_logs_status_check" CHECK ((status IS NULL) OR (status = ANY (ARRAY['pending'::text, 'sent'::text, 'skipped'::text, 'failed'::text, 'bounced'::text, 'opened'::text, 'clicked'::text, 'replied'::text])))
);
--> statement-breakpoint
ALTER TABLE "campaign_sequence_logs" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "communications" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"channel" varchar(50) NOT NULL,
	"direction" varchar(20) NOT NULL,
	"thread_id" uuid,
	"parent_id" uuid,
	"thread_position" integer DEFAULT 0,
	"from_address" text,
	"from_name" text,
	"to_address" text NOT NULL,
	"to_name" text,
	"cc_addresses" jsonb DEFAULT '[]'::jsonb,
	"bcc_addresses" jsonb DEFAULT '[]'::jsonb,
	"subject" text,
	"body_text" text,
	"body_html" text,
	"preview" text,
	"attachments" jsonb DEFAULT '[]'::jsonb,
	"entity_type" varchar(50),
	"entity_id" uuid,
	"secondary_entity_type" varchar(50),
	"secondary_entity_id" uuid,
	"contact_id" uuid,
	"provider" varchar(50),
	"provider_message_id" text,
	"provider_thread_id" text,
	"status" varchar(50) DEFAULT 'pending' NOT NULL,
	"scheduled_at" timestamp with time zone,
	"sent_at" timestamp with time zone,
	"delivered_at" timestamp with time zone,
	"opened_at" timestamp with time zone,
	"clicked_at" timestamp with time zone,
	"replied_at" timestamp with time zone,
	"failed_at" timestamp with time zone,
	"open_count" integer DEFAULT 0,
	"click_count" integer DEFAULT 0,
	"reply_count" integer DEFAULT 0,
	"clicked_links" jsonb DEFAULT '[]'::jsonb,
	"error_code" varchar(50),
	"error_message" text,
	"retry_count" integer DEFAULT 0,
	"max_retries" integer DEFAULT 3,
	"campaign_id" uuid,
	"sequence_step_id" uuid,
	"ab_variant" varchar(50),
	"template_id" uuid,
	"template_name" text,
	"template_variables" jsonb DEFAULT '{}'::jsonb,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"tags" text[] DEFAULT '{""}',
	"created_by" uuid,
	"created_at" timestamp with time zone DEFAULT now(),
	"updated_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "communications_channel_check" CHECK ((channel)::text = ANY ((ARRAY['email'::character varying, 'sms'::character varying, 'linkedin'::character varying, 'phone'::character varying, 'whatsapp'::character varying, 'in_app'::character varying])::text[])),
	CONSTRAINT "communications_direction_check" CHECK ((direction)::text = ANY ((ARRAY['outbound'::character varying, 'inbound'::character varying])::text[])),
	CONSTRAINT "communications_status_check" CHECK ((status)::text = ANY ((ARRAY['pending'::character varying, 'queued'::character varying, 'sending'::character varying, 'sent'::character varying, 'delivered'::character varying, 'opened'::character varying, 'clicked'::character varying, 'replied'::character varying, 'bounced'::character varying, 'failed'::character varying, 'spam'::character varying, 'unsubscribed'::character varying, 'received'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "communications" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "communication_events" (
	"id" uuid PRIMARY KEY DEFAULT gen_random_uuid() NOT NULL,
	"communication_id" uuid NOT NULL,
	"event_type" varchar(50) NOT NULL,
	"event_data" jsonb DEFAULT '{}'::jsonb,
	"provider_event_id" text,
	"raw_payload" jsonb,
	"occurred_at" timestamp with time zone DEFAULT now(),
	CONSTRAINT "communication_events_event_type_check" CHECK ((event_type)::text = ANY ((ARRAY['created'::character varying, 'queued'::character varying, 'sending'::character varying, 'sent'::character varying, 'delivered'::character varying, 'opened'::character varying, 'clicked'::character varying, 'replied'::character varying, 'bounced'::character varying, 'failed'::character varying, 'spam'::character varying, 'unsubscribed'::character varying, 'retried'::character varying])::text[]))
);
--> statement-breakpoint
ALTER TABLE "communication_events" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "pto_balances" (
	"employee_id" uuid NOT NULL,
	"year" integer NOT NULL,
	"annual_accrual_days" numeric(5, 2) DEFAULT '15.0',
	"accrual_rate_per_pay_period" numeric(5, 2),
	"total_accrued" numeric(5, 2) DEFAULT '0',
	"total_used" numeric(5, 2) DEFAULT '0',
	"total_pending" numeric(5, 2) DEFAULT '0',
	"current_balance" numeric(5, 2) GENERATED ALWAYS AS (((total_accrued - total_used) - total_pending)) STORED,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "pto_balances_pkey" PRIMARY KEY("employee_id","year")
);
--> statement-breakpoint
ALTER TABLE "pto_balances" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "user_roles" (
	"user_id" uuid NOT NULL,
	"role_id" uuid NOT NULL,
	"assigned_at" timestamp with time zone DEFAULT now() NOT NULL,
	"assigned_by" uuid,
	"expires_at" timestamp with time zone,
	"is_primary" boolean DEFAULT false,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"deleted_at" timestamp with time zone,
	"created_by" uuid,
	"updated_by" uuid,
	"updated_at" timestamp with time zone,
	CONSTRAINT "user_roles_pkey" PRIMARY KEY("user_id","role_id")
);
--> statement-breakpoint
ALTER TABLE "user_roles" ENABLE ROW LEVEL SECURITY;--> statement-breakpoint
CREATE TABLE "system_events_2025_12" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"event_type" varchar(100) NOT NULL,
	"event_category" "event_category" NOT NULL,
	"entity_type" varchar(50),
	"entity_id" uuid,
	"details" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"severity" "event_severity" DEFAULT 'info',
	"message" text,
	"user_id" uuid,
	"ip_address" "inet",
	"user_agent" text,
	"request_id" uuid,
	"api_endpoint" varchar(200),
	"http_method" varchar(10),
	"occurred_at" timestamp with time zone DEFAULT now() NOT NULL,
	"duration_ms" integer,
	CONSTRAINT "system_events_2025_12_pkey" PRIMARY KEY("id","occurred_at")
);
--> statement-breakpoint
CREATE TABLE "system_events_2026_01" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"event_type" varchar(100) NOT NULL,
	"event_category" "event_category" NOT NULL,
	"entity_type" varchar(50),
	"entity_id" uuid,
	"details" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"severity" "event_severity" DEFAULT 'info',
	"message" text,
	"user_id" uuid,
	"ip_address" "inet",
	"user_agent" text,
	"request_id" uuid,
	"api_endpoint" varchar(200),
	"http_method" varchar(10),
	"occurred_at" timestamp with time zone DEFAULT now() NOT NULL,
	"duration_ms" integer,
	CONSTRAINT "system_events_2026_01_pkey" PRIMARY KEY("id","occurred_at")
);
--> statement-breakpoint
CREATE TABLE "system_events_2026_02" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"event_type" varchar(100) NOT NULL,
	"event_category" "event_category" NOT NULL,
	"entity_type" varchar(50),
	"entity_id" uuid,
	"details" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"severity" "event_severity" DEFAULT 'info',
	"message" text,
	"user_id" uuid,
	"ip_address" "inet",
	"user_agent" text,
	"request_id" uuid,
	"api_endpoint" varchar(200),
	"http_method" varchar(10),
	"occurred_at" timestamp with time zone DEFAULT now() NOT NULL,
	"duration_ms" integer,
	CONSTRAINT "system_events_2026_02_pkey" PRIMARY KEY("id","occurred_at")
);
--> statement-breakpoint
CREATE TABLE "system_events_2026_03" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid,
	"event_type" varchar(100) NOT NULL,
	"event_category" "event_category" NOT NULL,
	"entity_type" varchar(50),
	"entity_id" uuid,
	"details" jsonb DEFAULT '{}'::jsonb NOT NULL,
	"severity" "event_severity" DEFAULT 'info',
	"message" text,
	"user_id" uuid,
	"ip_address" "inet",
	"user_agent" text,
	"request_id" uuid,
	"api_endpoint" varchar(200),
	"http_method" varchar(10),
	"occurred_at" timestamp with time zone DEFAULT now() NOT NULL,
	"duration_ms" integer,
	CONSTRAINT "system_events_2026_03_pkey" PRIMARY KEY("id","occurred_at")
);
--> statement-breakpoint
CREATE TABLE "audit_log_2026_02" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"operation" varchar(20) NOT NULL,
	"changes" jsonb NOT NULL,
	"change_count" integer,
	"contains_pii" boolean DEFAULT false,
	"pii_fields" text[],
	"is_masked" boolean DEFAULT false,
	"request_id" uuid,
	"ip_address" "inet",
	"user_agent" text,
	"session_id" varchar(100),
	"performed_by" uuid,
	"performed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"impersonated_by" uuid,
	"retention_until" date,
	"archived_at" timestamp with time zone,
	CONSTRAINT "audit_log_2026_02_pkey" PRIMARY KEY("id","performed_at"),
	CONSTRAINT "audit_log_operation_check" CHECK ((operation)::text = ANY ((ARRAY['create'::character varying, 'update'::character varying, 'delete'::character varying, 'restore'::character varying])::text[]))
);
--> statement-breakpoint
CREATE TABLE "audit_log_2026_03" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"operation" varchar(20) NOT NULL,
	"changes" jsonb NOT NULL,
	"change_count" integer,
	"contains_pii" boolean DEFAULT false,
	"pii_fields" text[],
	"is_masked" boolean DEFAULT false,
	"request_id" uuid,
	"ip_address" "inet",
	"user_agent" text,
	"session_id" varchar(100),
	"performed_by" uuid,
	"performed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"impersonated_by" uuid,
	"retention_until" date,
	"archived_at" timestamp with time zone,
	CONSTRAINT "audit_log_2026_03_pkey" PRIMARY KEY("id","performed_at"),
	CONSTRAINT "audit_log_operation_check" CHECK ((operation)::text = ANY ((ARRAY['create'::character varying, 'update'::character varying, 'delete'::character varying, 'restore'::character varying])::text[]))
);
--> statement-breakpoint
CREATE TABLE "audit_log_2025_12" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"operation" varchar(20) NOT NULL,
	"changes" jsonb NOT NULL,
	"change_count" integer,
	"contains_pii" boolean DEFAULT false,
	"pii_fields" text[],
	"is_masked" boolean DEFAULT false,
	"request_id" uuid,
	"ip_address" "inet",
	"user_agent" text,
	"session_id" varchar(100),
	"performed_by" uuid,
	"performed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"impersonated_by" uuid,
	"retention_until" date,
	"archived_at" timestamp with time zone,
	CONSTRAINT "audit_log_2025_12_pkey" PRIMARY KEY("id","performed_at"),
	CONSTRAINT "audit_log_operation_check" CHECK ((operation)::text = ANY ((ARRAY['create'::character varying, 'update'::character varying, 'delete'::character varying, 'restore'::character varying])::text[]))
);
--> statement-breakpoint
CREATE TABLE "audit_log_2026_01" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"operation" varchar(20) NOT NULL,
	"changes" jsonb NOT NULL,
	"change_count" integer,
	"contains_pii" boolean DEFAULT false,
	"pii_fields" text[],
	"is_masked" boolean DEFAULT false,
	"request_id" uuid,
	"ip_address" "inet",
	"user_agent" text,
	"session_id" varchar(100),
	"performed_by" uuid,
	"performed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"impersonated_by" uuid,
	"retention_until" date,
	"archived_at" timestamp with time zone,
	CONSTRAINT "audit_log_2026_01_pkey" PRIMARY KEY("id","performed_at"),
	CONSTRAINT "audit_log_operation_check" CHECK ((operation)::text = ANY ((ARRAY['create'::character varying, 'update'::character varying, 'delete'::character varying, 'restore'::character varying])::text[]))
);
--> statement-breakpoint
CREATE TABLE "entity_history_2026_01" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"change_type" "history_change_type" NOT NULL,
	"field_name" varchar(100) NOT NULL,
	"old_value" varchar(500),
	"new_value" varchar(500),
	"old_value_label" varchar(200),
	"new_value_label" varchar(200),
	"reason" text,
	"comment" text,
	"related_entity_type" varchar(50),
	"related_entity_id" uuid,
	"correlation_id" uuid,
	"workflow_id" uuid,
	"workflow_step_id" uuid,
	"is_automated" boolean DEFAULT false,
	"time_in_previous_state" interval,
	"changed_by" uuid,
	"changed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"metadata" jsonb,
	CONSTRAINT "entity_history_2026_01_pkey" PRIMARY KEY("id","changed_at")
);
--> statement-breakpoint
CREATE TABLE "entity_history_2026_02" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"change_type" "history_change_type" NOT NULL,
	"field_name" varchar(100) NOT NULL,
	"old_value" varchar(500),
	"new_value" varchar(500),
	"old_value_label" varchar(200),
	"new_value_label" varchar(200),
	"reason" text,
	"comment" text,
	"related_entity_type" varchar(50),
	"related_entity_id" uuid,
	"correlation_id" uuid,
	"workflow_id" uuid,
	"workflow_step_id" uuid,
	"is_automated" boolean DEFAULT false,
	"time_in_previous_state" interval,
	"changed_by" uuid,
	"changed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"metadata" jsonb,
	CONSTRAINT "entity_history_2026_02_pkey" PRIMARY KEY("id","changed_at")
);
--> statement-breakpoint
CREATE TABLE "entity_history_2026_03" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"change_type" "history_change_type" NOT NULL,
	"field_name" varchar(100) NOT NULL,
	"old_value" varchar(500),
	"new_value" varchar(500),
	"old_value_label" varchar(200),
	"new_value_label" varchar(200),
	"reason" text,
	"comment" text,
	"related_entity_type" varchar(50),
	"related_entity_id" uuid,
	"correlation_id" uuid,
	"workflow_id" uuid,
	"workflow_step_id" uuid,
	"is_automated" boolean DEFAULT false,
	"time_in_previous_state" interval,
	"changed_by" uuid,
	"changed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"metadata" jsonb,
	CONSTRAINT "entity_history_2026_03_pkey" PRIMARY KEY("id","changed_at")
);
--> statement-breakpoint
CREATE TABLE "entity_history_2025_12" (
	"id" uuid DEFAULT gen_random_uuid() NOT NULL,
	"org_id" uuid NOT NULL,
	"entity_type" varchar(50) NOT NULL,
	"entity_id" uuid NOT NULL,
	"change_type" "history_change_type" NOT NULL,
	"field_name" varchar(100) NOT NULL,
	"old_value" varchar(500),
	"new_value" varchar(500),
	"old_value_label" varchar(200),
	"new_value_label" varchar(200),
	"reason" text,
	"comment" text,
	"related_entity_type" varchar(50),
	"related_entity_id" uuid,
	"correlation_id" uuid,
	"workflow_id" uuid,
	"workflow_step_id" uuid,
	"is_automated" boolean DEFAULT false,
	"time_in_previous_state" interval,
	"changed_by" uuid,
	"changed_at" timestamp with time zone DEFAULT now() NOT NULL,
	"metadata" jsonb,
	CONSTRAINT "entity_history_2025_12_pkey" PRIMARY KEY("id","changed_at")
);
--> statement-breakpoint
ALTER TABLE "badge_progress" ADD CONSTRAINT "badge_progress_badge_id_fkey" FOREIGN KEY ("badge_id") REFERENCES "public"."badges"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "badge_progress" ADD CONSTRAINT "badge_progress_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "badge_trigger_events" ADD CONSTRAINT "badge_trigger_events_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "payment_transactions" ADD CONSTRAINT "payment_transactions_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "payment_transactions" ADD CONSTRAINT "payment_transactions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "commissions" ADD CONSTRAINT "commissions_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "commissions" ADD CONSTRAINT "commissions_deal_id_fkey" FOREIGN KEY ("deal_id") REFERENCES "public"."deals"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "commissions" ADD CONSTRAINT "commissions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "commissions" ADD CONSTRAINT "commissions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "commission_payments" ADD CONSTRAINT "commission_payments_commission_id_fkey" FOREIGN KEY ("commission_id") REFERENCES "public"."commissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "commission_payments" ADD CONSTRAINT "commission_payments_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "commission_payments" ADD CONSTRAINT "commission_payments_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "productivity_reports" ADD CONSTRAINT "productivity_reports_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "fk_leads_converted_to_deal" FOREIGN KEY ("converted_to_deal_id") REFERENCES "public"."deals"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "leads_campaign_id_fkey" FOREIGN KEY ("campaign_id") REFERENCES "public"."campaigns"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "leads_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "leads_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "leads_converted_to_company_id_fkey" FOREIGN KEY ("converted_to_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "leads_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "leads_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "leads_owner_id_fkey" FOREIGN KEY ("owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leads" ADD CONSTRAINT "leads_qualified_by_fkey" FOREIGN KEY ("qualified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "generated_resumes" ADD CONSTRAINT "generated_resumes_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "generated_resumes" ADD CONSTRAINT "generated_resumes_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "requisition_embeddings" ADD CONSTRAINT "requisition_embeddings_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "resume_matches" ADD CONSTRAINT "resume_matches_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_twin_interactions" ADD CONSTRAINT "employee_twin_interactions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_embeddings" ADD CONSTRAINT "candidate_embeddings_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_embeddings" ADD CONSTRAINT "candidate_embeddings_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_sourcing_credits" ADD CONSTRAINT "lead_sourcing_credits_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_sourcing_credits" ADD CONSTRAINT "lead_sourcing_credits_lead_id_fkey" FOREIGN KEY ("lead_id") REFERENCES "public"."leads"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_sourcing_credits" ADD CONSTRAINT "lead_sourcing_credits_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_sourcing_credits" ADD CONSTRAINT "lead_sourcing_credits_sourced_by_fkey" FOREIGN KEY ("sourced_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "roles" ADD CONSTRAINT "roles_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "roles" ADD CONSTRAINT "roles_parent_role_id_fkey" FOREIGN KEY ("parent_role_id") REFERENCES "public"."roles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "twin_preferences" ADD CONSTRAINT "twin_preferences_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "content_assets" ADD CONSTRAINT "content_assets_lesson_id_fkey" FOREIGN KEY ("lesson_id") REFERENCES "public"."topic_lessons"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "content_assets" ADD CONSTRAINT "content_assets_replaced_by_fkey" FOREIGN KEY ("replaced_by") REFERENCES "public"."content_assets"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "content_assets" ADD CONSTRAINT "content_assets_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "content_assets" ADD CONSTRAINT "content_assets_uploaded_by_fkey" FOREIGN KEY ("uploaded_by") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "video_progress" ADD CONSTRAINT "video_progress_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "video_progress" ADD CONSTRAINT "video_progress_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "video_progress" ADD CONSTRAINT "video_progress_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "project_timeline" ADD CONSTRAINT "project_timeline_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "session_metadata" ADD CONSTRAINT "session_metadata_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_documents" ADD CONSTRAINT "campaign_documents_campaign_id_fkey" FOREIGN KEY ("campaign_id") REFERENCES "public"."campaigns"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_documents" ADD CONSTRAINT "campaign_documents_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_documents" ADD CONSTRAINT "campaign_documents_uploaded_by_fkey" FOREIGN KEY ("uploaded_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "event_delivery_log" ADD CONSTRAINT "event_delivery_log_event_id_fkey" FOREIGN KEY ("event_id") REFERENCES "public"."events"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "event_delivery_log" ADD CONSTRAINT "event_delivery_log_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "event_delivery_log" ADD CONSTRAINT "event_delivery_log_subscription_id_fkey" FOREIGN KEY ("subscription_id") REFERENCES "public"."event_subscriptions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_checklist" ADD CONSTRAINT "onboarding_checklist_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "courses" ADD CONSTRAINT "courses_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "course_modules" ADD CONSTRAINT "course_modules_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "module_topics" ADD CONSTRAINT "module_topics_module_id_fkey" FOREIGN KEY ("module_id") REFERENCES "public"."course_modules"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_conversations" ADD CONSTRAINT "ai_conversations_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_patterns" ADD CONSTRAINT "ai_patterns_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_cost_tracking" ADD CONSTRAINT "ai_cost_tracking_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_cost_tracking" ADD CONSTRAINT "ai_cost_tracking_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_prompts" ADD CONSTRAINT "ai_prompts_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "student_progress" ADD CONSTRAINT "student_progress_student_id_fkey" FOREIGN KEY ("student_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_agent_interactions" ADD CONSTRAINT "ai_agent_interactions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_agent_interactions" ADD CONSTRAINT "ai_agent_interactions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "guru_interactions" ADD CONSTRAINT "guru_interactions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "guru_interactions" ADD CONSTRAINT "guru_interactions_student_id_fkey" FOREIGN KEY ("student_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "resume_versions" ADD CONSTRAINT "resume_versions_student_id_fkey" FOREIGN KEY ("student_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_sessions" ADD CONSTRAINT "interview_sessions_student_id_fkey" FOREIGN KEY ("student_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_screenshots" ADD CONSTRAINT "employee_screenshots_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "topic_lessons" ADD CONSTRAINT "topic_lessons_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "topic_completions" ADD CONSTRAINT "topic_completions_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE restrict ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "topic_completions" ADD CONSTRAINT "topic_completions_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "topic_completions" ADD CONSTRAINT "topic_completions_module_id_fkey" FOREIGN KEY ("module_id") REFERENCES "public"."course_modules"("id") ON DELETE restrict ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "topic_completions" ADD CONSTRAINT "topic_completions_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE restrict ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "topic_completions" ADD CONSTRAINT "topic_completions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "xp_transactions" ADD CONSTRAINT "xp_transactions_awarded_by_fkey" FOREIGN KEY ("awarded_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "xp_transactions" ADD CONSTRAINT "xp_transactions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "reading_progress" ADD CONSTRAINT "reading_progress_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "reading_progress" ADD CONSTRAINT "reading_progress_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "reading_progress" ADD CONSTRAINT "reading_progress_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_templates" ADD CONSTRAINT "lab_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_instances" ADD CONSTRAINT "lab_instances_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_instances" ADD CONSTRAINT "lab_instances_lab_template_id_fkey" FOREIGN KEY ("lab_template_id") REFERENCES "public"."lab_templates"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_instances" ADD CONSTRAINT "lab_instances_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_instances" ADD CONSTRAINT "lab_instances_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_submissions" ADD CONSTRAINT "lab_submissions_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_submissions" ADD CONSTRAINT "lab_submissions_graded_by_fkey" FOREIGN KEY ("graded_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_submissions" ADD CONSTRAINT "lab_submissions_lab_instance_id_fkey" FOREIGN KEY ("lab_instance_id") REFERENCES "public"."lab_instances"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_submissions" ADD CONSTRAINT "lab_submissions_previous_submission_id_fkey" FOREIGN KEY ("previous_submission_id") REFERENCES "public"."lab_submissions"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_submissions" ADD CONSTRAINT "lab_submissions_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lab_submissions" ADD CONSTRAINT "lab_submissions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "capstone_submissions" ADD CONSTRAINT "capstone_submissions_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "capstone_submissions" ADD CONSTRAINT "capstone_submissions_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "capstone_submissions" ADD CONSTRAINT "capstone_submissions_graded_by_fkey" FOREIGN KEY ("graded_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "capstone_submissions" ADD CONSTRAINT "capstone_submissions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "twin_events" ADD CONSTRAINT "twin_events_processed_by_fkey" FOREIGN KEY ("processed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "twin_events" ADD CONSTRAINT "twin_events_source_user_id_fkey" FOREIGN KEY ("source_user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "twin_conversations" ADD CONSTRAINT "twin_conversations_initiator_user_id_fkey" FOREIGN KEY ("initiator_user_id") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "quiz_questions" ADD CONSTRAINT "quiz_questions_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "quiz_questions" ADD CONSTRAINT "quiz_questions_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "quiz_settings" ADD CONSTRAINT "quiz_settings_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "peer_reviews" ADD CONSTRAINT "peer_reviews_reviewer_id_fkey" FOREIGN KEY ("reviewer_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "peer_reviews" ADD CONSTRAINT "peer_reviews_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."capstone_submissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_chats" ADD CONSTRAINT "ai_mentor_chats_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_chats" ADD CONSTRAINT "ai_mentor_chats_prompt_variant_id_fkey" FOREIGN KEY ("prompt_variant_id") REFERENCES "public"."ai_prompt_variants"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_chats" ADD CONSTRAINT "ai_mentor_chats_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_chats" ADD CONSTRAINT "ai_mentor_chats_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sequence_templates" ADD CONSTRAINT "sequence_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sequence_templates" ADD CONSTRAINT "sequence_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_rate_limits" ADD CONSTRAINT "ai_mentor_rate_limits_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_sessions" ADD CONSTRAINT "ai_mentor_sessions_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_sessions" ADD CONSTRAINT "ai_mentor_sessions_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_sessions" ADD CONSTRAINT "ai_mentor_sessions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "permission_overrides" ADD CONSTRAINT "permission_overrides_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "permission_overrides" ADD CONSTRAINT "permission_overrides_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "permission_overrides" ADD CONSTRAINT "permission_overrides_permission_id_fkey" FOREIGN KEY ("permission_id") REFERENCES "public"."permissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "permission_overrides" ADD CONSTRAINT "permission_overrides_revoked_by_fkey" FOREIGN KEY ("revoked_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "permission_overrides" ADD CONSTRAINT "permission_overrides_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_sequences" ADD CONSTRAINT "campaign_sequences_campaign_id_fkey" FOREIGN KEY ("campaign_id") REFERENCES "public"."campaigns"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_sequences" ADD CONSTRAINT "campaign_sequences_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_sequences" ADD CONSTRAINT "campaign_sequences_sequence_template_id_fkey" FOREIGN KEY ("sequence_template_id") REFERENCES "public"."sequence_templates"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "api_tokens" ADD CONSTRAINT "api_tokens_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "api_tokens" ADD CONSTRAINT "api_tokens_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "api_tokens" ADD CONSTRAINT "api_tokens_revoked_by_fkey" FOREIGN KEY ("revoked_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bulk_update_history" ADD CONSTRAINT "bulk_update_history_applied_by_fkey" FOREIGN KEY ("applied_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bulk_update_history" ADD CONSTRAINT "bulk_update_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bulk_update_history" ADD CONSTRAINT "bulk_update_history_rolled_back_by_fkey" FOREIGN KEY ("rolled_back_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "role_permissions" ADD CONSTRAINT "role_permissions_granted_by_fkey" FOREIGN KEY ("granted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "role_permissions" ADD CONSTRAINT "role_permissions_permission_id_fkey" FOREIGN KEY ("permission_id") REFERENCES "public"."permissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "role_permissions" ADD CONSTRAINT "role_permissions_role_id_fkey" FOREIGN KEY ("role_id") REFERENCES "public"."system_roles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_question_patterns" ADD CONSTRAINT "ai_question_patterns_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flag_roles" ADD CONSTRAINT "feature_flag_roles_feature_flag_id_fkey" FOREIGN KEY ("feature_flag_id") REFERENCES "public"."feature_flags"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flag_roles" ADD CONSTRAINT "feature_flag_roles_role_id_fkey" FOREIGN KEY ("role_id") REFERENCES "public"."system_roles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_badges" ADD CONSTRAINT "user_badges_badge_id_fkey" FOREIGN KEY ("badge_id") REFERENCES "public"."badges"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_badges" ADD CONSTRAINT "user_badges_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_settings" ADD CONSTRAINT "system_settings_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_states" ADD CONSTRAINT "workflow_states_workflow_id_fkey" FOREIGN KEY ("workflow_id") REFERENCES "public"."workflows"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_transitions" ADD CONSTRAINT "workflow_transitions_from_state_id_fkey" FOREIGN KEY ("from_state_id") REFERENCES "public"."workflow_states"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_transitions" ADD CONSTRAINT "workflow_transitions_to_state_id_fkey" FOREIGN KEY ("to_state_id") REFERENCES "public"."workflow_states"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_transitions" ADD CONSTRAINT "workflow_transitions_workflow_id_fkey" FOREIGN KEY ("workflow_id") REFERENCES "public"."workflows"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_instances" ADD CONSTRAINT "workflow_instances_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_instances" ADD CONSTRAINT "workflow_instances_current_state_id_fkey" FOREIGN KEY ("current_state_id") REFERENCES "public"."workflow_states"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_instances" ADD CONSTRAINT "workflow_instances_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_instances" ADD CONSTRAINT "workflow_instances_workflow_id_fkey" FOREIGN KEY ("workflow_id") REFERENCES "public"."workflows"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_history" ADD CONSTRAINT "workflow_history_from_state_id_fkey" FOREIGN KEY ("from_state_id") REFERENCES "public"."workflow_states"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_history" ADD CONSTRAINT "workflow_history_performed_by_fkey" FOREIGN KEY ("performed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_history" ADD CONSTRAINT "workflow_history_to_state_id_fkey" FOREIGN KEY ("to_state_id") REFERENCES "public"."workflow_states"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_history" ADD CONSTRAINT "workflow_history_workflow_instance_id_fkey" FOREIGN KEY ("workflow_instance_id") REFERENCES "public"."workflow_instances"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "file_uploads" ADD CONSTRAINT "file_uploads_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "file_uploads" ADD CONSTRAINT "file_uploads_uploaded_by_fkey" FOREIGN KEY ("uploaded_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "document_templates" ADD CONSTRAINT "document_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "document_templates" ADD CONSTRAINT "document_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "generated_documents" ADD CONSTRAINT "generated_documents_generated_by_fkey" FOREIGN KEY ("generated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "generated_documents" ADD CONSTRAINT "generated_documents_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "generated_documents" ADD CONSTRAINT "generated_documents_template_id_fkey" FOREIGN KEY ("template_id") REFERENCES "public"."document_templates"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflows" ADD CONSTRAINT "workflows_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflows" ADD CONSTRAINT "workflows_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_logs" ADD CONSTRAINT "email_logs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_logs" ADD CONSTRAINT "email_logs_template_id_fkey" FOREIGN KEY ("template_id") REFERENCES "public"."email_templates"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "background_jobs" ADD CONSTRAINT "background_jobs_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "background_jobs" ADD CONSTRAINT "background_jobs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "discount_codes" ADD CONSTRAINT "discount_codes_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "student_interventions" ADD CONSTRAINT "student_interventions_assigned_trainer_id_fkey" FOREIGN KEY ("assigned_trainer_id") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "student_interventions" ADD CONSTRAINT "student_interventions_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "student_interventions" ADD CONSTRAINT "student_interventions_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "student_interventions" ADD CONSTRAINT "student_interventions_student_id_fkey" FOREIGN KEY ("student_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "student_enrollments" ADD CONSTRAINT "student_enrollments_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE restrict ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "student_enrollments" ADD CONSTRAINT "student_enrollments_current_module_id_fkey" FOREIGN KEY ("current_module_id") REFERENCES "public"."course_modules"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "student_enrollments" ADD CONSTRAINT "student_enrollments_current_topic_id_fkey" FOREIGN KEY ("current_topic_id") REFERENCES "public"."module_topics"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "student_enrollments" ADD CONSTRAINT "student_enrollments_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "discount_code_usage" ADD CONSTRAINT "discount_code_usage_discount_code_id_fkey" FOREIGN KEY ("discount_code_id") REFERENCES "public"."discount_codes"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "discount_code_usage" ADD CONSTRAINT "discount_code_usage_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "discount_code_usage" ADD CONSTRAINT "discount_code_usage_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "course_pricing" ADD CONSTRAINT "course_pricing_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "organization_settings" ADD CONSTRAINT "organization_settings_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "organization_settings" ADD CONSTRAINT "organization_settings_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_lead_data" ADD CONSTRAINT "contact_lead_data_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_lead_data" ADD CONSTRAINT "contact_lead_data_source_campaign_id_fkey" FOREIGN KEY ("source_campaign_id") REFERENCES "public"."campaigns"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "comments" ADD CONSTRAINT "comments_author_id_fkey" FOREIGN KEY ("author_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "comments" ADD CONSTRAINT "comments_deleted_by_fkey" FOREIGN KEY ("deleted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "comments" ADD CONSTRAINT "comments_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "comments" ADD CONSTRAINT "comments_parent_comment_id_fkey" FOREIGN KEY ("parent_comment_id") REFERENCES "public"."comments"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_tasks" ADD CONSTRAINT "lead_tasks_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_tasks" ADD CONSTRAINT "lead_tasks_completed_by_fkey" FOREIGN KEY ("completed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_tasks" ADD CONSTRAINT "lead_tasks_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_tasks" ADD CONSTRAINT "lead_tasks_lead_id_fkey" FOREIGN KEY ("lead_id") REFERENCES "public"."leads"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_tasks" ADD CONSTRAINT "lead_tasks_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notifications" ADD CONSTRAINT "notifications_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notifications" ADD CONSTRAINT "notifications_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "tasks" ADD CONSTRAINT "tasks_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "tasks" ADD CONSTRAINT "tasks_completed_by_fkey" FOREIGN KEY ("completed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "tasks" ADD CONSTRAINT "tasks_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "tasks" ADD CONSTRAINT "tasks_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "tasks" ADD CONSTRAINT "tasks_parent_task_id_fkey" FOREIGN KEY ("parent_task_id") REFERENCES "public"."tasks"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "organization_branding" ADD CONSTRAINT "organization_branding_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "organization_branding" ADD CONSTRAINT "organization_branding_uploaded_by_fkey" FOREIGN KEY ("uploaded_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_contracts" ADD CONSTRAINT "company_contracts_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_contracts" ADD CONSTRAINT "company_contracts_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_contracts" ADD CONSTRAINT "company_contracts_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_contracts" ADD CONSTRAINT "company_contracts_our_signatory_id_fkey" FOREIGN KEY ("our_signatory_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_contracts" ADD CONSTRAINT "company_contracts_parent_contract_id_fkey" FOREIGN KEY ("parent_contract_id") REFERENCES "public"."company_contracts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_rate_cards" ADD CONSTRAINT "company_rate_cards_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_rate_cards" ADD CONSTRAINT "company_rate_cards_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_rate_cards" ADD CONSTRAINT "company_rate_cards_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_rate_cards" ADD CONSTRAINT "company_rate_cards_msp_program_id_fkey" FOREIGN KEY ("msp_program_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_rate_cards" ADD CONSTRAINT "company_rate_cards_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_rate_card_items" ADD CONSTRAINT "company_rate_card_items_rate_card_id_fkey" FOREIGN KEY ("rate_card_id") REFERENCES "public"."company_rate_cards"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_compliance_requirements" ADD CONSTRAINT "company_compliance_requirements_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_compliance_requirements" ADD CONSTRAINT "company_compliance_requirements_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_compliance_requirements" ADD CONSTRAINT "company_compliance_requirements_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_health_scores" ADD CONSTRAINT "company_health_scores_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_health_scores" ADD CONSTRAINT "company_health_scores_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_metrics" ADD CONSTRAINT "company_metrics_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_metrics" ADD CONSTRAINT "company_metrics_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_revenue" ADD CONSTRAINT "company_revenue_billing_company_id_fkey" FOREIGN KEY ("billing_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_revenue" ADD CONSTRAINT "company_revenue_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_revenue" ADD CONSTRAINT "company_revenue_end_client_company_id_fkey" FOREIGN KEY ("end_client_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_revenue" ADD CONSTRAINT "company_revenue_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_log" ADD CONSTRAINT "activity_log_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_log" ADD CONSTRAINT "activity_log_performed_by_fkey" FOREIGN KEY ("performed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_metadata" ADD CONSTRAINT "employee_metadata_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_metadata" ADD CONSTRAINT "fk_employee_pod" FOREIGN KEY ("pod_id") REFERENCES "public"."pods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_skills" ADD CONSTRAINT "candidate_skills_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_skills" ADD CONSTRAINT "candidate_skills_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_skills" ADD CONSTRAINT "candidate_skills_skill_id_fkey" FOREIGN KEY ("skill_id") REFERENCES "public"."skills"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pods" ADD CONSTRAINT "pods_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pods" ADD CONSTRAINT "pods_junior_member_id_fkey" FOREIGN KEY ("junior_member_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pods" ADD CONSTRAINT "pods_manager_id_fkey" FOREIGN KEY ("manager_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pods" ADD CONSTRAINT "pods_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pods" ADD CONSTRAINT "pods_region_id_fkey" FOREIGN KEY ("region_id") REFERENCES "public"."regions"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pods" ADD CONSTRAINT "pods_senior_member_id_fkey" FOREIGN KEY ("senior_member_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_session_context" ADD CONSTRAINT "user_session_context_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_managers" ADD CONSTRAINT "pod_managers_assigned_by_fkey" FOREIGN KEY ("assigned_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_managers" ADD CONSTRAINT "pod_managers_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_managers" ADD CONSTRAINT "pod_managers_pod_id_fkey" FOREIGN KEY ("pod_id") REFERENCES "public"."pods"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_managers" ADD CONSTRAINT "pod_managers_removed_by_fkey" FOREIGN KEY ("removed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_managers" ADD CONSTRAINT "pod_managers_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_strategies" ADD CONSTRAINT "lead_strategies_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_strategies" ADD CONSTRAINT "lead_strategies_lead_id_fkey" FOREIGN KEY ("lead_id") REFERENCES "public"."leads"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_strategies" ADD CONSTRAINT "lead_strategies_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_strategies" ADD CONSTRAINT "lead_strategies_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "talking_point_templates" ADD CONSTRAINT "talking_point_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "talking_point_templates" ADD CONSTRAINT "talking_point_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "payroll_items" ADD CONSTRAINT "payroll_items_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "payroll_items" ADD CONSTRAINT "payroll_items_payroll_run_id_fkey" FOREIGN KEY ("payroll_run_id") REFERENCES "public"."payroll_runs"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "time_attendance" ADD CONSTRAINT "time_attendance_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "time_attendance" ADD CONSTRAINT "time_attendance_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "payroll_runs" ADD CONSTRAINT "payroll_runs_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "payroll_runs" ADD CONSTRAINT "payroll_runs_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "payroll_runs" ADD CONSTRAINT "payroll_runs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "performance_reviews" ADD CONSTRAINT "performance_reviews_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "performance_reviews" ADD CONSTRAINT "performance_reviews_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "performance_reviews" ADD CONSTRAINT "performance_reviews_reviewer_id_fkey" FOREIGN KEY ("reviewer_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "import_jobs" ADD CONSTRAINT "import_jobs_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "import_jobs" ADD CONSTRAINT "import_jobs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "export_jobs" ADD CONSTRAINT "export_jobs_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "export_jobs" ADD CONSTRAINT "export_jobs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "gdpr_requests" ADD CONSTRAINT "gdpr_requests_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "gdpr_requests" ADD CONSTRAINT "gdpr_requests_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "gdpr_requests" ADD CONSTRAINT "gdpr_requests_processed_by_fkey" FOREIGN KEY ("processed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "duplicate_records" ADD CONSTRAINT "duplicate_records_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "duplicate_records" ADD CONSTRAINT "duplicate_records_reviewed_by_fkey" FOREIGN KEY ("reviewed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "duplicate_rules" ADD CONSTRAINT "duplicate_rules_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "duplicate_rules" ADD CONSTRAINT "duplicate_rules_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "archived_records" ADD CONSTRAINT "archived_records_archived_by_fkey" FOREIGN KEY ("archived_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "archived_records" ADD CONSTRAINT "archived_records_deleted_by_fkey" FOREIGN KEY ("deleted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "archived_records" ADD CONSTRAINT "archived_records_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "archived_records" ADD CONSTRAINT "archived_records_restored_by_fkey" FOREIGN KEY ("restored_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "retention_policies" ADD CONSTRAINT "retention_policies_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "retention_policies" ADD CONSTRAINT "retention_policies_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_resumes" ADD CONSTRAINT "candidate_resumes_archived_by_fkey" FOREIGN KEY ("archived_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_resumes" ADD CONSTRAINT "candidate_resumes_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_resumes" ADD CONSTRAINT "candidate_resumes_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_resumes" ADD CONSTRAINT "candidate_resumes_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_resumes" ADD CONSTRAINT "candidate_resumes_previous_version_id_fkey" FOREIGN KEY ("previous_version_id") REFERENCES "public"."candidate_resumes"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_resumes" ADD CONSTRAINT "candidate_resumes_uploaded_by_fkey" FOREIGN KEY ("uploaded_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_profiles" ADD CONSTRAINT "user_profiles_manager_id_fkey" FOREIGN KEY ("manager_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_profiles" ADD CONSTRAINT "user_profiles_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_profiles" ADD CONSTRAINT "user_profiles_role_id_fkey" FOREIGN KEY ("role_id") REFERENCES "public"."system_roles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_background_checks" ADD CONSTRAINT "candidate_background_checks_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_background_checks" ADD CONSTRAINT "candidate_background_checks_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_background_checks" ADD CONSTRAINT "candidate_background_checks_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_background_checks" ADD CONSTRAINT "candidate_background_checks_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_background_checks" ADD CONSTRAINT "candidate_background_checks_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_certifications" ADD CONSTRAINT "candidate_certifications_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_certifications" ADD CONSTRAINT "candidate_certifications_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_certifications" ADD CONSTRAINT "candidate_certifications_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_compliance_documents" ADD CONSTRAINT "candidate_compliance_documents_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_compliance_documents" ADD CONSTRAINT "candidate_compliance_documents_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_compliance_documents" ADD CONSTRAINT "candidate_compliance_documents_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_compliance_documents" ADD CONSTRAINT "candidate_compliance_documents_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_compliance_documents" ADD CONSTRAINT "candidate_compliance_documents_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "object_owners" ADD CONSTRAINT "object_owners_assigned_by_fkey" FOREIGN KEY ("assigned_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "object_owners" ADD CONSTRAINT "object_owners_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "object_owners" ADD CONSTRAINT "object_owners_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_education" ADD CONSTRAINT "candidate_education_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_education" ADD CONSTRAINT "candidate_education_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_education" ADD CONSTRAINT "candidate_education_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_references" ADD CONSTRAINT "candidate_references_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_references" ADD CONSTRAINT "candidate_references_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_references" ADD CONSTRAINT "candidate_references_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_work_authorizations" ADD CONSTRAINT "candidate_work_authorizations_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_work_authorizations" ADD CONSTRAINT "candidate_work_authorizations_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_work_authorizations" ADD CONSTRAINT "candidate_work_authorizations_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "regions" ADD CONSTRAINT "regions_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "regions" ADD CONSTRAINT "regions_manager_id_fkey" FOREIGN KEY ("manager_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "regions" ADD CONSTRAINT "regions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_members" ADD CONSTRAINT "pod_members_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_members" ADD CONSTRAINT "pod_members_pod_id_fkey" FOREIGN KEY ("pod_id") REFERENCES "public"."pods"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_members" ADD CONSTRAINT "pod_members_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_skills" ADD CONSTRAINT "job_skills_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_skills" ADD CONSTRAINT "job_skills_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_skills" ADD CONSTRAINT "job_skills_skill_id_fkey" FOREIGN KEY ("skill_id") REFERENCES "public"."skills"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_requirements" ADD CONSTRAINT "job_requirements_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_requirements" ADD CONSTRAINT "job_requirements_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_rates" ADD CONSTRAINT "job_rates_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_rates" ADD CONSTRAINT "job_rates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_assignments" ADD CONSTRAINT "job_assignments_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_assignments" ADD CONSTRAINT "job_assignments_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_assignments" ADD CONSTRAINT "job_assignments_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_screening_questions" ADD CONSTRAINT "job_screening_questions_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_screening_questions" ADD CONSTRAINT "job_screening_questions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_documents" ADD CONSTRAINT "candidate_documents_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_documents" ADD CONSTRAINT "candidate_documents_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_documents" ADD CONSTRAINT "candidate_documents_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_profiles" ADD CONSTRAINT "candidate_profiles_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_profiles" ADD CONSTRAINT "candidate_profiles_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_profiles" ADD CONSTRAINT "candidate_profiles_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_preferences" ADD CONSTRAINT "candidate_preferences_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_preferences" ADD CONSTRAINT "candidate_preferences_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_preferences" ADD CONSTRAINT "candidate_preferences_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_availability" ADD CONSTRAINT "candidate_availability_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_availability" ADD CONSTRAINT "candidate_availability_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_availability" ADD CONSTRAINT "candidate_availability_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_rates" ADD CONSTRAINT "submission_rates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_rates" ADD CONSTRAINT "submission_rates_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_screening_answers" ADD CONSTRAINT "submission_screening_answers_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_screening_answers" ADD CONSTRAINT "submission_screening_answers_question_id_fkey" FOREIGN KEY ("question_id") REFERENCES "public"."job_screening_questions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_screening_answers" ADD CONSTRAINT "submission_screening_answers_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_notes" ADD CONSTRAINT "submission_notes_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_notes" ADD CONSTRAINT "submission_notes_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_notes" ADD CONSTRAINT "submission_notes_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "marketing_templates" ADD CONSTRAINT "marketing_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "marketing_templates" ADD CONSTRAINT "marketing_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "hotlist_consultants" ADD CONSTRAINT "hotlist_consultants_added_by_fkey" FOREIGN KEY ("added_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "hotlist_consultants" ADD CONSTRAINT "hotlist_consultants_consultant_id_fkey" FOREIGN KEY ("consultant_id") REFERENCES "public"."bench_consultants"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "events" ADD CONSTRAINT "events_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "events" ADD CONSTRAINT "events_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "event_subscriptions" ADD CONSTRAINT "event_subscriptions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "event_subscriptions" ADD CONSTRAINT "event_subscriptions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "skill_aliases" ADD CONSTRAINT "skill_aliases_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "skill_aliases" ADD CONSTRAINT "skill_aliases_skill_id_fkey" FOREIGN KEY ("skill_id") REFERENCES "public"."skills"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_status_history" ADD CONSTRAINT "submission_status_history_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_status_history" ADD CONSTRAINT "submission_status_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_status_history" ADD CONSTRAINT "submission_status_history_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_feedback" ADD CONSTRAINT "interview_feedback_interview_id_fkey" FOREIGN KEY ("interview_id") REFERENCES "public"."interviews"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_feedback" ADD CONSTRAINT "interview_feedback_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_feedback" ADD CONSTRAINT "interview_feedback_submitted_by_fkey" FOREIGN KEY ("submitted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_reminders" ADD CONSTRAINT "interview_reminders_interview_id_fkey" FOREIGN KEY ("interview_id") REFERENCES "public"."interviews"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_reminders" ADD CONSTRAINT "interview_reminders_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offer_terms" ADD CONSTRAINT "offer_terms_offer_id_fkey" FOREIGN KEY ("offer_id") REFERENCES "public"."offers"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offer_terms" ADD CONSTRAINT "offer_terms_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_timesheets" ADD CONSTRAINT "placement_timesheets_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_timesheets" ADD CONSTRAINT "placement_timesheets_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_timesheets" ADD CONSTRAINT "placement_timesheets_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "consultant_visa_details" ADD CONSTRAINT "consultant_visa_details_consultant_id_fkey" FOREIGN KEY ("consultant_id") REFERENCES "public"."bench_consultants"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "consultant_work_authorization" ADD CONSTRAINT "consultant_work_authorization_consultant_id_fkey" FOREIGN KEY ("consultant_id") REFERENCES "public"."bench_consultants"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "consultant_work_authorization" ADD CONSTRAINT "consultant_work_authorization_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "consultant_availability" ADD CONSTRAINT "consultant_availability_consultant_id_fkey" FOREIGN KEY ("consultant_id") REFERENCES "public"."bench_consultants"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "consultant_rates" ADD CONSTRAINT "consultant_rates_consultant_id_fkey" FOREIGN KEY ("consultant_id") REFERENCES "public"."bench_consultants"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "consultant_rates" ADD CONSTRAINT "consultant_rates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "marketing_profiles" ADD CONSTRAINT "marketing_profiles_consultant_id_fkey" FOREIGN KEY ("consultant_id") REFERENCES "public"."bench_consultants"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "marketing_profiles" ADD CONSTRAINT "marketing_profiles_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "marketing_formats" ADD CONSTRAINT "marketing_formats_profile_id_fkey" FOREIGN KEY ("profile_id") REFERENCES "public"."marketing_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "vendor_relationships" ADD CONSTRAINT "vendor_relationships_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "vendor_blacklist" ADD CONSTRAINT "vendor_blacklist_blacklisted_by_fkey" FOREIGN KEY ("blacklisted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_team" ADD CONSTRAINT "company_team_assigned_by_fkey" FOREIGN KEY ("assigned_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_team" ADD CONSTRAINT "company_team_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_team" ADD CONSTRAINT "company_team_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_team" ADD CONSTRAINT "company_team_removed_by_fkey" FOREIGN KEY ("removed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_team" ADD CONSTRAINT "company_team_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_contacts" ADD CONSTRAINT "company_contacts_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_contacts" ADD CONSTRAINT "company_contacts_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_contacts" ADD CONSTRAINT "company_contacts_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_contacts" ADD CONSTRAINT "company_contacts_vendor_company_id_fkey" FOREIGN KEY ("vendor_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_relationships" ADD CONSTRAINT "company_relationships_company_a_id_fkey" FOREIGN KEY ("company_a_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_relationships" ADD CONSTRAINT "company_relationships_company_b_id_fkey" FOREIGN KEY ("company_b_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_relationships" ADD CONSTRAINT "company_relationships_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_relationships" ADD CONSTRAINT "company_relationships_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "immigration_attorneys" ADD CONSTRAINT "immigration_attorneys_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "immigration_documents" ADD CONSTRAINT "immigration_documents_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "immigration_alerts" ADD CONSTRAINT "immigration_alerts_acknowledged_by_fkey" FOREIGN KEY ("acknowledged_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "immigration_alerts" ADD CONSTRAINT "immigration_alerts_consultant_id_fkey" FOREIGN KEY ("consultant_id") REFERENCES "public"."bench_consultants"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_addresses" ADD CONSTRAINT "company_addresses_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_addresses" ADD CONSTRAINT "company_addresses_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_notes" ADD CONSTRAINT "company_notes_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_notes" ADD CONSTRAINT "company_notes_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_notes" ADD CONSTRAINT "company_notes_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_order_submissions" ADD CONSTRAINT "job_order_submissions_consultant_id_fkey" FOREIGN KEY ("consultant_id") REFERENCES "public"."bench_consultants"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_order_submissions" ADD CONSTRAINT "job_order_submissions_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_order_submissions" ADD CONSTRAINT "job_order_submissions_order_id_fkey" FOREIGN KEY ("order_id") REFERENCES "public"."external_job_orders"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_preferences" ADD CONSTRAINT "company_preferences_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_preferences" ADD CONSTRAINT "company_preferences_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_preferences" ADD CONSTRAINT "company_preferences_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_tags" ADD CONSTRAINT "company_tags_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_tags" ADD CONSTRAINT "company_tags_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_tags" ADD CONSTRAINT "company_tags_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "benefit_plan_options" ADD CONSTRAINT "benefit_plan_options_plan_id_fkey" FOREIGN KEY ("plan_id") REFERENCES "public"."benefit_plans"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integrations" ADD CONSTRAINT "integrations_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integrations" ADD CONSTRAINT "integrations_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_health_logs" ADD CONSTRAINT "integration_health_logs_checked_by_fkey" FOREIGN KEY ("checked_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_health_logs" ADD CONSTRAINT "integration_health_logs_integration_id_fkey" FOREIGN KEY ("integration_id") REFERENCES "public"."integrations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_health_logs" ADD CONSTRAINT "integration_health_logs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_orders" ADD CONSTRAINT "external_job_orders_vendor_company_id_fkey" FOREIGN KEY ("vendor_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_orders" ADD CONSTRAINT "job_orders_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_orders" ADD CONSTRAINT "job_orders_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deal_stages_history" ADD CONSTRAINT "deal_stages_history_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deal_stages_history" ADD CONSTRAINT "deal_stages_history_deal_id_fkey" FOREIGN KEY ("deal_id") REFERENCES "public"."deals"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deal_stakeholders" ADD CONSTRAINT "deal_stakeholders_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deal_stakeholders" ADD CONSTRAINT "deal_stakeholders_deal_id_fkey" FOREIGN KEY ("deal_id") REFERENCES "public"."deals"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_scores" ADD CONSTRAINT "lead_scores_lead_id_fkey" FOREIGN KEY ("lead_id") REFERENCES "public"."leads"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_qualification" ADD CONSTRAINT "lead_qualification_lead_id_fkey" FOREIGN KEY ("lead_id") REFERENCES "public"."leads"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_qualification" ADD CONSTRAINT "lead_qualification_qualified_by_fkey" FOREIGN KEY ("qualified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_work_history" ADD CONSTRAINT "candidate_work_history_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_work_history" ADD CONSTRAINT "candidate_work_history_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_work_history" ADD CONSTRAINT "candidate_work_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_touchpoints" ADD CONSTRAINT "lead_touchpoints_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "lead_touchpoints" ADD CONSTRAINT "lead_touchpoints_lead_id_fkey" FOREIGN KEY ("lead_id") REFERENCES "public"."leads"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deal_competitors" ADD CONSTRAINT "deal_competitors_deal_id_fkey" FOREIGN KEY ("deal_id") REFERENCES "public"."deals"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deal_products" ADD CONSTRAINT "deal_products_deal_id_fkey" FOREIGN KEY ("deal_id") REFERENCES "public"."deals"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employees" ADD CONSTRAINT "employees_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employees" ADD CONSTRAINT "employees_manager_id_fkey" FOREIGN KEY ("manager_id") REFERENCES "public"."employees"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employees" ADD CONSTRAINT "employees_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employees" ADD CONSTRAINT "employees_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employees" ADD CONSTRAINT "employees_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_profiles" ADD CONSTRAINT "employee_profiles_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."employees"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_documents" ADD CONSTRAINT "employee_documents_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_documents" ADD CONSTRAINT "employee_documents_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."employees"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_documents" ADD CONSTRAINT "employee_documents_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_time_off" ADD CONSTRAINT "employee_time_off_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_time_off" ADD CONSTRAINT "employee_time_off_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_time_off" ADD CONSTRAINT "employee_time_off_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."employees"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "benefit_plans" ADD CONSTRAINT "benefit_plans_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "benefit_plans" ADD CONSTRAINT "benefit_plans_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_benefits" ADD CONSTRAINT "employee_benefits_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_benefits" ADD CONSTRAINT "employee_benefits_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."employees"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_benefits" ADD CONSTRAINT "employee_benefits_plan_option_id_fkey" FOREIGN KEY ("plan_option_id") REFERENCES "public"."benefit_plan_options"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "benefit_dependents" ADD CONSTRAINT "benefit_dependents_employee_benefit_id_fkey" FOREIGN KEY ("employee_benefit_id") REFERENCES "public"."employee_benefits"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "raci_change_log" ADD CONSTRAINT "raci_change_log_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "raci_change_log" ADD CONSTRAINT "raci_change_log_object_owner_id_fkey" FOREIGN KEY ("object_owner_id") REFERENCES "public"."object_owners"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "raci_change_log" ADD CONSTRAINT "raci_change_log_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_compliance" ADD CONSTRAINT "employee_compliance_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."employees"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_compliance" ADD CONSTRAINT "employee_compliance_requirement_id_fkey" FOREIGN KEY ("requirement_id") REFERENCES "public"."legacy_compliance_requirements"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "i9_records" ADD CONSTRAINT "i9_records_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "i9_records" ADD CONSTRAINT "i9_records_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."employees"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "legacy_compliance_requirements" ADD CONSTRAINT "compliance_requirements_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "legacy_compliance_requirements" ADD CONSTRAINT "compliance_requirements_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "performance_goals" ADD CONSTRAINT "performance_goals_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "performance_goals" ADD CONSTRAINT "performance_goals_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."employees"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "performance_feedback" ADD CONSTRAINT "performance_feedback_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pattern_checklist_items" ADD CONSTRAINT "pattern_checklist_items_pattern_id_fkey" FOREIGN KEY ("pattern_id") REFERENCES "public"."activity_patterns"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_pattern_successors" ADD CONSTRAINT "activity_pattern_successors_pattern_id_fkey" FOREIGN KEY ("pattern_id") REFERENCES "public"."activity_patterns"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_pattern_successors" ADD CONSTRAINT "activity_pattern_successors_successor_pattern_id_fkey" FOREIGN KEY ("successor_pattern_id") REFERENCES "public"."activity_patterns"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workplan_templates" ADD CONSTRAINT "workplan_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workplan_phases" ADD CONSTRAINT "workplan_phases_template_id_fkey" FOREIGN KEY ("template_id") REFERENCES "public"."workplan_templates"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workplan_instances" ADD CONSTRAINT "workplan_instances_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workplan_instances" ADD CONSTRAINT "workplan_instances_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workplan_instances" ADD CONSTRAINT "workplan_instances_template_id_fkey" FOREIGN KEY ("template_id") REFERENCES "public"."workplan_templates"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workplan_template_activities" ADD CONSTRAINT "workplan_template_activities_pattern_id_fkey" FOREIGN KEY ("pattern_id") REFERENCES "public"."activity_patterns"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workplan_template_activities" ADD CONSTRAINT "workplan_template_activities_template_id_fkey" FOREIGN KEY ("template_id") REFERENCES "public"."workplan_templates"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_participants" ADD CONSTRAINT "activity_participants_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_participants" ADD CONSTRAINT "activity_participants_added_by_fkey" FOREIGN KEY ("added_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_participants" ADD CONSTRAINT "activity_participants_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_field_values" ADD CONSTRAINT "activity_field_values_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_field_values" ADD CONSTRAINT "activity_field_values_field_id_fkey" FOREIGN KEY ("field_id") REFERENCES "public"."pattern_fields"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_checklist_items" ADD CONSTRAINT "activity_checklist_items_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_checklist_items" ADD CONSTRAINT "activity_checklist_items_completed_by_fkey" FOREIGN KEY ("completed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_checklist_items" ADD CONSTRAINT "activity_checklist_items_pattern_checklist_item_id_fkey" FOREIGN KEY ("pattern_checklist_item_id") REFERENCES "public"."pattern_checklist_items"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_comments" ADD CONSTRAINT "activity_comments_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_comments" ADD CONSTRAINT "activity_comments_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_comments" ADD CONSTRAINT "activity_comments_parent_comment_id_fkey" FOREIGN KEY ("parent_comment_id") REFERENCES "public"."activity_comments"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_comments" ADD CONSTRAINT "activity_comments_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_attachments" ADD CONSTRAINT "activity_attachments_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_attachments" ADD CONSTRAINT "activity_attachments_uploaded_by_fkey" FOREIGN KEY ("uploaded_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_reminders" ADD CONSTRAINT "activity_reminders_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_reminders" ADD CONSTRAINT "activity_reminders_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_sprint_metrics" ADD CONSTRAINT "pod_sprint_metrics_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pod_sprint_metrics" ADD CONSTRAINT "pod_sprint_metrics_pod_id_fkey" FOREIGN KEY ("pod_id") REFERENCES "public"."pods"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_time_entries" ADD CONSTRAINT "activity_time_entries_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_time_entries" ADD CONSTRAINT "activity_time_entries_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_dependencies" ADD CONSTRAINT "activity_dependencies_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_dependencies" ADD CONSTRAINT "activity_dependencies_depends_on_activity_id_fkey" FOREIGN KEY ("depends_on_activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_auto_rules" ADD CONSTRAINT "activity_auto_rules_activity_pattern_id_fkey" FOREIGN KEY ("activity_pattern_id") REFERENCES "public"."activity_patterns"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_auto_rules" ADD CONSTRAINT "activity_auto_rules_assign_to_group_id_fkey" FOREIGN KEY ("assign_to_group_id") REFERENCES "public"."pods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_auto_rules" ADD CONSTRAINT "activity_auto_rules_assign_to_user_id_fkey" FOREIGN KEY ("assign_to_user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_auto_rules" ADD CONSTRAINT "activity_auto_rules_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_history" ADD CONSTRAINT "activity_history_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_history" ADD CONSTRAINT "activity_history_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "work_queues" ADD CONSTRAINT "work_queues_assigned_to_group_id_fkey" FOREIGN KEY ("assigned_to_group_id") REFERENCES "public"."pods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "work_queues" ADD CONSTRAINT "work_queues_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "addresses" ADD CONSTRAINT "addresses_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "queue_items" ADD CONSTRAINT "queue_items_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "queue_items" ADD CONSTRAINT "queue_items_queue_id_fkey" FOREIGN KEY ("queue_id") REFERENCES "public"."work_queues"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_instances" ADD CONSTRAINT "sla_instances_activity_id_fkey" FOREIGN KEY ("activity_id") REFERENCES "public"."activities"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_instances" ADD CONSTRAINT "sla_instances_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_instances" ADD CONSTRAINT "sla_instances_sla_definition_id_fkey" FOREIGN KEY ("sla_definition_id") REFERENCES "public"."sla_definitions"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bulk_activity_jobs" ADD CONSTRAINT "bulk_activity_jobs_activity_pattern_id_fkey" FOREIGN KEY ("activity_pattern_id") REFERENCES "public"."activity_patterns"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bulk_activity_jobs" ADD CONSTRAINT "bulk_activity_jobs_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bulk_activity_jobs" ADD CONSTRAINT "bulk_activity_jobs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_metrics" ADD CONSTRAINT "activity_metrics_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_metrics" ADD CONSTRAINT "activity_metrics_pod_id_fkey" FOREIGN KEY ("pod_id") REFERENCES "public"."pods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_metrics" ADD CONSTRAINT "activity_metrics_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "team_metrics" ADD CONSTRAINT "team_metrics_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "team_metrics" ADD CONSTRAINT "team_metrics_pod_id_fkey" FOREIGN KEY ("pod_id") REFERENCES "public"."pods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "learning_paths" ADD CONSTRAINT "learning_paths_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "learning_path_courses" ADD CONSTRAINT "learning_path_courses_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "learning_path_courses" ADD CONSTRAINT "learning_path_courses_path_id_fkey" FOREIGN KEY ("path_id") REFERENCES "public"."learning_paths"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "path_enrollments" ADD CONSTRAINT "path_enrollments_path_id_fkey" FOREIGN KEY ("path_id") REFERENCES "public"."learning_paths"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "path_enrollments" ADD CONSTRAINT "path_enrollments_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "certificates" ADD CONSTRAINT "certificates_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "certificates" ADD CONSTRAINT "certificates_template_id_fkey" FOREIGN KEY ("template_id") REFERENCES "public"."certificate_templates"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_levels" ADD CONSTRAINT "user_levels_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_achievements" ADD CONSTRAINT "user_achievements_achievement_id_fkey" FOREIGN KEY ("achievement_id") REFERENCES "public"."achievements"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_achievements" ADD CONSTRAINT "user_achievements_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "learning_streaks" ADD CONSTRAINT "learning_streaks_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leaderboard_entries" ADD CONSTRAINT "leaderboard_entries_leaderboard_id_fkey" FOREIGN KEY ("leaderboard_id") REFERENCES "public"."leaderboards"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "leaderboard_entries" ADD CONSTRAINT "leaderboard_entries_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "login_history" ADD CONSTRAINT "login_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "login_history" ADD CONSTRAINT "login_history_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_invitations" ADD CONSTRAINT "user_invitations_invited_by_fkey" FOREIGN KEY ("invited_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_invitations" ADD CONSTRAINT "user_invitations_manager_id_fkey" FOREIGN KEY ("manager_id") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_invitations" ADD CONSTRAINT "user_invitations_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_invitations" ADD CONSTRAINT "user_invitations_pod_id_fkey" FOREIGN KEY ("pod_id") REFERENCES "public"."pods"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_invitations" ADD CONSTRAINT "user_invitations_role_id_fkey" FOREIGN KEY ("role_id") REFERENCES "public"."system_roles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "webhooks" ADD CONSTRAINT "webhooks_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "webhooks" ADD CONSTRAINT "webhooks_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "webhook_deliveries" ADD CONSTRAINT "webhook_deliveries_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "webhook_deliveries" ADD CONSTRAINT "webhook_deliveries_webhook_id_fkey" FOREIGN KEY ("webhook_id") REFERENCES "public"."webhooks"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_retry_config" ADD CONSTRAINT "integration_retry_config_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_oauth_tokens" ADD CONSTRAINT "integration_oauth_tokens_integration_id_fkey" FOREIGN KEY ("integration_id") REFERENCES "public"."integrations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_oauth_tokens" ADD CONSTRAINT "integration_oauth_tokens_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_oauth_tokens" ADD CONSTRAINT "integration_oauth_tokens_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_failover_config" ADD CONSTRAINT "integration_failover_config_backup_integration_id_fkey" FOREIGN KEY ("backup_integration_id") REFERENCES "public"."integrations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_failover_config" ADD CONSTRAINT "integration_failover_config_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "integration_failover_config" ADD CONSTRAINT "integration_failover_config_primary_integration_id_fkey" FOREIGN KEY ("primary_integration_id") REFERENCES "public"."integrations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_assigned_group_fkey" FOREIGN KEY ("assigned_group") REFERENCES "public"."pods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_follow_up_activity_id_fkey" FOREIGN KEY ("follow_up_activity_id") REFERENCES "public"."activities"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_parent_activity_id_fkey" FOREIGN KEY ("parent_activity_id") REFERENCES "public"."activities"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_pattern_id_fkey" FOREIGN KEY ("pattern_id") REFERENCES "public"."activity_patterns"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_performed_by_fkey" FOREIGN KEY ("performed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_predecessor_activity_id_fkey" FOREIGN KEY ("predecessor_activity_id") REFERENCES "public"."activities"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_related_campaign_id_fkey" FOREIGN KEY ("related_campaign_id") REFERENCES "public"."campaigns"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_related_contact_id_fkey" FOREIGN KEY ("related_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_related_deal_id_fkey" FOREIGN KEY ("related_deal_id") REFERENCES "public"."deals"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activities" ADD CONSTRAINT "activities_workplan_instance_id_fkey" FOREIGN KEY ("workplan_instance_id") REFERENCES "public"."workplan_instances"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_order_requirements" ADD CONSTRAINT "job_order_requirements_order_id_fkey" FOREIGN KEY ("order_id") REFERENCES "public"."external_job_orders"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_order_skills" ADD CONSTRAINT "job_order_skills_order_id_fkey" FOREIGN KEY ("order_id") REFERENCES "public"."external_job_orders"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_order_notes" ADD CONSTRAINT "job_order_notes_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "external_job_order_notes" ADD CONSTRAINT "job_order_notes_order_id_fkey" FOREIGN KEY ("order_id") REFERENCES "public"."external_job_orders"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "skills" ADD CONSTRAINT "skills_deprecated_successor_id_fkey" FOREIGN KEY ("deprecated_successor_id") REFERENCES "public"."skills"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "skills" ADD CONSTRAINT "skills_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "skills" ADD CONSTRAINT "skills_parent_skill_id_fkey" FOREIGN KEY ("parent_skill_id") REFERENCES "public"."skills"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bench_consultants" ADD CONSTRAINT "bench_consultants_bench_sales_rep_id_fkey" FOREIGN KEY ("bench_sales_rep_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bench_consultants" ADD CONSTRAINT "bench_consultants_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bench_consultants" ADD CONSTRAINT "bench_consultants_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bench_consultants" ADD CONSTRAINT "bench_consultants_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "bench_consultants" ADD CONSTRAINT "bench_consultants_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_workflows" ADD CONSTRAINT "approval_workflows_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_workflows" ADD CONSTRAINT "approval_workflows_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_steps" ADD CONSTRAINT "approval_steps_approver_id_fkey" FOREIGN KEY ("approver_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_steps" ADD CONSTRAINT "approval_steps_decided_by_fkey" FOREIGN KEY ("decided_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_steps" ADD CONSTRAINT "approval_steps_instance_id_fkey" FOREIGN KEY ("instance_id") REFERENCES "public"."approval_instances"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_instances" ADD CONSTRAINT "approval_instances_escalated_to_fkey" FOREIGN KEY ("escalated_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_instances" ADD CONSTRAINT "approval_instances_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_instances" ADD CONSTRAINT "approval_instances_requested_by_fkey" FOREIGN KEY ("requested_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_instances" ADD CONSTRAINT "approval_instances_resolved_by_fkey" FOREIGN KEY ("resolved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "approval_instances" ADD CONSTRAINT "approval_instances_workflow_id_fkey" FOREIGN KEY ("workflow_id") REFERENCES "public"."approval_workflows"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_credits" ADD CONSTRAINT "placement_credits_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_credits" ADD CONSTRAINT "placement_credits_junior_rec_id_fkey" FOREIGN KEY ("junior_rec_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_credits" ADD CONSTRAINT "placement_credits_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_credits" ADD CONSTRAINT "placement_credits_original_graduate_id_fkey" FOREIGN KEY ("original_graduate_id") REFERENCES "public"."graduate_candidates"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_credits" ADD CONSTRAINT "placement_credits_pod_id_fkey" FOREIGN KEY ("pod_id") REFERENCES "public"."pods"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_credits" ADD CONSTRAINT "placement_credits_senior_rec_id_fkey" FOREIGN KEY ("senior_rec_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_credits" ADD CONSTRAINT "placement_credits_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "graduate_candidates" ADD CONSTRAINT "graduate_candidates_assigned_recruiter_id_fkey" FOREIGN KEY ("assigned_recruiter_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "graduate_candidates" ADD CONSTRAINT "graduate_candidates_course_id_fkey" FOREIGN KEY ("course_id") REFERENCES "public"."courses"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "graduate_candidates" ADD CONSTRAINT "graduate_candidates_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "graduate_candidates" ADD CONSTRAINT "graduate_candidates_status_changed_by_fkey" FOREIGN KEY ("status_changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "graduate_candidates" ADD CONSTRAINT "graduate_candidates_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "quiz_attempts" ADD CONSTRAINT "quiz_attempts_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."student_enrollments"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "quiz_attempts" ADD CONSTRAINT "quiz_attempts_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "quiz_attempts" ADD CONSTRAINT "quiz_attempts_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_escalations" ADD CONSTRAINT "ai_mentor_escalations_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_escalations" ADD CONSTRAINT "ai_mentor_escalations_chat_id_fkey" FOREIGN KEY ("chat_id") REFERENCES "public"."ai_mentor_chats"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_escalations" ADD CONSTRAINT "ai_mentor_escalations_resolved_by_fkey" FOREIGN KEY ("resolved_by") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_escalations" ADD CONSTRAINT "ai_mentor_escalations_topic_id_fkey" FOREIGN KEY ("topic_id") REFERENCES "public"."module_topics"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "ai_mentor_escalations" ADD CONSTRAINT "ai_mentor_escalations_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "trainer_responses" ADD CONSTRAINT "trainer_responses_escalation_id_fkey" FOREIGN KEY ("escalation_id") REFERENCES "public"."ai_mentor_escalations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "trainer_responses" ADD CONSTRAINT "trainer_responses_trainer_id_fkey" FOREIGN KEY ("trainer_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalation_notifications" ADD CONSTRAINT "escalation_notifications_escalation_id_fkey" FOREIGN KEY ("escalation_id") REFERENCES "public"."ai_mentor_escalations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalation_notifications" ADD CONSTRAINT "escalation_notifications_recipient_id_fkey" FOREIGN KEY ("recipient_id") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_skills" ADD CONSTRAINT "entity_skills_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_skills" ADD CONSTRAINT "entity_skills_skill_id_fkey" FOREIGN KEY ("skill_id") REFERENCES "public"."skills"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_skills" ADD CONSTRAINT "entity_skills_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "certifications" ADD CONSTRAINT "certifications_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "certifications" ADD CONSTRAINT "certifications_skill_id_fkey" FOREIGN KEY ("skill_id") REFERENCES "public"."skills"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "certifications" ADD CONSTRAINT "certifications_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_bench_data" ADD CONSTRAINT "contact_bench_data_bench_sales_rep_id_fkey" FOREIGN KEY ("bench_sales_rep_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_bench_data" ADD CONSTRAINT "contact_bench_data_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_bench_data" ADD CONSTRAINT "contact_bench_data_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_bench_data" ADD CONSTRAINT "contact_bench_data_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_bench_data" ADD CONSTRAINT "contact_bench_data_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_bench_data" ADD CONSTRAINT "contact_bench_data_vendor_contact_id_fkey" FOREIGN KEY ("vendor_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_bench_data" ADD CONSTRAINT "contact_bench_data_vendor_id_fkey" FOREIGN KEY ("vendor_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_feedback" ADD CONSTRAINT "submission_feedback_interview_id_fkey" FOREIGN KEY ("interview_id") REFERENCES "public"."interviews"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_feedback" ADD CONSTRAINT "submission_feedback_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_feedback" ADD CONSTRAINT "submission_feedback_provided_by_contact_id_fkey" FOREIGN KEY ("provided_by_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_feedback" ADD CONSTRAINT "submission_feedback_provided_by_user_id_fkey" FOREIGN KEY ("provided_by_user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_feedback" ADD CONSTRAINT "submission_feedback_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_rtr" ADD CONSTRAINT "submission_rtr_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_rtr" ADD CONSTRAINT "submission_rtr_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_rtr" ADD CONSTRAINT "submission_rtr_document_id_fkey" FOREIGN KEY ("document_id") REFERENCES "public"."documents"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_rtr" ADD CONSTRAINT "submission_rtr_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submission_rtr" ADD CONSTRAINT "submission_rtr_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "skill_endorsements" ADD CONSTRAINT "skill_endorsements_endorser_id_fkey" FOREIGN KEY ("endorser_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "skill_endorsements" ADD CONSTRAINT "skill_endorsements_entity_skill_id_fkey" FOREIGN KEY ("entity_skill_id") REFERENCES "public"."entity_skills"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "skill_endorsements" ADD CONSTRAINT "skill_endorsements_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_logs_2025_11" ADD CONSTRAINT "audit_logs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_logs_2025_11" ADD CONSTRAINT "audit_logs_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_logs_2025_12" ADD CONSTRAINT "audit_logs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_logs_2025_12" ADD CONSTRAINT "audit_logs_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_logs_2026_01" ADD CONSTRAINT "audit_logs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_logs_2026_01" ADD CONSTRAINT "audit_logs_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_logs_2026_02" ADD CONSTRAINT "audit_logs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_logs_2026_02" ADD CONSTRAINT "audit_logs_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "security_alerts" ADD CONSTRAINT "security_alerts_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "security_alerts" ADD CONSTRAINT "security_alerts_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "security_alerts" ADD CONSTRAINT "security_alerts_related_user_id_fkey" FOREIGN KEY ("related_user_id") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "alert_rules" ADD CONSTRAINT "alert_rules_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "alert_rules" ADD CONSTRAINT "alert_rules_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_templates" ADD CONSTRAINT "email_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_templates" ADD CONSTRAINT "email_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_templates" ADD CONSTRAINT "email_templates_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_sends" ADD CONSTRAINT "email_sends_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_sends" ADD CONSTRAINT "email_sends_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_sends" ADD CONSTRAINT "email_sends_template_id_fkey" FOREIGN KEY ("template_id") REFERENCES "public"."email_templates"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_senders" ADD CONSTRAINT "email_senders_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "email_senders" ADD CONSTRAINT "email_senders_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incidents" ADD CONSTRAINT "incidents_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incidents" ADD CONSTRAINT "incidents_incident_commander_fkey" FOREIGN KEY ("incident_commander") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incidents" ADD CONSTRAINT "incidents_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incidents" ADD CONSTRAINT "incidents_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incident_timeline" ADD CONSTRAINT "incident_timeline_incident_id_fkey" FOREIGN KEY ("incident_id") REFERENCES "public"."incidents"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incident_timeline" ADD CONSTRAINT "incident_timeline_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incident_timeline" ADD CONSTRAINT "incident_timeline_performed_by_fkey" FOREIGN KEY ("performed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incident_notifications" ADD CONSTRAINT "incident_notifications_incident_id_fkey" FOREIGN KEY ("incident_id") REFERENCES "public"."incidents"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incident_notifications" ADD CONSTRAINT "incident_notifications_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "incident_notifications" ADD CONSTRAINT "incident_notifications_sent_by_fkey" FOREIGN KEY ("sent_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "break_glass_access" ADD CONSTRAINT "break_glass_access_incident_id_fkey" FOREIGN KEY ("incident_id") REFERENCES "public"."incidents"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "break_glass_access" ADD CONSTRAINT "break_glass_access_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "break_glass_access" ADD CONSTRAINT "break_glass_access_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "emergency_drills" ADD CONSTRAINT "emergency_drills_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "emergency_drills" ADD CONSTRAINT "emergency_drills_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "emergency_drills" ADD CONSTRAINT "emergency_drills_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_definitions" ADD CONSTRAINT "sla_definitions_escalate_to_group_id_fkey" FOREIGN KEY ("escalate_to_group_id") REFERENCES "public"."pods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_definitions" ADD CONSTRAINT "sla_definitions_escalate_to_user_id_fkey" FOREIGN KEY ("escalate_to_user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_definitions" ADD CONSTRAINT "sla_definitions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_escalation_levels" ADD CONSTRAINT "sla_escalation_levels_sla_definition_id_fkey" FOREIGN KEY ("sla_definition_id") REFERENCES "public"."sla_definitions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_events" ADD CONSTRAINT "sla_events_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_events" ADD CONSTRAINT "sla_events_resolved_by_fkey" FOREIGN KEY ("resolved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_events" ADD CONSTRAINT "sla_events_sla_definition_id_fkey" FOREIGN KEY ("sla_definition_id") REFERENCES "public"."sla_definitions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "sla_notifications" ADD CONSTRAINT "sla_notifications_sla_event_id_fkey" FOREIGN KEY ("sla_event_id") REFERENCES "public"."sla_events"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_alumni_former_employee_id_fkey" FOREIGN KEY ("alumni_former_employee_id") REFERENCES "public"."employees"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_bench_vendor_contact_id_fkey" FOREIGN KEY ("bench_vendor_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_candidate_hotlist_added_by_fkey" FOREIGN KEY ("candidate_hotlist_added_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_client_contact_relationship_owner_id_fkey" FOREIGN KEY ("client_contact_relationship_owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_client_msp_id_fkey" FOREIGN KEY ("client_msp_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_client_team_lead_id_fkey" FOREIGN KEY ("client_team_lead_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_current_company_id_fkey" FOREIGN KEY ("current_company_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."employees"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_employer_company_id_fkey" FOREIGN KEY ("employer_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_lead_converted_to_deal_id_fkey" FOREIGN KEY ("lead_converted_to_deal_id") REFERENCES "public"."deals"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_linked_company_id_fkey" FOREIGN KEY ("linked_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_owner_id_fkey" FOREIGN KEY ("owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_parent_company_id_fkey" FOREIGN KEY ("parent_company_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_primary_address_id_fkey" FOREIGN KEY ("primary_address_id") REFERENCES "public"."addresses"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_prospect_primary_campaign_id_fkey" FOREIGN KEY ("prospect_primary_campaign_id") REFERENCES "public"."campaigns"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_source_company_id_fkey" FOREIGN KEY ("source_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_ultimate_parent_id_fkey" FOREIGN KEY ("ultimate_parent_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_user_profile_id_fkey" FOREIGN KEY ("user_profile_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_vendor_approved_by_fkey" FOREIGN KEY ("vendor_approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contacts" ADD CONSTRAINT "contacts_vendor_company_id_fkey" FOREIGN KEY ("vendor_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_stats_daily" ADD CONSTRAINT "activity_stats_daily_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_stats_daily" ADD CONSTRAINT "activity_stats_daily_pattern_id_fkey" FOREIGN KEY ("pattern_id") REFERENCES "public"."activity_patterns"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_stats_daily" ADD CONSTRAINT "activity_stats_daily_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notes" ADD CONSTRAINT "notes_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notes" ADD CONSTRAINT "notes_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notes" ADD CONSTRAINT "notes_parent_note_id_fkey" FOREIGN KEY ("parent_note_id") REFERENCES "public"."notes"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notes" ADD CONSTRAINT "notes_thread_root_id_fkey" FOREIGN KEY ("thread_root_id") REFERENCES "public"."notes"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notes" ADD CONSTRAINT "notes_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_patterns" ADD CONSTRAINT "activity_patterns_assignee_group_id_fkey" FOREIGN KEY ("assignee_group_id") REFERENCES "public"."pods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_patterns" ADD CONSTRAINT "activity_patterns_assignee_user_id_fkey" FOREIGN KEY ("assignee_user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_patterns" ADD CONSTRAINT "activity_patterns_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "activity_patterns" ADD CONSTRAINT "activity_patterns_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pattern_fields" ADD CONSTRAINT "pattern_fields_pattern_id_fkey" FOREIGN KEY ("pattern_id") REFERENCES "public"."activity_patterns"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flag_usage" ADD CONSTRAINT "feature_flag_usage_feature_flag_id_fkey" FOREIGN KEY ("feature_flag_id") REFERENCES "public"."feature_flags"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flag_usage" ADD CONSTRAINT "feature_flag_usage_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flag_usage" ADD CONSTRAINT "feature_flag_usage_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flag_feedback" ADD CONSTRAINT "feature_flag_feedback_feature_flag_id_fkey" FOREIGN KEY ("feature_flag_id") REFERENCES "public"."feature_flags"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flag_feedback" ADD CONSTRAINT "feature_flag_feedback_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flag_feedback" ADD CONSTRAINT "feature_flag_feedback_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flag_categories" ADD CONSTRAINT "feature_flag_categories_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flags" ADD CONSTRAINT "feature_flags_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flags" ADD CONSTRAINT "feature_flags_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "feature_flags" ADD CONSTRAINT "feature_flags_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_status_history" ADD CONSTRAINT "job_status_history_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_status_history" ADD CONSTRAINT "job_status_history_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_status_history" ADD CONSTRAINT "job_status_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "job_status_history" ADD CONSTRAINT "job_status_history_reopen_approved_by_fkey" FOREIGN KEY ("reopen_approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "saved_searches" ADD CONSTRAINT "saved_searches_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "saved_searches" ADD CONSTRAINT "saved_searches_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_prepared_profiles" ADD CONSTRAINT "candidate_prepared_profiles_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_prepared_profiles" ADD CONSTRAINT "candidate_prepared_profiles_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_prepared_profiles" ADD CONSTRAINT "candidate_prepared_profiles_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_prepared_profiles" ADD CONSTRAINT "candidate_prepared_profiles_finalized_by_fkey" FOREIGN KEY ("finalized_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_prepared_profiles" ADD CONSTRAINT "candidate_prepared_profiles_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_prepared_profiles" ADD CONSTRAINT "candidate_prepared_profiles_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_screenings" ADD CONSTRAINT "candidate_screenings_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_screenings" ADD CONSTRAINT "candidate_screenings_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_screenings" ADD CONSTRAINT "candidate_screenings_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_screenings" ADD CONSTRAINT "candidate_screenings_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_screenings" ADD CONSTRAINT "candidate_screenings_screener_id_fkey" FOREIGN KEY ("screener_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "candidate_screenings" ADD CONSTRAINT "candidate_screenings_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_relationships" ADD CONSTRAINT "contact_relationships_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_relationships" ADD CONSTRAINT "contact_relationships_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_relationships" ADD CONSTRAINT "contact_relationships_source_contact_id_fkey" FOREIGN KEY ("source_contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_relationships" ADD CONSTRAINT "contact_relationships_target_contact_id_fkey" FOREIGN KEY ("target_contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_relationships" ADD CONSTRAINT "contact_relationships_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_roles" ADD CONSTRAINT "contact_roles_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_roles" ADD CONSTRAINT "contact_roles_context_company_id_fkey" FOREIGN KEY ("context_company_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_roles" ADD CONSTRAINT "contact_roles_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_roles" ADD CONSTRAINT "contact_roles_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offers" ADD CONSTRAINT "offers_accepted_by_fkey" FOREIGN KEY ("accepted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offers" ADD CONSTRAINT "offers_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offers" ADD CONSTRAINT "offers_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offers" ADD CONSTRAINT "offers_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offers" ADD CONSTRAINT "offers_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offers" ADD CONSTRAINT "offers_sent_by_fkey" FOREIGN KEY ("sent_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offers" ADD CONSTRAINT "offers_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offer_negotiations" ADD CONSTRAINT "offer_negotiations_offer_id_fkey" FOREIGN KEY ("offer_id") REFERENCES "public"."offers"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offer_negotiations" ADD CONSTRAINT "offer_negotiations_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offer_approvals" ADD CONSTRAINT "offer_approvals_approver_id_fkey" FOREIGN KEY ("approver_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offer_approvals" ADD CONSTRAINT "offer_approvals_offer_id_fkey" FOREIGN KEY ("offer_id") REFERENCES "public"."offers"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offer_approvals" ADD CONSTRAINT "offer_approvals_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "offer_approvals" ADD CONSTRAINT "offer_approvals_requested_by_fkey" FOREIGN KEY ("requested_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_skills" ADD CONSTRAINT "contact_skills_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_skills" ADD CONSTRAINT "contact_skills_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_skills" ADD CONSTRAINT "contact_skills_skill_id_fkey" FOREIGN KEY ("skill_id") REFERENCES "public"."skills"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_skills" ADD CONSTRAINT "contact_skills_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_work_history" ADD CONSTRAINT "contact_work_history_company_contact_id_fkey" FOREIGN KEY ("company_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_work_history" ADD CONSTRAINT "contact_work_history_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_work_history" ADD CONSTRAINT "contact_work_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_work_history" ADD CONSTRAINT "contact_work_history_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_education" ADD CONSTRAINT "contact_education_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_education" ADD CONSTRAINT "contact_education_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_education" ADD CONSTRAINT "contact_education_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_certifications" ADD CONSTRAINT "contact_certifications_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_certifications" ADD CONSTRAINT "contact_certifications_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_milestones" ADD CONSTRAINT "placement_milestones_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_milestones" ADD CONSTRAINT "placement_milestones_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_rate_cards" ADD CONSTRAINT "contact_rate_cards_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_rate_cards" ADD CONSTRAINT "contact_rate_cards_client_id_fkey" FOREIGN KEY ("client_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_rate_cards" ADD CONSTRAINT "contact_rate_cards_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_rate_cards" ADD CONSTRAINT "contact_rate_cards_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_rate_cards" ADD CONSTRAINT "contact_rate_cards_skill_id_fkey" FOREIGN KEY ("skill_id") REFERENCES "public"."skills"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_extensions" ADD CONSTRAINT "placement_extensions_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_extensions" ADD CONSTRAINT "placement_extensions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_extensions" ADD CONSTRAINT "placement_extensions_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_rates" ADD CONSTRAINT "placement_rates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_rates" ADD CONSTRAINT "placement_rates_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_agreements" ADD CONSTRAINT "contact_agreements_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_agreements" ADD CONSTRAINT "contact_agreements_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_agreements" ADD CONSTRAINT "contact_agreements_our_signer_id_fkey" FOREIGN KEY ("our_signer_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_compliance" ADD CONSTRAINT "contact_compliance_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_compliance" ADD CONSTRAINT "contact_compliance_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_compliance" ADD CONSTRAINT "contact_compliance_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_communication_preferences" ADD CONSTRAINT "contact_communication_preferences_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_communication_preferences" ADD CONSTRAINT "contact_communication_preferences_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_merge_history" ADD CONSTRAINT "contact_merge_history_merged_by_fkey" FOREIGN KEY ("merged_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_merge_history" ADD CONSTRAINT "contact_merge_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contact_merge_history" ADD CONSTRAINT "contact_merge_history_survivor_contact_id_fkey" FOREIGN KEY ("survivor_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "note_reactions" ADD CONSTRAINT "note_reactions_note_id_fkey" FOREIGN KEY ("note_id") REFERENCES "public"."notes"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "note_reactions" ADD CONSTRAINT "note_reactions_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_account_manager_id_fkey" FOREIGN KEY ("account_manager_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_msp_provider_id_fkey" FOREIGN KEY ("msp_provider_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_onboarding_completed_by_fkey" FOREIGN KEY ("onboarding_completed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_owner_id_fkey" FOREIGN KEY ("owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_parent_company_id_fkey" FOREIGN KEY ("parent_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_pod_id_fkey" FOREIGN KEY ("pod_id") REFERENCES "public"."pods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_referring_company_id_fkey" FOREIGN KEY ("referring_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "companies" ADD CONSTRAINT "companies_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "documents" ADD CONSTRAINT "documents_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "documents" ADD CONSTRAINT "documents_previous_version_id_fkey" FOREIGN KEY ("previous_version_id") REFERENCES "public"."documents"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "documents" ADD CONSTRAINT "documents_uploaded_by_fkey" FOREIGN KEY ("uploaded_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "meeting_notes" ADD CONSTRAINT "meeting_notes_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "meeting_notes" ADD CONSTRAINT "meeting_notes_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "meeting_notes" ADD CONSTRAINT "meeting_notes_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalations" ADD CONSTRAINT "escalations_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalations" ADD CONSTRAINT "escalations_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalations" ADD CONSTRAINT "escalations_escalated_to_fkey" FOREIGN KEY ("escalated_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalations" ADD CONSTRAINT "escalations_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalations" ADD CONSTRAINT "escalations_resolved_by_fkey" FOREIGN KEY ("resolved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalation_updates" ADD CONSTRAINT "escalation_updates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalation_updates" ADD CONSTRAINT "escalation_updates_escalation_id_fkey" FOREIGN KEY ("escalation_id") REFERENCES "public"."escalations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalation_updates" ADD CONSTRAINT "escalation_updates_new_assignee_id_fkey" FOREIGN KEY ("new_assignee_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "escalation_updates" ADD CONSTRAINT "escalation_updates_old_assignee_id_fkey" FOREIGN KEY ("old_assignee_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "document_access_log" ADD CONSTRAINT "document_access_log_document_id_fkey" FOREIGN KEY ("document_id") REFERENCES "public"."documents"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "document_access_log" ADD CONSTRAINT "document_access_log_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_client_details" ADD CONSTRAINT "company_client_details_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_client_details" ADD CONSTRAINT "company_client_details_executive_sponsor_id_fkey" FOREIGN KEY ("executive_sponsor_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_client_details" ADD CONSTRAINT "company_client_details_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_vendor_details" ADD CONSTRAINT "company_vendor_details_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_vendor_details" ADD CONSTRAINT "company_vendor_details_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_vendor_details" ADD CONSTRAINT "company_vendor_details_vendor_manager_id_fkey" FOREIGN KEY ("vendor_manager_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_partner_details" ADD CONSTRAINT "company_partner_details_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "company_partner_details" ADD CONSTRAINT "company_partner_details_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deals" ADD CONSTRAINT "deals_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deals" ADD CONSTRAINT "deals_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deals" ADD CONSTRAINT "deals_lead_contact_id_fkey" FOREIGN KEY ("lead_contact_id") REFERENCES "public"."contacts"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deals" ADD CONSTRAINT "deals_lead_id_fkey" FOREIGN KEY ("lead_id") REFERENCES "public"."leads"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deals" ADD CONSTRAINT "deals_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deals" ADD CONSTRAINT "deals_owner_id_fkey" FOREIGN KEY ("owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deals" ADD CONSTRAINT "deals_pod_manager_id_fkey" FOREIGN KEY ("pod_manager_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "deals" ADD CONSTRAINT "deals_secondary_owner_id_fkey" FOREIGN KEY ("secondary_owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "data_retention_policies" ADD CONSTRAINT "data_retention_policies_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "data_retention_policies" ADD CONSTRAINT "data_retention_policies_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "compliance_requirements" ADD CONSTRAINT "compliance_requirements_created_by_fkey1" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "compliance_requirements" ADD CONSTRAINT "compliance_requirements_org_id_fkey1" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "compliance_items" ADD CONSTRAINT "compliance_items_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "compliance_items" ADD CONSTRAINT "compliance_items_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "compliance_items" ADD CONSTRAINT "compliance_items_requirement_id_fkey" FOREIGN KEY ("requirement_id") REFERENCES "public"."compliance_requirements"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "compliance_items" ADD CONSTRAINT "compliance_items_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "compliance_items" ADD CONSTRAINT "compliance_items_waived_by_fkey" FOREIGN KEY ("waived_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_compliance_requirements" ADD CONSTRAINT "entity_compliance_requirements_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_compliance_requirements" ADD CONSTRAINT "entity_compliance_requirements_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_compliance_requirements" ADD CONSTRAINT "entity_compliance_requirements_requirement_id_fkey" FOREIGN KEY ("requirement_id") REFERENCES "public"."compliance_requirements"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contracts" ADD CONSTRAINT "contracts_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contracts" ADD CONSTRAINT "contracts_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contracts" ADD CONSTRAINT "contracts_owner_id_fkey" FOREIGN KEY ("owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contracts" ADD CONSTRAINT "contracts_parent_contract_id_fkey" FOREIGN KEY ("parent_contract_id") REFERENCES "public"."contracts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contracts" ADD CONSTRAINT "contracts_previous_version_id_fkey" FOREIGN KEY ("previous_version_id") REFERENCES "public"."contracts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contracts" ADD CONSTRAINT "contracts_terminated_by_fkey" FOREIGN KEY ("terminated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_versions" ADD CONSTRAINT "contract_versions_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_versions" ADD CONSTRAINT "contract_versions_contract_id_fkey" FOREIGN KEY ("contract_id") REFERENCES "public"."contracts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_versions" ADD CONSTRAINT "contract_versions_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_parties" ADD CONSTRAINT "contract_parties_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_parties" ADD CONSTRAINT "contract_parties_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_parties" ADD CONSTRAINT "contract_parties_contract_id_fkey" FOREIGN KEY ("contract_id") REFERENCES "public"."contracts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_parties" ADD CONSTRAINT "contract_parties_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_parties" ADD CONSTRAINT "contract_parties_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_templates" ADD CONSTRAINT "contract_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_templates" ADD CONSTRAINT "contract_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_clauses" ADD CONSTRAINT "contract_clauses_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_clauses" ADD CONSTRAINT "contract_clauses_legal_approved_by_fkey" FOREIGN KEY ("legal_approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "contract_clauses" ADD CONSTRAINT "contract_clauses_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_approvals" ADD CONSTRAINT "rate_approvals_decided_by_fkey" FOREIGN KEY ("decided_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_approvals" ADD CONSTRAINT "rate_approvals_entity_rate_id_fkey" FOREIGN KEY ("entity_rate_id") REFERENCES "public"."entity_rates"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_approvals" ADD CONSTRAINT "rate_approvals_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_approvals" ADD CONSTRAINT "rate_approvals_requested_by_fkey" FOREIGN KEY ("requested_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_cards" ADD CONSTRAINT "rate_cards_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_cards" ADD CONSTRAINT "rate_cards_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_cards" ADD CONSTRAINT "rate_cards_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_cards" ADD CONSTRAINT "rate_cards_previous_version_id_fkey" FOREIGN KEY ("previous_version_id") REFERENCES "public"."rate_cards"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_card_items" ADD CONSTRAINT "rate_card_items_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_card_items" ADD CONSTRAINT "rate_card_items_rate_card_id_fkey" FOREIGN KEY ("rate_card_id") REFERENCES "public"."rate_cards"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_rates" ADD CONSTRAINT "entity_rates_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_rates" ADD CONSTRAINT "entity_rates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_rates" ADD CONSTRAINT "entity_rates_negotiated_by_fkey" FOREIGN KEY ("negotiated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_rates" ADD CONSTRAINT "entity_rates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_rates" ADD CONSTRAINT "entity_rates_rate_card_id_fkey" FOREIGN KEY ("rate_card_id") REFERENCES "public"."rate_cards"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_rates" ADD CONSTRAINT "entity_rates_rate_card_item_id_fkey" FOREIGN KEY ("rate_card_item_id") REFERENCES "public"."rate_card_items"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_change_history" ADD CONSTRAINT "rate_change_history_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "rate_change_history" ADD CONSTRAINT "rate_change_history_entity_rate_id_fkey" FOREIGN KEY ("entity_rate_id") REFERENCES "public"."entity_rates"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_client_company_id_fkey" FOREIGN KEY ("client_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_closed_by_fkey" FOREIGN KEY ("closed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_deal_id_fkey" FOREIGN KEY ("deal_id") REFERENCES "public"."deals"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_end_client_company_id_fkey" FOREIGN KEY ("end_client_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_hiring_manager_contact_id_fkey" FOREIGN KEY ("hiring_manager_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_hr_contact_id_fkey" FOREIGN KEY ("hr_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_intake_completed_by_fkey" FOREIGN KEY ("intake_completed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_owner_id_fkey" FOREIGN KEY ("owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_published_by_fkey" FOREIGN KEY ("published_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "jobs" ADD CONSTRAINT "jobs_vendor_company_id_fkey" FOREIGN KEY ("vendor_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_duplicate_of_submission_id_fkey" FOREIGN KEY ("duplicate_of_submission_id") REFERENCES "public"."submissions"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_offer_id_fkey" FOREIGN KEY ("offer_id") REFERENCES "public"."offers"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_owner_id_fkey" FOREIGN KEY ("owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_rate_card_id_fkey" FOREIGN KEY ("rate_card_id") REFERENCES "public"."rate_cards"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_rate_card_item_id_fkey" FOREIGN KEY ("rate_card_item_id") REFERENCES "public"."rate_card_items"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_rtr_document_id_fkey" FOREIGN KEY ("rtr_document_id") REFERENCES "public"."documents"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_submitted_by_company_id_fkey" FOREIGN KEY ("submitted_by_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_submitted_by_contact_id_fkey" FOREIGN KEY ("submitted_by_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_submitted_to_client_by_fkey" FOREIGN KEY ("submitted_to_client_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_vendor_decision_by_fkey" FOREIGN KEY ("vendor_decision_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "submissions" ADD CONSTRAINT "submissions_vendor_submitted_by_fkey" FOREIGN KEY ("vendor_submitted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_cancelled_by_fkey" FOREIGN KEY ("cancelled_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_confirmed_by_fkey" FOREIGN KEY ("confirmed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_coordinator_contact_id_fkey" FOREIGN KEY ("coordinator_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_prep_completed_by_fkey" FOREIGN KEY ("prep_completed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_primary_interviewer_contact_id_fkey" FOREIGN KEY ("primary_interviewer_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_rescheduled_by_fkey" FOREIGN KEY ("rescheduled_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_scheduled_by_fkey" FOREIGN KEY ("scheduled_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interviews" ADD CONSTRAINT "interviews_submitted_by_fkey" FOREIGN KEY ("submitted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_participants" ADD CONSTRAINT "interview_participants_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_participants" ADD CONSTRAINT "interview_participants_interview_id_fkey" FOREIGN KEY ("interview_id") REFERENCES "public"."interviews"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_participants" ADD CONSTRAINT "interview_participants_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_participants" ADD CONSTRAINT "interview_participants_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_scorecards" ADD CONSTRAINT "interview_scorecards_interview_id_fkey" FOREIGN KEY ("interview_id") REFERENCES "public"."interviews"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_scorecards" ADD CONSTRAINT "interview_scorecards_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_scorecards" ADD CONSTRAINT "interview_scorecards_participant_id_fkey" FOREIGN KEY ("participant_id") REFERENCES "public"."interview_participants"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "interview_scorecards" ADD CONSTRAINT "interview_scorecards_submitted_by_fkey" FOREIGN KEY ("submitted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "scorecard_templates" ADD CONSTRAINT "scorecard_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "scorecard_templates" ADD CONSTRAINT "scorecard_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_account_manager_id_fkey" FOREIGN KEY ("account_manager_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_billing_company_id_fkey" FOREIGN KEY ("billing_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_candidate_id_fkey" FOREIGN KEY ("candidate_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_client_company_id_fkey" FOREIGN KEY ("client_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_client_manager_contact_id_fkey" FOREIGN KEY ("client_manager_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_contract_id_fkey" FOREIGN KEY ("contract_id") REFERENCES "public"."contracts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_end_client_company_id_fkey" FOREIGN KEY ("end_client_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_hr_contact_id_fkey" FOREIGN KEY ("hr_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_job_id_fkey" FOREIGN KEY ("job_id") REFERENCES "public"."jobs"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_last_check_in_by_fkey" FOREIGN KEY ("last_check_in_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_offer_id_fkey" FOREIGN KEY ("offer_id") REFERENCES "public"."offers"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_rate_card_id_fkey" FOREIGN KEY ("rate_card_id") REFERENCES "public"."rate_cards"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_rate_card_item_id_fkey" FOREIGN KEY ("rate_card_item_id") REFERENCES "public"."rate_card_items"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_recruiter_id_fkey" FOREIGN KEY ("recruiter_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_reporting_manager_contact_id_fkey" FOREIGN KEY ("reporting_manager_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_submission_id_fkey" FOREIGN KEY ("submission_id") REFERENCES "public"."submissions"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_vendor_company_id_fkey" FOREIGN KEY ("vendor_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placements" ADD CONSTRAINT "placements_work_address_id_fkey" FOREIGN KEY ("work_address_id") REFERENCES "public"."addresses"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_vendors" ADD CONSTRAINT "placement_vendors_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_vendors" ADD CONSTRAINT "placement_vendors_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_vendors" ADD CONSTRAINT "placement_vendors_vendor_company_id_fkey" FOREIGN KEY ("vendor_company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_vendors" ADD CONSTRAINT "placement_vendors_vendor_contact_id_fkey" FOREIGN KEY ("vendor_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_vendors" ADD CONSTRAINT "placement_vendors_vendor_contract_id_fkey" FOREIGN KEY ("vendor_contract_id") REFERENCES "public"."contracts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_change_orders" ADD CONSTRAINT "placement_change_orders_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_change_orders" ADD CONSTRAINT "placement_change_orders_document_id_fkey" FOREIGN KEY ("document_id") REFERENCES "public"."documents"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_change_orders" ADD CONSTRAINT "placement_change_orders_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_change_orders" ADD CONSTRAINT "placement_change_orders_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_change_orders" ADD CONSTRAINT "placement_change_orders_requested_by_fkey" FOREIGN KEY ("requested_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_checkins" ADD CONSTRAINT "placement_checkins_client_contact_id_fkey" FOREIGN KEY ("client_contact_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_checkins" ADD CONSTRAINT "placement_checkins_completed_by_fkey" FOREIGN KEY ("completed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_checkins" ADD CONSTRAINT "placement_checkins_conducted_by_fkey" FOREIGN KEY ("conducted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_checkins" ADD CONSTRAINT "placement_checkins_escalated_to_fkey" FOREIGN KEY ("escalated_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_checkins" ADD CONSTRAINT "placement_checkins_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "placement_checkins" ADD CONSTRAINT "placement_checkins_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_tasks" ADD CONSTRAINT "onboarding_tasks_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_tasks" ADD CONSTRAINT "onboarding_tasks_completed_by_fkey" FOREIGN KEY ("completed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_tasks" ADD CONSTRAINT "onboarding_tasks_document_id_fkey" FOREIGN KEY ("document_id") REFERENCES "public"."documents"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_tasks" ADD CONSTRAINT "onboarding_tasks_onboarding_id_fkey" FOREIGN KEY ("onboarding_id") REFERENCES "public"."employee_onboarding"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_tasks" ADD CONSTRAINT "onboarding_tasks_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_onboarding" ADD CONSTRAINT "employee_onboarding_assigned_to_fkey" FOREIGN KEY ("assigned_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_onboarding" ADD CONSTRAINT "employee_onboarding_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_onboarding" ADD CONSTRAINT "employee_onboarding_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_onboarding" ADD CONSTRAINT "employee_onboarding_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."employees"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_onboarding" ADD CONSTRAINT "employee_onboarding_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "employee_onboarding" ADD CONSTRAINT "employee_onboarding_template_fkey" FOREIGN KEY ("checklist_template_id") REFERENCES "public"."onboarding_templates"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_templates" ADD CONSTRAINT "onboarding_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_templates" ADD CONSTRAINT "onboarding_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_templates" ADD CONSTRAINT "onboarding_templates_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_template_tasks" ADD CONSTRAINT "onboarding_template_tasks_document_template_id_fkey" FOREIGN KEY ("document_template_id") REFERENCES "public"."documents"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_template_tasks" ADD CONSTRAINT "onboarding_template_tasks_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "onboarding_template_tasks" ADD CONSTRAINT "onboarding_template_tasks_template_id_fkey" FOREIGN KEY ("template_id") REFERENCES "public"."onboarding_templates"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_entries" ADD CONSTRAINT "timesheet_entries_timesheet_id_fkey" FOREIGN KEY ("timesheet_id") REFERENCES "public"."timesheets"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_approvals" ADD CONSTRAINT "timesheet_approvals_approver_id_fkey" FOREIGN KEY ("approver_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_approvals" ADD CONSTRAINT "timesheet_approvals_delegated_from_fkey" FOREIGN KEY ("delegated_from") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_approvals" ADD CONSTRAINT "timesheet_approvals_timesheet_id_fkey" FOREIGN KEY ("timesheet_id") REFERENCES "public"."timesheets"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_expenses" ADD CONSTRAINT "timesheet_expenses_timesheet_id_fkey" FOREIGN KEY ("timesheet_id") REFERENCES "public"."timesheets"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_expenses" ADD CONSTRAINT "timesheet_expenses_verified_by_fkey" FOREIGN KEY ("verified_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_line_items" ADD CONSTRAINT "invoice_line_items_invoice_id_fkey" FOREIGN KEY ("invoice_id") REFERENCES "public"."invoices"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_line_items" ADD CONSTRAINT "invoice_line_items_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_line_items" ADD CONSTRAINT "invoice_line_items_timesheet_entry_id_fkey" FOREIGN KEY ("timesheet_entry_id") REFERENCES "public"."timesheet_entries"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_line_items" ADD CONSTRAINT "invoice_line_items_timesheet_id_fkey" FOREIGN KEY ("timesheet_id") REFERENCES "public"."timesheets"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_items" ADD CONSTRAINT "pay_items_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_items" ADD CONSTRAINT "pay_items_pay_run_id_fkey" FOREIGN KEY ("pay_run_id") REFERENCES "public"."pay_runs"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_item_earnings" ADD CONSTRAINT "pay_item_earnings_pay_item_id_fkey" FOREIGN KEY ("pay_item_id") REFERENCES "public"."pay_items"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_item_deductions" ADD CONSTRAINT "pay_item_deductions_pay_item_id_fkey" FOREIGN KEY ("pay_item_id") REFERENCES "public"."pay_items"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_stubs" ADD CONSTRAINT "pay_stubs_pay_item_id_fkey" FOREIGN KEY ("pay_item_id") REFERENCES "public"."pay_items"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheets" ADD CONSTRAINT "timesheets_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheets" ADD CONSTRAINT "timesheets_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheets" ADD CONSTRAINT "timesheets_placement_id_fkey" FOREIGN KEY ("placement_id") REFERENCES "public"."placements"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheets" ADD CONSTRAINT "timesheets_submitted_by_fkey" FOREIGN KEY ("submitted_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheets" ADD CONSTRAINT "timesheets_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_approval_workflows" ADD CONSTRAINT "timesheet_approval_workflows_escalation_to_fkey" FOREIGN KEY ("escalation_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_approval_workflows" ADD CONSTRAINT "timesheet_approval_workflows_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_adjustments" ADD CONSTRAINT "timesheet_adjustments_adjustment_timesheet_id_fkey" FOREIGN KEY ("adjustment_timesheet_id") REFERENCES "public"."timesheets"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_adjustments" ADD CONSTRAINT "timesheet_adjustments_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_adjustments" ADD CONSTRAINT "timesheet_adjustments_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_adjustments" ADD CONSTRAINT "timesheet_adjustments_original_timesheet_id_fkey" FOREIGN KEY ("original_timesheet_id") REFERENCES "public"."timesheets"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_adjustments" ADD CONSTRAINT "timesheet_adjustments_requested_by_fkey" FOREIGN KEY ("requested_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "timesheet_templates" ADD CONSTRAINT "timesheet_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoices" ADD CONSTRAINT "invoices_billing_contact_id_fkey" FOREIGN KEY ("billing_contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoices" ADD CONSTRAINT "invoices_company_id_fkey" FOREIGN KEY ("company_id") REFERENCES "public"."companies"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoices" ADD CONSTRAINT "invoices_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoices" ADD CONSTRAINT "invoices_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoices" ADD CONSTRAINT "invoices_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_payments" ADD CONSTRAINT "invoice_payments_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_payments" ADD CONSTRAINT "invoice_payments_invoice_id_fkey" FOREIGN KEY ("invoice_id") REFERENCES "public"."invoices"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_payments" ADD CONSTRAINT "invoice_payments_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "payment_terms" ADD CONSTRAINT "payment_terms_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_batches" ADD CONSTRAINT "invoice_batches_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_batches" ADD CONSTRAINT "invoice_batches_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_templates" ADD CONSTRAINT "invoice_templates_default_payment_terms_id_fkey" FOREIGN KEY ("default_payment_terms_id") REFERENCES "public"."payment_terms"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "invoice_templates" ADD CONSTRAINT "invoice_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_periods" ADD CONSTRAINT "pay_periods_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_runs" ADD CONSTRAINT "pay_runs_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_runs" ADD CONSTRAINT "pay_runs_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_runs" ADD CONSTRAINT "pay_runs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pay_runs" ADD CONSTRAINT "pay_runs_pay_period_id_fkey" FOREIGN KEY ("pay_period_id") REFERENCES "public"."pay_periods"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "worker_tax_setup" ADD CONSTRAINT "worker_tax_setup_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "worker_tax_setup" ADD CONSTRAINT "worker_tax_setup_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "worker_benefits" ADD CONSTRAINT "worker_benefits_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "worker_benefits" ADD CONSTRAINT "worker_benefits_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "worker_garnishments" ADD CONSTRAINT "worker_garnishments_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "worker_garnishments" ADD CONSTRAINT "worker_garnishments_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "tax_documents" ADD CONSTRAINT "tax_documents_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "tax_documents" ADD CONSTRAINT "tax_documents_corrects_document_id_fkey" FOREIGN KEY ("corrects_document_id") REFERENCES "public"."tax_documents"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "tax_documents" ADD CONSTRAINT "tax_documents_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_executions" ADD CONSTRAINT "workflow_executions_instance_id_fkey" FOREIGN KEY ("instance_id") REFERENCES "public"."workflow_instances"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_executions" ADD CONSTRAINT "workflow_executions_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_executions" ADD CONSTRAINT "workflow_executions_triggered_by_fkey" FOREIGN KEY ("triggered_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_steps" ADD CONSTRAINT "workflow_steps_execution_id_fkey" FOREIGN KEY ("execution_id") REFERENCES "public"."workflow_executions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_steps" ADD CONSTRAINT "workflow_steps_state_id_fkey" FOREIGN KEY ("state_id") REFERENCES "public"."workflow_states"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_steps" ADD CONSTRAINT "workflow_steps_transition_id_fkey" FOREIGN KEY ("transition_id") REFERENCES "public"."workflow_transitions"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_actions" ADD CONSTRAINT "workflow_actions_execution_id_fkey" FOREIGN KEY ("execution_id") REFERENCES "public"."workflow_executions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_actions" ADD CONSTRAINT "workflow_actions_step_id_fkey" FOREIGN KEY ("step_id") REFERENCES "public"."workflow_steps"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_approvals" ADD CONSTRAINT "workflow_approvals_approver_id_fkey" FOREIGN KEY ("approver_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_approvals" ADD CONSTRAINT "workflow_approvals_delegated_to_fkey" FOREIGN KEY ("delegated_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_approvals" ADD CONSTRAINT "workflow_approvals_escalated_to_fkey" FOREIGN KEY ("escalated_to") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_approvals" ADD CONSTRAINT "workflow_approvals_execution_id_fkey" FOREIGN KEY ("execution_id") REFERENCES "public"."workflow_executions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_approvals" ADD CONSTRAINT "workflow_approvals_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_approvals" ADD CONSTRAINT "workflow_approvals_step_id_fkey" FOREIGN KEY ("step_id") REFERENCES "public"."workflow_steps"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_execution_logs" ADD CONSTRAINT "workflow_execution_logs_action_id_fkey" FOREIGN KEY ("action_id") REFERENCES "public"."workflow_actions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_execution_logs" ADD CONSTRAINT "workflow_execution_logs_execution_id_fkey" FOREIGN KEY ("execution_id") REFERENCES "public"."workflow_executions"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "workflow_execution_logs" ADD CONSTRAINT "workflow_execution_logs_step_id_fkey" FOREIGN KEY ("step_id") REFERENCES "public"."workflow_steps"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notification_preferences" ADD CONSTRAINT "notification_preferences_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notification_preferences" ADD CONSTRAINT "notification_preferences_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notification_templates" ADD CONSTRAINT "notification_templates_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "notification_templates" ADD CONSTRAINT "notification_templates_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaigns" ADD CONSTRAINT "campaigns_approved_by_fkey" FOREIGN KEY ("approved_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaigns" ADD CONSTRAINT "campaigns_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaigns" ADD CONSTRAINT "campaigns_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaigns" ADD CONSTRAINT "campaigns_owner_id_fkey" FOREIGN KEY ("owner_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaigns" ADD CONSTRAINT "campaigns_updated_by_fkey" FOREIGN KEY ("updated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_enrollments" ADD CONSTRAINT "campaign_enrollments_campaign_id_fkey" FOREIGN KEY ("campaign_id") REFERENCES "public"."campaigns"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_enrollments" ADD CONSTRAINT "campaign_enrollments_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_enrollments" ADD CONSTRAINT "campaign_enrollments_converted_lead_id_fkey" FOREIGN KEY ("converted_lead_id") REFERENCES "public"."leads"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_enrollments" ADD CONSTRAINT "campaign_enrollments_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_sequence_logs" ADD CONSTRAINT "campaign_sequence_logs_campaign_id_fkey" FOREIGN KEY ("campaign_id") REFERENCES "public"."campaigns"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_sequence_logs" ADD CONSTRAINT "campaign_sequence_logs_enrollment_id_fkey" FOREIGN KEY ("enrollment_id") REFERENCES "public"."campaign_enrollments"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "campaign_sequence_logs" ADD CONSTRAINT "campaign_sequence_logs_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "communications" ADD CONSTRAINT "communications_campaign_id_fkey" FOREIGN KEY ("campaign_id") REFERENCES "public"."campaigns"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "communications" ADD CONSTRAINT "communications_contact_id_fkey" FOREIGN KEY ("contact_id") REFERENCES "public"."contacts"("id") ON DELETE set null ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "communications" ADD CONSTRAINT "communications_created_by_fkey" FOREIGN KEY ("created_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "communications" ADD CONSTRAINT "communications_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "communications" ADD CONSTRAINT "communications_parent_id_fkey" FOREIGN KEY ("parent_id") REFERENCES "public"."communications"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "communications" ADD CONSTRAINT "communications_thread_id_fkey" FOREIGN KEY ("thread_id") REFERENCES "public"."communications"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "communication_events" ADD CONSTRAINT "communication_events_communication_id_fkey" FOREIGN KEY ("communication_id") REFERENCES "public"."communications"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "pto_balances" ADD CONSTRAINT "pto_balances_employee_id_fkey" FOREIGN KEY ("employee_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_roles" ADD CONSTRAINT "user_roles_assigned_by_fkey" FOREIGN KEY ("assigned_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_roles" ADD CONSTRAINT "user_roles_role_id_fkey" FOREIGN KEY ("role_id") REFERENCES "public"."roles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "user_roles" ADD CONSTRAINT "user_roles_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_events_2025_12" ADD CONSTRAINT "system_events_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_events_2025_12" ADD CONSTRAINT "system_events_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_events_2026_01" ADD CONSTRAINT "system_events_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_events_2026_01" ADD CONSTRAINT "system_events_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_events_2026_02" ADD CONSTRAINT "system_events_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_events_2026_02" ADD CONSTRAINT "system_events_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_events_2026_03" ADD CONSTRAINT "system_events_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "system_events_2026_03" ADD CONSTRAINT "system_events_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2026_02" ADD CONSTRAINT "audit_log_impersonated_by_fkey" FOREIGN KEY ("impersonated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2026_02" ADD CONSTRAINT "audit_log_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2026_02" ADD CONSTRAINT "audit_log_performed_by_fkey" FOREIGN KEY ("performed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2026_03" ADD CONSTRAINT "audit_log_impersonated_by_fkey" FOREIGN KEY ("impersonated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2026_03" ADD CONSTRAINT "audit_log_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2026_03" ADD CONSTRAINT "audit_log_performed_by_fkey" FOREIGN KEY ("performed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2025_12" ADD CONSTRAINT "audit_log_impersonated_by_fkey" FOREIGN KEY ("impersonated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2025_12" ADD CONSTRAINT "audit_log_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2025_12" ADD CONSTRAINT "audit_log_performed_by_fkey" FOREIGN KEY ("performed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2026_01" ADD CONSTRAINT "audit_log_impersonated_by_fkey" FOREIGN KEY ("impersonated_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2026_01" ADD CONSTRAINT "audit_log_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "audit_log_2026_01" ADD CONSTRAINT "audit_log_performed_by_fkey" FOREIGN KEY ("performed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_history_2026_01" ADD CONSTRAINT "entity_history_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_history_2026_01" ADD CONSTRAINT "entity_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_history_2026_02" ADD CONSTRAINT "entity_history_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_history_2026_02" ADD CONSTRAINT "entity_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_history_2026_03" ADD CONSTRAINT "entity_history_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_history_2026_03" ADD CONSTRAINT "entity_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_history_2025_12" ADD CONSTRAINT "entity_history_changed_by_fkey" FOREIGN KEY ("changed_by") REFERENCES "public"."user_profiles"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "entity_history_2025_12" ADD CONSTRAINT "entity_history_org_id_fkey" FOREIGN KEY ("org_id") REFERENCES "public"."organizations"("id") ON DELETE no action ON UPDATE no action;--> statement-breakpoint
CREATE INDEX "idx_badge_progress_user" ON "badge_progress" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_badge_trigger_events_processed" ON "badge_trigger_events" USING btree ("processed" bool_ops) WHERE (processed = false);--> statement-breakpoint
CREATE INDEX "idx_badge_trigger_events_user" ON "badge_trigger_events" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_payment_transactions_created_at" ON "payment_transactions" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_payment_transactions_status" ON "payment_transactions" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_payment_transactions_stripe_pi" ON "payment_transactions" USING btree ("stripe_payment_intent_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_payment_transactions_user" ON "payment_transactions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_commissions_deal_id" ON "commissions" USING btree ("deal_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_commissions_org_id" ON "commissions" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_commissions_payment_period" ON "commissions" USING btree ("payment_period_start" date_ops,"payment_period_end" date_ops);--> statement-breakpoint
CREATE INDEX "idx_commissions_status" ON "commissions" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_commissions_type" ON "commissions" USING btree ("commission_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_commissions_user_id" ON "commissions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_commissions_user_status" ON "commissions" USING btree ("user_id" uuid_ops,"status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_commission_payments_commission_id" ON "commission_payments" USING btree ("commission_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_commission_payments_org_id" ON "commission_payments" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_commission_payments_payment_date" ON "commission_payments" USING btree ("payment_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_productivity_reports_date" ON "productivity_reports" USING btree ("date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_productivity_reports_user" ON "productivity_reports" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_productivity_reports_user_date" ON "productivity_reports" USING btree ("user_id" date_ops,"date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_account_id" ON "leads" USING btree ("account_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_bant_status" ON "leads" USING btree ("bant_total_score" text_ops,"status" int4_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_leads_bant_total" ON "leads" USING btree ("bant_total_score" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_campaign" ON "leads" USING btree ("campaign_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_campaign_org" ON "leads" USING btree ("campaign_id" uuid_ops,"org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_leads_company_id" ON "leads" USING btree ("company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_leads_contact_id" ON "leads" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_leads_converted_to_company" ON "leads" USING btree ("converted_to_company_id" uuid_ops) WHERE (converted_to_company_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_leads_cross_pillar_type" ON "leads" USING btree ("cross_pillar_type" text_ops) WHERE (cross_pillar_type IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_leads_email" ON "leads" USING btree ("email" text_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_interest_level" ON "leads" USING btree ("interest_level" text_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_org" ON "leads" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_leads_org_id" ON "leads" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_owner" ON "leads" USING btree ("owner_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_owner_id" ON "leads" USING btree ("owner_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_qualification_result" ON "leads" USING btree ("qualification_result" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_leads_source" ON "leads" USING btree ("source_campaign_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_leads_status" ON "leads" USING btree ("status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_leads_urgency" ON "leads" USING btree ("urgency" text_ops);--> statement-breakpoint
CREATE INDEX "idx_resumes_org" ON "generated_resumes" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_resumes_placement" ON "generated_resumes" USING btree ("placement_achieved" bool_ops) WHERE (placement_achieved = true);--> statement-breakpoint
CREATE INDEX "idx_resumes_quality" ON "generated_resumes" USING btree ("quality_score" int4_ops) WHERE (quality_score IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_resumes_role" ON "generated_resumes" USING btree ("target_role" text_ops);--> statement-breakpoint
CREATE INDEX "idx_resumes_user" ON "generated_resumes" USING btree ("user_id" uuid_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_requisition_embeddings_experience" ON "requisition_embeddings" USING btree ("experience_level" text_ops);--> statement-breakpoint
CREATE INDEX "idx_requisition_embeddings_org" ON "requisition_embeddings" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_requisition_embeddings_skills" ON "requisition_embeddings" USING gin ("required_skills" array_ops);--> statement-breakpoint
CREATE INDEX "idx_requisition_embeddings_vector" ON "requisition_embeddings" USING ivfflat ("embedding" vector_cosine_ops) WITH (lists=100);--> statement-breakpoint
CREATE INDEX "idx_matches_candidate" ON "resume_matches" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_matches_created" ON "resume_matches" USING btree ("org_id" uuid_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_matches_org" ON "resume_matches" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_matches_placement" ON "resume_matches" USING btree ("placement_achieved" bool_ops) WHERE (placement_achieved = true);--> statement-breakpoint
CREATE INDEX "idx_matches_relevant" ON "resume_matches" USING btree ("is_relevant" bool_ops) WHERE (is_relevant IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_matches_requisition" ON "resume_matches" USING btree ("requisition_id" uuid_ops,"match_score" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_twin_interactions_role" ON "employee_twin_interactions" USING btree ("twin_role" text_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_twin_interactions_type" ON "employee_twin_interactions" USING btree ("interaction_type" text_ops,"created_at" text_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_twin_interactions_user" ON "employee_twin_interactions" USING btree ("user_id" timestamptz_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_embeddings_availability" ON "candidate_embeddings" USING btree ("availability" text_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_embeddings_contact_id" ON "candidate_embeddings" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_embeddings_experience" ON "candidate_embeddings" USING btree ("experience_level" text_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_embeddings_org" ON "candidate_embeddings" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_embeddings_skills" ON "candidate_embeddings" USING gin ("skills" array_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_embeddings_vector" ON "candidate_embeddings" USING ivfflat ("embedding" vector_cosine_ops) WITH (lists=100);--> statement-breakpoint
CREATE INDEX "idx_lead_sourcing_credits_lead" ON "lead_sourcing_credits" USING btree ("lead_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_sourcing_credits_org" ON "lead_sourcing_credits" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_sourcing_credits_sourced_by" ON "lead_sourcing_credits" USING btree ("sourced_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_sourcing_credits_status" ON "lead_sourcing_credits" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_sourcing_credits_target" ON "lead_sourcing_credits" USING btree ("target_pillar" text_ops);--> statement-breakpoint
CREATE INDEX "idx_roles_name" ON "roles" USING btree ("name" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_roles_parent" ON "roles" USING btree ("parent_role_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_roles_system" ON "roles" USING btree ("is_system_role" bool_ops) WHERE (is_system_role = true);--> statement-breakpoint
CREATE INDEX "idx_twin_preferences_user" ON "twin_preferences" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_content_assets_file_type" ON "content_assets" USING btree ("file_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_content_assets_is_current" ON "content_assets" USING btree ("is_current" bool_ops) WHERE (is_current = true);--> statement-breakpoint
CREATE INDEX "idx_content_assets_lesson" ON "content_assets" USING btree ("lesson_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_content_assets_search" ON "content_assets" USING gin (to_tsvector('english'::regconfig, COALESCE(searchable_content,  tsvector_ops);--> statement-breakpoint
CREATE INDEX "idx_content_assets_storage_path" ON "content_assets" USING btree ("storage_path" text_ops);--> statement-breakpoint
CREATE INDEX "idx_content_assets_topic" ON "content_assets" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_content_assets_uploaded_by" ON "content_assets" USING btree ("uploaded_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_video_progress_enrollment" ON "video_progress" USING btree ("enrollment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_video_progress_topic" ON "video_progress" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_video_progress_updated" ON "video_progress" USING btree ("updated_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_video_progress_user" ON "video_progress" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_project_timeline_org_id" ON "project_timeline" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_timeline_agent_type" ON "project_timeline" USING btree ("agent_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_timeline_created_at" ON "project_timeline" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_timeline_not_archived" ON "project_timeline" USING btree ("is_archived" bool_ops) WHERE (is_archived = false);--> statement-breakpoint
CREATE INDEX "idx_timeline_search" ON "project_timeline" USING gin ("search_vector" tsvector_ops);--> statement-breakpoint
CREATE INDEX "idx_timeline_session_date" ON "project_timeline" USING btree ("session_date" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_timeline_session_id" ON "project_timeline" USING btree ("session_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_timeline_tags" ON "project_timeline" USING gin ("tags" array_ops);--> statement-breakpoint
CREATE INDEX "idx_session_branch" ON "session_metadata" USING btree ("branch" text_ops);--> statement-breakpoint
CREATE INDEX "idx_session_environment" ON "session_metadata" USING btree ("environment" text_ops);--> statement-breakpoint
CREATE INDEX "idx_session_metadata_org_id" ON "session_metadata" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_session_started_at" ON "session_metadata" USING btree ("started_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_documents_campaign" ON "campaign_documents" USING btree ("campaign_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_campaign_documents_campaign_org" ON "campaign_documents" USING btree ("campaign_id" uuid_ops,"org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_campaign_documents_category" ON "campaign_documents" USING btree ("category" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_campaign_documents_org" ON "campaign_documents" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_campaign_documents_type" ON "campaign_documents" USING btree ("document_type" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_event_delivery_attempted" ON "event_delivery_log" USING btree ("attempted_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_event_delivery_event" ON "event_delivery_log" USING btree ("event_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_event_delivery_log_org_id" ON "event_delivery_log" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_event_delivery_subscription" ON "event_delivery_log" USING btree ("subscription_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_onboarding_checklist_completion" ON "onboarding_checklist" USING btree ("completion_percentage" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_onboarding_checklist_incomplete" ON "onboarding_checklist" USING btree ("user_id" uuid_ops) WHERE (completed_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_onboarding_checklist_user" ON "onboarding_checklist" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_courses_featured" ON "courses" USING btree ("is_featured" bool_ops) WHERE (is_featured = true);--> statement-breakpoint
CREATE INDEX "idx_courses_published" ON "courses" USING btree ("is_published" bool_ops) WHERE (is_published = true);--> statement-breakpoint
CREATE INDEX "idx_courses_slug" ON "courses" USING btree ("slug" text_ops);--> statement-breakpoint
CREATE INDEX "idx_course_modules_course_id" ON "course_modules" USING btree ("course_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_course_modules_number" ON "course_modules" USING btree ("course_id" uuid_ops,"module_number" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_module_topics_module_id" ON "module_topics" USING btree ("module_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_module_topics_number" ON "module_topics" USING btree ("module_id" uuid_ops,"topic_number" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_module_topics_required" ON "module_topics" USING btree ("is_required" bool_ops) WHERE (is_required = true);--> statement-breakpoint
CREATE INDEX "idx_ai_conversations_agent_type" ON "ai_conversations" USING btree ("agent_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_conversations_metadata" ON "ai_conversations" USING gin ("metadata" jsonb_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_conversations_updated_at" ON "ai_conversations" USING btree ("updated_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_conversations_user_id" ON "ai_conversations" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_embeddings_metadata" ON "ai_embeddings" USING gin ("metadata" jsonb_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_embeddings_vector" ON "ai_embeddings" USING ivfflat ("embedding" vector_cosine_ops) WITH (lists=100);--> statement-breakpoint
CREATE INDEX "idx_ai_patterns_last_seen" ON "ai_patterns" USING btree ("last_seen" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_patterns_type" ON "ai_patterns" USING btree ("pattern_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_patterns_user_id" ON "ai_patterns" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_cost_tracking_date" ON "ai_cost_tracking" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_cost_tracking_model" ON "ai_cost_tracking" USING btree ("model" text_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_cost_tracking_org_date" ON "ai_cost_tracking" USING btree ("org_id" timestamptz_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_cost_tracking_provider" ON "ai_cost_tracking" USING btree ("provider" text_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_cost_tracking_user" ON "ai_cost_tracking" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_prompts_active" ON "ai_prompts" USING btree ("is_active" bool_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_ai_prompts_category" ON "ai_prompts" USING btree ("category" text_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_prompts_name" ON "ai_prompts" USING btree ("name" text_ops);--> statement-breakpoint
CREATE INDEX "idx_student_progress_mastery" ON "student_progress" USING btree ("mastery_score" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_student_progress_module" ON "student_progress" USING btree ("current_module" text_ops);--> statement-breakpoint
CREATE INDEX "idx_student_progress_student" ON "student_progress" USING btree ("student_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_agent_interactions_agent" ON "ai_agent_interactions" USING btree ("agent_name" text_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_agent_interactions_org_date" ON "ai_agent_interactions" USING btree ("org_id" uuid_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_agent_interactions_success" ON "ai_agent_interactions" USING btree ("success" bool_ops) WHERE (success = false);--> statement-breakpoint
CREATE INDEX "idx_ai_agent_interactions_type" ON "ai_agent_interactions" USING btree ("interaction_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_agent_interactions_user" ON "ai_agent_interactions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_guru_interactions_agent_type" ON "guru_interactions" USING btree ("agent_type" text_ops,"created_at" text_ops);--> statement-breakpoint
CREATE INDEX "idx_guru_interactions_conversation" ON "guru_interactions" USING btree ("conversation_id" text_ops) WHERE (conversation_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_guru_interactions_org" ON "guru_interactions" USING btree ("org_id" uuid_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_guru_interactions_student" ON "guru_interactions" USING btree ("student_id" timestamptz_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_resume_versions_ats_score" ON "resume_versions" USING btree ("ats_score" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_resume_versions_format" ON "resume_versions" USING btree ("format" text_ops);--> statement-breakpoint
CREATE INDEX "idx_resume_versions_student" ON "resume_versions" USING btree ("student_id" timestamptz_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_interview_sessions_module" ON "interview_sessions" USING btree ("guidewire_module" text_ops) WHERE (guidewire_module IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_interview_sessions_score" ON "interview_sessions" USING btree ("average_score" numeric_ops);--> statement-breakpoint
CREATE INDEX "idx_interview_sessions_student" ON "interview_sessions" USING btree ("student_id" uuid_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_interview_sessions_type" ON "interview_sessions" USING btree ("interview_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_screenshots_analyzed" ON "employee_screenshots" USING btree ("analyzed" bool_ops) WHERE ((NOT analyzed) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_screenshots_captured_at" ON "employee_screenshots" USING btree ("captured_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_screenshots_category" ON "employee_screenshots" USING btree ("activity_category" text_ops) WHERE (analyzed = true);--> statement-breakpoint
CREATE INDEX "idx_screenshots_machine" ON "employee_screenshots" USING btree ("machine_name" text_ops);--> statement-breakpoint
CREATE INDEX "idx_screenshots_user_date" ON "employee_screenshots" USING btree ("user_id" timestamptz_ops,"captured_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_screenshots_user_id" ON "employee_screenshots" USING btree ("user_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_topic_lessons_topic_id" ON "topic_lessons" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_topic_lessons_type" ON "topic_lessons" USING btree ("content_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_topic_completions_completed_at" ON "topic_completions" USING btree ("completed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_topic_completions_course" ON "topic_completions" USING btree ("course_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_topic_completions_enrollment" ON "topic_completions" USING btree ("enrollment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_topic_completions_user" ON "topic_completions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_xp_transactions_awarded_at" ON "xp_transactions" USING btree ("awarded_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_xp_transactions_created_week" ON "xp_transactions" USING btree ("user_id" timestamptz_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_xp_transactions_reference" ON "xp_transactions" USING btree ("reference_type" uuid_ops,"reference_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_xp_transactions_type" ON "xp_transactions" USING btree ("transaction_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_xp_transactions_user" ON "xp_transactions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_reading_progress_enrollment" ON "reading_progress" USING btree ("enrollment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_reading_progress_topic" ON "reading_progress" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_reading_progress_updated" ON "reading_progress" USING btree ("updated_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_reading_progress_user" ON "reading_progress" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_templates_active" ON "lab_templates" USING btree ("is_active" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_templates_difficulty" ON "lab_templates" USING btree ("difficulty_level" text_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_lab_instances_active_unique" ON "lab_instances" USING btree ("user_id" uuid_ops,"topic_id" uuid_ops) WHERE (status = 'active'::text);--> statement-breakpoint
CREATE INDEX "idx_lab_instances_enrollment" ON "lab_instances" USING btree ("enrollment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_instances_expires" ON "lab_instances" USING btree ("expires_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_instances_status" ON "lab_instances" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_instances_topic" ON "lab_instances" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_instances_user" ON "lab_instances" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_submissions_grader" ON "lab_submissions" USING btree ("graded_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_submissions_instance" ON "lab_submissions" USING btree ("lab_instance_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_submissions_pending" ON "lab_submissions" USING btree ("status" text_ops) WHERE (status = ANY (ARRAY['pending'::text, 'manual_review'::text]));--> statement-breakpoint
CREATE INDEX "idx_lab_submissions_status" ON "lab_submissions" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_submissions_topic" ON "lab_submissions" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lab_submissions_user" ON "lab_submissions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_capstone_submissions_course" ON "capstone_submissions" USING btree ("course_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_capstone_submissions_enrollment" ON "capstone_submissions" USING btree ("enrollment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_capstone_submissions_grader" ON "capstone_submissions" USING btree ("graded_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_capstone_submissions_status" ON "capstone_submissions" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_capstone_submissions_user" ON "capstone_submissions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_twin_events_org_role" ON "twin_events" USING btree ("org_id" uuid_ops,"target_role" uuid_ops,"processed" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_twin_events_source" ON "twin_events" USING btree ("source_user_id" timestamptz_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_twin_events_type" ON "twin_events" USING btree ("event_type" timestamptz_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_twin_events_unprocessed" ON "twin_events" USING btree ("org_id" uuid_ops,"processed" bool_ops,"priority" timestamptz_ops,"created_at" timestamptz_ops) WHERE (processed = false);--> statement-breakpoint
CREATE INDEX "idx_twin_conversations_initiator" ON "twin_conversations" USING btree ("initiator_role" text_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_twin_conversations_org" ON "twin_conversations" USING btree ("org_id" uuid_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_twin_conversations_responder" ON "twin_conversations" USING btree ("responder_role" text_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_quiz_questions_created_by" ON "quiz_questions" USING btree ("created_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_quiz_questions_difficulty" ON "quiz_questions" USING btree ("difficulty" text_ops);--> statement-breakpoint
CREATE INDEX "idx_quiz_questions_public" ON "quiz_questions" USING btree ("is_public" bool_ops) WHERE (is_public = true);--> statement-breakpoint
CREATE INDEX "idx_quiz_questions_text_search" ON "quiz_questions" USING gin (to_tsvector('english'::regconfig, question_text) tsvector_ops);--> statement-breakpoint
CREATE INDEX "idx_quiz_questions_topic" ON "quiz_questions" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_quiz_questions_type" ON "quiz_questions" USING btree ("question_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_quiz_settings_topic" ON "quiz_settings" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_org_context_cache_lookup" ON "org_context_cache" USING btree ("org_id" timestamptz_ops,"context_type" uuid_ops,"expires_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_org_standups_date" ON "org_standups" USING btree ("org_id" uuid_ops,"standup_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_peer_reviews_reviewer" ON "peer_reviews" USING btree ("reviewer_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_peer_reviews_submission" ON "peer_reviews" USING btree ("submission_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_mentor_chats_course_id" ON "ai_mentor_chats" USING btree ("course_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_mentor_chats_created_at" ON "ai_mentor_chats" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_mentor_chats_escalated" ON "ai_mentor_chats" USING btree ("escalated_to_trainer" bool_ops) WHERE (escalated_to_trainer = true);--> statement-breakpoint
CREATE INDEX "idx_ai_mentor_chats_flagged" ON "ai_mentor_chats" USING btree ("flagged_for_review" bool_ops) WHERE (flagged_for_review = true);--> statement-breakpoint
CREATE INDEX "idx_ai_mentor_chats_topic_id" ON "ai_mentor_chats" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_mentor_chats_user_id" ON "ai_mentor_chats" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_mentor_chats_prompt_variant" ON "ai_mentor_chats" USING btree ("prompt_variant_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_mentor_chats_question_hash" ON "ai_mentor_chats" USING btree ("question_hash" text_ops);--> statement-breakpoint
CREATE INDEX "idx_sequence_templates_channel" ON "sequence_templates" USING btree ("channel" text_ops);--> statement-breakpoint
CREATE INDEX "idx_sequence_templates_created_by" ON "sequence_templates" USING btree ("created_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_sequence_templates_is_active" ON "sequence_templates" USING btree ("is_active" bool_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_sequence_templates_org_id" ON "sequence_templates" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_mentor_rate_limits_user_id" ON "ai_mentor_rate_limits" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_mentor_sessions_last_message" ON "ai_mentor_sessions" USING btree ("last_message_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_ai_mentor_sessions_user_id" ON "ai_mentor_sessions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_permission_overrides_active" ON "permission_overrides" USING btree ("user_id" uuid_ops,"permission_id" uuid_ops) WHERE (revoked_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_permission_overrides_expires" ON "permission_overrides" USING btree ("expires_at" timestamptz_ops) WHERE (expires_at IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_permission_overrides_org" ON "permission_overrides" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_permission_overrides_user" ON "permission_overrides" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_sequences_campaign_id" ON "campaign_sequences" USING btree ("campaign_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_sequences_sequence_template_id" ON "campaign_sequences" USING btree ("sequence_template_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_api_tokens_active" ON "api_tokens" USING btree ("org_id" uuid_ops) WHERE (revoked_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_api_tokens_hash" ON "api_tokens" USING btree ("token_hash" text_ops);--> statement-breakpoint
CREATE INDEX "idx_api_tokens_org" ON "api_tokens" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_bulk_update_history_applied" ON "bulk_update_history" USING btree ("applied_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_bulk_update_history_org" ON "bulk_update_history" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_role_permissions_permission_id" ON "role_permissions" USING btree ("permission_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_role_permissions_role_id" ON "role_permissions" USING btree ("role_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_permissions_action" ON "permissions" USING btree ("action" text_ops);--> statement-breakpoint
CREATE INDEX "idx_permissions_code" ON "permissions" USING btree ("code" text_ops);--> statement-breakpoint
CREATE INDEX "idx_permissions_object_type" ON "permissions" USING btree ("object_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_question_patterns_hash" ON "ai_question_patterns" USING btree ("pattern_hash" text_ops);--> statement-breakpoint
CREATE INDEX "idx_question_patterns_occurrence" ON "ai_question_patterns" USING btree ("occurrence_count" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_question_patterns_topic" ON "ai_question_patterns" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flag_roles_flag" ON "feature_flag_roles" USING btree ("feature_flag_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flag_roles_role" ON "feature_flag_roles" USING btree ("role_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_badges_rarity" ON "badges" USING btree ("rarity" text_ops);--> statement-breakpoint
CREATE INDEX "idx_badges_trigger_type" ON "badges" USING btree ("trigger_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_user_badges_badge" ON "user_badges" USING btree ("badge_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_badges_earned" ON "user_badges" USING btree ("earned_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_user_badges_new" ON "user_badges" USING btree ("user_id" uuid_ops,"is_new" uuid_ops) WHERE (is_new = true);--> statement-breakpoint
CREATE INDEX "idx_user_badges_user" ON "user_badges" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_system_settings_category" ON "system_settings" USING btree ("category" text_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_states_terminal" ON "workflow_states" USING btree ("is_terminal" bool_ops) WHERE (is_terminal = true);--> statement-breakpoint
CREATE INDEX "idx_workflow_states_workflow_id" ON "workflow_states" USING btree ("workflow_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_transitions_action" ON "workflow_transitions" USING btree ("action" text_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_transitions_from_state" ON "workflow_transitions" USING btree ("from_state_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_transitions_workflow_id" ON "workflow_transitions" USING btree ("workflow_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_instances_current_state" ON "workflow_instances" USING btree ("current_state_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_instances_entity" ON "workflow_instances" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_instances_org_id" ON "workflow_instances" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_instances_status" ON "workflow_instances" USING btree ("status" text_ops) WHERE (status = 'active'::text);--> statement-breakpoint
CREATE INDEX "idx_workflow_instances_workflow_id" ON "workflow_instances" USING btree ("workflow_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_history_created_at" ON "workflow_history" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_history_instance_id" ON "workflow_history" USING btree ("workflow_instance_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_history_performed_by" ON "workflow_history" USING btree ("performed_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_file_uploads_bucket" ON "file_uploads" USING btree ("bucket" text_ops);--> statement-breakpoint
CREATE INDEX "idx_file_uploads_entity" ON "file_uploads" USING btree ("entity_type" text_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_file_uploads_not_deleted" ON "file_uploads" USING btree ("deleted_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_file_uploads_org_id" ON "file_uploads" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_file_uploads_uploaded_by" ON "file_uploads" USING btree ("uploaded_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_document_templates_active" ON "document_templates" USING btree ("is_active" bool_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_document_templates_category" ON "document_templates" USING btree ("category" text_ops);--> statement-breakpoint
CREATE INDEX "idx_document_templates_org_id" ON "document_templates" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_document_templates_type" ON "document_templates" USING btree ("template_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_generated_documents_entity" ON "generated_documents" USING btree ("entity_type" uuid_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_generated_documents_generated_at" ON "generated_documents" USING btree ("generated_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_generated_documents_org_id" ON "generated_documents" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_generated_documents_template_id" ON "generated_documents" USING btree ("template_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflows_active" ON "workflows" USING btree ("is_active" bool_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_workflows_definition_actions" ON "workflows" USING gin (((definition -> 'actions'::text)) jsonb_ops);--> statement-breakpoint
CREATE INDEX "idx_workflows_definition_triggers" ON "workflows" USING gin (((definition -> 'triggers'::text)) jsonb_ops);--> statement-breakpoint
CREATE INDEX "idx_workflows_entity_type" ON "workflows" USING btree ("entity_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_workflows_org_id" ON "workflows" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_email_logs_org_id" ON "email_logs" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_email_logs_resend_id" ON "email_logs" USING btree ("resend_id" text_ops) WHERE (resend_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_email_logs_sent_at" ON "email_logs" USING btree ("sent_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_email_logs_status" ON "email_logs" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_email_logs_template_id" ON "email_logs" USING btree ("template_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_email_logs_to_email" ON "email_logs" USING btree ("to_email" text_ops);--> statement-breakpoint
CREATE INDEX "idx_background_jobs_failed" ON "background_jobs" USING btree ("attempts" int4_ops,"created_at" timestamptz_ops) WHERE ((status = 'failed'::text) AND (attempts < max_attempts));--> statement-breakpoint
CREATE INDEX "idx_background_jobs_job_type" ON "background_jobs" USING btree ("job_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_background_jobs_org_id" ON "background_jobs" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_background_jobs_pending" ON "background_jobs" USING btree ("priority" int4_ops,"created_at" int4_ops) WHERE (status = 'pending'::text);--> statement-breakpoint
CREATE INDEX "idx_background_jobs_status" ON "background_jobs" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_pricing_plans_active" ON "pricing_plans" USING btree ("is_active" bool_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_pricing_plans_plan_type" ON "pricing_plans" USING btree ("plan_type" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_pricing_plans_slug" ON "pricing_plans" USING btree ("slug" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_discount_codes_active" ON "discount_codes" USING btree ("is_active" bool_ops,"valid_from" timestamptz_ops,"valid_until" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_discount_codes_code" ON "discount_codes" USING btree ("code" text_ops) WHERE ((deleted_at IS NULL) AND (is_active = true));--> statement-breakpoint
CREATE INDEX "idx_discount_codes_validity" ON "discount_codes" USING btree ("valid_from" timestamptz_ops,"valid_until" timestamptz_ops) WHERE ((deleted_at IS NULL) AND (is_active = true));--> statement-breakpoint
CREATE INDEX "idx_student_interventions_created" ON "student_interventions" USING btree ("created_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_student_interventions_enrollment" ON "student_interventions" USING btree ("enrollment_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_student_interventions_status" ON "student_interventions" USING btree ("status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_student_interventions_student" ON "student_interventions" USING btree ("student_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_student_interventions_trainer" ON "student_interventions" USING btree ("assigned_trainer_id" uuid_ops) WHERE ((deleted_at IS NULL) AND (status = ANY (ARRAY['pending'::text, 'in_progress'::text])));--> statement-breakpoint
CREATE INDEX "idx_enrollments_active" ON "student_enrollments" USING btree ("user_id" text_ops,"status" uuid_ops) WHERE (status = 'active'::text);--> statement-breakpoint
CREATE INDEX "idx_enrollments_course_id" ON "student_enrollments" USING btree ("course_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_enrollments_payment" ON "student_enrollments" USING btree ("payment_id" text_ops) WHERE (payment_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_enrollments_status" ON "student_enrollments" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_enrollments_user_id" ON "student_enrollments" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_student_enrollments_at_risk" ON "student_enrollments" USING btree ("is_at_risk" text_ops,"risk_level" bool_ops) WHERE (is_at_risk = true);--> statement-breakpoint
CREATE INDEX "idx_student_enrollments_enrolled_month" ON "student_enrollments" USING btree ("course_id" timestamptz_ops,"enrolled_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_discount_usage_code" ON "discount_code_usage" USING btree ("discount_code_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_discount_usage_enrollment" ON "discount_code_usage" USING btree ("enrollment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_discount_usage_user" ON "discount_code_usage" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_discount_usage_user_code" ON "discount_code_usage" USING btree ("user_id" uuid_ops,"discount_code_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_course_pricing_course" ON "course_pricing" USING btree ("course_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_course_pricing_early_bird" ON "course_pricing" USING btree ("early_bird_valid_until" timestamptz_ops) WHERE (early_bird_price IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_org_settings_category" ON "organization_settings" USING btree ("org_id" text_ops,"category" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_org_settings_org" ON "organization_settings" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contact_lead_data_contact_id" ON "contact_lead_data" USING btree ("contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contact_lead_data_status" ON "contact_lead_data" USING btree ("lead_status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_comments_author" ON "comments" USING btree ("author_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_comments_created" ON "comments" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_comments_entity" ON "comments" USING btree ("entity_type" uuid_ops,"entity_id" text_ops) WHERE (NOT is_deleted);--> statement-breakpoint
CREATE INDEX "idx_comments_org" ON "comments" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_comments_parent" ON "comments" USING btree ("parent_comment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_tasks_completed" ON "lead_tasks" USING btree ("completed" bool_ops) WHERE (NOT completed);--> statement-breakpoint
CREATE INDEX "idx_lead_tasks_due_date" ON "lead_tasks" USING btree ("due_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_tasks_lead_id" ON "lead_tasks" USING btree ("lead_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_tasks_org_id" ON "lead_tasks" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_notifications_created" ON "notifications" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_notifications_entity" ON "notifications" USING btree ("entity_type" text_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_notifications_org" ON "notifications" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_notifications_type" ON "notifications" USING btree ("notification_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_notifications_user" ON "notifications" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_notifications_user_unread" ON "notifications" USING btree ("user_id" uuid_ops,"is_read" uuid_ops) WHERE ((NOT is_read) AND (NOT is_archived));--> statement-breakpoint
CREATE INDEX "idx_tasks_assigned" ON "tasks" USING btree ("assigned_to" text_ops,"status" text_ops) WHERE (status = ANY (ARRAY['todo'::text, 'in_progress'::text]));--> statement-breakpoint
CREATE INDEX "idx_tasks_assignee" ON "tasks" USING btree ("assigned_to" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_tasks_created_by" ON "tasks" USING btree ("created_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_tasks_due" ON "tasks" USING btree ("due_date" date_ops) WHERE (status = ANY (ARRAY['todo'::text, 'in_progress'::text]));--> statement-breakpoint
CREATE INDEX "idx_tasks_entity" ON "tasks" USING btree ("entity_type" uuid_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_tasks_org" ON "tasks" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_tasks_status" ON "tasks" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_org_branding_org" ON "organization_branding" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contracts_company" ON "company_contracts" USING btree ("company_id" uuid_ops,"status" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contracts_expiration" ON "company_contracts" USING btree ("expiration_date" date_ops) WHERE ((status = 'active'::contract_status) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_rate_cards_company" ON "company_rate_cards" USING btree ("company_id" uuid_ops,"status" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_rate_card_items_card" ON "company_rate_card_items" USING btree ("rate_card_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_health_scores_company" ON "company_health_scores" USING btree ("company_id" date_ops,"score_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_health_scores_date" ON "company_health_scores" USING btree ("org_id" date_ops,"score_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_company_metrics_lookup" ON "company_metrics" USING btree ("company_id" date_ops,"period_type" date_ops,"period_start" date_ops);--> statement-breakpoint
CREATE INDEX "idx_company_revenue_company" ON "company_revenue" USING btree ("company_id" date_ops,"revenue_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_date" ON "activity_log" USING btree ("activity_date" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_entity" ON "activity_log" USING btree ("entity_type" text_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_log_activity_date" ON "activity_log" USING btree ("activity_date" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_log_entity" ON "activity_log" USING btree ("entity_type" text_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_log_org_id" ON "activity_log" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_log_performed_by" ON "activity_log" USING btree ("performed_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_org" ON "activity_log" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_owner" ON "activity_log" USING btree ("performed_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_poc" ON "activity_log" USING btree ("poc_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_engagement_contact" ON "engagement_tracking" USING btree ("campaign_contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_engagement_timestamp" ON "engagement_tracking" USING btree ("event_timestamp" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_engagement_type" ON "engagement_tracking" USING btree ("event_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_id_number" ON "employee_metadata" USING btree ("employee_id_number" text_ops) WHERE (employee_id_number IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_employee_metadata_pod" ON "employee_metadata" USING btree ("pod_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_skills_candidate" ON "candidate_skills" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_skills_contact_id" ON "candidate_skills" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_skills_primary" ON "candidate_skills" USING btree ("candidate_id" uuid_ops) WHERE (is_primary = true);--> statement-breakpoint
CREATE INDEX "idx_candidate_skills_proficiency" ON "candidate_skills" USING btree ("proficiency_level" text_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_skills_skill" ON "candidate_skills" USING btree ("skill_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pods_active" ON "pods" USING btree ("is_active" bool_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_pods_manager_id" ON "pods" USING btree ("manager_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pods_members" ON "pods" USING btree ("senior_member_id" uuid_ops,"junior_member_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pods_org" ON "pods" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pods_region_id" ON "pods" USING btree ("region_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pods_type" ON "pods" USING btree ("pod_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_session_context_role" ON "user_session_context" USING btree ("active_role" text_ops);--> statement-breakpoint
CREATE INDEX "idx_session_context_started" ON "user_session_context" USING btree ("session_started_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_session_context_user" ON "user_session_context" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_managers_active" ON "pod_managers" USING btree ("pod_id" uuid_ops) WHERE (removed_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_pod_managers_org" ON "pod_managers" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_managers_org_id" ON "pod_managers" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_managers_pod" ON "pod_managers" USING btree ("pod_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_managers_pod_id" ON "pod_managers" USING btree ("pod_id" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_pod_managers_primary" ON "pod_managers" USING btree ("pod_id" uuid_ops) WHERE ((is_primary = true) AND (removed_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_pod_managers_user" ON "pod_managers" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_managers_user_id" ON "pod_managers" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_strategies_lead" ON "lead_strategies" USING btree ("lead_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_strategies_org" ON "lead_strategies" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_talking_point_templates_org" ON "talking_point_templates" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_payroll_items_employee" ON "payroll_items" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_payroll_items_run" ON "payroll_items" USING btree ("payroll_run_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_time_attendance_date" ON "time_attendance" USING btree ("date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_time_attendance_employee" ON "time_attendance" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_time_attendance_status" ON "time_attendance" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_payroll_runs_org" ON "payroll_runs" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_payroll_runs_pay_date" ON "payroll_runs" USING btree ("pay_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_payroll_runs_period" ON "payroll_runs" USING btree ("period_start_date" date_ops,"period_end_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_payroll_runs_status" ON "payroll_runs" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_reviews_cycle" ON "performance_reviews" USING btree ("review_cycle" text_ops);--> statement-breakpoint
CREATE INDEX "idx_reviews_employee" ON "performance_reviews" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_reviews_org" ON "performance_reviews" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_reviews_reviewer" ON "performance_reviews" USING btree ("reviewer_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_reviews_status" ON "performance_reviews" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_import_jobs_created_at" ON "import_jobs" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_import_jobs_created_by" ON "import_jobs" USING btree ("created_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_import_jobs_org" ON "import_jobs" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_import_jobs_status" ON "import_jobs" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_export_jobs_created_at" ON "export_jobs" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_export_jobs_next_run" ON "export_jobs" USING btree ("next_run_at" timestamptz_ops) WHERE (is_scheduled = true);--> statement-breakpoint
CREATE INDEX "idx_export_jobs_org" ON "export_jobs" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_export_jobs_scheduled" ON "export_jobs" USING btree ("is_scheduled" bool_ops) WHERE (is_scheduled = true);--> statement-breakpoint
CREATE INDEX "idx_export_jobs_status" ON "export_jobs" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_gdpr_requests_due_date" ON "gdpr_requests" USING btree ("due_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_gdpr_requests_email" ON "gdpr_requests" USING btree ("subject_email" text_ops);--> statement-breakpoint
CREATE INDEX "idx_gdpr_requests_org" ON "gdpr_requests" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_gdpr_requests_status" ON "gdpr_requests" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_gdpr_requests_type" ON "gdpr_requests" USING btree ("request_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_duplicate_records_confidence" ON "duplicate_records" USING btree ("confidence_score" numeric_ops);--> statement-breakpoint
CREATE INDEX "idx_duplicate_records_entity" ON "duplicate_records" USING btree ("entity_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_duplicate_records_org" ON "duplicate_records" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_duplicate_records_status" ON "duplicate_records" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_duplicate_rules_entity" ON "duplicate_rules" USING btree ("entity_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_duplicate_rules_org" ON "duplicate_rules" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_archived_records_archived_at" ON "archived_records" USING btree ("archived_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_archived_records_entity" ON "archived_records" USING btree ("entity_type" uuid_ops,"original_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_archived_records_org" ON "archived_records" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_retention_policies_entity" ON "retention_policies" USING btree ("entity_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_retention_policies_org" ON "retention_policies" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_resumes_candidate_id" ON "candidate_resumes" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_resumes_contact_id" ON "candidate_resumes" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_resumes_is_latest" ON "candidate_resumes" USING btree ("candidate_id" uuid_ops,"is_latest" uuid_ops) WHERE (is_latest = true);--> statement-breakpoint
CREATE INDEX "idx_candidate_resumes_not_archived" ON "candidate_resumes" USING btree ("candidate_id" uuid_ops) WHERE (is_archived = false);--> statement-breakpoint
CREATE INDEX "idx_candidate_resumes_org_id" ON "candidate_resumes" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_resumes_resume_type" ON "candidate_resumes" USING btree ("resume_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_active" ON "user_profiles" USING btree ("is_active" bool_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_auth" ON "user_profiles" USING btree ("auth_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_auth_id" ON "user_profiles" USING btree ("auth_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_auth_lookup" ON "user_profiles" USING btree ("auth_id" uuid_ops,"org_id" text_ops,"email" text_ops) WHERE ((deleted_at IS NULL) AND (is_active = true));--> statement-breakpoint
CREATE INDEX "idx_user_profiles_candidate_skills" ON "user_profiles" USING gin ("candidate_skills" array_ops) WHERE ((candidate_skills IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_user_profiles_candidate_status" ON "user_profiles" USING btree ("candidate_status" text_ops) WHERE ((candidate_status IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_user_profiles_client_tier" ON "user_profiles" USING btree ("client_tier" text_ops) WHERE ((client_tier IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_user_profiles_created_at" ON "user_profiles" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_email" ON "user_profiles" USING btree ("email" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_employee_department" ON "user_profiles" USING btree ("employee_department" text_ops) WHERE ((employee_department IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_user_profiles_employee_role" ON "user_profiles" USING btree ("employee_role" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_last_login" ON "user_profiles" USING btree ("last_login_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_leaderboard_visible" ON "user_profiles" USING btree ("leaderboard_visible" bool_ops) WHERE (leaderboard_visible = true);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_manager" ON "user_profiles" USING btree ("manager_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_not_deleted" ON "user_profiles" USING btree ("id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_org" ON "user_profiles" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_org_id" ON "user_profiles" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_org_id_active" ON "user_profiles" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_role" ON "user_profiles" USING btree ("role_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_search" ON "user_profiles" USING gin ("search_vector" tsvector_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_status" ON "user_profiles" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_stripe_customer" ON "user_profiles" USING btree ("stripe_customer_id" text_ops) WHERE (stripe_customer_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_user_profiles_updated_at" ON "user_profiles" USING btree ("updated_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_bgc_candidate" ON "candidate_background_checks" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_bgc_org" ON "candidate_background_checks" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_background_checks_contact_id" ON "candidate_background_checks" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_certifications_contact_id" ON "candidate_certifications" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_certifications_candidate" ON "candidate_certifications" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_certifications_org" ON "candidate_certifications" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_compliance_documents_contact_id" ON "candidate_compliance_documents" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_compliance_docs_candidate" ON "candidate_compliance_documents" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_compliance_docs_org" ON "candidate_compliance_documents" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_object_owners_entity" ON "object_owners" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_object_owners_is_primary" ON "object_owners" USING btree ("is_primary" bool_ops) WHERE (is_primary = true);--> statement-breakpoint
CREATE INDEX "idx_object_owners_org" ON "object_owners" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_object_owners_org_id" ON "object_owners" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_object_owners_permission" ON "object_owners" USING btree ("permission" text_ops);--> statement-breakpoint
CREATE INDEX "idx_object_owners_primary" ON "object_owners" USING btree ("entity_type" text_ops,"entity_id" text_ops) WHERE (is_primary = true);--> statement-breakpoint
CREATE INDEX "idx_object_owners_role" ON "object_owners" USING btree ("role" text_ops);--> statement-breakpoint
CREATE INDEX "idx_object_owners_user" ON "object_owners" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_object_owners_user_id" ON "object_owners" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_education_contact_id" ON "candidate_education" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_education_candidate" ON "candidate_education" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_education_org" ON "candidate_education" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_references_contact_id" ON "candidate_references" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_references_candidate" ON "candidate_references" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_references_org" ON "candidate_references" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_work_authorizations_contact_id" ON "candidate_work_authorizations" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_work_auth_candidate" ON "candidate_work_authorizations" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_work_auth_country" ON "candidate_work_authorizations" USING btree ("country_code" text_ops);--> statement-breakpoint
CREATE INDEX "idx_work_auth_expiry" ON "candidate_work_authorizations" USING btree ("expiry_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_work_auth_org" ON "candidate_work_authorizations" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_work_auth_status" ON "candidate_work_authorizations" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_regions_is_active" ON "regions" USING btree ("is_active" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_regions_manager_id" ON "regions" USING btree ("manager_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_regions_org_id" ON "regions" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_members_is_active" ON "pod_members" USING btree ("is_active" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_members_org_id" ON "pod_members" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_members_pod_id" ON "pod_members" USING btree ("pod_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_members_user_id" ON "pod_members" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_skills_job_id" ON "job_skills" USING btree ("job_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_skills_skill_id" ON "job_skills" USING btree ("skill_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_system_roles_category" ON "system_roles" USING btree ("category" text_ops);--> statement-breakpoint
CREATE INDEX "idx_system_roles_code" ON "system_roles" USING btree ("code" text_ops);--> statement-breakpoint
CREATE INDEX "idx_system_roles_pod_type" ON "system_roles" USING btree ("pod_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_job_requirements_job_id" ON "job_requirements" USING btree ("job_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_rates_job_id" ON "job_rates" USING btree ("job_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_assignments_job_id" ON "job_assignments" USING btree ("job_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_assignments_user_id" ON "job_assignments" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_screening_questions_job_id" ON "job_screening_questions" USING btree ("job_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_documents_candidate_id" ON "candidate_documents" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_documents_contact_id" ON "candidate_documents" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_profiles_contact_id" ON "candidate_profiles" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_preferences_contact_id" ON "candidate_preferences" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_availability_contact_id" ON "candidate_availability" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_submission_screening_answers_submission_id" ON "submission_screening_answers" USING btree ("submission_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submission_notes_submission_id" ON "submission_notes" USING btree ("submission_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_marketing_templates_org_id" ON "marketing_templates" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_hotlist_consultants_consultant_id" ON "hotlist_consultants" USING btree ("consultant_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_hotlist_consultants_hotlist_id" ON "hotlist_consultants" USING btree ("hotlist_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_events_actor_id" ON "events" USING btree ("actor_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_events_aggregate_id" ON "events" USING btree ("aggregate_id" uuid_ops) WHERE (aggregate_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_events_correlation_id" ON "events" USING btree ("correlation_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_events_created_at" ON "events" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_events_entity_type_id" ON "events" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_events_event_category" ON "events" USING btree ("event_category" text_ops);--> statement-breakpoint
CREATE INDEX "idx_events_event_type" ON "events" USING btree ("event_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_events_idempotency_key" ON "events" USING btree ("idempotency_key" text_ops);--> statement-breakpoint
CREATE INDEX "idx_events_next_retry" ON "events" USING btree ("next_retry_at" timestamptz_ops) WHERE (next_retry_at IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_events_occurred_at" ON "events" USING btree ("occurred_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_events_org_id" ON "events" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_events_status" ON "events" USING btree ("status" text_ops) WHERE (status = ANY (ARRAY['pending'::text, 'processing'::text, 'failed'::text]));--> statement-breakpoint
CREATE INDEX "idx_events_user_id" ON "events" USING btree ("user_id" uuid_ops) WHERE (user_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_event_subscriptions_channel" ON "event_subscriptions" USING btree ("channel" text_ops);--> statement-breakpoint
CREATE INDEX "idx_event_subscriptions_failure_count" ON "event_subscriptions" USING btree ("failure_count" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_event_subscriptions_is_active" ON "event_subscriptions" USING btree ("is_active" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_event_subscriptions_org_id" ON "event_subscriptions" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_event_subscriptions_unique" ON "event_subscriptions" USING btree ("subscriber_name" text_ops,"event_pattern" text_ops);--> statement-breakpoint
CREATE INDEX "idx_event_subscriptions_user_id" ON "event_subscriptions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_skill_aliases_skill_id" ON "skill_aliases" USING btree ("skill_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submission_status_history_submission_id" ON "submission_status_history" USING btree ("submission_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_interview_feedback_interview_id" ON "interview_feedback" USING btree ("interview_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_interview_reminders_interview_id" ON "interview_reminders" USING btree ("interview_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_offer_terms_offer_id" ON "offer_terms" USING btree ("offer_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_timesheets_placement_id" ON "placement_timesheets" USING btree ("placement_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_timesheets_week_ending" ON "placement_timesheets" USING btree ("week_ending" date_ops);--> statement-breakpoint
CREATE INDEX "idx_consultant_visa_details_alert_level" ON "consultant_visa_details" USING btree ("alert_level" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_consultant_visa_details_consultant_id" ON "consultant_visa_details" USING btree ("consultant_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_consultant_work_auth_consultant_id" ON "consultant_work_authorization" USING btree ("consultant_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_consultant_availability_consultant_id" ON "consultant_availability" USING btree ("consultant_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_consultant_rates_consultant_id" ON "consultant_rates" USING btree ("consultant_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_marketing_profiles_consultant_id" ON "marketing_profiles" USING btree ("consultant_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_marketing_formats_profile_id" ON "marketing_formats" USING btree ("profile_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_vendor_relationships_related_entity" ON "vendor_relationships" USING btree ("related_entity_type" text_ops,"related_entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_vendor_relationships_vendor_id" ON "vendor_relationships" USING btree ("vendor_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_vendor_blacklist_vendor_id" ON "vendor_blacklist" USING btree ("vendor_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_company_team_company" ON "company_team" USING btree ("company_id" uuid_ops) WHERE (removed_at IS NULL);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_company_team_unique" ON "company_team" USING btree ("company_id" enum_ops,"user_id" enum_ops,"role" enum_ops) WHERE (removed_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_company_team_user" ON "company_team" USING btree ("user_id" uuid_ops) WHERE (removed_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_company_contacts_company" ON "company_contacts" USING btree ("company_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_company_contacts_contact" ON "company_contacts" USING btree ("contact_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_company_contacts_unique" ON "company_contacts" USING btree ("company_id" uuid_ops,"contact_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_company_relationships_a" ON "company_relationships" USING btree ("company_a_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_company_relationships_b" ON "company_relationships" USING btree ("company_b_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_company_relationships_unique" ON "company_relationships" USING btree ("company_a_id" enum_ops,"company_b_id" uuid_ops,"relationship_category" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_immigration_timelines_case_id" ON "immigration_timelines" USING btree ("case_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_immigration_attorneys_org_id" ON "immigration_attorneys" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_immigration_documents_case_id" ON "immigration_documents" USING btree ("case_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_immigration_alerts_alert_date" ON "immigration_alerts" USING btree ("alert_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_immigration_alerts_consultant_id" ON "immigration_alerts" USING btree ("consultant_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_immigration_alerts_severity" ON "immigration_alerts" USING btree ("severity" text_ops);--> statement-breakpoint
CREATE INDEX "idx_company_addresses_company" ON "company_addresses" USING btree ("company_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_company_addresses_unique" ON "company_addresses" USING btree ("company_id" uuid_ops,"address_id" text_ops,"address_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_company_notes_company" ON "company_notes" USING btree ("company_id" timestamptz_ops,"created_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_job_order_submissions_consultant_id" ON "external_job_order_submissions" USING btree ("consultant_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_order_submissions_order_id" ON "external_job_order_submissions" USING btree ("order_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_company_tags_company" ON "company_tags" USING btree ("company_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_company_tags_name" ON "company_tags" USING btree ("org_id" text_ops,"tag_name" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_company_tags_unique" ON "company_tags" USING btree ("company_id" uuid_ops,"tag_name" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_benefit_plan_options_plan_id" ON "benefit_plan_options" USING btree ("plan_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_integrations_org_id" ON "integrations" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_integrations_org_primary" ON "integrations" USING btree ("org_id" uuid_ops,"type" bool_ops,"is_primary" bool_ops) WHERE ((is_primary = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_integrations_org_type" ON "integrations" USING btree ("org_id" uuid_ops,"type" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_integrations_status" ON "integrations" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_integrations_type" ON "integrations" USING btree ("type" text_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_integrations_unique_primary" ON "integrations" USING btree ("org_id" text_ops,"type" uuid_ops) WHERE ((is_primary = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_health_logs_created" ON "integration_health_logs" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_health_logs_integration" ON "integration_health_logs" USING btree ("integration_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_health_logs_org" ON "integration_health_logs" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_health_logs_status" ON "integration_health_logs" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_external_job_orders_org" ON "external_job_orders" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_external_job_orders_status" ON "external_job_orders" USING btree ("org_id" enum_ops,"status" enum_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_external_job_orders_vendor_company" ON "external_job_orders" USING btree ("vendor_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_job_orders_org_id" ON "external_job_orders" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_orders_priority" ON "external_job_orders" USING btree ("priority" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_job_orders_status" ON "external_job_orders" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_job_orders_vendor_id" ON "external_job_orders" USING btree ("vendor_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_stages_history_deal_id" ON "deal_stages_history" USING btree ("deal_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_stages_history_entered_at" ON "deal_stages_history" USING btree ("entered_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_stages_history_stage" ON "deal_stages_history" USING btree ("stage" text_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_stakeholders_contact_id" ON "deal_stakeholders" USING btree ("contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_stakeholders_deal_id" ON "deal_stakeholders" USING btree ("deal_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_stakeholders_role" ON "deal_stakeholders" USING btree ("role" text_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_scores_lead_id" ON "lead_scores" USING btree ("lead_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_scores_score" ON "lead_scores" USING btree ("score" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_qualification_lead_id" ON "lead_qualification" USING btree ("lead_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_qualification_status" ON "lead_qualification" USING btree ("qualification_status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_candidate_work_history_contact_id" ON "candidate_work_history" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_work_history_candidate" ON "candidate_work_history" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_work_history_org" ON "candidate_work_history" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_touchpoints_date" ON "lead_touchpoints" USING btree ("touchpoint_date" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_touchpoints_lead_id" ON "lead_touchpoints" USING btree ("lead_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_lead_touchpoints_type" ON "lead_touchpoints" USING btree ("touchpoint_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_competitors_deal_id" ON "deal_competitors" USING btree ("deal_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_competitors_name" ON "deal_competitors" USING btree ("competitor_name" text_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_competitors_status" ON "deal_competitors" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_products_deal_id" ON "deal_products" USING btree ("deal_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deal_products_type" ON "deal_products" USING btree ("product_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_employees_deleted_at" ON "employees" USING btree ("deleted_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_employees_manager_id" ON "employees" USING btree ("manager_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employees_org_id" ON "employees" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employees_status" ON "employees" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_employees_user_id" ON "employees" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_documents_employee_id" ON "employee_documents" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_documents_status" ON "employee_documents" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_documents_type" ON "employee_documents" USING btree ("document_type" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_time_off_dates" ON "employee_time_off" USING btree ("start_date" date_ops,"end_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_time_off_employee_id" ON "employee_time_off" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_time_off_status" ON "employee_time_off" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_benefit_plans_org_id" ON "benefit_plans" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_benefit_plans_status" ON "benefit_plans" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_benefit_plans_type" ON "benefit_plans" USING btree ("type" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_benefits_employee_id" ON "employee_benefits" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_benefits_plan_option_id" ON "employee_benefits" USING btree ("plan_option_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_benefits_status" ON "employee_benefits" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_benefit_dependents_employee_benefit_id" ON "benefit_dependents" USING btree ("employee_benefit_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_raci_change_log_changed_at" ON "raci_change_log" USING btree ("changed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_raci_change_log_entity" ON "raci_change_log" USING btree ("entity_type" text_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_compliance_employee_id" ON "employee_compliance" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_compliance_requirement_id" ON "employee_compliance" USING btree ("requirement_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_compliance_status" ON "employee_compliance" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_i9_records_employee_id" ON "i9_records" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_i9_records_status" ON "i9_records" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_compliance_requirements_active" ON "legacy_compliance_requirements" USING btree ("is_active" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_compliance_requirements_org_id" ON "legacy_compliance_requirements" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_compliance_requirements_type" ON "legacy_compliance_requirements" USING btree ("type" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_performance_goals_employee_id" ON "performance_goals" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_performance_goals_review_id" ON "performance_goals" USING btree ("review_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_performance_goals_status" ON "performance_goals" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_performance_feedback_review_id" ON "performance_feedback" USING btree ("review_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_performance_feedback_type" ON "performance_feedback" USING btree ("feedback_type" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_pattern_successors_pattern" ON "activity_pattern_successors" USING btree ("pattern_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workplan_templates_entity" ON "workplan_templates" USING btree ("entity_type" bool_ops,"is_active" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_workplan_templates_trigger" ON "workplan_templates" USING btree ("entity_type" text_ops,"trigger_event" text_ops,"trigger_status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_workplan_instances_entity" ON "workplan_instances" USING btree ("entity_type" text_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workplan_instances_status" ON "workplan_instances" USING btree ("org_id" uuid_ops,"status" uuid_ops);--> statement-breakpoint
CREATE INDEX "workplan_instances_entity_idx" ON "workplan_instances" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "workplan_instances_status_idx" ON "workplan_instances" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_workplan_activities_template" ON "workplan_template_activities" USING btree ("template_id" int4_ops,"order_index" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_participants_activity_idx" ON "activity_participants" USING btree ("activity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_participants_user_idx" ON "activity_participants" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_comments_activity_idx" ON "activity_comments" USING btree ("activity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_attachments_activity_idx" ON "activity_attachments" USING btree ("activity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_reminders_activity_idx" ON "activity_reminders" USING btree ("activity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_reminders_remind_at_idx" ON "activity_reminders" USING btree ("remind_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_sprint_metrics_active" ON "pod_sprint_metrics" USING btree ("pod_id" uuid_ops) WHERE (status = 'active'::text);--> statement-breakpoint
CREATE INDEX "idx_pod_sprint_metrics_dates" ON "pod_sprint_metrics" USING btree ("sprint_start_date" date_ops,"sprint_end_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_sprint_metrics_org_id" ON "pod_sprint_metrics" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pod_sprint_metrics_pod_id" ON "pod_sprint_metrics" USING btree ("pod_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_time_entries_activity_idx" ON "activity_time_entries" USING btree ("activity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_time_entries_user_idx" ON "activity_time_entries" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_dependencies_activity_idx" ON "activity_dependencies" USING btree ("activity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_auto_rules_event_type_idx" ON "activity_auto_rules" USING btree ("event_type" text_ops);--> statement-breakpoint
CREATE INDEX "activity_history_activity_idx" ON "activity_history" USING btree ("activity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_history_changed_at_idx" ON "activity_history" USING btree ("changed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_history_activity" ON "activity_history" USING btree ("activity_id" timestamptz_ops,"changed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_addresses_country" ON "addresses" USING btree ("country_code" text_ops);--> statement-breakpoint
CREATE INDEX "idx_addresses_entity" ON "addresses" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_addresses_entity_lookup" ON "addresses" USING btree ("entity_type" uuid_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_addresses_org" ON "addresses" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_addresses_org_city_state" ON "addresses" USING btree ("org_id" text_ops,"city" uuid_ops,"state_province" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_addresses_primary" ON "addresses" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops,"is_primary" uuid_ops) WHERE (is_primary = true);--> statement-breakpoint
CREATE INDEX "idx_addresses_type" ON "addresses" USING btree ("org_id" text_ops,"address_type" text_ops);--> statement-breakpoint
CREATE INDEX "queue_items_entity_idx" ON "queue_items" USING btree ("entity_type" uuid_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "queue_items_queue_idx" ON "queue_items" USING btree ("queue_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "queue_items_status_idx" ON "queue_items" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "sla_instances_activity_idx" ON "sla_instances" USING btree ("activity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "sla_instances_status_idx" ON "sla_instances" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "sla_instances_target_time_idx" ON "sla_instances" USING btree ("target_time" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "bulk_activity_jobs_created_by_idx" ON "bulk_activity_jobs" USING btree ("created_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "bulk_activity_jobs_status_idx" ON "bulk_activity_jobs" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "activity_metrics_date_idx" ON "activity_metrics" USING btree ("metric_date" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "activity_metrics_pod_idx" ON "activity_metrics" USING btree ("pod_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activity_metrics_user_idx" ON "activity_metrics" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "team_metrics_date_idx" ON "team_metrics" USING btree ("metric_date" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "team_metrics_pod_idx" ON "team_metrics" USING btree ("pod_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_paths_deleted_at" ON "learning_paths" USING btree ("deleted_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_learning_paths_difficulty" ON "learning_paths" USING btree ("difficulty" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_paths_slug" ON "learning_paths" USING btree ("slug" text_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_paths_status" ON "learning_paths" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_path_courses_course_id" ON "learning_path_courses" USING btree ("course_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_path_courses_path_id" ON "learning_path_courses" USING btree ("path_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_path_courses_sequence" ON "learning_path_courses" USING btree ("sequence" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_path_enrollments_path_id" ON "path_enrollments" USING btree ("path_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_path_enrollments_status" ON "path_enrollments" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_path_enrollments_user_id" ON "path_enrollments" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_certificates_certificate_number" ON "certificates" USING btree ("certificate_number" text_ops);--> statement-breakpoint
CREATE INDEX "idx_certificates_enrollment_id" ON "certificates" USING btree ("enrollment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_certificates_verification_code" ON "certificates" USING btree ("verification_code" text_ops);--> statement-breakpoint
CREATE INDEX "idx_certificate_templates_active" ON "certificate_templates" USING btree ("is_active" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_user_levels_current_level" ON "user_levels" USING btree ("current_level" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_user_levels_current_xp" ON "user_levels" USING btree ("current_xp" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_user_achievements_achievement_id" ON "user_achievements" USING btree ("achievement_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_achievements_unlocked_at" ON "user_achievements" USING btree ("unlocked_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_user_achievements_user_id" ON "user_achievements" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_achievements_category" ON "achievements" USING btree ("category" text_ops);--> statement-breakpoint
CREATE INDEX "idx_achievements_is_secret" ON "achievements" USING btree ("is_secret" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_achievements_slug" ON "achievements" USING btree ("slug" text_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_streaks_current_count" ON "learning_streaks" USING btree ("current_count" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_streaks_last_activity_date" ON "learning_streaks" USING btree ("last_activity_date" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_streaks_streak_type" ON "learning_streaks" USING btree ("streak_type" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_learning_streaks_user_id" ON "learning_streaks" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_leaderboards_period" ON "leaderboards" USING btree ("period_start" timestamptz_ops,"period_end" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_leaderboards_scope" ON "leaderboards" USING btree ("scope" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_leaderboards_type" ON "leaderboards" USING btree ("type" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_leaderboard_entries_leaderboard_id" ON "leaderboard_entries" USING btree ("leaderboard_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_leaderboard_entries_rank" ON "leaderboard_entries" USING btree ("rank" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_leaderboard_entries_user_id" ON "leaderboard_entries" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_leaderboard_entries_xp_earned" ON "leaderboard_entries" USING btree ("xp_earned" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_level_definitions_xp_required" ON "level_definitions" USING btree ("xp_required" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_login_history_created" ON "login_history" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_login_history_email" ON "login_history" USING btree ("email" text_ops);--> statement-breakpoint
CREATE INDEX "idx_login_history_org_id" ON "login_history" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_login_history_success" ON "login_history" USING btree ("success" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_login_history_user_id" ON "login_history" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_invitations_email" ON "user_invitations" USING btree ("email" text_ops);--> statement-breakpoint
CREATE INDEX "idx_user_invitations_expires" ON "user_invitations" USING btree ("expires_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_user_invitations_invited_by" ON "user_invitations" USING btree ("invited_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_invitations_org" ON "user_invitations" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_user_invitations_status" ON "user_invitations" USING btree ("accepted_at" timestamptz_ops,"cancelled_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_user_invitations_token" ON "user_invitations" USING btree ("token" text_ops);--> statement-breakpoint
CREATE INDEX "idx_webhooks_events" ON "webhooks" USING gin ("events" array_ops);--> statement-breakpoint
CREATE INDEX "idx_webhooks_org_id" ON "webhooks" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_webhooks_status" ON "webhooks" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_webhook_deliveries_created" ON "webhook_deliveries" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_webhook_deliveries_dlq" ON "webhook_deliveries" USING btree ("org_id" text_ops,"status" uuid_ops) WHERE ((status)::text = 'dlq'::text);--> statement-breakpoint
CREATE INDEX "idx_webhook_deliveries_next_retry" ON "webhook_deliveries" USING btree ("next_retry_at" timestamptz_ops) WHERE (((status)::text = 'retrying'::text) AND (next_retry_at IS NOT NULL));--> statement-breakpoint
CREATE INDEX "idx_webhook_deliveries_org" ON "webhook_deliveries" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_webhook_deliveries_status" ON "webhook_deliveries" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_webhook_deliveries_webhook" ON "webhook_deliveries" USING btree ("webhook_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_oauth_tokens_expires" ON "integration_oauth_tokens" USING btree ("expires_at" timestamptz_ops) WHERE ((status)::text = 'active'::text);--> statement-breakpoint
CREATE INDEX "idx_oauth_tokens_integration" ON "integration_oauth_tokens" USING btree ("integration_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_oauth_tokens_org" ON "integration_oauth_tokens" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_oauth_tokens_unique_integration" ON "integration_oauth_tokens" USING btree ("integration_id" uuid_ops) WHERE ((status)::text = 'active'::text);--> statement-breakpoint
CREATE INDEX "idx_failover_config_backup" ON "integration_failover_config" USING btree ("backup_integration_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_failover_config_org" ON "integration_failover_config" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_failover_config_primary" ON "integration_failover_config" USING btree ("primary_integration_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activities_activity_type_idx" ON "activities" USING btree ("activity_type" text_ops);--> statement-breakpoint
CREATE INDEX "activities_assigned_to_idx" ON "activities" USING btree ("assigned_to" uuid_ops);--> statement-breakpoint
CREATE INDEX "activities_due_date_idx" ON "activities" USING btree ("due_date" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "activities_entity_idx" ON "activities" USING btree ("entity_type" text_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "activities_pattern_idx" ON "activities" USING btree ("pattern_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "activities_status_idx" ON "activities" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "activities_workplan_instance_idx" ON "activities" USING btree ("workplan_instance_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_activity_number" ON "activities" USING btree ("activity_number" text_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_assigned" ON "activities" USING btree ("assigned_to" text_ops,"status" text_ops) WHERE (status = ANY (ARRAY['open'::text, 'in_progress'::text]));--> statement-breakpoint
CREATE INDEX "idx_activities_assigned_to" ON "activities" USING btree ("assigned_to" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_due" ON "activities" USING btree ("due_date" timestamptz_ops) WHERE (status = ANY (ARRAY['open'::text, 'in_progress'::text]));--> statement-breakpoint
CREATE INDEX "idx_activities_due_date" ON "activities" USING btree ("due_date" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_entity" ON "activities" USING btree ("entity_type" text_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_entity_timeline" ON "activities" USING btree ("entity_type" timestamptz_ops,"entity_id" text_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_escalation" ON "activities" USING btree ("escalation_date" timestamptz_ops) WHERE ((status = 'open'::text) AND (escalation_date IS NOT NULL));--> statement-breakpoint
CREATE INDEX "idx_activities_follow_up" ON "activities" USING btree ("follow_up_required" timestamptz_ops,"follow_up_date" bool_ops) WHERE ((follow_up_required = true) AND (status = ANY (ARRAY['open'::text, 'in_progress'::text])));--> statement-breakpoint
CREATE INDEX "idx_activities_follow_up_date" ON "activities" USING btree ("follow_up_date" timestamptz_ops) WHERE (follow_up_required = true);--> statement-breakpoint
CREATE INDEX "idx_activities_group" ON "activities" USING btree ("assigned_group" uuid_ops,"status" text_ops) WHERE (status = ANY (ARRAY['open'::text, 'in_progress'::text]));--> statement-breakpoint
CREATE INDEX "idx_activities_my_tasks" ON "activities" USING btree ("assigned_to" uuid_ops,"status" text_ops,"due_date" uuid_ops) WHERE (status = ANY (ARRAY['open'::text, 'in_progress'::text]));--> statement-breakpoint
CREATE INDEX "idx_activities_org" ON "activities" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_org_entity_composite" ON "activities" USING btree ("org_id" text_ops,"entity_type" text_ops,"entity_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_activities_org_entity_recent" ON "activities" USING btree ("org_id" text_ops,"entity_type" uuid_ops,"entity_id" text_ops,"created_at" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_activities_org_entity_type" ON "activities" USING btree ("org_id" text_ops,"entity_type" text_ops,"entity_id" text_ops,"activity_type" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_activities_org_id" ON "activities" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_org_status" ON "activities" USING btree ("org_id" uuid_ops,"status" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_parent" ON "activities" USING btree ("parent_activity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_related_campaign" ON "activities" USING btree ("related_campaign_id" uuid_ops) WHERE (related_campaign_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_activities_related_contact" ON "activities" USING btree ("related_contact_id" uuid_ops) WHERE (related_contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_activities_related_deal" ON "activities" USING btree ("related_deal_id" uuid_ops) WHERE (related_deal_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_activities_secondary_entity" ON "activities" USING btree ("secondary_entity_type" uuid_ops,"secondary_entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_status" ON "activities" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_tags" ON "activities" USING gin ("tags" array_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_type" ON "activities" USING btree ("activity_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_activities_workplan" ON "activities" USING btree ("workplan_instance_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_order_requirements_order_id" ON "external_job_order_requirements" USING btree ("order_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_order_skills_order_id" ON "external_job_order_skills" USING btree ("order_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_order_notes_order_id" ON "external_job_order_notes" USING btree ("order_id" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_skills_canonical_unique" ON "skills" USING btree (COALESCE(org_id, '00000000-0000-0000-0000-000000000000'::uuid) text_ops,canonical_name text_ops) WHERE (canonical_name IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_skills_category" ON "skills" USING btree ("category" text_ops);--> statement-breakpoint
CREATE INDEX "idx_skills_category_domain" ON "skills" USING btree ("category" text_ops,"domain" text_ops) WHERE (is_verified = true);--> statement-breakpoint
CREATE INDEX "idx_skills_hierarchy" ON "skills" USING btree ("hierarchy_path" text_ops) WHERE (hierarchy_path IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_skills_name_lower" ON "skills" USING btree (lower(name) text_ops);--> statement-breakpoint
CREATE INDEX "idx_skills_org" ON "skills" USING btree ("org_id" uuid_ops) WHERE (org_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_skills_parent" ON "skills" USING btree ("parent_skill_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_skills_search" ON "skills" USING gin ("search_vector" tsvector_ops) WHERE (search_vector IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_skills_trending" ON "skills" USING btree ("demand_score" numeric_ops) WHERE (trending = true);--> statement-breakpoint
CREATE INDEX "idx_bench_consultants_bench_sales_rep_id" ON "bench_consultants" USING btree ("bench_sales_rep_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_bench_consultants_candidate_id" ON "bench_consultants" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_bench_consultants_contact_id" ON "bench_consultants" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_bench_consultants_org" ON "bench_consultants" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_bench_consultants_org_id" ON "bench_consultants" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_bench_consultants_status" ON "bench_consultants" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_approval_workflows_active" ON "approval_workflows" USING btree ("org_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_approval_workflows_entity_type" ON "approval_workflows" USING btree ("entity_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_approval_workflows_org" ON "approval_workflows" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_approval_steps_approver" ON "approval_steps" USING btree ("approver_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_approval_steps_instance" ON "approval_steps" USING btree ("instance_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_approval_steps_pending" ON "approval_steps" USING btree ("approver_id" uuid_ops) WHERE (status = 'pending'::text);--> statement-breakpoint
CREATE INDEX "idx_approval_instances_entity" ON "approval_instances" USING btree ("entity_type" text_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_approval_instances_org" ON "approval_instances" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_approval_instances_pending" ON "approval_instances" USING btree ("org_id" uuid_ops) WHERE (status = 'pending'::text);--> statement-breakpoint
CREATE INDEX "idx_approval_instances_requestor" ON "approval_instances" USING btree ("requested_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_approval_instances_status" ON "approval_instances" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_approval_instances_workflow" ON "approval_instances" USING btree ("workflow_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_credits_date" ON "placement_credits" USING btree ("placement_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_credits_org" ON "placement_credits" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_credits_pod" ON "placement_credits" USING btree ("pod_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_credits_source" ON "placement_credits" USING btree ("source_pillar" text_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_credits_sprint" ON "placement_credits" USING btree ("pod_id" uuid_ops,"sprint_number" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_graduate_candidates_enrollment" ON "graduate_candidates" USING btree ("enrollment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_graduate_candidates_pending" ON "graduate_candidates" USING btree ("assigned_recruiter_id" uuid_ops) WHERE (status = 'pending_review'::graduate_candidate_status);--> statement-breakpoint
CREATE INDEX "idx_graduate_candidates_recruiter" ON "graduate_candidates" USING btree ("assigned_recruiter_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_graduate_candidates_status" ON "graduate_candidates" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_graduate_candidates_user" ON "graduate_candidates" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_quiz_attempts_enrollment" ON "quiz_attempts" USING btree ("enrollment_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_quiz_attempts_submitted" ON "quiz_attempts" USING btree ("submitted_at" timestamptz_ops) WHERE (submitted_at IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_quiz_attempts_topic" ON "quiz_attempts" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_quiz_attempts_unique" ON "quiz_attempts" USING btree ("user_id" int4_ops,"topic_id" uuid_ops,"attempt_number" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_quiz_attempts_user" ON "quiz_attempts" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_escalations_assigned_to" ON "ai_mentor_escalations" USING btree ("assigned_to" uuid_ops) WHERE (assigned_to IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_escalations_chat_id" ON "ai_mentor_escalations" USING btree ("chat_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_escalations_created_at" ON "ai_mentor_escalations" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_escalations_status" ON "ai_mentor_escalations" USING btree ("status" text_ops) WHERE (status = ANY (ARRAY['pending'::text, 'in_progress'::text]));--> statement-breakpoint
CREATE INDEX "idx_escalations_topic_id" ON "ai_mentor_escalations" USING btree ("topic_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_escalations_user_id" ON "ai_mentor_escalations" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_trainer_responses_escalation_id" ON "trainer_responses" USING btree ("escalation_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_trainer_responses_trainer_id" ON "trainer_responses" USING btree ("trainer_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_escalation_notifications_escalation_id" ON "escalation_notifications" USING btree ("escalation_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_escalation_notifications_sent_at" ON "escalation_notifications" USING btree ("sent_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_entity_skills_entity" ON "entity_skills" USING btree ("entity_type" text_ops,"entity_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_entity_skills_org" ON "entity_skills" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_entity_skills_primary" ON "entity_skills" USING btree ("entity_type" uuid_ops,"entity_id" text_ops) WHERE ((is_primary = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_entity_skills_proficiency" ON "entity_skills" USING btree ("proficiency_level" int4_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_entity_skills_skill" ON "entity_skills" USING btree ("skill_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_entity_skills_unique" ON "entity_skills" USING btree ("entity_type" text_ops,"entity_id" uuid_ops,"skill_id" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_entity_skills_verified" ON "entity_skills" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops) WHERE ((is_verified = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_certifications_entity" ON "certifications" USING btree ("entity_type" text_ops,"entity_id" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_certifications_expiry" ON "certifications" USING btree ("expiry_date" date_ops) WHERE ((is_active = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_certifications_skill" ON "certifications" USING btree ("skill_id" uuid_ops) WHERE ((skill_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_bench_data_bench_type" ON "contact_bench_data" USING btree ("bench_type" enum_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_bench_data_contact" ON "contact_bench_data" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_bench_data_marketing" ON "contact_bench_data" USING btree ("marketing_status" enum_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_bench_data_org" ON "contact_bench_data" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_bench_data_sales_rep" ON "contact_bench_data" USING btree ("bench_sales_rep_id" uuid_ops) WHERE ((bench_sales_rep_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_bench_data_status" ON "contact_bench_data" USING btree ("bench_status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_bench_data_vendor" ON "contact_bench_data" USING btree ("vendor_id" uuid_ops) WHERE ((vendor_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_bench_data_visa_expiry" ON "contact_bench_data" USING btree ("visa_expiry_date" date_ops) WHERE ((visa_expiry_date IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_submission_feedback_interview" ON "submission_feedback" USING btree ("interview_id" uuid_ops) WHERE ((interview_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_submission_feedback_org" ON "submission_feedback" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submission_feedback_submission" ON "submission_feedback" USING btree ("submission_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submission_rtr_contact" ON "submission_rtr" USING btree ("contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submission_rtr_expiry" ON "submission_rtr" USING btree ("expires_at" timestamptz_ops) WHERE ((status)::text = 'active'::text);--> statement-breakpoint
CREATE INDEX "idx_submission_rtr_org" ON "submission_rtr" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submission_rtr_submission" ON "submission_rtr" USING btree ("submission_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_entity_registry_active" ON "entity_type_registry" USING btree ("entity_type" text_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_skill_endorsements_endorser" ON "skill_endorsements" USING btree ("endorser_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_skill_endorsements_skill" ON "skill_endorsements" USING btree ("entity_skill_id" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_skill_endorsements_unique" ON "skill_endorsements" USING btree ("entity_skill_id" uuid_ops,"endorser_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_action_idx" ON "audit_logs_2025_11" USING btree ("action" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_actor_id_idx" ON "audit_logs_2025_11" USING btree ("actor_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_correlation_id_idx" ON "audit_logs_2025_11" USING btree ("correlation_id" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_created_at_idx" ON "audit_logs_2025_11" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_entity_type_entity_id_idx" ON "audit_logs_2025_11" USING btree ("entity_type" text_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_event_id_idx" ON "audit_logs_2025_11" USING btree ("event_id" int8_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_ip_address_idx" ON "audit_logs_2025_11" USING btree ("ip_address" inet_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_org_id_created_at_idx" ON "audit_logs_2025_11" USING btree ("org_id" uuid_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_org_id_idx" ON "audit_logs_2025_11" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_record_id_idx" ON "audit_logs_2025_11" USING btree ("record_id" uuid_ops) WHERE (record_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_result_idx" ON "audit_logs_2025_11" USING btree ("result" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_session_id_idx" ON "audit_logs_2025_11" USING btree ("session_id" text_ops) WHERE (session_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_severity_idx" ON "audit_logs_2025_11" USING btree ("severity" text_ops) WHERE (severity = ANY (ARRAY['error'::text, 'critical'::text]));--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_table_name_action_idx" ON "audit_logs_2025_11" USING btree ("table_name" text_ops,"action" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_table_name_idx" ON "audit_logs_2025_11" USING btree ("table_name" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_11_user_id_idx" ON "audit_logs_2025_11" USING btree ("user_id" uuid_ops) WHERE (user_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_action_idx" ON "audit_logs_2025_12" USING btree ("action" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_actor_id_idx" ON "audit_logs_2025_12" USING btree ("actor_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_correlation_id_idx" ON "audit_logs_2025_12" USING btree ("correlation_id" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_created_at_idx" ON "audit_logs_2025_12" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_entity_type_entity_id_idx" ON "audit_logs_2025_12" USING btree ("entity_type" text_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_event_id_idx" ON "audit_logs_2025_12" USING btree ("event_id" int8_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_ip_address_idx" ON "audit_logs_2025_12" USING btree ("ip_address" inet_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_org_id_created_at_idx" ON "audit_logs_2025_12" USING btree ("org_id" uuid_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_org_id_idx" ON "audit_logs_2025_12" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_record_id_idx" ON "audit_logs_2025_12" USING btree ("record_id" uuid_ops) WHERE (record_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_result_idx" ON "audit_logs_2025_12" USING btree ("result" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_session_id_idx" ON "audit_logs_2025_12" USING btree ("session_id" text_ops) WHERE (session_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_severity_idx" ON "audit_logs_2025_12" USING btree ("severity" text_ops) WHERE (severity = ANY (ARRAY['error'::text, 'critical'::text]));--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_table_name_action_idx" ON "audit_logs_2025_12" USING btree ("table_name" text_ops,"action" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_table_name_idx" ON "audit_logs_2025_12" USING btree ("table_name" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2025_12_user_id_idx" ON "audit_logs_2025_12" USING btree ("user_id" uuid_ops) WHERE (user_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_action_idx" ON "audit_logs_2026_01" USING btree ("action" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_actor_id_idx" ON "audit_logs_2026_01" USING btree ("actor_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_correlation_id_idx" ON "audit_logs_2026_01" USING btree ("correlation_id" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_created_at_idx" ON "audit_logs_2026_01" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_entity_type_entity_id_idx" ON "audit_logs_2026_01" USING btree ("entity_type" text_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_event_id_idx" ON "audit_logs_2026_01" USING btree ("event_id" int8_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_ip_address_idx" ON "audit_logs_2026_01" USING btree ("ip_address" inet_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_org_id_created_at_idx" ON "audit_logs_2026_01" USING btree ("org_id" uuid_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_org_id_idx" ON "audit_logs_2026_01" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_record_id_idx" ON "audit_logs_2026_01" USING btree ("record_id" uuid_ops) WHERE (record_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_result_idx" ON "audit_logs_2026_01" USING btree ("result" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_session_id_idx" ON "audit_logs_2026_01" USING btree ("session_id" text_ops) WHERE (session_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_severity_idx" ON "audit_logs_2026_01" USING btree ("severity" text_ops) WHERE (severity = ANY (ARRAY['error'::text, 'critical'::text]));--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_table_name_action_idx" ON "audit_logs_2026_01" USING btree ("table_name" text_ops,"action" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_table_name_idx" ON "audit_logs_2026_01" USING btree ("table_name" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_01_user_id_idx" ON "audit_logs_2026_01" USING btree ("user_id" uuid_ops) WHERE (user_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_action_idx" ON "audit_logs_2026_02" USING btree ("action" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_actor_id_idx" ON "audit_logs_2026_02" USING btree ("actor_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_correlation_id_idx" ON "audit_logs_2026_02" USING btree ("correlation_id" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_created_at_idx" ON "audit_logs_2026_02" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_entity_type_entity_id_idx" ON "audit_logs_2026_02" USING btree ("entity_type" text_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_event_id_idx" ON "audit_logs_2026_02" USING btree ("event_id" int8_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_ip_address_idx" ON "audit_logs_2026_02" USING btree ("ip_address" inet_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_org_id_created_at_idx" ON "audit_logs_2026_02" USING btree ("org_id" timestamptz_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_org_id_idx" ON "audit_logs_2026_02" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_record_id_idx" ON "audit_logs_2026_02" USING btree ("record_id" uuid_ops) WHERE (record_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_result_idx" ON "audit_logs_2026_02" USING btree ("result" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_session_id_idx" ON "audit_logs_2026_02" USING btree ("session_id" text_ops) WHERE (session_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_severity_idx" ON "audit_logs_2026_02" USING btree ("severity" text_ops) WHERE (severity = ANY (ARRAY['error'::text, 'critical'::text]));--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_table_name_action_idx" ON "audit_logs_2026_02" USING btree ("table_name" text_ops,"action" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_table_name_idx" ON "audit_logs_2026_02" USING btree ("table_name" text_ops);--> statement-breakpoint
CREATE INDEX "audit_logs_2026_02_user_id_idx" ON "audit_logs_2026_02" USING btree ("user_id" uuid_ops) WHERE (user_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_security_alerts_created" ON "security_alerts" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_security_alerts_org" ON "security_alerts" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_security_alerts_severity" ON "security_alerts" USING btree ("severity" text_ops);--> statement-breakpoint
CREATE INDEX "idx_security_alerts_status" ON "security_alerts" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_security_alerts_user" ON "security_alerts" USING btree ("related_user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_alert_rules_active" ON "alert_rules" USING btree ("is_active" bool_ops);--> statement-breakpoint
CREATE INDEX "idx_alert_rules_event_type" ON "alert_rules" USING btree ("event_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_alert_rules_org" ON "alert_rules" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_email_templates_active" ON "email_templates" USING btree ("is_active" bool_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_email_templates_category" ON "email_templates" USING btree ("category" text_ops);--> statement-breakpoint
CREATE INDEX "idx_email_templates_org_category" ON "email_templates" USING btree ("org_id" uuid_ops,"category" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_email_templates_org_id" ON "email_templates" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_email_templates_org_slug" ON "email_templates" USING btree ("org_id" text_ops,"slug" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_email_templates_org_status" ON "email_templates" USING btree ("org_id" uuid_ops,"status" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_email_sends_org" ON "email_sends" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_email_sends_recipient" ON "email_sends" USING btree ("recipient_email" text_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_email_sends_status" ON "email_sends" USING btree ("org_id" uuid_ops,"status" text_ops,"created_at" text_ops);--> statement-breakpoint
CREATE INDEX "idx_email_sends_template" ON "email_sends" USING btree ("template_id" uuid_ops,"status" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_email_senders_org" ON "email_senders" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_incidents_org" ON "incidents" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_incidents_org_created" ON "incidents" USING btree ("org_id" uuid_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_incidents_org_status" ON "incidents" USING btree ("org_id" text_ops,"status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_incidents_severity" ON "incidents" USING btree ("severity" text_ops);--> statement-breakpoint
CREATE INDEX "idx_incidents_started" ON "incidents" USING btree ("started_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_incidents_status" ON "incidents" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_incident_timeline_created" ON "incident_timeline" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_incident_timeline_incident" ON "incident_timeline" USING btree ("incident_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_incident_timeline_org" ON "incident_timeline" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_incident_notifications_incident" ON "incident_notifications" USING btree ("incident_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_incident_notifications_org" ON "incident_notifications" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_incident_notifications_status" ON "incident_notifications" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_break_glass_accessed" ON "break_glass_access" USING btree ("accessed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_break_glass_org" ON "break_glass_access" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_break_glass_user" ON "break_glass_access" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_emergency_drills_org" ON "emergency_drills" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_emergency_drills_scheduled" ON "emergency_drills" USING btree ("scheduled_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_emergency_drills_status" ON "emergency_drills" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_emergency_drills_type" ON "emergency_drills" USING btree ("drill_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_sla_definitions_status" ON "sla_definitions" USING btree ("org_id" uuid_ops,"status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_sla_escalation_levels_definition" ON "sla_escalation_levels" USING btree ("sla_definition_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_sla_events_active" ON "sla_events" USING btree ("org_id" uuid_ops,"status" uuid_ops) WHERE (status = ANY (ARRAY['pending'::text, 'warning'::text, 'breach'::text]));--> statement-breakpoint
CREATE INDEX "idx_sla_events_deadline" ON "sla_events" USING btree ("target_deadline" timestamptz_ops) WHERE (status = 'pending'::text);--> statement-breakpoint
CREATE INDEX "idx_sla_events_entity" ON "sla_events" USING btree ("entity_type" text_ops,"entity_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_sla_events_org_status" ON "sla_events" USING btree ("org_id" text_ops,"status" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_sla_notifications_event_level" ON "sla_notifications" USING btree ("sla_event_id" int4_ops,"escalation_level" uuid_ops,"notification_type" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contacts_alumni_employee" ON "contacts" USING btree ("alumni_former_employee_id" uuid_ops) WHERE ((subtype = 'person_alumni'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_auth_id" ON "contacts" USING btree ("auth_id" uuid_ops) WHERE (auth_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_bench_status" ON "contacts" USING btree ("bench_status" text_ops) WHERE ((category = 'person'::text) AND (subtype ~~ 'person_bench_%'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_candidate_hotlist" ON "contacts" USING btree ("org_id" uuid_ops,"candidate_hotlist_added_at" uuid_ops) WHERE ((subtype = 'candidate'::text) AND (candidate_is_on_hotlist = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_candidate_skills" ON "contacts" USING gin ("candidate_skills" array_ops) WHERE ((subtype = 'candidate'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_candidates" ON "contacts" USING btree ("org_id" text_ops,"candidate_status" timestamptz_ops,"created_at" uuid_ops) WHERE ((subtype = 'candidate'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_category" ON "contacts" USING btree ("category" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_category_subtype" ON "contacts" USING btree ("category" text_ops,"subtype" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_client_contact_company" ON "contacts" USING btree ("client_contact_company_id" uuid_ops) WHERE ((category = 'person'::text) AND (subtype ~~ 'person_%_contact'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_client_msp" ON "contacts" USING btree ("client_msp_id" uuid_ops) WHERE ((client_msp_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_client_tier" ON "contacts" USING btree ("client_tier" text_ops,"client_status" text_ops) WHERE ((category = 'company'::text) AND (subtype = 'company_client'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_company_id" ON "contacts" USING btree ("company_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contacts_company_org" ON "contacts" USING btree ("company_id" uuid_ops,"org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_company_subtypes" ON "contacts" USING btree ("subtype" text_ops) WHERE ((category = 'company'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_contact_status" ON "contacts" USING btree ("contact_status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_current_company" ON "contacts" USING btree ("current_company_id" uuid_ops) WHERE ((current_company_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_email" ON "contacts" USING btree ("email" text_ops);--> statement-breakpoint
CREATE INDEX "idx_contacts_employees" ON "contacts" USING btree ("org_id" text_ops,"employee_status" uuid_ops) WHERE ((subtype = 'employee'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_employer_company" ON "contacts" USING btree ("employer_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_engagement" ON "contacts" USING btree ("engagement_score" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_contacts_lead_skills_needed" ON "contacts" USING gin ("lead_skills_needed" array_ops) WHERE ((subtype = 'lead'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_leads" ON "contacts" USING btree ("org_id" int4_ops,"lead_status" uuid_ops,"lead_score" text_ops) WHERE ((subtype = 'lead'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_linked_company" ON "contacts" USING btree ("linked_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_org_id" ON "contacts" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contacts_owner_id" ON "contacts" USING btree ("owner_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contacts_parent_company" ON "contacts" USING btree ("parent_company_id" uuid_ops) WHERE ((parent_company_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_placed_client" ON "contacts" USING btree ("placed_client_id" uuid_ops,"placed_status" text_ops) WHERE ((category = 'person'::text) AND (subtype = 'person_placed'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_primary_address" ON "contacts" USING btree ("primary_address_id" uuid_ops) WHERE (primary_address_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_primary_company" ON "contacts" USING btree ("company_id" bool_ops,"is_primary" uuid_ops) WHERE ((is_primary = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_prospects" ON "contacts" USING btree ("org_id" int4_ops,"prospect_sequence_status" int4_ops,"engagement_score" uuid_ops) WHERE ((subtype = 'prospect'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_search" ON "contacts" USING gin ("search_vector" tsvector_ops);--> statement-breakpoint
CREATE INDEX "idx_contacts_source_company" ON "contacts" USING btree ("source_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_status" ON "contacts" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_contacts_subtype" ON "contacts" USING btree ("subtype" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_types" ON "contacts" USING gin ("types" array_ops);--> statement-breakpoint
CREATE INDEX "idx_contacts_user_profile_id" ON "contacts" USING btree ("user_profile_id" uuid_ops) WHERE (user_profile_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_vendor_company" ON "contacts" USING btree ("vendor_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contacts_vendor_contact_company" ON "contacts" USING btree ("vendor_contact_company_id" uuid_ops) WHERE ((category = 'person'::text) AND (subtype = 'person_vendor_contact'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contacts_vendor_status" ON "contacts" USING btree ("vendor_status" text_ops,"vendor_tier" text_ops) WHERE ((category = 'company'::text) AND (subtype = 'company_vendor'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_activity_stats_user_date" ON "activity_stats_daily" USING btree ("user_id" date_ops,"date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_notes_creator" ON "notes" USING btree ("created_by" uuid_ops,"created_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_notes_entity" ON "notes" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops,"created_at" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_notes_mentions_users" ON "notes" USING gin ("mentioned_user_ids" array_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_notes_org" ON "notes" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_notes_parent" ON "notes" USING btree ("parent_note_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_notes_pinned" ON "notes" USING btree ("entity_type" uuid_ops,"entity_id" text_ops,"pin_order" text_ops) WHERE ((is_pinned = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_notes_search" ON "notes" USING gin ("search_vector" tsvector_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_notes_thread" ON "notes" USING btree ("thread_root_id" uuid_ops,"created_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "activity_patterns_entity_type_idx" ON "activity_patterns" USING btree ("entity_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_patterns_category" ON "activity_patterns" USING btree ("org_id" bool_ops,"category" text_ops,"is_active" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_patterns_display" ON "activity_patterns" USING btree ("org_id" int4_ops,"category" text_ops,"display_order" text_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_patterns_entity" ON "activity_patterns" USING btree ("entity_type" bool_ops,"is_active" text_ops);--> statement-breakpoint
CREATE INDEX "idx_activity_patterns_org" ON "activity_patterns" USING btree ("org_id" uuid_ops) WHERE (org_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_feature_flag_usage_flag" ON "feature_flag_usage" USING btree ("feature_flag_id" timestamptz_ops,"checked_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flag_usage_org" ON "feature_flag_usage" USING btree ("org_id" timestamptz_ops,"checked_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flag_usage_user" ON "feature_flag_usage" USING btree ("user_id" uuid_ops,"checked_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flag_feedback_flag" ON "feature_flag_feedback" USING btree ("feature_flag_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flags_code" ON "feature_flags" USING btree ("key" text_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flags_enabled_pods" ON "feature_flags" USING gin ("enabled_pods" array_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flags_enabled_roles" ON "feature_flags" USING gin ("enabled_roles" array_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flags_enabled_users" ON "feature_flags" USING gin ("enabled_users" array_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flags_org" ON "feature_flags" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flags_org_key" ON "feature_flags" USING btree ("org_id" uuid_ops,"key" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_feature_flags_org_state" ON "feature_flags" USING btree ("org_id" uuid_ops,"state" text_ops);--> statement-breakpoint
CREATE INDEX "idx_job_status_history_job_id" ON "job_status_history" USING btree ("job_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_job_status_history_new_status" ON "job_status_history" USING btree ("new_status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_job_status_history_org_changed_at" ON "job_status_history" USING btree ("org_id" uuid_ops,"changed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_organizations_deleted_at" ON "organizations" USING btree ("deleted_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_organizations_email" ON "organizations" USING btree ("email" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_organizations_industry" ON "organizations" USING btree ("industry" text_ops);--> statement-breakpoint
CREATE INDEX "idx_organizations_slug" ON "organizations" USING btree ("slug" text_ops);--> statement-breakpoint
CREATE INDEX "idx_organizations_status" ON "organizations" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_organizations_stripe_customer" ON "organizations" USING btree ("stripe_customer_id" text_ops) WHERE (stripe_customer_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_organizations_subscription_tier" ON "organizations" USING btree ("subscription_tier" text_ops);--> statement-breakpoint
CREATE INDEX "idx_organizations_timezone" ON "organizations" USING btree ("timezone" text_ops);--> statement-breakpoint
CREATE INDEX "idx_saved_searches_default" ON "saved_searches" USING btree ("user_id" text_ops,"entity_type" uuid_ops,"is_default" uuid_ops) WHERE ((is_default = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_saved_searches_entity" ON "saved_searches" USING btree ("entity_type" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_saved_searches_org" ON "saved_searches" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_saved_searches_shared" ON "saved_searches" USING btree ("org_id" bool_ops,"entity_type" uuid_ops,"is_shared" uuid_ops) WHERE ((is_shared = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_saved_searches_user" ON "saved_searches" USING btree ("user_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_prepared_profiles_candidate" ON "candidate_prepared_profiles" USING btree ("candidate_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_prepared_profiles_contact_id" ON "candidate_prepared_profiles" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_prepared_profiles_job" ON "candidate_prepared_profiles" USING btree ("job_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_screenings_candidate" ON "candidate_screenings" USING btree ("candidate_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_screenings_contact_id" ON "candidate_screenings" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_screenings_job" ON "candidate_screenings" USING btree ("job_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_screenings_recommendation" ON "candidate_screenings" USING btree ("recommendation" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_screenings_screener" ON "candidate_screenings" USING btree ("screener_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_candidate_screenings_status" ON "candidate_screenings" USING btree ("status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_relationships_current" ON "contact_relationships" USING btree ("source_contact_id" uuid_ops,"is_current" uuid_ops) WHERE ((is_current = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_relationships_source" ON "contact_relationships" USING btree ("source_contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_relationships_target" ON "contact_relationships" USING btree ("target_contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_relationships_type" ON "contact_relationships" USING btree ("relationship_type" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_roles_active" ON "contact_roles" USING btree ("contact_id" text_ops,"role_type" uuid_ops) WHERE ((role_status = 'active'::text) AND (role_ended_at IS NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_roles_contact" ON "contact_roles" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_roles_type" ON "contact_roles" USING btree ("role_type" text_ops,"role_status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_offers_bill_rate" ON "offers" USING btree ("bill_rate" numeric_ops);--> statement-breakpoint
CREATE INDEX "idx_offers_candidate" ON "offers" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_offers_employment_type" ON "offers" USING btree ("employment_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_offers_expires" ON "offers" USING btree ("expires_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_offers_job" ON "offers" USING btree ("job_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_offers_org_id" ON "offers" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_offers_pay_rate" ON "offers" USING btree ("pay_rate" numeric_ops);--> statement-breakpoint
CREATE INDEX "idx_offers_status" ON "offers" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_offers_submission" ON "offers" USING btree ("submission_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_offer_negotiations_offer_id" ON "offer_negotiations" USING btree ("offer_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_offer_approvals_approver_id" ON "offer_approvals" USING btree ("approver_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_offer_approvals_offer_id" ON "offer_approvals" USING btree ("offer_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contact_skills_contact" ON "contact_skills" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_skills_name" ON "contact_skills" USING btree ("skill_name" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_skills_primary" ON "contact_skills" USING btree ("contact_id" uuid_ops) WHERE ((is_primary = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_skills_skill" ON "contact_skills" USING btree ("skill_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_work_history_company" ON "contact_work_history" USING btree ("company_contact_id" uuid_ops) WHERE ((company_contact_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_work_history_contact" ON "contact_work_history" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_work_history_current" ON "contact_work_history" USING btree ("contact_id" uuid_ops) WHERE ((is_current = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_education_contact" ON "contact_education" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_certifications_contact" ON "contact_certifications" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_certifications_expiry" ON "contact_certifications" USING btree ("expiry_date" date_ops) WHERE ((is_active = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_placement_milestones_due_date" ON "placement_milestones" USING btree ("due_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_milestones_placement_id" ON "placement_milestones" USING btree ("placement_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contact_rate_cards_active" ON "contact_rate_cards" USING btree ("contact_id" bool_ops,"is_active" uuid_ops) WHERE ((is_active = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_rate_cards_client" ON "contact_rate_cards" USING btree ("client_id" uuid_ops) WHERE ((client_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_rate_cards_contact" ON "contact_rate_cards" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_placement_extensions_placement_id" ON "placement_extensions" USING btree ("placement_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_rates_placement_id" ON "placement_rates" USING btree ("placement_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contact_agreements_contact" ON "contact_agreements" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_agreements_expiry" ON "contact_agreements" USING btree ("expiry_date" date_ops) WHERE ((status = 'active'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_agreements_status" ON "contact_agreements" USING btree ("status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_compliance_contact" ON "contact_compliance" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_compliance_expiry" ON "contact_compliance" USING btree ("expiry_date" date_ops) WHERE ((status = ANY (ARRAY['verified'::text, 'expiring'::text])) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contact_compliance_type" ON "contact_compliance" USING btree ("compliance_type" text_ops,"status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contact_comm_prefs_contact" ON "contact_communication_preferences" USING btree ("contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contact_comm_prefs_opted_out" ON "contact_communication_preferences" USING btree ("channel" text_ops) WHERE (is_opted_in = false);--> statement-breakpoint
CREATE INDEX "idx_contact_merge_history_merged" ON "contact_merge_history" USING btree ("merged_contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contact_merge_history_survivor" ON "contact_merge_history" USING btree ("survivor_contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_note_reactions_note" ON "note_reactions" USING btree ("note_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_note_reactions_user" ON "note_reactions" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_companies_account_manager" ON "companies" USING btree ("account_manager_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_companies_category" ON "companies" USING btree ("org_id" uuid_ops,"category" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_companies_health" ON "companies" USING btree ("org_id" int4_ops,"health_status" uuid_ops,"health_score" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_companies_hierarchy" ON "companies" USING btree ("org_id" text_ops,"hierarchy_path" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_companies_name_trgm" ON "companies" USING gin ("name" gin_trgm_ops);--> statement-breakpoint
CREATE INDEX "idx_companies_org" ON "companies" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_companies_owner" ON "companies" USING btree ("owner_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_companies_parent" ON "companies" USING btree ("parent_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_companies_search" ON "companies" USING gin ("search_vector" tsvector_ops);--> statement-breakpoint
CREATE INDEX "idx_companies_status" ON "companies" USING btree ("org_id" enum_ops,"status" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_companies_tier" ON "companies" USING btree ("org_id" uuid_ops,"tier" enum_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_documents_entity" ON "documents" USING btree ("entity_type" text_ops,"entity_id" timestamptz_ops,"created_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_documents_expiry" ON "documents" USING btree ("expires_at" timestamptz_ops) WHERE ((expires_at IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_documents_hash" ON "documents" USING btree ("content_hash" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_documents_latest" ON "documents" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops,"document_type" text_ops) WHERE ((is_latest_version = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_documents_org" ON "documents" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_documents_processing" ON "documents" USING btree ("processing_status" text_ops) WHERE (((processing_status)::text <> 'completed'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_documents_type" ON "documents" USING btree ("document_type" text_ops,"entity_type" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_meeting_notes_account" ON "meeting_notes" USING btree ("account_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_meeting_notes_created_by" ON "meeting_notes" USING btree ("created_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_meeting_notes_org" ON "meeting_notes" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_meeting_notes_scheduled" ON "meeting_notes" USING btree ("scheduled_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_meeting_notes_status" ON "meeting_notes" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_meeting_notes_type" ON "meeting_notes" USING btree ("meeting_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_client_escalations_account" ON "escalations" USING btree ("account_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_client_escalations_assigned" ON "escalations" USING btree ("assigned_to" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_client_escalations_created_by" ON "escalations" USING btree ("created_by" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_client_escalations_number" ON "escalations" USING btree ("escalation_number" text_ops);--> statement-breakpoint
CREATE INDEX "idx_client_escalations_org" ON "escalations" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_client_escalations_severity" ON "escalations" USING btree ("severity" text_ops);--> statement-breakpoint
CREATE INDEX "idx_client_escalations_sla_response" ON "escalations" USING btree ("sla_response_due" timestamptz_ops) WHERE (status = ANY (ARRAY['open'::text, 'in_progress'::text]));--> statement-breakpoint
CREATE INDEX "idx_client_escalations_status" ON "escalations" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_client_escalations_type" ON "escalations" USING btree ("escalation_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_escalation_updates_created_at" ON "escalation_updates" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_escalation_updates_escalation" ON "escalation_updates" USING btree ("escalation_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_escalation_updates_type" ON "escalation_updates" USING btree ("update_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_document_access_document" ON "document_access_log" USING btree ("document_id" timestamptz_ops,"accessed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_document_access_user" ON "document_access_log" USING btree ("user_id" timestamptz_ops,"accessed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_company_client_details_org" ON "company_client_details" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_company_vendor_details_blacklist" ON "company_vendor_details" USING btree ("company_id" uuid_ops) WHERE (is_blacklisted = true);--> statement-breakpoint
CREATE INDEX "idx_company_vendor_details_org" ON "company_vendor_details" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_company_vendor_details_type" ON "company_vendor_details" USING btree ("vendor_type" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_company_partner_details_org" ON "company_partner_details" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_account" ON "deals" USING btree ("account_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_account_id" ON "deals" USING btree ("account_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_company_id" ON "deals" USING btree ("company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_deals_expected_close" ON "deals" USING btree ("expected_close_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_expected_close_active" ON "deals" USING btree ("expected_close_date" date_ops) WHERE ((deleted_at IS NULL) AND (stage <> ALL (ARRAY['closed_won'::text, 'closed_lost'::text])));--> statement-breakpoint
CREATE INDEX "idx_deals_health_status" ON "deals" USING btree ("health_status" text_ops) WHERE ((deleted_at IS NULL) AND (stage <> ALL (ARRAY['closed_won'::text, 'closed_lost'::text])));--> statement-breakpoint
CREATE INDEX "idx_deals_last_activity" ON "deals" USING btree ("last_activity_at" timestamptz_ops) WHERE ((deleted_at IS NULL) AND (stage <> ALL (ARRAY['closed_won'::text, 'closed_lost'::text])));--> statement-breakpoint
CREATE INDEX "idx_deals_lead" ON "deals" USING btree ("lead_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_lead_contact" ON "deals" USING btree ("lead_contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_deals_lead_id" ON "deals" USING btree ("lead_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_org" ON "deals" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_deals_org_id" ON "deals" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_owner" ON "deals" USING btree ("owner_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_owner_id" ON "deals" USING btree ("owner_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_stage" ON "deals" USING btree ("stage" text_ops);--> statement-breakpoint
CREATE INDEX "idx_deals_stage_owner" ON "deals" USING btree ("stage" text_ops,"owner_id" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_retention_policies_active" ON "data_retention_policies" USING btree ("org_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_compliance_req_blocking" ON "compliance_requirements" USING btree ("is_blocking" bool_ops) WHERE ((is_blocking = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_compliance_req_category" ON "compliance_requirements" USING btree ("category" bool_ops,"is_active" bool_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_compliance_req_org" ON "compliance_requirements" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_compliance_items_entity" ON "compliance_items" USING btree ("entity_type" text_ops,"entity_id" timestamptz_ops,"created_at" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_compliance_items_expiring" ON "compliance_items" USING btree ("expiry_date" date_ops,"status" enum_ops) WHERE ((status <> ALL (ARRAY['expired'::compliance_item_status, 'rejected'::compliance_item_status, 'waived'::compliance_item_status])) AND (expiry_date IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_compliance_items_expiry" ON "compliance_items" USING btree ("expiry_date" date_ops) WHERE ((expiry_date IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_compliance_items_org" ON "compliance_items" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_compliance_items_requirement" ON "compliance_items" USING btree ("requirement_id" uuid_ops) WHERE ((requirement_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_compliance_items_status" ON "compliance_items" USING btree ("status" enum_ops,"entity_type" enum_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_entity_compliance_req_entity" ON "entity_compliance_requirements" USING btree ("entity_type" text_ops,"entity_id" text_ops);--> statement-breakpoint
CREATE INDEX "idx_contracts_entity" ON "contracts" USING btree ("entity_type" timestamptz_ops,"entity_id" timestamptz_ops,"created_at" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contracts_expiry" ON "contracts" USING btree ("expiry_date" date_ops) WHERE ((expiry_date IS NOT NULL) AND (status = 'active'::contract_status) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contracts_latest" ON "contracts" USING btree ("entity_type" enum_ops,"entity_id" enum_ops,"contract_type" enum_ops) WHERE ((is_latest_version = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contracts_org" ON "contracts" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contracts_parent" ON "contracts" USING btree ("parent_contract_id" uuid_ops) WHERE ((parent_contract_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_contracts_status" ON "contracts" USING btree ("status" enum_ops,"contract_type" enum_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contract_versions_contract" ON "contract_versions" USING btree ("contract_id" int4_ops,"version_number" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_contract_parties_contact" ON "contract_parties" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_contract_parties_contract" ON "contract_parties" USING btree ("contract_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_contract_parties_pending" ON "contract_parties" USING btree ("contract_id" uuid_ops,"signatory_status" enum_ops) WHERE (signatory_status = 'pending'::signatory_status);--> statement-breakpoint
CREATE INDEX "idx_contract_parties_user" ON "contract_parties" USING btree ("user_id" uuid_ops) WHERE (user_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_contract_templates_org" ON "contract_templates" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contract_templates_type" ON "contract_templates" USING btree ("contract_type" bool_ops,"is_active" bool_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contract_clauses_category" ON "contract_clauses" USING btree ("category" text_ops,"is_active" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_contract_clauses_org" ON "contract_clauses" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_rate_approvals_pending" ON "rate_approvals" USING btree ("status" text_ops) WHERE ((status)::text = 'pending'::text);--> statement-breakpoint
CREATE INDEX "idx_rate_approvals_rate" ON "rate_approvals" USING btree ("entity_rate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_rate_cards_active" ON "rate_cards" USING btree ("entity_type" bool_ops,"entity_id" text_ops,"is_active" uuid_ops) WHERE ((is_active = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_rate_cards_effective" ON "rate_cards" USING btree ("effective_start_date" date_ops,"effective_end_date" date_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_rate_cards_entity" ON "rate_cards" USING btree ("entity_type" text_ops,"entity_id" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_rate_cards_org" ON "rate_cards" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_rate_cards_unique_active" ON "rate_cards" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops) WHERE ((is_active = true) AND (is_latest_version = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_rate_card_items_category" ON "rate_card_items" USING btree ("job_category" text_ops,"job_level" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_rate_card_items_skill" ON "rate_card_items" USING btree ("skill_id" uuid_ops) WHERE ((skill_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_entity_rates_card" ON "entity_rates" USING btree ("rate_card_id" uuid_ops) WHERE ((rate_card_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_entity_rates_current" ON "entity_rates" USING btree ("entity_type" text_ops,"entity_id" uuid_ops) WHERE ((is_current = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_entity_rates_entity" ON "entity_rates" USING btree ("entity_type" uuid_ops,"entity_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_entity_rates_margin" ON "entity_rates" USING btree ("margin_percentage" numeric_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_entity_rates_org" ON "entity_rates" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_rate_change_history_rate" ON "rate_change_history" USING btree ("entity_rate_id" timestamptz_ops,"changed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_jobs_client_company" ON "jobs" USING btree ("client_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_jobs_company_id" ON "jobs" USING btree ("company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_jobs_company_org" ON "jobs" USING btree ("company_id" uuid_ops,"org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_jobs_deal" ON "jobs" USING btree ("deal_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_jobs_end_client" ON "jobs" USING btree ("end_client_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_jobs_external_id" ON "jobs" USING btree ("org_id" uuid_ops,"external_job_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_jobs_hiring_manager" ON "jobs" USING btree ("hiring_manager_contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_jobs_org" ON "jobs" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_jobs_org_status" ON "jobs" USING btree ("org_id" uuid_ops,"status" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_jobs_owner" ON "jobs" USING btree ("owner_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_jobs_posted_date" ON "jobs" USING btree ("posted_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_jobs_priority_rank" ON "jobs" USING btree ("org_id" uuid_ops,"priority_rank" int4_ops) WHERE ((status = ANY (ARRAY['open'::text, 'active'::text])) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_jobs_search" ON "jobs" USING gin ("search_vector" tsvector_ops);--> statement-breakpoint
CREATE INDEX "idx_jobs_sla" ON "jobs" USING btree ("org_id" uuid_ops,"sla_days" uuid_ops) WHERE ((status = ANY (ARRAY['open'::text, 'active'::text])) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_jobs_status" ON "jobs" USING btree ("status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_jobs_vendor" ON "jobs" USING btree ("vendor_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_account" ON "submissions" USING btree ("account_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submissions_candidate" ON "submissions" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submissions_candidate_org" ON "submissions" USING btree ("candidate_id" uuid_ops,"org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_client_decision" ON "submissions" USING btree ("client_decision" text_ops) WHERE (client_decision IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_company_id" ON "submissions" USING btree ("company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_contact" ON "submissions" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_contact_id" ON "submissions" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_created" ON "submissions" USING btree ("created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_submissions_job" ON "submissions" USING btree ("job_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_job_org" ON "submissions" USING btree ("job_id" uuid_ops,"org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_offer_id" ON "submissions" USING btree ("offer_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submissions_org" ON "submissions" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submissions_owner" ON "submissions" USING btree ("owner_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submissions_placement_id" ON "submissions" USING btree ("placement_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_submissions_rtr" ON "submissions" USING btree ("rtr_expires_at" timestamptz_ops) WHERE ((rtr_obtained = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_submissions_score" ON "submissions" USING btree ("org_id" int4_ops,"submission_score" int4_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_status" ON "submissions" USING btree ("status" text_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_status_entered" ON "submissions" USING btree ("status_entered_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_submissions_unique" ON "submissions" USING btree ("job_id" uuid_ops,"candidate_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_submissions_vendor" ON "submissions" USING btree ("submitted_by_company_id" uuid_ops) WHERE ((is_vendor_submission = true) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_submissions_vendor_decision" ON "submissions" USING btree ("vendor_decision" text_ops) WHERE (vendor_decision IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_interviews_attendance" ON "interviews" USING btree ("attendance_status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_interviews_candidate" ON "interviews" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_interviews_confirmed_at" ON "interviews" USING btree ("confirmed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_interviews_contact_id" ON "interviews" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_interviews_hiring_decision" ON "interviews" USING btree ("org_id" text_ops,"hiring_decision" uuid_ops) WHERE (hiring_decision IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_interviews_job" ON "interviews" USING btree ("job_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_interviews_org_id" ON "interviews" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_interviews_prep_completed" ON "interviews" USING btree ("prep_completed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_interviews_primary_interviewer" ON "interviews" USING btree ("primary_interviewer_contact_id" uuid_ops) WHERE (primary_interviewer_contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_interviews_proposed_times" ON "interviews" USING gin ("proposed_times" jsonb_ops);--> statement-breakpoint
CREATE INDEX "idx_interviews_scheduled" ON "interviews" USING btree ("scheduled_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_interviews_scorecard_template" ON "interviews" USING btree ("scorecard_template_id" uuid_ops) WHERE (scorecard_template_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_interviews_status" ON "interviews" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_interviews_submission" ON "interviews" USING btree ("submission_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_interview_participants_contact" ON "interview_participants" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_interview_participants_interview" ON "interview_participants" USING btree ("interview_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_interview_participants_interview_id" ON "interview_participants" USING btree ("interview_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_interview_participants_org" ON "interview_participants" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_interview_participants_unique_contact" ON "interview_participants" USING btree ("interview_id" uuid_ops,"contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_interview_participants_unique_user" ON "interview_participants" USING btree ("interview_id" uuid_ops,"user_id" uuid_ops) WHERE (user_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_interview_participants_user" ON "interview_participants" USING btree ("user_id" uuid_ops) WHERE (user_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_interview_scorecards_interview" ON "interview_scorecards" USING btree ("interview_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_interview_scorecards_org" ON "interview_scorecards" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_interview_scorecards_participant" ON "interview_scorecards" USING btree ("participant_id" uuid_ops) WHERE ((participant_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_interview_scorecards_submitted_by" ON "interview_scorecards" USING btree ("submitted_by" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_scorecard_templates_org" ON "scorecard_templates" USING btree ("org_id" uuid_ops) WHERE ((deleted_at IS NULL) AND (is_active = true));--> statement-breakpoint
CREATE INDEX "idx_scorecard_templates_type" ON "scorecard_templates" USING btree ("interview_type" text_ops) WHERE ((deleted_at IS NULL) AND (is_active = true));--> statement-breakpoint
CREATE INDEX "idx_placements_approval" ON "placements" USING btree ("org_id" text_ops,"approval_status" text_ops) WHERE (((approval_status)::text = 'pending'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_placements_billing_company" ON "placements" USING btree ("billing_company_id" uuid_ops) WHERE (billing_company_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_placements_candidate" ON "placements" USING btree ("candidate_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placements_client_company" ON "placements" USING btree ("client_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_placements_company_id" ON "placements" USING btree ("company_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placements_compliance" ON "placements" USING btree ("org_id" uuid_ops,"compliance_status" text_ops) WHERE ((status = 'active'::text) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_placements_contact" ON "placements" USING btree ("contact_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_placements_contact_id" ON "placements" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_placements_contract" ON "placements" USING btree ("contract_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_placements_end_client" ON "placements" USING btree ("end_client_company_id" uuid_ops) WHERE (end_client_company_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_placements_health_status" ON "placements" USING btree ("health_status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_placements_job" ON "placements" USING btree ("job_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placements_next_check_in" ON "placements" USING btree ("next_check_in_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_placements_org" ON "placements" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placements_recruiter" ON "placements" USING btree ("recruiter_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placements_start_date" ON "placements" USING btree ("start_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_placements_status" ON "placements" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_placements_vendor" ON "placements" USING btree ("vendor_company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_placement_vendors_company" ON "placement_vendors" USING btree ("vendor_company_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_vendors_org" ON "placement_vendors" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_vendors_placement" ON "placement_vendors" USING btree ("placement_id" uuid_ops);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_placement_vendors_unique" ON "placement_vendors" USING btree ("placement_id" int4_ops,"vendor_company_id" uuid_ops,"position_in_chain" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_change_orders_org" ON "placement_change_orders" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_change_orders_placement" ON "placement_change_orders" USING btree ("placement_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_change_orders_status" ON "placement_change_orders" USING btree ("status" text_ops) WHERE ((status)::text = 'pending'::text);--> statement-breakpoint
CREATE INDEX "idx_placement_checkins_date" ON "placement_checkins" USING btree ("checkin_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_checkins_health" ON "placement_checkins" USING btree ("overall_health" text_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_checkins_org" ON "placement_checkins" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_checkins_pending" ON "placement_checkins" USING btree ("checkin_date" date_ops) WHERE (completed_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_placement_checkins_placement" ON "placement_checkins" USING btree ("placement_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_placement_checkins_type" ON "placement_checkins" USING btree ("checkin_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_onboarding_tasks_assigned" ON "onboarding_tasks" USING btree ("assigned_to" uuid_ops) WHERE (assigned_to IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_onboarding_tasks_due" ON "onboarding_tasks" USING btree ("due_date" date_ops) WHERE ((status = 'pending'::task_status) AND (due_date IS NOT NULL));--> statement-breakpoint
CREATE INDEX "idx_onboarding_tasks_onboarding_id" ON "onboarding_tasks" USING btree ("onboarding_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_onboarding_tasks_org" ON "onboarding_tasks" USING btree ("org_id" uuid_ops) WHERE (org_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_onboarding_tasks_status" ON "onboarding_tasks" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_onboarding_contact" ON "employee_onboarding" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_employee_onboarding_employee_id" ON "employee_onboarding" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_onboarding_org" ON "employee_onboarding" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_onboarding_status" ON "employee_onboarding" USING btree ("status" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_employee_onboarding_status_active" ON "employee_onboarding" USING btree ("org_id" uuid_ops,"status" uuid_ops) WHERE (status = ANY (ARRAY['not_started'::onboarding_status, 'in_progress'::onboarding_status]));--> statement-breakpoint
CREATE INDEX "idx_onboarding_templates_active" ON "onboarding_templates" USING btree ("org_id" bool_ops,"is_active" bool_ops) WHERE ((deleted_at IS NULL) AND (is_active = true));--> statement-breakpoint
CREATE INDEX "idx_onboarding_templates_default" ON "onboarding_templates" USING btree ("org_id" bool_ops,"is_default" uuid_ops) WHERE ((deleted_at IS NULL) AND (is_default = true));--> statement-breakpoint
CREATE INDEX "idx_onboarding_templates_org" ON "onboarding_templates" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_onboarding_template_tasks_org" ON "onboarding_template_tasks" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_onboarding_template_tasks_template" ON "onboarding_template_tasks" USING btree ("template_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_timesheet_entries_timesheet" ON "timesheet_entries" USING btree ("timesheet_id" uuid_ops,"work_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_timesheet_approvals_timesheet" ON "timesheet_approvals" USING btree ("timesheet_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_timesheet_expenses_timesheet" ON "timesheet_expenses" USING btree ("timesheet_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_invoice_line_items_invoice" ON "invoice_line_items" USING btree ("invoice_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_invoice_line_items_timesheet" ON "invoice_line_items" USING btree ("timesheet_id" uuid_ops) WHERE (timesheet_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_pay_items_contact" ON "pay_items" USING btree ("contact_id" uuid_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_pay_items_run" ON "pay_items" USING btree ("pay_run_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pay_items_worker" ON "pay_items" USING btree ("worker_id" enum_ops,"worker_type" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pay_item_earnings_item" ON "pay_item_earnings" USING btree ("pay_item_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pay_item_deductions_item" ON "pay_item_deductions" USING btree ("pay_item_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pay_stubs_item" ON "pay_stubs" USING btree ("pay_item_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pay_stubs_token" ON "pay_stubs" USING btree ("access_token" text_ops) WHERE (access_token IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_timesheets_invoice" ON "timesheets" USING btree ("invoice_id" uuid_ops) WHERE ((invoice_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_timesheets_org" ON "timesheets" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_timesheets_payroll" ON "timesheets" USING btree ("payroll_run_id" uuid_ops) WHERE ((payroll_run_id IS NOT NULL) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_timesheets_placement" ON "timesheets" USING btree ("placement_id" uuid_ops,"period_start" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_timesheets_status" ON "timesheets" USING btree ("status" enum_ops,"org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_timesheets_submitted" ON "timesheets" USING btree ("submitted_at" timestamptz_ops) WHERE ((status = 'submitted'::timesheet_status) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_timesheet_approval_workflows_org" ON "timesheet_approval_workflows" USING btree ("org_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_timesheet_adjustments_org" ON "timesheet_adjustments" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_timesheet_templates_org" ON "timesheet_templates" USING btree ("org_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_invoices_company" ON "invoices" USING btree ("company_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_invoices_due_date" ON "invoices" USING btree ("due_date" date_ops) WHERE ((status <> ALL (ARRAY['paid'::invoice_status, 'void'::invoice_status])) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_invoices_org" ON "invoices" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_invoices_overdue" ON "invoices" USING btree ("due_date" numeric_ops,"balance_due" numeric_ops) WHERE ((status = 'overdue'::invoice_status) AND (deleted_at IS NULL));--> statement-breakpoint
CREATE INDEX "idx_invoices_status" ON "invoices" USING btree ("status" enum_ops,"org_id" enum_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_invoice_payments_invoice" ON "invoice_payments" USING btree ("invoice_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_invoice_payments_org" ON "invoice_payments" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_payment_terms_org" ON "payment_terms" USING btree ("org_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_invoice_batches_org" ON "invoice_batches" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_invoice_templates_org" ON "invoice_templates" USING btree ("org_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_pay_periods_dates" ON "pay_periods" USING btree ("org_id" date_ops,"period_start" uuid_ops,"period_end" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pay_periods_org" ON "pay_periods" USING btree ("org_id" int4_ops,"year" int4_ops,"period_number" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_pay_runs_org" ON "pay_runs" USING btree ("org_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_pay_runs_period" ON "pay_runs" USING btree ("pay_period_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pay_runs_status" ON "pay_runs" USING btree ("status" enum_ops,"org_id" enum_ops);--> statement-breakpoint
CREATE INDEX "idx_worker_tax_setup_contact" ON "worker_tax_setup" USING btree ("contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_worker_tax_setup_org" ON "worker_tax_setup" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_worker_benefits_contact" ON "worker_benefits" USING btree ("contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_worker_benefits_org" ON "worker_benefits" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_worker_garnishments_contact" ON "worker_garnishments" USING btree ("contact_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_worker_garnishments_org" ON "worker_garnishments" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_tax_documents_org" ON "tax_documents" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_tax_documents_worker" ON "tax_documents" USING btree ("worker_id" uuid_ops,"tax_year" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_tax_documents_year" ON "tax_documents" USING btree ("tax_year" text_ops,"document_type" int4_ops) WHERE (filed_with_irs = false);--> statement-breakpoint
CREATE INDEX "idx_workflow_executions_instance" ON "workflow_executions" USING btree ("instance_id" uuid_ops,"status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_executions_org" ON "workflow_executions" USING btree ("org_id" timestamptz_ops,"status" timestamptz_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_executions_retry" ON "workflow_executions" USING btree ("next_retry_at" timestamptz_ops) WHERE (((status)::text = 'failed'::text) AND (retry_count < max_retries));--> statement-breakpoint
CREATE INDEX "idx_workflow_executions_running" ON "workflow_executions" USING btree ("org_id" uuid_ops) WHERE ((status)::text = 'running'::text);--> statement-breakpoint
CREATE INDEX "idx_workflow_steps_execution" ON "workflow_steps" USING btree ("execution_id" int4_ops,"position" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_steps_status" ON "workflow_steps" USING btree ("execution_id" uuid_ops,"status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_steps_waiting" ON "workflow_steps" USING btree ("wait_until" timestamptz_ops) WHERE ((status)::text = 'waiting'::text);--> statement-breakpoint
CREATE INDEX "idx_workflow_actions_execution" ON "workflow_actions" USING btree ("execution_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_actions_scheduled" ON "workflow_actions" USING btree ("scheduled_at" timestamptz_ops) WHERE (((status)::text = 'pending'::text) AND (scheduled_at IS NOT NULL));--> statement-breakpoint
CREATE INDEX "idx_workflow_actions_status" ON "workflow_actions" USING btree ("status" text_ops,"created_at" timestamptz_ops) WHERE ((status)::text = ANY ((ARRAY['pending'::character varying, 'running'::character varying, 'failed'::character varying])::text[]));--> statement-breakpoint
CREATE INDEX "idx_workflow_actions_step" ON "workflow_actions" USING btree ("step_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_approvals_approver" ON "workflow_approvals" USING btree ("approver_id" text_ops,"status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_approvals_due" ON "workflow_approvals" USING btree ("due_at" timestamptz_ops) WHERE ((status)::text = 'pending'::text);--> statement-breakpoint
CREATE INDEX "idx_workflow_approvals_execution" ON "workflow_approvals" USING btree ("execution_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_approvals_org_pending" ON "workflow_approvals" USING btree ("org_id" uuid_ops) WHERE ((status)::text = 'pending'::text);--> statement-breakpoint
CREATE INDEX "idx_workflow_execution_logs_execution" ON "workflow_execution_logs" USING btree ("execution_id" timestamptz_ops,"occurred_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_workflow_execution_logs_level" ON "workflow_execution_logs" USING btree ("level" timestamptz_ops,"occurred_at" text_ops) WHERE ((level)::text = ANY ((ARRAY['warning'::character varying, 'error'::character varying])::text[]));--> statement-breakpoint
CREATE INDEX "idx_workflow_execution_logs_step" ON "workflow_execution_logs" USING btree ("step_id" uuid_ops) WHERE (step_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_notification_preferences_dnd" ON "notification_preferences" USING btree ("dnd_until" timestamptz_ops) WHERE (dnd_enabled = true);--> statement-breakpoint
CREATE INDEX "idx_notification_preferences_org_user" ON "notification_preferences" USING btree ("org_id" uuid_ops,"user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_notification_preferences_user" ON "notification_preferences" USING btree ("user_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_notification_templates_category" ON "notification_templates" USING btree ("org_id" uuid_ops,"category" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_notification_templates_org" ON "notification_templates" USING btree ("org_id" uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_notification_templates_slug" ON "notification_templates" USING btree ("slug" text_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE UNIQUE INDEX "idx_notification_templates_unique_slug" ON "notification_templates" USING btree (COALESCE(org_id, '00000000-0000-0000-0000-000000000000'::uuid) uuid_ops,slug uuid_ops) WHERE (is_active = true);--> statement-breakpoint
CREATE INDEX "idx_campaigns_approval_status" ON "campaigns" USING btree ("approval_status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_campaigns_channels" ON "campaigns" USING gin ("channels" array_ops);--> statement-breakpoint
CREATE INDEX "idx_campaigns_dates" ON "campaigns" USING btree ("start_date" date_ops,"end_date" date_ops);--> statement-breakpoint
CREATE INDEX "idx_campaigns_deleted_at" ON "campaigns" USING btree ("deleted_at" timestamptz_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_campaigns_goal" ON "campaigns" USING btree ("goal" text_ops);--> statement-breakpoint
CREATE INDEX "idx_campaigns_org" ON "campaigns" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaigns_org_created" ON "campaigns" USING btree ("org_id" timestamptz_ops,"created_at" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_campaigns_org_status" ON "campaigns" USING btree ("org_id" text_ops,"status" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_campaigns_owner" ON "campaigns" USING btree ("owner_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaigns_search" ON "campaigns" USING gin ("search_vector" tsvector_ops);--> statement-breakpoint
CREATE INDEX "idx_campaigns_sequence_template_ids" ON "campaigns" USING gin ("sequence_template_ids" array_ops);--> statement-breakpoint
CREATE INDEX "idx_campaigns_status" ON "campaigns" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_campaigns_type" ON "campaigns" USING btree ("campaign_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_enrollments_active" ON "campaign_enrollments" USING btree ("campaign_id" text_ops,"status" text_ops,"next_step_at" text_ops) WHERE (status = ANY (ARRAY['enrolled'::text, 'contacted'::text, 'engaged'::text]));--> statement-breakpoint
CREATE INDEX "idx_campaign_enrollments_campaign" ON "campaign_enrollments" USING btree ("campaign_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_enrollments_campaign_org" ON "campaign_enrollments" USING btree ("campaign_id" uuid_ops,"org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_enrollments_contact" ON "campaign_enrollments" USING btree ("contact_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_enrollments_funnel" ON "campaign_enrollments" USING btree ("campaign_id" timestamptz_ops,"first_contacted_at" timestamptz_ops,"opened_at" timestamptz_ops,"clicked_at" timestamptz_ops,"responded_at" timestamptz_ops,"converted_to_lead_at" timestamptz_ops,"meeting_booked_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_enrollments_next_step" ON "campaign_enrollments" USING btree ("next_step_at" timestamptz_ops) WHERE ((status = 'enrolled'::text) AND (next_step_at IS NOT NULL));--> statement-breakpoint
CREATE INDEX "idx_campaign_enrollments_org" ON "campaign_enrollments" USING btree ("org_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_enrollments_sequence" ON "campaign_enrollments" USING btree ("campaign_id" text_ops,"sequence_status" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_enrollments_status" ON "campaign_enrollments" USING btree ("status" text_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_sequence_logs_action_at" ON "campaign_sequence_logs" USING btree ("action_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_sequence_logs_action_type" ON "campaign_sequence_logs" USING btree ("action_type" text_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_sequence_logs_campaign" ON "campaign_sequence_logs" USING btree ("campaign_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_campaign_sequence_logs_enrollment" ON "campaign_sequence_logs" USING btree ("enrollment_id" int4_ops,"step_number" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_communications_campaign" ON "communications" USING btree ("campaign_id" uuid_ops,"created_at" uuid_ops) WHERE (campaign_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_communications_channel" ON "communications" USING btree ("org_id" timestamptz_ops,"channel" uuid_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_communications_contact" ON "communications" USING btree ("contact_id" timestamptz_ops,"created_at" timestamptz_ops) WHERE (contact_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_communications_entity" ON "communications" USING btree ("entity_type" timestamptz_ops,"entity_id" uuid_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_communications_org" ON "communications" USING btree ("org_id" uuid_ops,"created_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_communications_provider" ON "communications" USING btree ("provider_message_id" text_ops) WHERE (provider_message_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_communications_queue" ON "communications" USING btree ("scheduled_at" timestamptz_ops) WHERE (((status)::text = ANY ((ARRAY['pending'::character varying, 'queued'::character varying])::text[])) AND (scheduled_at IS NOT NULL));--> statement-breakpoint
CREATE INDEX "idx_communications_status" ON "communications" USING btree ("org_id" uuid_ops,"status" uuid_ops,"created_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_communications_thread" ON "communications" USING btree ("thread_id" uuid_ops) WHERE (thread_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_communication_events_comm" ON "communication_events" USING btree ("communication_id" timestamptz_ops,"occurred_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "idx_communication_events_type" ON "communication_events" USING btree ("event_type" text_ops,"occurred_at" text_ops);--> statement-breakpoint
CREATE INDEX "idx_pto_balances_employee" ON "pto_balances" USING btree ("employee_id" uuid_ops);--> statement-breakpoint
CREATE INDEX "idx_pto_balances_year" ON "pto_balances" USING btree ("year" int4_ops);--> statement-breakpoint
CREATE INDEX "idx_user_roles_expires" ON "user_roles" USING btree ("expires_at" timestamptz_ops) WHERE (expires_at IS NOT NULL);--> statement-breakpoint
CREATE INDEX "idx_user_roles_primary" ON "user_roles" USING btree ("user_id" bool_ops,"is_primary" bool_ops) WHERE (is_primary = true);--> statement-breakpoint
CREATE INDEX "idx_user_roles_role" ON "user_roles" USING btree ("role_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "idx_user_roles_user" ON "user_roles" USING btree ("user_id" uuid_ops) WHERE (deleted_at IS NULL);--> statement-breakpoint
CREATE INDEX "system_events_2025_12_entity_type_entity_id_occurred_at_idx" ON "system_events_2025_12" USING btree ("entity_type" timestamptz_ops,"entity_id" uuid_ops,"occurred_at" timestamptz_ops) WHERE (entity_type IS NOT NULL);--> statement-breakpoint
CREATE INDEX "system_events_2025_12_event_category_occurred_at_idx" ON "system_events_2025_12" USING btree ("event_category" enum_ops,"occurred_at" enum_ops);--> statement-breakpoint
CREATE INDEX "system_events_2025_12_event_type_occurred_at_idx" ON "system_events_2025_12" USING btree ("event_type" text_ops,"occurred_at" text_ops);--> statement-breakpoint
CREATE INDEX "system_events_2025_12_severity_occurred_at_idx" ON "system_events_2025_12" USING btree ("severity" enum_ops,"occurred_at" enum_ops) WHERE (severity = ANY (ARRAY['warning'::event_severity, 'error'::event_severity, 'critical'::event_severity]));--> statement-breakpoint
CREATE INDEX "system_events_2025_12_user_id_occurred_at_idx" ON "system_events_2025_12" USING btree ("user_id" uuid_ops,"occurred_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "system_events_2026_01_entity_type_entity_id_occurred_at_idx" ON "system_events_2026_01" USING btree ("entity_type" timestamptz_ops,"entity_id" uuid_ops,"occurred_at" timestamptz_ops) WHERE (entity_type IS NOT NULL);--> statement-breakpoint
CREATE INDEX "system_events_2026_01_event_category_occurred_at_idx" ON "system_events_2026_01" USING btree ("event_category" enum_ops,"occurred_at" enum_ops);--> statement-breakpoint
CREATE INDEX "system_events_2026_01_event_type_occurred_at_idx" ON "system_events_2026_01" USING btree ("event_type" text_ops,"occurred_at" text_ops);--> statement-breakpoint
CREATE INDEX "system_events_2026_01_severity_occurred_at_idx" ON "system_events_2026_01" USING btree ("severity" enum_ops,"occurred_at" enum_ops) WHERE (severity = ANY (ARRAY['warning'::event_severity, 'error'::event_severity, 'critical'::event_severity]));--> statement-breakpoint
CREATE INDEX "system_events_2026_01_user_id_occurred_at_idx" ON "system_events_2026_01" USING btree ("user_id" uuid_ops,"occurred_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "system_events_2026_02_entity_type_entity_id_occurred_at_idx" ON "system_events_2026_02" USING btree ("entity_type" timestamptz_ops,"entity_id" uuid_ops,"occurred_at" timestamptz_ops) WHERE (entity_type IS NOT NULL);--> statement-breakpoint
CREATE INDEX "system_events_2026_02_event_category_occurred_at_idx" ON "system_events_2026_02" USING btree ("event_category" enum_ops,"occurred_at" enum_ops);--> statement-breakpoint
CREATE INDEX "system_events_2026_02_event_type_occurred_at_idx" ON "system_events_2026_02" USING btree ("event_type" text_ops,"occurred_at" text_ops);--> statement-breakpoint
CREATE INDEX "system_events_2026_02_severity_occurred_at_idx" ON "system_events_2026_02" USING btree ("severity" enum_ops,"occurred_at" enum_ops) WHERE (severity = ANY (ARRAY['warning'::event_severity, 'error'::event_severity, 'critical'::event_severity]));--> statement-breakpoint
CREATE INDEX "system_events_2026_02_user_id_occurred_at_idx" ON "system_events_2026_02" USING btree ("user_id" uuid_ops,"occurred_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "system_events_2026_03_entity_type_entity_id_occurred_at_idx" ON "system_events_2026_03" USING btree ("entity_type" timestamptz_ops,"entity_id" uuid_ops,"occurred_at" timestamptz_ops) WHERE (entity_type IS NOT NULL);--> statement-breakpoint
CREATE INDEX "system_events_2026_03_event_category_occurred_at_idx" ON "system_events_2026_03" USING btree ("event_category" enum_ops,"occurred_at" enum_ops);--> statement-breakpoint
CREATE INDEX "system_events_2026_03_event_type_occurred_at_idx" ON "system_events_2026_03" USING btree ("event_type" text_ops,"occurred_at" text_ops);--> statement-breakpoint
CREATE INDEX "system_events_2026_03_severity_occurred_at_idx" ON "system_events_2026_03" USING btree ("severity" enum_ops,"occurred_at" enum_ops) WHERE (severity = ANY (ARRAY['warning'::event_severity, 'error'::event_severity, 'critical'::event_severity]));--> statement-breakpoint
CREATE INDEX "system_events_2026_03_user_id_occurred_at_idx" ON "system_events_2026_03" USING btree ("user_id" uuid_ops,"occurred_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_02_contains_pii_is_masked_idx" ON "audit_log_2026_02" USING btree ("contains_pii" bool_ops,"is_masked" bool_ops) WHERE (contains_pii = true);--> statement-breakpoint
CREATE INDEX "audit_log_2026_02_entity_type_entity_id_performed_at_idx" ON "audit_log_2026_02" USING btree ("entity_type" timestamptz_ops,"entity_id" text_ops,"performed_at" text_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_02_org_id_performed_at_idx" ON "audit_log_2026_02" USING btree ("org_id" uuid_ops,"performed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_02_performed_by_performed_at_idx" ON "audit_log_2026_02" USING btree ("performed_by" timestamptz_ops,"performed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_02_retention_until_idx" ON "audit_log_2026_02" USING btree ("retention_until" date_ops) WHERE (retention_until IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_log_2026_03_contains_pii_is_masked_idx" ON "audit_log_2026_03" USING btree ("contains_pii" bool_ops,"is_masked" bool_ops) WHERE (contains_pii = true);--> statement-breakpoint
CREATE INDEX "audit_log_2026_03_entity_type_entity_id_performed_at_idx" ON "audit_log_2026_03" USING btree ("entity_type" timestamptz_ops,"entity_id" text_ops,"performed_at" text_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_03_org_id_performed_at_idx" ON "audit_log_2026_03" USING btree ("org_id" uuid_ops,"performed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_03_performed_by_performed_at_idx" ON "audit_log_2026_03" USING btree ("performed_by" timestamptz_ops,"performed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_03_retention_until_idx" ON "audit_log_2026_03" USING btree ("retention_until" date_ops) WHERE (retention_until IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_log_2025_12_contains_pii_is_masked_idx" ON "audit_log_2025_12" USING btree ("contains_pii" bool_ops,"is_masked" bool_ops) WHERE (contains_pii = true);--> statement-breakpoint
CREATE INDEX "audit_log_2025_12_entity_type_entity_id_performed_at_idx" ON "audit_log_2025_12" USING btree ("entity_type" timestamptz_ops,"entity_id" text_ops,"performed_at" text_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2025_12_org_id_performed_at_idx" ON "audit_log_2025_12" USING btree ("org_id" uuid_ops,"performed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2025_12_performed_by_performed_at_idx" ON "audit_log_2025_12" USING btree ("performed_by" timestamptz_ops,"performed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2025_12_retention_until_idx" ON "audit_log_2025_12" USING btree ("retention_until" date_ops) WHERE (retention_until IS NOT NULL);--> statement-breakpoint
CREATE INDEX "audit_log_2026_01_contains_pii_is_masked_idx" ON "audit_log_2026_01" USING btree ("contains_pii" bool_ops,"is_masked" bool_ops) WHERE (contains_pii = true);--> statement-breakpoint
CREATE INDEX "audit_log_2026_01_entity_type_entity_id_performed_at_idx" ON "audit_log_2026_01" USING btree ("entity_type" timestamptz_ops,"entity_id" text_ops,"performed_at" text_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_01_org_id_performed_at_idx" ON "audit_log_2026_01" USING btree ("org_id" uuid_ops,"performed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_01_performed_by_performed_at_idx" ON "audit_log_2026_01" USING btree ("performed_by" timestamptz_ops,"performed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "audit_log_2026_01_retention_until_idx" ON "audit_log_2026_01" USING btree ("retention_until" date_ops) WHERE (retention_until IS NOT NULL);--> statement-breakpoint
CREATE INDEX "entity_history_2026_01_changed_by_changed_at_idx" ON "entity_history_2026_01" USING btree ("changed_by" timestamptz_ops,"changed_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_01_correlation_id_idx" ON "entity_history_2026_01" USING btree ("correlation_id" uuid_ops) WHERE (correlation_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "entity_history_2026_01_entity_type_entity_id_changed_at_idx" ON "entity_history_2026_01" USING btree ("entity_type" timestamptz_ops,"entity_id" timestamptz_ops,"changed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_01_entity_type_field_name_changed_at_idx" ON "entity_history_2026_01" USING btree ("entity_type" timestamptz_ops,"field_name" timestamptz_ops,"changed_at" text_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_01_org_id_changed_at_idx" ON "entity_history_2026_01" USING btree ("org_id" timestamptz_ops,"changed_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_02_changed_by_changed_at_idx" ON "entity_history_2026_02" USING btree ("changed_by" uuid_ops,"changed_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_02_correlation_id_idx" ON "entity_history_2026_02" USING btree ("correlation_id" uuid_ops) WHERE (correlation_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "entity_history_2026_02_entity_type_entity_id_changed_at_idx" ON "entity_history_2026_02" USING btree ("entity_type" uuid_ops,"entity_id" text_ops,"changed_at" text_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_02_entity_type_field_name_changed_at_idx" ON "entity_history_2026_02" USING btree ("entity_type" text_ops,"field_name" timestamptz_ops,"changed_at" text_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_02_org_id_changed_at_idx" ON "entity_history_2026_02" USING btree ("org_id" timestamptz_ops,"changed_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_03_changed_by_changed_at_idx" ON "entity_history_2026_03" USING btree ("changed_by" uuid_ops,"changed_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_03_correlation_id_idx" ON "entity_history_2026_03" USING btree ("correlation_id" uuid_ops) WHERE (correlation_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "entity_history_2026_03_entity_type_entity_id_changed_at_idx" ON "entity_history_2026_03" USING btree ("entity_type" uuid_ops,"entity_id" text_ops,"changed_at" text_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_03_entity_type_field_name_changed_at_idx" ON "entity_history_2026_03" USING btree ("entity_type" text_ops,"field_name" timestamptz_ops,"changed_at" text_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2026_03_org_id_changed_at_idx" ON "entity_history_2026_03" USING btree ("org_id" timestamptz_ops,"changed_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2025_12_changed_by_changed_at_idx" ON "entity_history_2025_12" USING btree ("changed_by" timestamptz_ops,"changed_at" uuid_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2025_12_correlation_id_idx" ON "entity_history_2025_12" USING btree ("correlation_id" uuid_ops) WHERE (correlation_id IS NOT NULL);--> statement-breakpoint
CREATE INDEX "entity_history_2025_12_entity_type_entity_id_changed_at_idx" ON "entity_history_2025_12" USING btree ("entity_type" timestamptz_ops,"entity_id" timestamptz_ops,"changed_at" timestamptz_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2025_12_entity_type_field_name_changed_at_idx" ON "entity_history_2025_12" USING btree ("entity_type" timestamptz_ops,"field_name" timestamptz_ops,"changed_at" text_ops);--> statement-breakpoint
CREATE INDEX "entity_history_2025_12_org_id_changed_at_idx" ON "entity_history_2025_12" USING btree ("org_id" timestamptz_ops,"changed_at" uuid_ops);--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."revenue_analytics" AS (SELECT date_trunc('month'::text, pt.created_at) AS month, sum( CASE WHEN pt.status = 'succeeded'::text AND se.payment_type = 'subscription'::text THEN pt.amount ELSE 0::numeric END) AS mrr, sum( CASE WHEN pt.status = 'succeeded'::text THEN pt.amount ELSE 0::numeric END) AS total_revenue, sum( CASE WHEN pt.status = 'succeeded'::text AND se.payment_type = 'one_time'::text THEN pt.amount ELSE 0::numeric END) AS one_time_revenue, count(DISTINCT se.id) AS total_enrollments, count(DISTINCT CASE WHEN se.status = 'active'::text AND se.payment_type = 'subscription'::text THEN se.id ELSE NULL::uuid END) AS active_subscriptions, count(DISTINCT CASE WHEN se.payment_type = 'subscription'::text AND date_trunc('month'::text, se.enrolled_at) = date_trunc('month'::text, pt.created_at) THEN se.id ELSE NULL::uuid END) AS new_subscriptions, count(DISTINCT CASE WHEN (se.status = ANY (ARRAY['dropped'::text, 'expired'::text])) AND se.payment_type = 'subscription'::text AND date_trunc('month'::text, se.updated_at) = date_trunc('month'::text, pt.created_at) THEN se.id ELSE NULL::uuid END) AS churned_subscriptions, count( CASE WHEN pt.status = 'succeeded'::text THEN 1 ELSE NULL::integer END) AS successful_payments, count( CASE WHEN pt.status = 'failed'::text THEN 1 ELSE NULL::integer END) AS failed_payments, count( CASE WHEN pt.status = 'refunded'::text THEN 1 ELSE NULL::integer END) AS refunded_payments, sum( CASE WHEN pt.status = 'refunded'::text THEN pt.amount ELSE 0::numeric END) AS refund_amount, avg( CASE WHEN pt.status = 'succeeded'::text THEN pt.amount ELSE NULL::numeric END) AS avg_revenue_per_enrollment, count(DISTINCT pt.user_id) AS unique_paying_students FROM payment_transactions pt JOIN student_enrollments se ON se.id = pt.enrollment_id GROUP BY (date_trunc('month'::text, pt.created_at)));--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."course_revenue_analytics" AS (SELECT c.id AS course_id, c.title AS course_title, c.slug AS course_slug, sum( CASE WHEN pt.status = 'succeeded'::text THEN pt.amount ELSE 0::numeric END) AS total_revenue, count(DISTINCT se.id) AS total_enrollments, count(DISTINCT CASE WHEN se.status = 'active'::text THEN se.id ELSE NULL::uuid END) AS active_enrollments, count(DISTINCT CASE WHEN se.status = 'completed'::text THEN se.id ELSE NULL::uuid END) AS completed_enrollments, avg( CASE WHEN pt.status = 'succeeded'::text THEN pt.amount ELSE NULL::numeric END) AS avg_revenue_per_enrollment, round(count(DISTINCT CASE WHEN se.status = 'completed'::text THEN se.id ELSE NULL::uuid END)::numeric / NULLIF(count(DISTINCT se.id), 0)::numeric * 100::numeric, 2) AS completion_rate_percent, min(se.enrolled_at) AS first_enrollment_at, max(se.enrolled_at) AS last_enrollment_at FROM courses c LEFT JOIN student_enrollments se ON se.course_id = c.id LEFT JOIN payment_transactions pt ON pt.enrollment_id = se.id WHERE c.deleted_at IS NULL GROUP BY c.id, c.title, c.slug);--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."user_xp_totals" AS (SELECT user_id, sum(amount) AS total_xp, count(*) AS transaction_count, max(awarded_at) AS last_xp_earned_at, rank() OVER (ORDER BY (sum(amount)) DESC) AS leaderboard_rank FROM xp_transactions GROUP BY user_id);--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."student_ltv_analytics" AS (SELECT up.id AS student_id, up.full_name AS student_name, up.email AS student_email, sum( CASE WHEN pt.status = 'succeeded'::text THEN pt.amount ELSE 0::numeric END) AS lifetime_revenue, count(DISTINCT se.id) AS total_enrollments, count(DISTINCT CASE WHEN se.status = 'active'::text AND se.payment_type = 'subscription'::text THEN se.id ELSE NULL::uuid END) AS active_subscriptions, avg( CASE WHEN pt.status = 'succeeded'::text THEN pt.amount ELSE NULL::numeric END) AS avg_revenue_per_enrollment, min(pt.created_at) AS first_purchase_at, max(pt.created_at) AS last_purchase_at, EXTRACT(epoch FROM max(pt.created_at) - min(pt.created_at)) / (30 * 24 * 60 * 60)::numeric AS months_as_customer FROM user_profiles up JOIN payment_transactions pt ON pt.user_id = up.id JOIN student_enrollments se ON se.id = pt.enrollment_id WHERE pt.status = 'succeeded'::text GROUP BY up.id, up.full_name, up.email);--> statement-breakpoint
CREATE VIEW "public"."v_sprint_5_status" AS (SELECT 'generated_resumes'::text AS table_name, count(*) AS total_records, count(DISTINCT generated_resumes.org_id) AS unique_orgs, count(DISTINCT generated_resumes.user_id) AS unique_users, count(*) FILTER (WHERE generated_resumes.placement_achieved = true) AS placements, round(avg(generated_resumes.quality_score), 2) AS avg_quality FROM generated_resumes UNION ALL SELECT 'candidate_embeddings'::text AS table_name, count(*) AS total_records, count(DISTINCT candidate_embeddings.org_id) AS unique_orgs, count(DISTINCT candidate_embeddings.candidate_id) AS unique_users, NULL::bigint AS placements, NULL::numeric AS avg_quality FROM candidate_embeddings UNION ALL SELECT 'requisition_embeddings'::text AS table_name, count(*) AS total_records, count(DISTINCT requisition_embeddings.org_id) AS unique_orgs, count(DISTINCT requisition_embeddings.requisition_id) AS unique_users, NULL::bigint AS placements, NULL::numeric AS avg_quality FROM requisition_embeddings UNION ALL SELECT 'resume_matches'::text AS table_name, count(*) AS total_records, count(DISTINCT resume_matches.org_id) AS unique_orgs, count(DISTINCT resume_matches.candidate_id) AS unique_users, count(*) FILTER (WHERE resume_matches.placement_achieved = true) AS placements, round(avg(resume_matches.match_score), 2) AS avg_quality FROM resume_matches);--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."discount_effectiveness_analytics" AS (SELECT dc.id AS discount_code_id, dc.code AS discount_code, dc.name AS discount_name, dc.discount_type, dc.discount_value, count(dcu.id) AS total_uses, dc.max_uses AS max_uses_limit, sum(dcu.original_amount) AS total_original_amount, sum(dcu.discount_amount) AS total_discount_given, sum(dcu.final_amount) AS total_revenue_generated, avg(dcu.discount_amount) AS avg_discount_per_use, round(sum(dcu.final_amount) / NULLIF(sum(dcu.discount_amount), 0::numeric), 2) AS roi_ratio, min(dcu.used_at) AS first_used_at, max(dcu.used_at) AS last_used_at, dc.is_active, dc.valid_from, dc.valid_until FROM discount_codes dc LEFT JOIN discount_code_usage dcu ON dcu.discount_code_id = dc.id WHERE dc.deleted_at IS NULL GROUP BY dc.id, dc.code, dc.name, dc.discount_type, dc.discount_value, dc.max_uses, dc.is_active, dc.valid_from, dc.valid_until);--> statement-breakpoint
CREATE VIEW "public"."module_unlock_requirements" AS (SELECT id AS module_id, course_id, title AS module_title, module_number, prerequisite_module_ids, ( SELECT array_agg(cm2.title) AS array_agg FROM course_modules cm2 WHERE cm2.id = ANY (cm.prerequisite_module_ids)) AS prerequisite_titles, ( SELECT array_agg(cm2.module_number) AS array_agg FROM course_modules cm2 WHERE cm2.id = ANY (cm.prerequisite_module_ids)) AS prerequisite_numbers FROM course_modules cm);--> statement-breakpoint
CREATE VIEW "public"."topic_unlock_requirements" AS (SELECT id AS topic_id, module_id, title AS topic_title, topic_number, prerequisite_topic_ids, ( SELECT array_agg(mt2.title) AS array_agg FROM module_topics mt2 WHERE mt2.id = ANY (mt.prerequisite_topic_ids)) AS prerequisite_titles, ( SELECT array_agg(mt2.topic_number) AS array_agg FROM module_topics mt2 WHERE mt2.id = ANY (mt.prerequisite_topic_ids)) AS prerequisite_numbers FROM module_topics mt);--> statement-breakpoint
CREATE VIEW "public"."video_watch_stats" AS (SELECT vp.user_id, vp.topic_id, vp.enrollment_id, mt.title AS topic_title, cm.title AS module_title, c.title AS course_title, vp.total_watch_time_seconds, vp.completion_percentage, vp.session_count, vp.last_watched_at, vp.video_duration_seconds, vp.video_provider, CASE WHEN vp.video_duration_seconds > 0 THEN LEAST(100, vp.total_watch_time_seconds * 100 / vp.video_duration_seconds) ELSE 0 END AS engagement_score FROM video_progress vp JOIN module_topics mt ON mt.id = vp.topic_id JOIN course_modules cm ON cm.id = mt.module_id JOIN courses c ON c.id = cm.course_id);--> statement-breakpoint
CREATE VIEW "public"."v_timeline_recent" AS (SELECT pt.id, pt.session_id, pt.session_date, pt.agent_type, pt.agent_model, pt.duration, pt.conversation_summary, pt.user_intent, pt.actions_taken, pt.files_changed, pt.decisions, pt.assumptions, pt.results, pt.future_notes, pt.related_commits, pt.related_prs, pt.related_docs, pt.tags, pt.ai_generated_summary, pt.key_learnings, pt.search_vector, pt.created_at, pt.updated_at, pt.deleted_at, pt.is_archived, sm.started_at AS session_started_at, sm.ended_at AS session_ended_at, sm.branch AS session_branch, sm.successfully_completed FROM project_timeline pt LEFT JOIN session_metadata sm ON pt.session_id::text = sm.session_id::text WHERE pt.is_archived = false AND pt.deleted_at IS NULL ORDER BY pt.session_date DESC LIMIT 100);--> statement-breakpoint
CREATE VIEW "public"."v_timeline_stats_by_tag" AS (SELECT unnest(tags) AS tag, count(*) AS entry_count, count(DISTINCT session_id) AS session_count, min(session_date) AS first_occurrence, max(session_date) AS last_occurrence FROM project_timeline WHERE is_archived = false AND deleted_at IS NULL GROUP BY (unnest(tags)) ORDER BY (count(*)) DESC);--> statement-breakpoint
CREATE VIEW "public"."v_session_summary" AS (SELECT sm.id, sm.session_id, sm.started_at, sm.ended_at, sm.duration, sm.branch, sm.commit_hash, sm.environment, sm.files_modified, sm.lines_added, sm.lines_removed, sm.commands_executed, sm.overall_goal, sm.successfully_completed, sm.created_at, sm.updated_at, count(pt.id) AS timeline_entries, COALESCE(array_agg(DISTINCT t.tag) FILTER (WHERE t.tag IS NOT NULL), ARRAY[]::text[]) AS all_tags FROM session_metadata sm LEFT JOIN project_timeline pt ON sm.session_id::text = pt.session_id::text LEFT JOIN LATERAL unnest(pt.tags) t(tag) ON true GROUP BY sm.id ORDER BY sm.started_at DESC);--> statement-breakpoint
CREATE VIEW "public"."v_active_users" AS (SELECT id, auth_id, email, full_name, avatar_url, phone, timezone, locale, student_enrollment_date, student_course_id, student_current_module, student_course_progress, student_graduation_date, student_certificates, employee_hire_date, employee_department, employee_position, employee_salary, employee_status, employee_manager_id, employee_performance_rating, candidate_status, candidate_resume_url, candidate_skills, candidate_experience_years, candidate_current_visa, candidate_visa_expiry, candidate_hourly_rate, candidate_bench_start_date, candidate_availability, candidate_location, candidate_willing_to_relocate, client_company_name, client_industry, client_tier, client_contract_start_date, client_contract_end_date, client_payment_terms, client_preferred_markup_percentage, recruiter_territory, recruiter_specialization, recruiter_monthly_placement_target, recruiter_pod_id, created_at, updated_at, created_by, updated_by, deleted_at, is_active, search_vector FROM user_profiles WHERE deleted_at IS NULL AND is_active = true);--> statement-breakpoint
CREATE VIEW "public"."v_students" AS (SELECT id, email, full_name, student_enrollment_date, student_current_module, student_course_progress, student_graduation_date, created_at FROM user_profiles WHERE student_enrollment_date IS NOT NULL AND deleted_at IS NULL ORDER BY student_enrollment_date DESC);--> statement-breakpoint
CREATE VIEW "public"."v_bench_candidates" AS (SELECT id, email, full_name, candidate_skills, candidate_experience_years, candidate_current_visa, candidate_hourly_rate, candidate_availability, candidate_location, candidate_bench_start_date FROM user_profiles WHERE candidate_status = 'bench'::text AND deleted_at IS NULL ORDER BY candidate_bench_start_date);--> statement-breakpoint
CREATE VIEW "public"."v_employees" AS (SELECT id, email, full_name, employee_department, employee_position, employee_hire_date, employee_manager_id, employee_status FROM user_profiles WHERE employee_hire_date IS NOT NULL AND employee_status = 'active'::text AND deleted_at IS NULL ORDER BY employee_hire_date DESC);--> statement-breakpoint
CREATE VIEW "public"."v_clients" AS (SELECT id, email, full_name AS contact_name, client_company_name, client_industry, client_tier, client_contract_start_date, client_contract_end_date, client_payment_terms FROM user_profiles WHERE client_company_name IS NOT NULL AND deleted_at IS NULL ORDER BY client_tier DESC, client_company_name);--> statement-breakpoint
CREATE VIEW "public"."v_user_roles_detailed" AS (SELECT up.id AS user_id, up.email, up.full_name, r.name AS role_name, r.display_name AS role_display_name, ur.is_primary, ur.assigned_at, ur.expires_at, CASE WHEN ur.expires_at IS NOT NULL AND ur.expires_at < now() THEN 'expired'::text WHEN ur.deleted_at IS NOT NULL THEN 'revoked'::text ELSE 'active'::text END AS role_status FROM user_profiles up JOIN user_roles ur ON up.id = ur.user_id JOIN roles r ON ur.role_id = r.id WHERE up.deleted_at IS NULL ORDER BY up.email, ur.is_primary DESC, r.name);--> statement-breakpoint
CREATE VIEW "public"."v_audit_logs_recent" AS (SELECT al.id, al.created_at, al.table_name, al.action, al.user_email, al.changed_fields, al.severity, up.full_name AS user_name FROM audit_logs al LEFT JOIN user_profiles up ON al.user_id = up.id WHERE al.created_at > (now() - '7 days'::interval) ORDER BY al.created_at DESC LIMIT 1000);--> statement-breakpoint
CREATE VIEW "public"."v_audit_logs_critical" AS (SELECT al.id, al.created_at, al.table_name, al.action, al.user_email, al.record_id, al.metadata, up.full_name AS user_name FROM audit_logs al LEFT JOIN user_profiles up ON al.user_id = up.id WHERE al.severity = ANY (ARRAY['error'::text, 'critical'::text]) ORDER BY al.created_at DESC);--> statement-breakpoint
CREATE VIEW "public"."v_user_activity_summary" AS (SELECT user_id, user_email, count(*) AS total_actions, count(*) FILTER (WHERE action = 'INSERT'::text) AS inserts, count(*) FILTER (WHERE action = 'UPDATE'::text) AS updates, count(*) FILTER (WHERE action = 'DELETE'::text) AS deletes, max(created_at) AS last_activity FROM audit_logs WHERE user_id IS NOT NULL AND created_at > (now() - '30 days'::interval) GROUP BY user_id, user_email ORDER BY (count(*)) DESC);--> statement-breakpoint
CREATE VIEW "public"."v_events_recent" AS (SELECT e.id, e.event_type, e.event_category, e.status, e.user_email, e.payload, e.created_at, up.full_name AS triggered_by FROM events e LEFT JOIN user_profiles up ON e.user_id = up.id WHERE e.created_at > (now() - '24:00:00'::interval) ORDER BY e.created_at DESC LIMIT 100);--> statement-breakpoint
CREATE VIEW "public"."v_events_failed" AS (SELECT id, event_type, status, retry_count, max_retries, next_retry_at, error_message, created_at, failed_at FROM events e WHERE status = ANY (ARRAY['failed'::text, 'dead_letter'::text]) ORDER BY created_at DESC);--> statement-breakpoint
CREATE VIEW "public"."v_event_stats_by_type" AS (SELECT event_type, count(*) AS total_events, count(*) FILTER (WHERE status = 'completed'::text) AS completed, count(*) FILTER (WHERE status = 'failed'::text) AS failed, count(*) FILTER (WHERE status = 'dead_letter'::text) AS dead_letter, avg(EXTRACT(epoch FROM processed_at - created_at)) AS avg_processing_time_seconds, max(created_at) AS last_event_at FROM events WHERE created_at > (now() - '7 days'::interval) GROUP BY event_type ORDER BY (count(*)) DESC);--> statement-breakpoint
CREATE VIEW "public"."v_subscriber_performance" AS (SELECT es.subscriber_name, es.event_pattern, count(edl.id) AS total_deliveries, count(*) FILTER (WHERE edl.status = 'success'::text) AS successful, count(*) FILTER (WHERE edl.status = 'failure'::text) AS failed, avg(edl.duration_ms) AS avg_duration_ms, max(edl.attempted_at) AS last_delivery_at FROM event_subscriptions es LEFT JOIN event_delivery_log edl ON es.id = edl.subscription_id WHERE edl.attempted_at > (now() - '7 days'::interval) GROUP BY es.id, es.subscriber_name, es.event_pattern ORDER BY (count(edl.id)) DESC);--> statement-breakpoint
CREATE VIEW "public"."v_rls_status" AS (SELECT schemaname, tablename, rowsecurity AS rls_enabled FROM pg_tables WHERE schemaname = 'public'::name AND (tablename = ANY (ARRAY['user_profiles'::name, 'roles'::name, 'permissions'::name, 'user_roles'::name, 'role_permissions'::name, 'audit_logs'::name, 'events'::name, 'event_subscriptions'::name])) ORDER BY tablename);--> statement-breakpoint
CREATE VIEW "public"."v_rls_policies" AS (SELECT schemaname, tablename, policyname, permissive, roles, cmd, qual, with_check FROM pg_policies WHERE schemaname = 'public'::name ORDER BY tablename, policyname);--> statement-breakpoint
CREATE VIEW "public"."v_multi_tenancy_status" AS (SELECT 'organizations'::text AS table_name, count(*) AS total_records, count(DISTINCT organizations.id) AS unique_orgs, count(*) FILTER (WHERE organizations.status = 'active'::text) AS active_orgs, count(*) FILTER (WHERE organizations.deleted_at IS NOT NULL) AS soft_deleted_orgs FROM organizations UNION ALL SELECT 'user_profiles'::text AS table_name, count(*) AS total_records, count(DISTINCT user_profiles.org_id) AS unique_orgs, count(*) FILTER (WHERE user_profiles.org_id IS NOT NULL) AS active_orgs, NULL::bigint AS soft_deleted_orgs FROM user_profiles UNION ALL SELECT 'audit_logs'::text AS table_name, count(*) AS total_records, count(DISTINCT audit_logs.org_id) AS unique_orgs, count(*) FILTER (WHERE audit_logs.org_id IS NOT NULL) AS active_orgs, NULL::bigint AS soft_deleted_orgs FROM audit_logs UNION ALL SELECT 'events'::text AS table_name, count(*) AS total_records, count(DISTINCT events.org_id) AS unique_orgs, count(*) FILTER (WHERE events.org_id IS NOT NULL) AS active_orgs, NULL::bigint AS soft_deleted_orgs FROM events UNION ALL SELECT 'event_delivery_log'::text AS table_name, count(*) AS total_records, count(DISTINCT event_delivery_log.org_id) AS unique_orgs, count(*) FILTER (WHERE event_delivery_log.org_id IS NOT NULL) AS active_orgs, NULL::bigint AS soft_deleted_orgs FROM event_delivery_log UNION ALL SELECT 'project_timeline'::text AS table_name, count(*) AS total_records, count(DISTINCT project_timeline.org_id) AS unique_orgs, count(*) FILTER (WHERE project_timeline.org_id IS NOT NULL) AS active_orgs, NULL::bigint AS soft_deleted_orgs FROM project_timeline UNION ALL SELECT 'session_metadata'::text AS table_name, count(*) AS total_records, count(DISTINCT session_metadata.org_id) AS unique_orgs, count(*) FILTER (WHERE session_metadata.org_id IS NOT NULL) AS active_orgs, NULL::bigint AS soft_deleted_orgs FROM session_metadata);--> statement-breakpoint
CREATE VIEW "public"."v_organization_stats" AS (SELECT o.id, o.name, o.slug, o.subscription_tier, o.subscription_status, o.status, o.max_users, count(DISTINCT up.id) AS current_users, o.max_users - count(DISTINCT up.id) AS available_user_slots, o.max_candidates, count(DISTINCT up.id) FILTER (WHERE up.candidate_status IS NOT NULL) AS current_candidates, o.created_at, o.updated_at FROM organizations o LEFT JOIN user_profiles up ON up.org_id = o.id AND up.deleted_at IS NULL WHERE o.deleted_at IS NULL GROUP BY o.id);--> statement-breakpoint
CREATE VIEW "public"."ai_foundation_validation" AS (SELECT 'RLS Functions'::text AS component, CASE WHEN count(*) = 4 THEN 'OK'::text ELSE 'MISSING'::text END AS status FROM pg_proc WHERE (pg_proc.proname = ANY (ARRAY['auth_user_id'::name, 'auth_user_org_id'::name, 'user_is_admin'::name, 'user_has_role'::name])) AND pg_proc.pronamespace = 'public'::regnamespace::oid UNION ALL SELECT 'AI Tables'::text AS component, CASE WHEN count(*) = 3 THEN 'OK'::text ELSE 'MISSING'::text END AS status FROM pg_tables WHERE pg_tables.schemaname = 'public'::name AND (pg_tables.tablename = ANY (ARRAY['ai_conversations'::name, 'ai_embeddings'::name, 'ai_patterns'::name])) UNION ALL SELECT 'pgvector Extension'::text AS component, CASE WHEN count(*) = 1 THEN 'OK'::text ELSE 'NOT INSTALLED'::text END AS status FROM pg_extension WHERE pg_extension.extname = 'vector'::name UNION ALL SELECT 'Vector Search Function'::text AS component, CASE WHEN count(*) = 1 THEN 'OK'::text ELSE 'MISSING'::text END AS status FROM pg_proc WHERE pg_proc.proname = 'search_embeddings'::name AND pg_proc.pronamespace = 'public'::regnamespace::oid);--> statement-breakpoint
CREATE VIEW "public"."v_agent_framework_status" AS (SELECT ( SELECT count(*) AS count FROM ai_prompts WHERE ai_prompts.is_active = true) AS active_prompts, ( SELECT count(DISTINCT ai_prompts.name) AS count FROM ai_prompts) AS unique_templates, ( SELECT count(*) AS count FROM ai_cost_tracking WHERE ai_cost_tracking.created_at > (now() - '24:00:00'::interval)) AS cost_entries_24h, ( SELECT COALESCE(sum(ai_cost_tracking.cost_usd), 0::numeric) AS "coalesce" FROM ai_cost_tracking WHERE ai_cost_tracking.created_at > (now() - '24:00:00'::interval)) AS cost_24h_usd, ( SELECT COALESCE(sum(ai_cost_tracking.cost_usd), 0::numeric) AS "coalesce" FROM ai_cost_tracking WHERE ai_cost_tracking.created_at > (now() - '30 days'::interval)) AS cost_30d_usd, ( SELECT count(*) AS count FROM ai_agent_interactions WHERE ai_agent_interactions.created_at > (now() - '24:00:00'::interval)) AS interactions_24h, ( SELECT count(*) AS count FROM ai_agent_interactions WHERE ai_agent_interactions.created_at > (now() - '24:00:00'::interval) AND ai_agent_interactions.success = false) AS failures_24h, ( SELECT count(DISTINCT ai_agent_interactions.agent_name) AS count FROM ai_agent_interactions WHERE ai_agent_interactions.created_at > (now() - '7 days'::interval)) AS active_agents_7d);--> statement-breakpoint
CREATE VIEW "public"."reading_stats" AS (SELECT rp.user_id, rp.topic_id, rp.enrollment_id, mt.title AS topic_title, cm.title AS module_title, c.title AS course_title, rp.scroll_percentage, rp.total_reading_time_seconds, rp.session_count, rp.last_read_at, rp.content_type, rp.current_page, rp.total_pages, CASE WHEN rp.scroll_percentage >= 90 THEN 100 WHEN rp.scroll_percentage >= 75 THEN 85 WHEN rp.scroll_percentage >= 50 THEN 70 WHEN rp.scroll_percentage >= 25 THEN 50 ELSE 25 END AS engagement_score FROM reading_progress rp JOIN module_topics mt ON mt.id = rp.topic_id JOIN course_modules cm ON cm.id = mt.module_id JOIN courses c ON c.id = cm.course_id);--> statement-breakpoint
CREATE VIEW "public"."grading_queue" AS (SELECT ls.id AS submission_id, ls.user_id, up.full_name AS student_name, up.email AS student_email, ls.topic_id, mt.title AS topic_title, cm.title AS module_title, c.title AS course_title, ls.repository_url, ls.commit_sha, ls.submitted_at, ls.status, ls.auto_grade_score, ls.attempt_number, ls.enrollment_id FROM lab_submissions ls JOIN user_profiles up ON up.id = ls.user_id JOIN module_topics mt ON mt.id = ls.topic_id JOIN course_modules cm ON cm.id = mt.module_id JOIN courses c ON c.id = cm.course_id WHERE ls.status = ANY (ARRAY['pending'::text, 'manual_review'::text]) ORDER BY ls.submitted_at);--> statement-breakpoint
CREATE VIEW "public"."question_bank_stats" AS (SELECT qq.id AS question_id, qq.topic_id, qq.question_text, qq.question_type, qq.difficulty, qq.points, qq.is_public, qq.created_by, up.full_name AS created_by_name, count(DISTINCT qa.id) AS times_used, count(DISTINCT qa.user_id) AS unique_students, COALESCE(avg( CASE WHEN qa.submitted_at IS NOT NULL THEN CASE WHEN (qa.answers -> qq.id::text) = qq.correct_answers THEN 100.0 ELSE 0.0 END ELSE NULL::numeric END), 0::numeric) AS avg_correct_percentage, qq.created_at, qq.updated_at FROM quiz_questions qq LEFT JOIN user_profiles up ON qq.created_by = up.id LEFT JOIN quiz_attempts qa ON qa.topic_id = qq.topic_id GROUP BY qq.id, up.full_name);--> statement-breakpoint
CREATE VIEW "public"."quiz_analytics" AS (SELECT mt.id AS topic_id, mt.title AS topic_title, cm.id AS module_id, cm.title AS module_title, c.id AS course_id, c.title AS course_title, count(DISTINCT qq.id) AS total_questions, count(DISTINCT CASE WHEN qq.difficulty = 'easy'::text THEN qq.id ELSE NULL::uuid END) AS easy_questions, count(DISTINCT CASE WHEN qq.difficulty = 'medium'::text THEN qq.id ELSE NULL::uuid END) AS medium_questions, count(DISTINCT CASE WHEN qq.difficulty = 'hard'::text THEN qq.id ELSE NULL::uuid END) AS hard_questions, count(DISTINCT qa.id) AS total_attempts, count(DISTINCT qa.user_id) AS unique_students, count(DISTINCT CASE WHEN qa.passed = true THEN qa.id ELSE NULL::uuid END) AS passed_attempts, COALESCE(avg(qa.score), 0::numeric) AS avg_score, COALESCE(avg(qa.time_taken_seconds), 0::numeric) AS avg_time_seconds, COALESCE(count(DISTINCT CASE WHEN qa.passed = true THEN qa.id ELSE NULL::uuid END)::double precision / NULLIF(count(DISTINCT qa.id), 0)::double precision * 100::double precision, 0::double precision) AS pass_rate FROM module_topics mt JOIN course_modules cm ON mt.module_id = cm.id JOIN courses c ON cm.course_id = c.id LEFT JOIN quiz_questions qq ON qq.topic_id = mt.id LEFT JOIN quiz_attempts qa ON qa.topic_id = mt.id AND qa.submitted_at IS NOT NULL WHERE mt.content_type = 'quiz'::text GROUP BY mt.id, cm.id, c.id);--> statement-breakpoint
CREATE VIEW "public"."capstone_grading_queue" AS (SELECT cs.id, cs.user_id, cs.enrollment_id, cs.course_id, up.full_name AS student_name, up.email AS student_email, c.title AS course_title, cs.repository_url, cs.demo_video_url, cs.description, cs.submitted_at, cs.status, cs.revision_count, cs.peer_review_count, cs.avg_peer_rating, EXTRACT(epoch FROM now() - cs.submitted_at) / 3600::numeric AS hours_waiting FROM capstone_submissions cs JOIN user_profiles up ON cs.user_id = up.id JOIN courses c ON cs.course_id = c.id WHERE cs.status = ANY (ARRAY['pending'::text, 'peer_review'::text, 'trainer_review'::text]) ORDER BY cs.submitted_at);--> statement-breakpoint
CREATE VIEW "public"."v_auth_rls_status" AS (SELECT c.relname AS table_name, c.relrowsecurity AS rls_enabled, c.relforcerowsecurity AS rls_forced, count(p.polname) AS policy_count, array_agg(p.polname ORDER BY p.polname) AS policies FROM pg_class c LEFT JOIN pg_policy p ON p.polrelid = c.oid WHERE c.relnamespace = 'public'::regnamespace::oid AND c.relkind = 'r'::"char" AND (c.relname = ANY (ARRAY['user_profiles'::name, 'roles'::name, 'permissions'::name, 'user_roles'::name, 'role_permissions'::name, 'organizations'::name, 'audit_logs'::name])) GROUP BY c.relname, c.relrowsecurity, c.relforcerowsecurity ORDER BY c.relname);--> statement-breakpoint
CREATE VIEW "public"."capstone_statistics" AS (SELECT cs.course_id, c.title AS course_title, count(*) AS total_submissions, count( CASE WHEN cs.status = 'passed'::text THEN 1 ELSE NULL::integer END) AS passed_count, count( CASE WHEN cs.status = 'failed'::text THEN 1 ELSE NULL::integer END) AS failed_count, count( CASE WHEN cs.status = 'revision_requested'::text THEN 1 ELSE NULL::integer END) AS revision_count, avg(cs.grade) FILTER (WHERE cs.grade IS NOT NULL) AS avg_grade, avg(cs.peer_review_count) AS avg_peer_reviews, avg(cs.revision_count) AS avg_revisions FROM capstone_submissions cs JOIN courses c ON cs.course_id = c.id GROUP BY cs.course_id, c.title);--> statement-breakpoint
CREATE VIEW "public"."peer_review_leaderboard" AS (SELECT pr.reviewer_id, up.full_name AS reviewer_name, count(*) AS reviews_completed, avg(pr.rating) AS avg_rating_given, count(DISTINCT cs.course_id) AS courses_reviewed FROM peer_reviews pr JOIN user_profiles up ON pr.reviewer_id = up.id JOIN capstone_submissions cs ON pr.submission_id = cs.id GROUP BY pr.reviewer_id, up.full_name ORDER BY (count(*)) DESC);--> statement-breakpoint
CREATE VIEW "public"."ai_mentor_daily_stats" AS (SELECT date(created_at) AS date, count(*) AS total_chats, count(DISTINCT user_id) AS unique_users, sum(tokens_used) AS total_tokens, sum(cost_usd) AS total_cost, avg(response_time_ms) AS avg_response_time_ms, avg(student_rating) FILTER (WHERE student_rating IS NOT NULL) AS avg_rating, count(*) FILTER (WHERE flagged_for_review = true) AS flagged_count, count(*) FILTER (WHERE escalated_to_trainer = true) AS escalated_count FROM ai_mentor_chats GROUP BY (date(created_at)) ORDER BY (date(created_at)) DESC);--> statement-breakpoint
CREATE VIEW "public"."ai_mentor_student_stats" AS (SELECT u.id AS user_id, u.full_name, u.email, count(c.id) AS total_chats, sum(c.tokens_used) AS total_tokens, sum(c.cost_usd) AS total_cost, avg(c.response_time_ms) AS avg_response_time_ms, avg(c.student_rating) FILTER (WHERE c.student_rating IS NOT NULL) AS avg_rating, count(*) FILTER (WHERE c.flagged_for_review = true) AS flagged_count, count(*) FILTER (WHERE c.escalated_to_trainer = true) AS escalated_count, max(c.created_at) AS last_chat_at FROM user_profiles u LEFT JOIN ai_mentor_chats c ON c.user_id = u.id WHERE (EXISTS ( SELECT 1 FROM user_roles ur JOIN roles r ON r.id = ur.role_id WHERE ur.user_id = u.id AND r.name = 'student'::text)) GROUP BY u.id, u.full_name, u.email);--> statement-breakpoint
CREATE VIEW "public"."ai_mentor_topic_stats" AS (SELECT mt.id AS topic_id, mt.title AS topic_title, c.title AS course_title, count(mc.id) AS total_chats, count(DISTINCT mc.user_id) AS unique_students, avg(mc.student_rating) FILTER (WHERE mc.student_rating IS NOT NULL) AS avg_rating, count(*) FILTER (WHERE mc.escalated_to_trainer = true) AS escalation_count FROM module_topics mt JOIN course_modules m ON m.id = mt.module_id JOIN courses c ON c.id = m.course_id LEFT JOIN ai_mentor_chats mc ON mc.topic_id = mt.id GROUP BY mt.id, mt.title, c.title ORDER BY (count(mc.id)) DESC);--> statement-breakpoint
CREATE VIEW "public"."escalation_queue" AS (SELECT e.id AS escalation_id, e.chat_id, e.user_id, u.full_name AS student_name, u.email AS student_email, e.topic_id, mt.title AS topic_title, e.reason, e.confidence, e.auto_detected, e.triggers, e.metadata, e.status, e.assigned_to, trainer.full_name AS assigned_trainer_name, e.created_at, EXTRACT(epoch FROM now() - e.created_at) / 60::numeric AS wait_time_minutes, c.question AS original_question, ( SELECT count(*) AS count FROM trainer_responses WHERE trainer_responses.escalation_id = e.id) AS response_count FROM ai_mentor_escalations e JOIN user_profiles u ON u.id = e.user_id LEFT JOIN module_topics mt ON mt.id = e.topic_id LEFT JOIN user_profiles trainer ON trainer.id = e.assigned_to LEFT JOIN ai_mentor_chats c ON c.id = e.chat_id WHERE e.status = ANY (ARRAY['pending'::text, 'in_progress'::text]) ORDER BY e.created_at);--> statement-breakpoint
CREATE VIEW "public"."ai_mentor_hourly_stats" AS (SELECT date_trunc('hour'::text, created_at) AS hour, count(*) AS total_chats, count(DISTINCT user_id) AS unique_users, sum(tokens_used) AS total_tokens, sum(cost_usd) AS total_cost, avg(response_time_ms) AS avg_response_time_ms, avg(student_rating) FILTER (WHERE student_rating IS NOT NULL) AS avg_rating, count(*) FILTER (WHERE student_rating >= 4) AS positive_ratings, count(*) FILTER (WHERE student_rating <= 2) AS negative_ratings, count(*) FILTER (WHERE flagged_for_review = true) AS flagged_count, count(*) FILTER (WHERE escalated_to_trainer = true) AS escalated_count FROM ai_mentor_chats WHERE created_at >= (now() - '7 days'::interval) GROUP BY (date_trunc('hour'::text, created_at)) ORDER BY (date_trunc('hour'::text, created_at)) DESC);--> statement-breakpoint
CREATE VIEW "public"."ai_mentor_topic_quality" AS (SELECT mt.id AS topic_id, mt.title AS topic_title, c.title AS course_title, count(mc.id) AS total_chats, count(DISTINCT mc.user_id) AS unique_students, avg(mc.student_rating) FILTER (WHERE mc.student_rating IS NOT NULL) AS avg_rating, count(*) FILTER (WHERE mc.student_rating >= 4)::numeric / NULLIF(count(*) FILTER (WHERE mc.student_rating IS NOT NULL), 0)::numeric * 100::numeric AS helpful_percentage, count(*) FILTER (WHERE mc.student_rating <= 2)::numeric / NULLIF(count(*) FILTER (WHERE mc.student_rating IS NOT NULL), 0)::numeric * 100::numeric AS unhelpful_percentage, avg(mc.response_time_ms) AS avg_response_time_ms, avg(mc.tokens_used) AS avg_tokens_used, sum(mc.cost_usd) AS total_cost, count(*) FILTER (WHERE mc.escalated_to_trainer = true)::numeric / NULLIF(count(*), 0)::numeric * 100::numeric AS escalation_rate, count(*) FILTER (WHERE mc.flagged_for_review = true) AS flagged_count FROM module_topics mt JOIN course_modules cm ON cm.id = mt.module_id JOIN courses c ON c.id = cm.course_id LEFT JOIN ai_mentor_chats mc ON mc.topic_id = mt.id GROUP BY mt.id, mt.title, c.title HAVING count(mc.id) > 0 ORDER BY (count(mc.id)) DESC);--> statement-breakpoint
CREATE VIEW "public"."ai_prompt_variant_performance" AS (SELECT pv.id AS variant_id, pv.variant_name, pv.is_active, pv.traffic_percentage, count(mc.id) AS total_uses, count(DISTINCT mc.user_id) AS unique_users, avg(mc.student_rating) FILTER (WHERE mc.student_rating IS NOT NULL) AS avg_rating, count(*) FILTER (WHERE mc.student_rating >= 4)::numeric / NULLIF(count(*) FILTER (WHERE mc.student_rating IS NOT NULL), 0)::numeric * 100::numeric AS helpful_percentage, avg(mc.response_time_ms) AS avg_response_time_ms, avg(mc.tokens_used) AS avg_tokens_used, avg(mc.cost_usd) AS avg_cost_per_chat, count(*) FILTER (WHERE mc.escalated_to_trainer = true)::numeric / NULLIF(count(*), 0)::numeric * 100::numeric AS escalation_rate, count(*) FILTER (WHERE mc.flagged_for_review = true) AS flagged_count, pv.created_at FROM ai_prompt_variants pv LEFT JOIN ai_mentor_chats mc ON mc.prompt_variant_id = pv.id GROUP BY pv.id, pv.variant_name, pv.is_active, pv.traffic_percentage, pv.created_at ORDER BY pv.created_at DESC);--> statement-breakpoint
CREATE VIEW "public"."ai_mentor_cost_breakdown" AS (SELECT date(mc.created_at) AS date, mc.topic_id, mt.title AS topic_title, count(*) AS chat_count, sum(mc.tokens_used) AS total_tokens, sum(mc.cost_usd) AS total_cost, avg(mc.cost_usd) AS avg_cost_per_chat, sum(mc.cost_usd) / NULLIF(sum(mc.tokens_used), 0)::numeric * 1000::numeric AS cost_per_1k_tokens, sum(mc.cost_usd) / NULLIF(count(*) FILTER (WHERE mc.student_rating >= 4), 0)::numeric AS cost_per_helpful_response FROM ai_mentor_chats mc LEFT JOIN module_topics mt ON mt.id = mc.topic_id WHERE mc.created_at >= (CURRENT_DATE - '30 days'::interval) GROUP BY (date(mc.created_at)), mc.topic_id, mt.title ORDER BY (date(mc.created_at)) DESC, (sum(mc.cost_usd)) DESC);--> statement-breakpoint
CREATE VIEW "public"."badge_completion_stats" AS (SELECT b.id AS badge_id, b.name AS badge_name, b.rarity, b.trigger_type, count(ub.id) AS total_earned, count(DISTINCT ub.user_id) AS unique_earners, count(DISTINCT ub.user_id)::numeric / NULLIF(( SELECT count(DISTINCT user_badges.user_id) AS count FROM user_badges), 0)::numeric * 100::numeric AS completion_percentage, min(ub.earned_at) AS first_earned_at, max(ub.earned_at) AS last_earned_at, sum(ub.share_count) AS total_shares FROM badges b LEFT JOIN user_badges ub ON ub.badge_id = b.id GROUP BY b.id, b.name, b.rarity, b.trigger_type ORDER BY (count(ub.id)) DESC);--> statement-breakpoint
CREATE VIEW "public"."ai_mentor_student_engagement" AS (SELECT u.id AS user_id, u.full_name, count(mc.id) AS total_chats, date(min(mc.created_at)) AS first_chat_date, date(max(mc.created_at)) AS last_chat_date, EXTRACT(epoch FROM max(mc.created_at) - min(mc.created_at)) / 86400::numeric AS active_days, avg(mc.student_rating) FILTER (WHERE mc.student_rating IS NOT NULL) AS avg_rating_given, count(*) FILTER (WHERE mc.student_rating IS NOT NULL)::numeric / NULLIF(count(*), 0)::numeric * 100::numeric AS rating_frequency, count(DISTINCT mc.topic_id) AS topics_explored, count(*) FILTER (WHERE mc.escalated_to_trainer = true) AS escalations, sum(mc.cost_usd) AS total_cost_incurred FROM user_profiles u JOIN ai_mentor_chats mc ON mc.user_id = u.id GROUP BY u.id, u.full_name ORDER BY (count(mc.id)) DESC);--> statement-breakpoint
CREATE VIEW "public"."user_badge_progress" AS (SELECT u.id AS user_id, u.full_name, count(ub.id) FILTER (WHERE b.rarity = 'common'::text) AS common_badges, count(ub.id) FILTER (WHERE b.rarity = 'rare'::text) AS rare_badges, count(ub.id) FILTER (WHERE b.rarity = 'epic'::text) AS epic_badges, count(ub.id) FILTER (WHERE b.rarity = 'legendary'::text) AS legendary_badges, count(ub.id) AS total_badges_earned, ( SELECT count(*) AS count FROM badges WHERE badges.is_hidden = false) AS total_badges_available, count(ub.id)::numeric / NULLIF(( SELECT count(*) AS count FROM badges WHERE badges.is_hidden = false), 0)::numeric * 100::numeric AS completion_percentage, max(ub.earned_at) AS last_badge_earned_at, count(*) FILTER (WHERE ub.is_new = true) AS new_badges_count FROM user_profiles u LEFT JOIN user_badges ub ON ub.user_id = u.id LEFT JOIN badges b ON b.id = ub.badge_id GROUP BY u.id, u.full_name ORDER BY (count(ub.id)) DESC);--> statement-breakpoint
CREATE VIEW "public"."rare_achievements" AS (SELECT b.id AS badge_id, b.name AS badge_name, b.rarity, count(ub.id) AS earner_count, count(DISTINCT ub.user_id)::numeric / NULLIF(( SELECT count(DISTINCT user_badges.user_id) AS count FROM user_badges), 0)::numeric * 100::numeric AS earner_percentage FROM badges b LEFT JOIN user_badges ub ON ub.badge_id = b.id GROUP BY b.id, b.name, b.rarity HAVING (count(DISTINCT ub.user_id)::numeric / NULLIF(( SELECT count(DISTINCT user_badges.user_id) AS count FROM user_badges), 0)::numeric * 100::numeric) <= 1.0 ORDER BY (count(DISTINCT ub.user_id)::numeric / NULLIF(( SELECT count(DISTINCT user_badges.user_id) AS count FROM user_badges), 0)::numeric * 100::numeric));--> statement-breakpoint
CREATE VIEW "public"."v_workflow_instances_with_state" AS (SELECT wi.id, wi.org_id, w.name AS workflow_name, wi.entity_type, wi.entity_id, ws.name AS current_state, ws.display_name AS current_state_display, ws.is_terminal, wi.status, wi.started_at, wi.completed_at, wi.cancelled_at, EXTRACT(epoch FROM COALESCE(wi.completed_at, now()) - wi.started_at) / 3600::numeric AS duration_hours, up.full_name AS created_by_name, wi.created_at, wi.updated_at FROM workflow_instances wi JOIN workflows w ON wi.workflow_id = w.id JOIN workflow_states ws ON wi.current_state_id = ws.id JOIN user_profiles up ON wi.created_by = up.id WHERE wi.org_id = auth_user_org_id() OR user_is_admin());--> statement-breakpoint
CREATE VIEW "public"."v_workflow_metrics" AS (SELECT w.id AS workflow_id, w.name AS workflow_name, w.entity_type, count(*) AS total_instances, count(*) FILTER (WHERE wi.status = 'active'::text) AS active_instances, count(*) FILTER (WHERE wi.status = 'completed'::text) AS completed_instances, count(*) FILTER (WHERE wi.status = 'cancelled'::text) AS cancelled_instances, round(avg(EXTRACT(epoch FROM wi.completed_at - wi.started_at) / 3600::numeric), 2) AS avg_completion_hours, max(wi.started_at) AS last_started_at, w.org_id FROM workflows w LEFT JOIN workflow_instances wi ON w.id = wi.workflow_id WHERE w.org_id = auth_user_org_id() OR user_is_admin() GROUP BY w.id, w.name, w.entity_type, w.org_id);--> statement-breakpoint
CREATE VIEW "public"."leaderboard_global" AS (WITH ranked_users AS ( SELECT up.id AS user_id, up.full_name, up.avatar_url, uxp.total_xp, floor((uxp.total_xp / 1000)::double precision)::integer + 1 AS level, CASE WHEN uxp.total_xp < 1000 THEN 'Beginner'::text WHEN uxp.total_xp < 5000 THEN 'Intermediate'::text WHEN uxp.total_xp < 10000 THEN 'Advanced'::text WHEN uxp.total_xp < 25000 THEN 'Expert'::text ELSE 'Master'::text END AS level_name, rank() OVER (ORDER BY uxp.total_xp DESC) AS rank, dense_rank() OVER (ORDER BY uxp.total_xp DESC) AS dense_rank FROM user_profiles up JOIN user_xp_totals uxp ON uxp.user_id = up.id WHERE up.leaderboard_visible = true AND uxp.total_xp > 0 ) SELECT user_id, full_name, avatar_url, total_xp, level, level_name, rank, dense_rank, total_xp - lag(total_xp) OVER (ORDER BY rank DESC) AS xp_diff_from_above, lead(total_xp) OVER (ORDER BY rank DESC) - total_xp AS xp_to_next_rank FROM ranked_users ORDER BY rank);--> statement-breakpoint
CREATE VIEW "public"."leaderboard_by_course" AS (WITH ranked_students AS ( SELECT e.course_id, c.title AS course_title, up.id AS user_id, up.full_name, up.avatar_url, uxp.total_xp AS course_xp, e.completion_percentage, 0 AS modules_completed, 0 AS total_modules, rank() OVER (PARTITION BY e.course_id ORDER BY uxp.total_xp DESC) AS rank, count(*) OVER (PARTITION BY e.course_id) AS total_students FROM student_enrollments e JOIN user_profiles up ON up.id = e.user_id JOIN courses c ON c.id = e.course_id JOIN user_xp_totals uxp ON uxp.user_id = e.user_id WHERE up.leaderboard_visible = true AND (e.status = ANY (ARRAY['active'::text, 'completed'::text])) AND uxp.total_xp > 0 ) SELECT course_id, course_title, user_id, full_name, avatar_url, course_xp, completion_percentage, modules_completed, total_modules, rank, total_students, round((1::numeric - rank::numeric / total_students::numeric) * 100::numeric, 1) AS percentile FROM ranked_students ORDER BY course_id, rank);--> statement-breakpoint
CREATE VIEW "public"."leaderboard_by_cohort" AS (WITH cohorts AS ( SELECT e.course_id, c.title AS course_title, date_trunc('month'::text, e.enrolled_at) AS cohort_month, to_char(e.enrolled_at, 'Month YYYY'::text) AS cohort_name, up.id AS user_id, up.full_name, up.avatar_url, uxp.total_xp, e.completion_percentage, e.enrolled_at FROM student_enrollments e JOIN user_profiles up ON up.id = e.user_id JOIN courses c ON c.id = e.course_id JOIN user_xp_totals uxp ON uxp.user_id = up.id WHERE up.leaderboard_visible = true AND (e.status = ANY (ARRAY['active'::text, 'completed'::text])) ), ranked_cohorts AS ( SELECT cohorts.course_id, cohorts.course_title, cohorts.cohort_month, cohorts.cohort_name, cohorts.user_id, cohorts.full_name, cohorts.avatar_url, cohorts.total_xp, cohorts.completion_percentage, cohorts.enrolled_at, rank() OVER (PARTITION BY cohorts.course_id, cohorts.cohort_month ORDER BY cohorts.total_xp DESC) AS rank, count(*) OVER (PARTITION BY cohorts.course_id, cohorts.cohort_month) AS cohort_size FROM cohorts ) SELECT course_id, course_title, cohort_month, cohort_name, user_id, full_name, avatar_url, total_xp, completion_percentage, enrolled_at, rank, cohort_size, round((1::numeric - rank::numeric / cohort_size::numeric) * 100::numeric, 1) AS cohort_percentile FROM ranked_cohorts ORDER BY cohort_month DESC, rank);--> statement-breakpoint
CREATE VIEW "public"."leaderboard_weekly" AS (WITH weekly_xp AS ( SELECT xt.user_id, up.full_name, up.avatar_url, date_trunc('week'::text, xt.created_at) AS week_start, to_char(date_trunc('week'::text, xt.created_at), 'Mon DD, YYYY'::text) AS week_label, sum(xt.amount) AS weekly_xp FROM xp_transactions xt JOIN user_profiles up ON up.id = xt.user_id WHERE up.leaderboard_visible = true AND xt.created_at >= (CURRENT_DATE - '84 days'::interval) GROUP BY xt.user_id, up.full_name, up.avatar_url, (date_trunc('week'::text, xt.created_at)) ), ranked_weekly AS ( SELECT weekly_xp.week_start, weekly_xp.week_label, weekly_xp.user_id, weekly_xp.full_name, weekly_xp.avatar_url, weekly_xp.weekly_xp, rank() OVER (PARTITION BY weekly_xp.week_start ORDER BY weekly_xp.weekly_xp DESC) AS rank, count(*) OVER (PARTITION BY weekly_xp.week_start) AS participants FROM weekly_xp WHERE weekly_xp.weekly_xp > 0 ) SELECT week_start, week_label, user_id, full_name, avatar_url, weekly_xp, rank, participants, CASE WHEN week_start = date_trunc('week'::text, CURRENT_DATE::timestamp with time zone) THEN true ELSE false END AS is_current_week FROM ranked_weekly ORDER BY week_start DESC, rank);--> statement-breakpoint
CREATE VIEW "public"."leaderboard_all_time" AS (WITH all_time_stats AS ( SELECT up.id AS user_id, up.full_name, up.avatar_url, up.created_at AS joined_at, uxp.total_xp, floor((uxp.total_xp / 1000)::double precision)::integer + 1 AS level, CASE WHEN uxp.total_xp < 1000 THEN 'Beginner'::text WHEN uxp.total_xp < 5000 THEN 'Intermediate'::text WHEN uxp.total_xp < 10000 THEN 'Advanced'::text WHEN uxp.total_xp < 25000 THEN 'Expert'::text ELSE 'Master'::text END AS level_name, ( SELECT count(*) AS count FROM user_badges WHERE user_badges.user_id = up.id) AS badge_count, ( SELECT count(*) AS count FROM student_enrollments WHERE student_enrollments.user_id = up.id AND student_enrollments.status = 'completed'::text) AS courses_completed, (CURRENT_DATE - up.created_at::date)::numeric AS days_active FROM user_profiles up JOIN user_xp_totals uxp ON uxp.user_id = up.id WHERE up.leaderboard_visible = true AND uxp.total_xp > 0 ), ranked_all_time AS ( SELECT all_time_stats.user_id, all_time_stats.full_name, all_time_stats.avatar_url, all_time_stats.joined_at, all_time_stats.total_xp, all_time_stats.level, all_time_stats.level_name, all_time_stats.badge_count, all_time_stats.courses_completed, all_time_stats.days_active, rank() OVER (ORDER BY all_time_stats.total_xp DESC) AS rank, CASE WHEN all_time_stats.days_active > 0::numeric THEN round(all_time_stats.total_xp::numeric / all_time_stats.days_active, 2) ELSE 0::numeric END AS avg_xp_per_day FROM all_time_stats ) SELECT user_id, full_name, avatar_url, joined_at, total_xp, level, level_name, badge_count, courses_completed, days_active, rank, avg_xp_per_day FROM ranked_all_time WHERE rank <= 100 ORDER BY rank);--> statement-breakpoint
CREATE VIEW "public"."badge_leaderboard" AS (WITH top_users AS ( SELECT u.id, u.full_name, u.avatar_url, count(ub_1.id) AS badge_count, sum( CASE b_1.rarity WHEN 'legendary'::text THEN 4 WHEN 'epic'::text THEN 3 WHEN 'rare'::text THEN 2 WHEN 'common'::text THEN 1 ELSE 0 END) AS rarity_score, sum(b_1.xp_reward) AS badge_xp_earned FROM user_profiles u LEFT JOIN user_badges ub_1 ON ub_1.user_id = u.id LEFT JOIN badges b_1 ON b_1.id = ub_1.badge_id GROUP BY u.id, u.full_name, u.avatar_url ORDER BY (count(ub_1.id)) DESC, (sum( CASE b_1.rarity WHEN 'legendary'::text THEN 4 WHEN 'epic'::text THEN 3 WHEN 'rare'::text THEN 2 WHEN 'common'::text THEN 1 ELSE 0 END)) DESC LIMIT 100 ) SELECT tu.id AS user_id, tu.full_name, tu.avatar_url, tu.badge_count, tu.rarity_score, tu.badge_xp_earned, COALESCE(jsonb_agg(jsonb_build_object('badge_id', b.id, 'name', b.name, 'rarity', b.rarity, 'earned_at', ub.earned_at) ORDER BY ub.earned_at DESC) FILTER (WHERE ub.id IS NOT NULL), '[]'::jsonb) AS recent_badges FROM top_users tu LEFT JOIN user_badges ub ON ub.user_id = tu.id LEFT JOIN badges b ON b.id = ub.badge_id GROUP BY tu.id, tu.full_name, tu.avatar_url, tu.badge_count, tu.rarity_score, tu.badge_xp_earned ORDER BY tu.badge_count DESC, tu.rarity_score DESC);--> statement-breakpoint
CREATE VIEW "public"."organization_addresses_view" AS (SELECT o.id AS organization_id, o.name AS organization_name, addr.id AS address_id, addr.address_type, addr.address_line_1, addr.address_line_2, addr.address_line_3, addr.city, addr.state_province, addr.postal_code, addr.country_code, addr.county, addr.latitude, addr.longitude, addr.is_verified, addr.is_primary, addr.effective_from, addr.effective_to, addr.notes, addr.created_at, addr.updated_at FROM organizations o LEFT JOIN addresses addr ON addr.entity_type = 'organization'::text AND addr.entity_id = o.id);--> statement-breakpoint
CREATE VIEW "public"."lead_addresses_view" AS (SELECT l.id AS lead_id, l.org_id, l.company_name, l.first_name, l.last_name, addr.id AS address_id, addr.address_type, addr.address_line_1, addr.address_line_2, addr.address_line_3, addr.city, addr.state_province, addr.postal_code, addr.country_code, addr.county, addr.latitude, addr.longitude, addr.is_verified, addr.is_primary, addr.effective_from, addr.effective_to, addr.notes, addr.created_at, addr.updated_at FROM leads l LEFT JOIN addresses addr ON addr.entity_type = 'lead'::text AND addr.entity_id = l.id);--> statement-breakpoint
CREATE VIEW "public"."employee_addresses_view" AS (SELECT e.id AS employee_id, e.org_id, up.full_name AS employee_name, up.email, addr.id AS address_id, addr.address_type, addr.address_line_1, addr.city, addr.state_province, addr.postal_code, addr.country_code, addr.is_primary, addr.created_at, addr.updated_at FROM employees e LEFT JOIN user_profiles up ON up.id = e.user_id LEFT JOIN addresses addr ON addr.entity_type = 'employee'::text AND addr.entity_id = e.id WHERE e.deleted_at IS NULL);--> statement-breakpoint
CREATE VIEW "public"."interview_addresses_view" AS (SELECT i.id AS interview_id, i.org_id, i.interview_type, i.scheduled_at, addr.id AS address_id, addr.address_type, addr.address_line_1, addr.city, addr.state_province, addr.notes AS address_notes, addr.is_primary FROM interviews i LEFT JOIN addresses addr ON addr.entity_type = 'interview'::text AND addr.entity_id = i.id WHERE i.cancelled_at IS NULL);--> statement-breakpoint
CREATE VIEW "public"."contact_addresses_view" AS (SELECT c.id AS contact_id, c.org_id, c.first_name, c.last_name, c.email, addr.id AS address_id, addr.address_type, addr.address_line_1, addr.city, addr.state_province, addr.postal_code, addr.country_code, addr.is_primary, addr.created_at, addr.updated_at FROM contacts c LEFT JOIN addresses addr ON addr.entity_type = 'contact'::text AND addr.entity_id = c.id WHERE c.deleted_at IS NULL);--> statement-breakpoint
CREATE VIEW "public"."placement_addresses_view" AS (SELECT p.id AS placement_id, p.org_id, p.status AS placement_status, p.start_date, addr.id AS address_id, addr.address_type, addr.address_line_1, addr.city, addr.state_province, addr.notes AS address_notes, addr.is_primary FROM placements p LEFT JOIN addresses addr ON addr.entity_type = 'placement'::text AND addr.entity_id = p.id);--> statement-breakpoint
CREATE VIEW "public"."lab_statistics" AS (SELECT mt.id AS topic_id, mt.title AS lab_title, count(DISTINCT li.user_id) AS total_students_started, count(DISTINCT ls.user_id) AS total_students_submitted, count(ls.id) FILTER (WHERE ls.passed = true) AS total_passed, count(ls.id) FILTER (WHERE ls.passed = false) AS total_failed, avg(ls.final_score) AS avg_final_score, avg(li.time_spent_seconds) FILTER (WHERE li.status = 'completed'::text) AS avg_time_spent_seconds FROM module_topics mt LEFT JOIN lab_instances li ON li.topic_id = mt.id LEFT JOIN lab_submissions ls ON ls.topic_id = mt.id WHERE mt.content_type = 'lab'::text GROUP BY mt.id, mt.title);--> statement-breakpoint
CREATE VIEW "public"."escalation_daily_stats" AS (SELECT date(created_at) AS date, count(*) AS total_escalations, count(DISTINCT user_id) AS unique_students, count(*) FILTER (WHERE auto_detected = true) AS auto_detected_count, count(*) FILTER (WHERE auto_detected = false) AS manual_count, avg(confidence) AS avg_confidence, count(*) FILTER (WHERE status = 'resolved'::text) AS resolved_count, count(*) FILTER (WHERE status = 'dismissed'::text) AS dismissed_count, avg(resolution_time_minutes) FILTER (WHERE resolution_time_minutes IS NOT NULL) AS avg_resolution_time_minutes FROM ai_mentor_escalations GROUP BY (date(created_at)) ORDER BY (date(created_at)) DESC);--> statement-breakpoint
CREATE VIEW "public"."trainer_escalation_stats" AS (SELECT t.id AS trainer_id, t.full_name AS trainer_name, count(e.id) AS total_assigned, count(*) FILTER (WHERE e.status = 'resolved'::text) AS resolved_count, count(*) FILTER (WHERE e.status = 'dismissed'::text) AS dismissed_count, avg(e.resolution_time_minutes) FILTER (WHERE e.resolution_time_minutes IS NOT NULL) AS avg_resolution_time_minutes, count(tr.id) AS total_responses, max(e.resolved_at) AS last_resolution_at FROM user_profiles t JOIN user_roles ur ON ur.user_id = t.id JOIN roles r ON r.id = ur.role_id LEFT JOIN ai_mentor_escalations e ON e.assigned_to = t.id LEFT JOIN trainer_responses tr ON tr.trainer_id = t.id WHERE r.name = 'trainer'::text GROUP BY t.id, t.full_name);--> statement-breakpoint
CREATE VIEW "public"."topic_difficulty_stats" AS (SELECT mt.id AS topic_id, mt.title AS topic_title, cm.title AS module_title, c.title AS course_title, count(e.id) AS escalation_count, count(DISTINCT e.user_id) AS unique_students, avg(e.confidence) AS avg_escalation_confidence, count(*) FILTER (WHERE e.status = 'resolved'::text) AS resolved_count FROM module_topics mt JOIN course_modules cm ON cm.id = mt.module_id JOIN courses c ON c.id = cm.course_id LEFT JOIN ai_mentor_escalations e ON e.topic_id = mt.id GROUP BY mt.id, mt.title, cm.title, c.title HAVING count(e.id) > 0 ORDER BY (count(e.id)) DESC);--> statement-breakpoint
CREATE VIEW "public"."submissions_legacy_v" AS (SELECT id, org_id, job_id, candidate_id, account_id, status, ai_match_score, recruiter_match_score, match_explanation, submitted_rate, submitted_rate_type, submission_notes, submitted_to_client_at, submitted_to_client_by, client_resume_file_id, client_profile_url, interview_count, last_interview_date, interview_feedback, offer_extended_at, offer_accepted_at, offer_declined_at, offer_decline_reason, rejected_at, rejection_reason, rejection_source, owner_id, created_at, updated_at, created_by, deleted_at, vendor_submitted_at, vendor_submitted_by, vendor_decision, vendor_decision_at, vendor_decision_by, vendor_notes, vendor_screening_notes, vendor_screening_completed_at, client_decision, client_decision_at, client_decision_notes, offer_id, placement_id, contact_id, company_id, submitted_by_company_id, submitted_by_contact_id, is_vendor_submission, rtr_obtained, rtr_obtained_at, rtr_expires_at, rtr_document_id, rate_card_id, rate_card_item_id, negotiated_bill_rate, negotiated_pay_rate, rate_negotiation_notes, status_entered_at, expected_decision_date, submission_score, score_breakdown, rank_among_submissions, is_duplicate, duplicate_of_submission_id, COALESCE(contact_id, candidate_id) AS unified_contact_id, candidate_id AS legacy_candidate_id FROM submissions s);--> statement-breakpoint
CREATE VIEW "public"."campaign_prospects_view" AS (SELECT ce.id, ce.org_id, ce.campaign_id, NULL::uuid AS lead_id, c.first_name, c.last_name, c.email, c.phone, c.linkedin_url, c.company_name, NULL::text AS company_industry, NULL::text AS company_size, c.title, NULL::text AS location, c.timezone, ce.primary_channel, ce.sequence_step, ce.sequence_status, ce.stop_reason, ce.first_contacted_at, ce.last_contacted_at, ce.opened_at, ce.clicked_at, ce.responded_at, ce.response_type, ce.response_text, ce.converted_to_lead_at, ce.converted_lead_id, ce.meeting_booked_at, ce.meeting_scheduled_for, ce.engagement_score, ce.status, ce.created_at, ce.updated_at, ce.contact_id FROM campaign_enrollments ce JOIN contacts c ON c.id = ce.contact_id AND c.deleted_at IS NULL);--> statement-breakpoint
CREATE VIEW "public"."legacy_compliance_requirements_view" AS (SELECT id, org_id, requirement_name AS name, category::text AS type, jurisdiction, 'all'::text AS applies_to, CASE WHEN validity_period_days IS NULL THEN 'once'::text WHEN validity_period_days <= 365 THEN 'annual'::text ELSE 'once'::text END AS frequency, description, NULL::text AS document_template_url, is_active, created_at, updated_at, created_by FROM compliance_requirements WHERE deleted_at IS NULL);--> statement-breakpoint
CREATE VIEW "public"."contact_compliance_legacy" AS (SELECT ci.id, ci.org_id, ci.entity_id AS contact_id, COALESCE(ci.compliance_type, cr.category) AS compliance_type, CASE ci.status::text WHEN 'pending'::text THEN 'pending'::text WHEN 'received'::text THEN 'received'::text WHEN 'under_review'::text THEN 'received'::text WHEN 'verified'::text THEN 'verified'::text WHEN 'expiring'::text THEN 'expiring'::text WHEN 'expired'::text THEN 'expired'::text WHEN 'rejected'::text THEN 'rejected'::text WHEN 'waived'::text THEN 'verified'::text ELSE 'pending'::text END AS status, ci.document_url, ci.document_received_at, ci.effective_date, ci.expiry_date, ci.verified_by, ci.verified_at, ci.verification_notes, ci.policy_number, ci.coverage_amount, ci.insurance_carrier, ci.expiry_alert_sent_at, ci.created_at, ci.updated_at, ci.deleted_at FROM compliance_items ci LEFT JOIN compliance_requirements cr ON cr.id = ci.requirement_id WHERE ci.entity_type::text = 'contact'::text);--> statement-breakpoint
CREATE VIEW "public"."contact_agreements_legacy" AS (SELECT id, org_id, entity_id AS contact_id, CASE contract_type::text WHEN 'msa'::text THEN 'msa'::text WHEN 'nda'::text THEN 'nda'::text WHEN 'sow'::text THEN 'sow'::text WHEN 'rate_card_agreement'::text THEN 'rate_card'::text WHEN 'sla'::text THEN 'sla'::text WHEN 'vendor_agreement'::text THEN 'vendor_agreement'::text ELSE 'other'::text END AS agreement_type, contract_name AS agreement_name, effective_date, expiry_date, auto_renew, renewal_notice_days, CASE status::text WHEN 'draft'::text THEN 'draft'::text WHEN 'pending_review'::text THEN 'pending'::text WHEN 'pending_signature'::text THEN 'pending'::text WHEN 'partially_signed'::text THEN 'pending'::text WHEN 'active'::text THEN 'active'::text WHEN 'expired'::text THEN 'expired'::text WHEN 'terminated'::text THEN 'terminated'::text WHEN 'renewed'::text THEN 'active'::text WHEN 'superseded'::text THEN 'expired'::text ELSE 'draft'::text END AS status, document_url, signed_document_url, ( SELECT cp.user_id FROM contract_parties cp WHERE cp.contract_id = c.id AND cp.party_type::text = 'internal'::text AND cp.is_required = true LIMIT 1) AS our_signer_id, ( SELECT cp.signed_at FROM contract_parties cp WHERE cp.contract_id = c.id AND cp.party_type::text = 'internal'::text AND cp.is_required = true AND cp.signatory_status = 'signed'::signatory_status LIMIT 1) AS our_signed_at, ( SELECT COALESCE(cp.party_name, concat_ws(' '::text, ct.first_name, ct.last_name)::character varying) AS "coalesce" FROM contract_parties cp LEFT JOIN contacts ct ON ct.id = cp.contact_id WHERE cp.contract_id = c.id AND cp.party_type::text <> 'internal'::text AND cp.is_required = true LIMIT 1) AS their_signer_name, ( SELECT cp.signed_at FROM contract_parties cp WHERE cp.contract_id = c.id AND cp.party_type::text <> 'internal'::text AND cp.is_required = true AND cp.signatory_status = 'signed'::signatory_status LIMIT 1) AS their_signed_at, terms, created_at, updated_at, deleted_at FROM contracts c WHERE entity_type::text = 'contact'::text);--> statement-breakpoint
CREATE VIEW "public"."contact_rate_cards_legacy" AS (SELECT id, org_id, entity_id AS contact_id, context_client_id AS client_id, NULL::uuid AS skill_id, context_job_id AS job_id, bill_rate AS bill_rate_hourly, pay_rate AS pay_rate_hourly, markup_percentage, CASE WHEN pay_rate > 0::numeric AND ot_pay_rate IS NOT NULL THEN round(ot_pay_rate / pay_rate, 2) ELSE 1.5 END AS overtime_multiplier, effective_date, end_date AS expiry_date, is_current AS is_active, approved_by, approved_at, negotiation_notes AS notes, created_at, updated_at, deleted_at FROM entity_rates er WHERE entity_type::text = 'contact'::text);--> statement-breakpoint
CREATE VIEW "public"."placements_extended_v" AS (SELECT p.id, p.org_id, p.submission_id, p.offer_id, p.job_id, p.candidate_id, p.placement_type, p.start_date, p.end_date, p.bill_rate, p.pay_rate, p.markup_percentage, p.status, p.end_reason, p.actual_end_date, p.total_revenue, p.total_paid, p.onboarding_status, p.onboarding_completed_at, p.performance_rating, p.extension_count, p.recruiter_id, p.account_manager_id, p.created_at, p.updated_at, p.created_by, p.health_status, p.next_check_in_date, p.last_check_in_date, p.last_check_in_by, p.rate_type, p.employment_type, p.work_location, p.work_schedule, p.timezone, p.onboarding_format, p.first_day_meeting_link, p.first_day_location, p.hiring_manager_name, p.hiring_manager_email, p.hiring_manager_phone, p.hr_contact_name, p.hr_contact_email, p.paperwork_complete, p.background_check_status, p.i9_complete, p.nda_signed, p.equipment_ordered, p.equipment_notes, p.internal_notes, p.deleted_at, p.contact_id, p.company_id, p.billing_company_id, p.end_client_company_id, p.client_company_id, p.vendor_company_id, p.client_manager_contact_id, p.hr_contact_id, p.reporting_manager_contact_id, p.contract_id, p.rate_card_id, p.rate_card_item_id, p.has_change_orders, p.active_change_order_id, p.change_order_count, p.original_end_date, p.original_bill_rate, p.approval_status, p.approved_by, p.approved_at, p.expected_hours_per_week, p.overtime_eligible, p.expenses_allowed, p.expense_budget, p.compliance_status, p.compliance_cleared_at, p.compliance_expires_at, p.work_arrangement, p.hybrid_days_per_week, p.work_address_id, COALESCE((c.first_name || ' '::text) || c.last_name, c.first_name, c.last_name) AS contact_name, c.email AS contact_email, cc.name AS client_company_name, ec.name AS end_client_company_name, vc.name AS vendor_company_name FROM placements p LEFT JOIN contacts c ON c.id = p.contact_id LEFT JOIN companies cc ON cc.id = p.client_company_id LEFT JOIN companies ec ON ec.id = p.end_client_company_id LEFT JOIN companies vc ON vc.id = p.vendor_company_id);--> statement-breakpoint
CREATE VIEW "public"."deal_stages_history_legacy" AS (SELECT dsh.id, d.org_id, dsh.deal_id AS entity_id, 'deal'::text AS entity_type, 'stage_change'::text AS change_type, 'stage'::text AS field_name, to_jsonb(dsh.previous_stage) AS old_value, to_jsonb(dsh.stage) AS new_value, dsh.changed_by, dsh.entered_at AS changed_at, jsonb_build_object('duration_days', dsh.duration_days, 'notes', dsh.notes, 'reason', dsh.reason) AS metadata FROM deal_stages_history dsh LEFT JOIN deals d ON d.id = dsh.deal_id);--> statement-breakpoint
CREATE VIEW "public"."unified_inbox" AS (SELECT c.id, c.org_id, c.channel, c.direction, c.thread_id, c.parent_id, c.thread_position, c.from_address, c.from_name, c.to_address, c.to_name, c.cc_addresses, c.bcc_addresses, c.subject, c.body_text, c.body_html, c.preview, c.attachments, c.entity_type, c.entity_id, c.secondary_entity_type, c.secondary_entity_id, c.contact_id, c.provider, c.provider_message_id, c.provider_thread_id, c.status, c.scheduled_at, c.sent_at, c.delivered_at, c.opened_at, c.clicked_at, c.replied_at, c.failed_at, c.open_count, c.click_count, c.reply_count, c.clicked_links, c.error_code, c.error_message, c.retry_count, c.max_retries, c.campaign_id, c.sequence_step_id, c.ab_variant, c.template_id, c.template_name, c.template_variables, c.metadata, c.tags, c.created_by, c.created_at, c.updated_at, ct.first_name AS contact_first_name, ct.last_name AS contact_last_name, ct.email AS contact_email, ct.company_name AS contact_company, CASE WHEN c.thread_id IS NOT NULL THEN ( SELECT count(*) AS count FROM communications WHERE communications.thread_id = c.thread_id) ELSE 1::bigint END AS thread_count, CASE WHEN c.thread_id IS NOT NULL THEN ( SELECT max(communications.created_at) AS max FROM communications WHERE communications.thread_id = c.thread_id) ELSE c.created_at END AS thread_updated_at FROM communications c LEFT JOIN contacts ct ON c.contact_id = ct.id);--> statement-breakpoint
CREATE POLICY "badge_progress_insert_system" ON "badge_progress" AS PERMISSIVE FOR INSERT TO public WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "badge_progress_select_own" ON "badge_progress" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "badge_trigger_events_insert_system" ON "badge_trigger_events" AS PERMISSIVE FOR INSERT TO public WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "payment_transactions_admin_read" ON "payment_transactions" AS PERMISSIVE FOR SELECT TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = ANY (ARRAY['admin'::text, 'super_admin'::text]))))));--> statement-breakpoint
CREATE POLICY "payment_transactions_own_read" ON "payment_transactions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "commissions_org_isolation" ON "commissions" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "commissions_user_select" ON "commissions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "commission_payments_org_isolation" ON "commission_payments" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "reports_admin_all" ON "productivity_reports" AS PERMISSIVE FOR SELECT TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((ur.role_id = r.id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = 'admin'::text)))));--> statement-breakpoint
CREATE POLICY "reports_system_insert" ON "productivity_reports" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "reports_system_update" ON "productivity_reports" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "reports_user_own" ON "productivity_reports" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "leads_employee_insert" ON "leads" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((auth_has_role('employee'::text) OR auth_has_role('admin'::text) OR auth_has_role('ta_specialist'::text)));--> statement-breakpoint
CREATE POLICY "leads_employee_select" ON "leads" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "leads_org_isolation" ON "leads" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "leads_owner_update" ON "leads" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "resumes_admin_all" ON "generated_resumes" AS PERMISSIVE FOR ALL TO public USING (((org_id = auth_user_org_id()) AND user_has_role('org_admin'::text)));--> statement-breakpoint
CREATE POLICY "resumes_trainer_view" ON "generated_resumes" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "resumes_user_own" ON "generated_resumes" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "requisitions_recruiter_all" ON "requisition_embeddings" AS PERMISSIVE FOR SELECT TO public USING (((org_id = auth_user_org_id()) AND user_has_role('recruiter'::text)));--> statement-breakpoint
CREATE POLICY "requisitions_service_role" ON "requisition_embeddings" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "matches_admin_all" ON "resume_matches" AS PERMISSIVE FOR ALL TO public USING (((org_id = auth_user_org_id()) AND user_has_role('org_admin'::text)));--> statement-breakpoint
CREATE POLICY "matches_recruiter_all" ON "resume_matches" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "employee_twin_interactions_user_own" ON "employee_twin_interactions" AS PERMISSIVE FOR ALL TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "embeddings_recruiter_all" ON "candidate_embeddings" AS PERMISSIVE FOR SELECT TO public USING (((org_id = auth_user_org_id()) AND user_has_role('recruiter'::text)));--> statement-breakpoint
CREATE POLICY "embeddings_service_role" ON "candidate_embeddings" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "lead_sourcing_credits_create" ON "lead_sourcing_credits" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((auth_has_role('employee'::text) OR auth_has_role('admin'::text) OR auth_has_role('recruiter'::text)));--> statement-breakpoint
CREATE POLICY "lead_sourcing_credits_org_isolation" ON "lead_sourcing_credits" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "lead_sourcing_credits_select" ON "lead_sourcing_credits" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Everyone can view active roles" ON "roles" AS PERMISSIVE FOR SELECT TO public USING (((deleted_at IS NULL) AND (is_active = true)));--> statement-breakpoint
CREATE POLICY "Super admins can manage roles" ON "roles" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "twin_preferences_user_own" ON "twin_preferences" AS PERMISSIVE FOR ALL TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "Enrolled students view course assets" ON "content_assets" AS PERMISSIVE FOR SELECT TO public USING ((EXISTS ( SELECT 1
   FROM ((student_enrollments se
     JOIN course_modules cm ON ((cm.course_id = se.course_id)))
     JOIN module_topics mt ON ((mt.module_id = cm.id)))
  WHERE ((mt.id = content_assets.topic_id) AND (se.user_id = auth.uid()) AND (se.status = ANY (ARRAY['active'::text, 'completed'::text]))))));--> statement-breakpoint
CREATE POLICY "Public assets viewable by all" ON "content_assets" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "video_progress_student_policy" ON "video_progress" AS PERMISSIVE FOR ALL TO public USING (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))))) WITH CHECK (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))));--> statement-breakpoint
CREATE POLICY "Admins can manage retention policies" ON "audit_log_retention_policy" AS PERMISSIVE FOR ALL TO public USING (user_is_admin()) WITH CHECK (user_is_admin());--> statement-breakpoint
CREATE POLICY "Everyone can view retention policies" ON "audit_log_retention_policy" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Admins can view timeline" ON "project_timeline" AS PERMISSIVE FOR SELECT TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "Allow all for authenticated users" ON "project_timeline" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "System can insert timeline" ON "project_timeline" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Users can view timeline in their org" ON "project_timeline" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Admins can view sessions" ON "session_metadata" AS PERMISSIVE FOR SELECT TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "Allow all for authenticated users" ON "session_metadata" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "System can insert sessions" ON "session_metadata" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Users can view sessions in their org" ON "session_metadata" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "campaign_documents_delete" ON "campaign_documents" AS PERMISSIVE FOR DELETE TO public USING ((auth_has_role('admin'::text) OR (uploaded_by = auth.uid())));--> statement-breakpoint
CREATE POLICY "campaign_documents_insert" ON "campaign_documents" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "campaign_documents_org_isolation" ON "campaign_documents" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "campaign_documents_select" ON "campaign_documents" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "campaign_documents_update" ON "campaign_documents" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Admins can view delivery logs" ON "event_delivery_log" AS PERMISSIVE FOR SELECT TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "System can insert delivery logs" ON "event_delivery_log" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Users can view delivery logs in their org" ON "event_delivery_log" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Admins can view all onboarding checklists" ON "onboarding_checklist" AS PERMISSIVE FOR SELECT TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = ANY (ARRAY['admin'::text, 'super_admin'::text]))))));--> statement-breakpoint
CREATE POLICY "System can insert onboarding checklist" ON "onboarding_checklist" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Users can update own onboarding checklist" ON "onboarding_checklist" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can view own onboarding checklist" ON "onboarding_checklist" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_conversations_admin_all" ON "ai_conversations" AS PERMISSIVE FOR ALL TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "ai_conversations_delete_own" ON "ai_conversations" AS PERMISSIVE FOR DELETE TO public;--> statement-breakpoint
CREATE POLICY "ai_conversations_insert_own" ON "ai_conversations" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "ai_conversations_select_own" ON "ai_conversations" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_conversations_update_own" ON "ai_conversations" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "ai_embeddings_admin_modify" ON "ai_embeddings" AS PERMISSIVE FOR ALL TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "ai_embeddings_select_authenticated" ON "ai_embeddings" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_patterns_admin_all" ON "ai_patterns" AS PERMISSIVE FOR ALL TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "ai_patterns_insert_own" ON "ai_patterns" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "ai_patterns_select_own" ON "ai_patterns" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_patterns_update_own" ON "ai_patterns" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "ai_cost_tracking_insert_own" ON "ai_cost_tracking" AS PERMISSIVE FOR INSERT TO public WITH CHECK (((user_id = auth_user_id()) AND (org_id = auth_user_org_id())));--> statement-breakpoint
CREATE POLICY "ai_cost_tracking_select_own" ON "ai_cost_tracking" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_cost_tracking_select_platform_admin" ON "ai_cost_tracking" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_prompts_admin_all" ON "ai_prompts" AS PERMISSIVE FOR ALL TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "ai_prompts_read_active" ON "ai_prompts" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "System can manage student progress" ON "student_progress" AS PERMISSIVE FOR ALL TO public USING (true) WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "student_progress_select_platform_admin" ON "student_progress" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_agent_interactions_insert_own" ON "ai_agent_interactions" AS PERMISSIVE FOR INSERT TO public WITH CHECK (((user_id = auth_user_id()) AND (org_id = auth_user_org_id())));--> statement-breakpoint
CREATE POLICY "ai_agent_interactions_select_own" ON "ai_agent_interactions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_agent_interactions_select_platform_admin" ON "ai_agent_interactions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Students can update own feedback" ON "guru_interactions" AS PERMISSIVE FOR UPDATE TO public USING ((student_id = auth.uid())) WITH CHECK ((student_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "System can insert guru interactions" ON "guru_interactions" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Students can insert own resumes" ON "resume_versions" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((student_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "Students can update own resumes" ON "resume_versions" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Students can view own resumes" ON "resume_versions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Students can insert own interview sessions" ON "interview_sessions" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((student_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "Students can update own interview sessions" ON "interview_sessions" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Students can view own interview sessions" ON "interview_sessions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "interview_sessions_select_platform_admin" ON "interview_sessions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "screenshots_admin_select" ON "employee_screenshots" AS PERMISSIVE FOR SELECT TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((ur.role_id = r.id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = 'admin'::text)))));--> statement-breakpoint
CREATE POLICY "Users can view their own completions" ON "topic_completions" AS PERMISSIVE FOR SELECT TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "Users can view their own XP transactions" ON "xp_transactions" AS PERMISSIVE FOR SELECT TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "reading_progress_user_policy" ON "reading_progress" AS PERMISSIVE FOR ALL TO public USING (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))))) WITH CHECK (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))));--> statement-breakpoint
CREATE POLICY "lab_templates_public_read" ON "lab_templates" AS PERMISSIVE FOR SELECT TO public USING ((is_active = true));--> statement-breakpoint
CREATE POLICY "lab_instances_user_policy" ON "lab_instances" AS PERMISSIVE FOR ALL TO public USING (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))))) WITH CHECK (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))));--> statement-breakpoint
CREATE POLICY "lab_submissions_user_policy" ON "lab_submissions" AS PERMISSIVE FOR ALL TO public USING (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))))) WITH CHECK (((user_id = auth.uid()) OR (EXISTS ( SELECT 1
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())))));--> statement-breakpoint
CREATE POLICY "capstone_submissions_insert_own" ON "capstone_submissions" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "capstone_submissions_select_own" ON "capstone_submissions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "capstone_submissions_select_trainer" ON "capstone_submissions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "capstone_submissions_update_own" ON "capstone_submissions" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "capstone_submissions_update_trainer" ON "capstone_submissions" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "twin_events_org_access" ON "twin_events" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "twin_conversations_org_access" ON "twin_conversations" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "quiz_questions_admin_all" ON "quiz_questions" AS PERMISSIVE FOR ALL TO "authenticated" USING (true);--> statement-breakpoint
CREATE POLICY "quiz_questions_student_read" ON "quiz_questions" AS PERMISSIVE FOR SELECT TO "authenticated";--> statement-breakpoint
CREATE POLICY "quiz_settings_admin_all" ON "quiz_settings" AS PERMISSIVE FOR ALL TO "authenticated" USING (true);--> statement-breakpoint
CREATE POLICY "quiz_settings_student_read" ON "quiz_settings" AS PERMISSIVE FOR SELECT TO "authenticated";--> statement-breakpoint
CREATE POLICY "org_context_cache_read" ON "org_context_cache" AS PERMISSIVE FOR SELECT TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "org_context_cache_update" ON "org_context_cache" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "org_context_cache_write" ON "org_context_cache" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "org_standups_org_access" ON "org_standups" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "peer_reviews_insert_student" ON "peer_reviews" AS PERMISSIVE FOR INSERT TO public WITH CHECK (((reviewer_id = auth.uid()) AND (NOT (EXISTS ( SELECT 1
   FROM capstone_submissions
  WHERE ((capstone_submissions.id = peer_reviews.submission_id) AND (capstone_submissions.user_id = auth.uid())))))));--> statement-breakpoint
CREATE POLICY "peer_reviews_select_own_reviews" ON "peer_reviews" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "peer_reviews_select_own_submission" ON "peer_reviews" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "peer_reviews_select_trainer" ON "peer_reviews" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_mentor_chats_insert_own" ON "ai_mentor_chats" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "ai_mentor_chats_select_own" ON "ai_mentor_chats" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_mentor_chats_select_staff" ON "ai_mentor_chats" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "ai_mentor_chats_update_rating" ON "ai_mentor_chats" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "sequence_templates_delete_org" ON "sequence_templates" AS PERMISSIVE FOR DELETE TO public USING ((org_id = (current_setting('app.current_org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "sequence_templates_insert_org" ON "sequence_templates" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "sequence_templates_select_org" ON "sequence_templates" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "sequence_templates_update_org" ON "sequence_templates" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "ai_mentor_rate_limits_select_own" ON "ai_mentor_rate_limits" AS PERMISSIVE FOR SELECT TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "ai_mentor_sessions_select_own" ON "ai_mentor_sessions" AS PERMISSIVE FOR SELECT TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "ai_mentor_sessions_select_staff" ON "ai_mentor_sessions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "permission_overrides_org_isolation" ON "permission_overrides" AS PERMISSIVE FOR ALL TO public USING ((org_id = COALESCE(( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())), ((auth.jwt() ->> 'org_id'::text))::uuid)));--> statement-breakpoint
CREATE POLICY "campaign_sequences_delete_org" ON "campaign_sequences" AS PERMISSIVE FOR DELETE TO public USING ((org_id = (current_setting('app.current_org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "campaign_sequences_insert_org" ON "campaign_sequences" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "campaign_sequences_select_org" ON "campaign_sequences" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "campaign_sequences_update_org" ON "campaign_sequences" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "api_tokens_org_isolation" ON "api_tokens" AS PERMISSIVE FOR ALL TO public USING ((org_id = COALESCE(( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())), ((auth.jwt() ->> 'org_id'::text))::uuid)));--> statement-breakpoint
CREATE POLICY "bulk_update_history_org_isolation" ON "bulk_update_history" AS PERMISSIVE FOR ALL TO public USING ((org_id = COALESCE(( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())), ((auth.jwt() ->> 'org_id'::text))::uuid)));--> statement-breakpoint
CREATE POLICY "role_permissions_public_read" ON "role_permissions" AS PERMISSIVE FOR SELECT TO public USING (true);--> statement-breakpoint
CREATE POLICY "permissions_public_read" ON "permissions" AS PERMISSIVE FOR SELECT TO public USING (true);--> statement-breakpoint
CREATE POLICY "question_patterns_select_admin" ON "ai_question_patterns" AS PERMISSIVE FOR SELECT TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = 'admin'::text)))));--> statement-breakpoint
CREATE POLICY "feature_flag_roles_read" ON "feature_flag_roles" AS PERMISSIVE FOR SELECT TO public USING (true);--> statement-breakpoint
CREATE POLICY "prompt_variants_all_admin" ON "ai_prompt_variants" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = 'admin'::text)))));--> statement-breakpoint
CREATE POLICY "badges_all_admin" ON "badges" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = 'admin'::text)))));--> statement-breakpoint
CREATE POLICY "badges_select_all" ON "badges" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "user_badges_select_own" ON "user_badges" AS PERMISSIVE FOR SELECT TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "user_badges_update_own" ON "user_badges" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Only admins can modify workflow states" ON "workflow_states" AS PERMISSIVE FOR ALL TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "Users can view workflow states" ON "workflow_states" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Only admins can modify workflow transitions" ON "workflow_transitions" AS PERMISSIVE FOR ALL TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "Users can view workflow transitions" ON "workflow_transitions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Service role can update workflow instances" ON "workflow_instances" AS PERMISSIVE FOR UPDATE TO public USING (true);--> statement-breakpoint
CREATE POLICY "Users can create workflow instances in their org" ON "workflow_instances" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Users can view workflow instances in their org" ON "workflow_instances" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Service role can insert workflow history" ON "workflow_history" AS PERMISSIVE FOR INSERT TO public WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "Users can view workflow history for their org instances" ON "workflow_history" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Users can soft-delete their own files" ON "file_uploads" AS PERMISSIVE FOR UPDATE TO public USING (((org_id = auth_user_org_id()) AND (uploaded_by = auth_user_id()))) WITH CHECK (((org_id = auth_user_org_id()) AND (uploaded_by = auth_user_id())));--> statement-breakpoint
CREATE POLICY "Users can upload files to their org" ON "file_uploads" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Users can view files in their org" ON "file_uploads" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "file_uploads_org_isolation" ON "file_uploads" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "Only admins can create templates" ON "document_templates" AS PERMISSIVE FOR INSERT TO public WITH CHECK (user_is_admin());--> statement-breakpoint
CREATE POLICY "Only admins can delete templates" ON "document_templates" AS PERMISSIVE FOR DELETE TO public;--> statement-breakpoint
CREATE POLICY "Only admins can update templates" ON "document_templates" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can view templates in their org" ON "document_templates" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Users can create generated documents in their org" ON "generated_documents" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((org_id = auth_user_org_id()));--> statement-breakpoint
CREATE POLICY "Users can view generated documents in their org" ON "generated_documents" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Only admins can create workflows" ON "workflows" AS PERMISSIVE FOR INSERT TO public WITH CHECK (user_is_admin());--> statement-breakpoint
CREATE POLICY "Only admins can delete workflows" ON "workflows" AS PERMISSIVE FOR DELETE TO public;--> statement-breakpoint
CREATE POLICY "Only admins can update workflows" ON "workflows" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can view workflows in their org" ON "workflows" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Service role can insert email logs" ON "email_logs" AS PERMISSIVE FOR INSERT TO public WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "Service role can update email logs" ON "email_logs" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can view email logs in their org" ON "email_logs" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Service role can update jobs" ON "background_jobs" AS PERMISSIVE FOR UPDATE TO public USING (true);--> statement-breakpoint
CREATE POLICY "Users can create jobs in their org" ON "background_jobs" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Users can view jobs in their org" ON "background_jobs" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "pricing_plans_admin_all" ON "pricing_plans" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = ANY (ARRAY['admin'::text, 'super_admin'::text]))))));--> statement-breakpoint
CREATE POLICY "pricing_plans_public_read" ON "pricing_plans" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "discount_codes_admin_all" ON "discount_codes" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = ANY (ARRAY['admin'::text, 'super_admin'::text]))))));--> statement-breakpoint
CREATE POLICY "Only admins can delete interventions" ON "student_interventions" AS PERMISSIVE FOR UPDATE TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = ANY (ARRAY['admin'::text, 'super_admin'::text]))))));--> statement-breakpoint
CREATE POLICY "Students can view own interventions" ON "student_interventions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Trainers and admins can create interventions" ON "student_interventions" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Trainers and admins can view all interventions" ON "student_interventions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Trainers can update assigned interventions" ON "student_interventions" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Admins create enrollments" ON "student_enrollments" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((EXISTS ( SELECT 1
   FROM user_roles
  WHERE ((user_roles.user_id = auth.uid()) AND (user_roles.role_id IN ( SELECT roles.id
           FROM roles
          WHERE (roles.name = ANY (ARRAY['admin'::text, 'course_admin'::text]))))))));--> statement-breakpoint
CREATE POLICY "Students update own enrollments" ON "student_enrollments" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Students view own enrollments" ON "student_enrollments" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "discount_usage_admin_all" ON "discount_code_usage" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = ANY (ARRAY['admin'::text, 'super_admin'::text]))))));--> statement-breakpoint
CREATE POLICY "discount_usage_own_read" ON "discount_code_usage" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "course_pricing_admin_all" ON "course_pricing" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = ANY (ARRAY['admin'::text, 'super_admin'::text]))))));--> statement-breakpoint
CREATE POLICY "course_pricing_public_read" ON "course_pricing" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Users can manage their org settings" ON "organization_settings" AS PERMISSIVE FOR ALL TO public USING (((org_id = auth_user_org_id()) OR user_is_admin()));--> statement-breakpoint
CREATE POLICY "Users can view their org settings" ON "organization_settings" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "comments_create_employee" ON "comments" AS PERMISSIVE FOR INSERT TO public WITH CHECK (((author_id = auth.uid()) AND (auth_has_role('employee'::text) OR auth_has_role('admin'::text))));--> statement-breakpoint
CREATE POLICY "comments_delete_own_or_admin" ON "comments" AS PERMISSIVE FOR DELETE TO public;--> statement-breakpoint
CREATE POLICY "comments_org_isolation" ON "comments" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "comments_read_all" ON "comments" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "comments_update_own" ON "comments" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "lead_tasks_org_isolation" ON "lead_tasks" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "notifications_org_isolation" ON "notifications" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "notifications_system_create" ON "notifications" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "notifications_user_own" ON "notifications" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "notifications_user_update_own" ON "notifications" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "tasks_assigned_or_created" ON "tasks" AS PERMISSIVE FOR SELECT TO public USING (((assigned_to = auth.uid()) OR (created_by = auth.uid()) OR auth_has_role('admin'::text)));--> statement-breakpoint
CREATE POLICY "tasks_create_own" ON "tasks" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "tasks_delete_creator_or_admin" ON "tasks" AS PERMISSIVE FOR DELETE TO public;--> statement-breakpoint
CREATE POLICY "tasks_org_isolation" ON "tasks" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "tasks_update_assigned_or_admin" ON "tasks" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can manage their org branding" ON "organization_branding" AS PERMISSIVE FOR ALL TO public USING (((org_id = auth_user_org_id()) OR user_is_admin()));--> statement-breakpoint
CREATE POLICY "Users can view their org branding" ON "organization_branding" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "contracts_org" ON "company_contracts" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "rate_cards_org" ON "company_rate_cards" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "rate_card_items_org" ON "company_rate_card_items" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM company_rate_cards rc
  WHERE ((rc.id = company_rate_card_items.rate_card_id) AND (rc.org_id = current_user_org_id())))));--> statement-breakpoint
CREATE POLICY "compliance_org" ON "company_compliance_requirements" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "health_scores_org" ON "company_health_scores" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "metrics_org" ON "company_metrics" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "revenue_org" ON "company_revenue" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "activity_employee_insert" ON "activity_log" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((auth_has_role('employee'::text) OR auth_has_role('admin'::text) OR auth_has_role('recruiter'::text)));--> statement-breakpoint
CREATE POLICY "activity_employee_select" ON "activity_log" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "activity_org_isolation" ON "activity_log" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "employee_metadata_employee_own" ON "employee_metadata" AS PERMISSIVE FOR SELECT TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "employee_metadata_hr_all" ON "employee_metadata" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "candidate_skills_candidate_own" ON "candidate_skills" AS PERMISSIVE FOR ALL TO public USING ((candidate_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "candidate_skills_employee_read" ON "candidate_skills" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "candidate_skills_org_isolation" ON "candidate_skills" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "candidate_skills_recruiter_write" ON "candidate_skills" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "pods_admin_write" ON "pods" AS PERMISSIVE FOR ALL TO public USING ((auth_has_role('admin'::text) OR auth_has_role('hr'::text)));--> statement-breakpoint
CREATE POLICY "pods_employee_read" ON "pods" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "pods_org_isolation" ON "pods" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "session_context_own" ON "user_session_context" AS PERMISSIVE FOR ALL TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "pod_managers_org_isolation" ON "pod_managers" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid())
 LIMIT 1)));--> statement-breakpoint
CREATE POLICY "pod_managers_org_policy" ON "pod_managers" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "lead_strategies_org_isolation" ON "lead_strategies" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "talking_point_templates_org_isolation" ON "talking_point_templates" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "payroll_items_employee_own" ON "payroll_items" AS PERMISSIVE FOR SELECT TO public USING ((employee_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "payroll_items_hr_admin_only" ON "payroll_items" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "time_attendance_employee_own" ON "time_attendance" AS PERMISSIVE FOR ALL TO public USING ((employee_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "time_attendance_hr_read" ON "time_attendance" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "time_attendance_manager_approve" ON "time_attendance" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "payroll_runs_hr_admin_only" ON "payroll_runs" AS PERMISSIVE FOR ALL TO public USING ((auth_has_role('admin'::text) OR auth_has_role('hr'::text)));--> statement-breakpoint
CREATE POLICY "payroll_runs_org_isolation" ON "payroll_runs" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "performance_reviews_org_isolation" ON "performance_reviews" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "reviews_employee_own" ON "performance_reviews" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "reviews_hr_all" ON "performance_reviews" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "reviews_org_isolation" ON "performance_reviews" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "import_jobs_org_isolation" ON "import_jobs" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "export_jobs_org_isolation" ON "export_jobs" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "gdpr_requests_org_isolation" ON "gdpr_requests" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "duplicate_records_org_isolation" ON "duplicate_records" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "duplicate_rules_org_isolation" ON "duplicate_rules" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "archived_records_org_isolation" ON "archived_records" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "retention_policies_org_isolation" ON "retention_policies" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "Users can insert resumes in their org" ON "candidate_resumes" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "Users can update resumes in their org" ON "candidate_resumes" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can view resumes in their org" ON "candidate_resumes" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Admins can insert profiles" ON "user_profiles" AS PERMISSIVE FOR INSERT TO public WITH CHECK (user_is_admin());--> statement-breakpoint
CREATE POLICY "Admins can soft delete profiles" ON "user_profiles" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Admins can update any profile" ON "user_profiles" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Admins can view all profiles" ON "user_profiles" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "HR managers can view employees" ON "user_profiles" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Recruiters can view candidates" ON "user_profiles" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Trainers can view students" ON "user_profiles" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Users can update own profile" ON "user_profiles" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can view own profile" ON "user_profiles" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Users can view profiles in their org" ON "user_profiles" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "candidates_context_read" ON "user_profiles" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "user_profiles_org_isolation" ON "user_profiles" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "bgv_service_all" ON "candidate_background_checks" AS PERMISSIVE FOR ALL TO "service_role" USING (true) WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "certifications_service_all" ON "candidate_certifications" AS PERMISSIVE FOR ALL TO "service_role" USING (true) WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "compliance_service_all" ON "candidate_compliance_documents" AS PERMISSIVE FOR ALL TO "service_role" USING (true) WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "object_owners_org_isolation" ON "object_owners" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "object_owners_user_read" ON "object_owners" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "education_service_all" ON "candidate_education" AS PERMISSIVE FOR ALL TO "service_role" USING (true) WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "references_service_all" ON "candidate_references" AS PERMISSIVE FOR ALL TO "service_role" USING (true) WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "work_auth_service_all" ON "candidate_work_authorizations" AS PERMISSIVE FOR ALL TO "service_role" USING (true) WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "regions_org_isolation" ON "regions" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "pod_members_org_isolation" ON "pod_members" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "system_roles_public_read" ON "system_roles" AS PERMISSIVE FOR SELECT TO public USING (true);--> statement-breakpoint
CREATE POLICY "Admins can view all events" ON "events" AS PERMISSIVE FOR SELECT TO public USING (user_is_admin());--> statement-breakpoint
CREATE POLICY "System can publish events" ON "events" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "System can update events" ON "events" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can view events in their org" ON "events" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Users can view own events" ON "events" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Admins can manage subscriptions" ON "event_subscriptions" AS PERMISSIVE FOR ALL TO public USING (user_is_admin()) WITH CHECK (user_is_admin());--> statement-breakpoint
CREATE POLICY "Everyone can view subscriptions" ON "event_subscriptions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "event_subscriptions_insert" ON "event_subscriptions" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "event_subscriptions_select" ON "event_subscriptions" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "team_org" ON "company_team" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "contacts_org" ON "company_contacts" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "relationships_org" ON "company_relationships" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "addresses_org" ON "company_addresses" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "notes_org" ON "company_notes" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "preferences_org" ON "company_preferences" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "tags_org" ON "company_tags" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "integrations_org_access" ON "integrations" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "health_logs_org_access" ON "integration_health_logs" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "integration_types_read" ON "integration_types" AS PERMISSIVE FOR SELECT TO public USING (true);--> statement-breakpoint
CREATE POLICY "external_job_orders_org_isolation" ON "external_job_orders" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "work_history_service_all" ON "candidate_work_history" AS PERMISSIVE FOR ALL TO "service_role" USING (true) WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "raci_change_log_org_isolation" ON "raci_change_log" AS PERMISSIVE FOR ALL TO public USING ((org_id = COALESCE((current_setting('app.current_org_id'::text, true))::uuid, ((auth.jwt() ->> 'org_id'::text))::uuid)));--> statement-breakpoint
CREATE POLICY "workplan_templates_org_isolation" ON "workplan_templates" AS PERMISSIVE FOR ALL TO public USING (((org_id = current_user_org_id()) OR (is_system = true)));--> statement-breakpoint
CREATE POLICY "workplan_instances_org_isolation" ON "workplan_instances" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "pod_sprint_metrics_employee_read" ON "pod_sprint_metrics" AS PERMISSIVE FOR SELECT TO public USING ((EXISTS ( SELECT 1
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "pod_sprint_metrics_org_isolation" ON "pod_sprint_metrics" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "addresses_service_all" ON "addresses" AS PERMISSIVE FOR ALL TO "service_role" USING (true) WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "sla_instances_org_isolation" ON "sla_instances" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "login_history_org_policy" ON "login_history" AS PERMISSIVE FOR ALL TO public USING (((org_id = auth_user_org_id()) OR user_is_admin()));--> statement-breakpoint
CREATE POLICY "user_invitations_org_policy" ON "user_invitations" AS PERMISSIVE FOR ALL TO public USING (((org_id = auth_user_org_id()) OR user_is_admin()));--> statement-breakpoint
CREATE POLICY "webhooks_org_access" ON "webhooks" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "webhook_deliveries_org_access" ON "webhook_deliveries" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "retry_config_org_access" ON "integration_retry_config" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "oauth_tokens_org_access" ON "integration_oauth_tokens" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "failover_config_org_access" ON "integration_failover_config" AS PERMISSIVE FOR ALL TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))) OR ((auth.jwt() ->> 'role'::text) = 'service_role'::text)));--> statement-breakpoint
CREATE POLICY "activities_org_isolation" ON "activities" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "skills_admin_write" ON "skills" AS PERMISSIVE FOR ALL TO public USING (auth_has_role('admin'::text));--> statement-breakpoint
CREATE POLICY "skills_public_read" ON "skills" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "bench_consultants_org_isolation" ON "bench_consultants" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "approval_workflows_org_isolation" ON "approval_workflows" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "approval_steps_org_isolation" ON "approval_steps" AS PERMISSIVE FOR ALL TO public USING ((instance_id IN ( SELECT approval_instances.id
   FROM approval_instances
  WHERE (approval_instances.org_id = ((auth.jwt() ->> 'org_id'::text))::uuid))));--> statement-breakpoint
CREATE POLICY "approval_instances_org_isolation" ON "approval_instances" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "placement_credits_org_isolation" ON "placement_credits" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "graduate_candidates_org_isolation" ON "graduate_candidates" AS PERMISSIVE FOR ALL TO public USING ((user_id IN ( SELECT user_profiles.id
   FROM user_profiles
  WHERE (user_profiles.org_id = ((auth.jwt() ->> 'org_id'::text))::uuid))));--> statement-breakpoint
CREATE POLICY "quiz_attempts_admin_read" ON "quiz_attempts" AS PERMISSIVE FOR SELECT TO "authenticated" USING (true);--> statement-breakpoint
CREATE POLICY "quiz_attempts_user_insert" ON "quiz_attempts" AS PERMISSIVE FOR INSERT TO "authenticated";--> statement-breakpoint
CREATE POLICY "quiz_attempts_user_read" ON "quiz_attempts" AS PERMISSIVE FOR SELECT TO "authenticated";--> statement-breakpoint
CREATE POLICY "quiz_attempts_user_update" ON "quiz_attempts" AS PERMISSIVE FOR UPDATE TO "authenticated";--> statement-breakpoint
CREATE POLICY "escalations_select_own" ON "ai_mentor_escalations" AS PERMISSIVE FOR SELECT TO public USING ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "escalations_select_staff" ON "ai_mentor_escalations" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "escalations_update_assigned" ON "ai_mentor_escalations" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "trainer_responses_insert_staff" ON "trainer_responses" AS PERMISSIVE FOR INSERT TO public WITH CHECK (((trainer_id = auth.uid()) AND (EXISTS ( SELECT 1
   FROM (user_roles ur
     JOIN roles r ON ((r.id = ur.role_id)))
  WHERE ((ur.user_id = auth.uid()) AND (r.name = ANY (ARRAY['admin'::text, 'trainer'::text])))))));--> statement-breakpoint
CREATE POLICY "trainer_responses_select_staff" ON "trainer_responses" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "trainer_responses_select_student" ON "trainer_responses" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "entity_skills_org_isolation" ON "entity_skills" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "certifications_org_isolation" ON "certifications" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "contact_bench_data_org_isolation" ON "contact_bench_data" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "contact_bench_data_service_role" ON "contact_bench_data" AS PERMISSIVE FOR ALL TO "service_role";--> statement-breakpoint
CREATE POLICY "submission_feedback_org_isolation" ON "submission_feedback" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "submission_rtr_org_isolation" ON "submission_rtr" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "skill_endorsements_org_isolation" ON "skill_endorsements" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "Admins can manage security alerts" ON "security_alerts" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "Users can view security alerts in their org" ON "security_alerts" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Admins can manage alert rules" ON "alert_rules" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "Users can view alert rules in their org" ON "alert_rules" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Only admins can create email templates" ON "email_templates" AS PERMISSIVE FOR INSERT TO public WITH CHECK (user_is_admin());--> statement-breakpoint
CREATE POLICY "Only admins can update email templates" ON "email_templates" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can view email templates in their org" ON "email_templates" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "email_templates_org_isolation" ON "email_templates" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "email_sends_org_isolation" ON "email_sends" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "email_senders_org_isolation" ON "email_senders" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "incidents_org_isolation" ON "incidents" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "incident_timeline_org_isolation" ON "incident_timeline" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "incident_notifications_org_isolation" ON "incident_notifications" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "break_glass_access_org_isolation" ON "break_glass_access" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "emergency_drills_org_isolation" ON "emergency_drills" AS PERMISSIVE FOR ALL TO public USING ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "sla_definitions_org_isolation" ON "sla_definitions" AS PERMISSIVE FOR ALL TO public USING (((org_id IS NULL) OR (org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid())))));--> statement-breakpoint
CREATE POLICY "sla_escalation_levels_org_isolation" ON "sla_escalation_levels" AS PERMISSIVE FOR ALL TO public USING ((sla_definition_id IN ( SELECT sla_definitions.id
   FROM sla_definitions
  WHERE (sla_definitions.org_id = COALESCE((current_setting('app.current_org_id'::text, true))::uuid, ((auth.jwt() ->> 'org_id'::text))::uuid)))));--> statement-breakpoint
CREATE POLICY "sla_events_org_isolation" ON "sla_events" AS PERMISSIVE FOR ALL TO public USING ((org_id = COALESCE((current_setting('app.current_org_id'::text, true))::uuid, ((auth.jwt() ->> 'org_id'::text))::uuid)));--> statement-breakpoint
CREATE POLICY "sla_notifications_org_isolation" ON "sla_notifications" AS PERMISSIVE FOR ALL TO public USING ((sla_event_id IN ( SELECT sla_events.id
   FROM sla_events
  WHERE (sla_events.org_id = COALESCE((current_setting('app.current_org_id'::text, true))::uuid, ((auth.jwt() ->> 'org_id'::text))::uuid)))));--> statement-breakpoint
CREATE POLICY "contacts_org_isolation" ON "contacts" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "activity_stats_daily_insert_policy" ON "activity_stats_daily" AS PERMISSIVE FOR INSERT TO public WITH CHECK (true);--> statement-breakpoint
CREATE POLICY "activity_stats_daily_select_policy" ON "activity_stats_daily" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "activity_stats_daily_update_policy" ON "activity_stats_daily" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "notes_org_isolation" ON "notes" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "notes_select_visibility" ON "notes" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "feature_flag_usage_insert" ON "feature_flag_usage" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "feature_flag_usage_select" ON "feature_flag_usage" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "feature_flag_feedback_insert" ON "feature_flag_feedback" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((user_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "feature_flag_feedback_select" ON "feature_flag_feedback" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "feature_flag_categories_select" ON "feature_flag_categories" AS PERMISSIVE FOR SELECT TO public USING (((org_id IS NULL) OR (org_id = COALESCE(( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())), ((auth.jwt() ->> 'org_id'::text))::uuid))));--> statement-breakpoint
CREATE POLICY "feature_flags_access" ON "feature_flags" AS PERMISSIVE FOR SELECT TO public USING (((is_global = true) OR (org_id IS NULL) OR (org_id = COALESCE(( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid())), ((auth.jwt() ->> 'org_id'::text))::uuid))));--> statement-breakpoint
CREATE POLICY "feature_flags_org_delete" ON "feature_flags" AS PERMISSIVE FOR DELETE TO public;--> statement-breakpoint
CREATE POLICY "feature_flags_org_update" ON "feature_flags" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "feature_flags_org_write" ON "feature_flags" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Users can insert job status history in their org" ON "job_status_history" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((org_id = ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "Users can view job status history in their org" ON "job_status_history" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Authenticated users can view active organizations" ON "organizations" AS PERMISSIVE FOR SELECT TO public USING (((status = 'active'::text) AND (deleted_at IS NULL) AND ((id = auth_user_org_id()) OR user_is_admin())));--> statement-breakpoint
CREATE POLICY "Only admins can create organizations" ON "organizations" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Only admins can delete organizations" ON "organizations" AS PERMISSIVE FOR DELETE TO public;--> statement-breakpoint
CREATE POLICY "Only admins can update organizations" ON "organizations" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Service role can create organizations" ON "organizations" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "Users can view their own organization" ON "organizations" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "saved_searches_delete_policy" ON "saved_searches" AS PERMISSIVE FOR DELETE TO public USING (((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))) AND (user_id = auth.uid())));--> statement-breakpoint
CREATE POLICY "saved_searches_insert_policy" ON "saved_searches" AS PERMISSIVE FOR INSERT TO public;--> statement-breakpoint
CREATE POLICY "saved_searches_select_policy" ON "saved_searches" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "saved_searches_update_policy" ON "saved_searches" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "candidate_prepared_profiles_org_access" ON "candidate_prepared_profiles" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "candidate_screenings_org_access" ON "candidate_screenings" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "contact_relationships_org_isolation" ON "contact_relationships" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "contact_roles_org_isolation" ON "contact_roles" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "Users can manage offers in their organization" ON "offers" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "Users can view offers in their organization" ON "offers" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "offers_candidate_own" ON "offers" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "offers_employee_all" ON "offers" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "contact_skills_org_isolation" ON "contact_skills" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "contact_work_history_org_isolation" ON "contact_work_history" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "contact_education_org_isolation" ON "contact_education" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "contact_certifications_org_isolation" ON "contact_certifications" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "contact_rate_cards_org_isolation" ON "contact_rate_cards" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "contact_agreements_org_isolation" ON "contact_agreements" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "contact_compliance_org_isolation" ON "contact_compliance" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "contact_comm_prefs_org_isolation" ON "contact_communication_preferences" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "contact_merge_history_org_isolation" ON "contact_merge_history" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "note_reactions_access" ON "note_reactions" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM notes n
  WHERE ((n.id = note_reactions.note_id) AND (n.org_id = (current_setting('app.org_id'::text, true))::uuid)))));--> statement-breakpoint
CREATE POLICY "companies_org_isolation" ON "companies" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "documents_access_level" ON "documents" AS PERMISSIVE FOR SELECT TO public USING ((((access_level)::text = ANY ((ARRAY['public'::character varying, 'standard'::character varying])::text[])) OR (((access_level)::text = 'confidential'::text) AND (EXISTS ( SELECT 1
   FROM user_roles ur
  WHERE ((ur.user_id = (current_setting('app.user_id'::text, true))::uuid) AND (ur.role_id IN ( SELECT roles.id
           FROM roles
          WHERE (roles.name = ANY (ARRAY['admin'::text, 'manager'::text])))))))) OR (uploaded_by = (current_setting('app.user_id'::text, true))::uuid)));--> statement-breakpoint
CREATE POLICY "documents_org_isolation" ON "documents" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "meeting_notes_employee_access" ON "meeting_notes" AS PERMISSIVE FOR ALL TO public USING ((auth_has_role('employee'::text) OR auth_has_role('admin'::text) OR auth_has_role('recruiter'::text)));--> statement-breakpoint
CREATE POLICY "meeting_notes_org_isolation" ON "meeting_notes" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "escalations_employee_access" ON "escalations" AS PERMISSIVE FOR ALL TO public USING ((auth_has_role('employee'::text) OR auth_has_role('admin'::text) OR auth_has_role('recruiter'::text)));--> statement-breakpoint
CREATE POLICY "escalations_org_isolation" ON "escalations" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "escalation_updates_access" ON "escalation_updates" AS PERMISSIVE FOR ALL TO public USING ((escalation_id IN ( SELECT escalations.id
   FROM escalations
  WHERE (escalations.org_id = auth_org_id()))));--> statement-breakpoint
CREATE POLICY "document_access_log_policy" ON "document_access_log" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM documents d
  WHERE ((d.id = document_access_log.document_id) AND (d.org_id = (current_setting('app.org_id'::text, true))::uuid)))));--> statement-breakpoint
CREATE POLICY "company_client_details_org_isolation" ON "company_client_details" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "company_vendor_details_org_isolation" ON "company_vendor_details" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "company_partner_details_org_isolation" ON "company_partner_details" AS PERMISSIVE FOR ALL TO public USING ((org_id = current_user_org_id()));--> statement-breakpoint
CREATE POLICY "deals_employee_insert" ON "deals" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((auth_has_role('employee'::text) OR auth_has_role('admin'::text) OR auth_has_role('recruiter'::text)));--> statement-breakpoint
CREATE POLICY "deals_employee_select" ON "deals" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "deals_org_isolation" ON "deals" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "deals_owner_update" ON "deals" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "retention_policies_org_isolation" ON "data_retention_policies" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "compliance_requirements_org_isolation" ON "compliance_requirements" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "compliance_items_org_isolation" ON "compliance_items" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "entity_compliance_requirements_org_isolation" ON "entity_compliance_requirements" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "contracts_org_isolation" ON "contracts" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "contract_versions_org_isolation" ON "contract_versions" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM contracts c
  WHERE ((c.id = contract_versions.contract_id) AND (c.org_id = (current_setting('app.org_id'::text, true))::uuid)))));--> statement-breakpoint
CREATE POLICY "contract_parties_org_isolation" ON "contract_parties" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "contract_templates_org_isolation" ON "contract_templates" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "contract_clauses_org_isolation" ON "contract_clauses" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "rate_approvals_org_isolation" ON "rate_approvals" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "rate_cards_org_isolation" ON "rate_cards" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "rate_card_items_org_isolation" ON "rate_card_items" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "entity_rates_org_isolation" ON "entity_rates" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "rate_change_history_org_isolation" ON "rate_change_history" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM entity_rates e
  WHERE ((e.id = rate_change_history.entity_rate_id) AND (e.org_id = (current_setting('app.org_id'::text, true))::uuid)))));--> statement-breakpoint
CREATE POLICY "jobs_employee_read" ON "jobs" AS PERMISSIVE FOR SELECT TO public USING (((auth_has_active_role('recruiter'::text) AND ((owner_id = auth.uid()) OR (auth.uid() = ANY (recruiter_ids)))) OR auth_has_active_role('bench_sales'::text) OR auth_has_active_role('ta_specialist'::text) OR auth_has_active_role('admin'::text)));--> statement-breakpoint
CREATE POLICY "jobs_org_isolation" ON "jobs" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "jobs_recruiter_write" ON "jobs" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "submissions_candidate_own_read" ON "submissions" AS PERMISSIVE FOR SELECT TO public USING ((auth_has_role('candidate'::text) AND (candidate_id = auth.uid())));--> statement-breakpoint
CREATE POLICY "submissions_org_isolation" ON "submissions" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "submissions_recruiter_write" ON "submissions" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "Users can manage interviews in their organization" ON "interviews" AS PERMISSIVE FOR ALL TO public USING ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE (user_profiles.auth_id = auth.uid()))));--> statement-breakpoint
CREATE POLICY "Users can view interviews in their organization" ON "interviews" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "interviews_candidate_own" ON "interviews" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "interviews_employee_all" ON "interviews" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "interview_participants_org_isolation" ON "interview_participants" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "interview_scorecards_org_isolation" ON "interview_scorecards" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "scorecard_templates_org_isolation" ON "scorecard_templates" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "placements_candidate_own" ON "placements" AS PERMISSIVE FOR SELECT TO public USING ((candidate_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "placements_employee_all" ON "placements" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "placements_org_isolation" ON "placements" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "placement_vendors_org_isolation" ON "placement_vendors" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "placement_change_orders_org_isolation" ON "placement_change_orders" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "Users can insert placement checkins for their org" ON "placement_checkins" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((org_id IN ( SELECT user_profiles.org_id
   FROM user_profiles
  WHERE ((user_profiles.id = auth.uid()) OR (user_profiles.auth_id = auth.uid())))));--> statement-breakpoint
CREATE POLICY "Users can update their org's placement checkins" ON "placement_checkins" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "Users can view their org's placement checkins" ON "placement_checkins" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "placement_checkins_org_isolation" ON "placement_checkins" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "onboarding_templates_org_isolation" ON "onboarding_templates" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "onboarding_template_tasks_org_isolation" ON "onboarding_template_tasks" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "timesheets_org_isolation" ON "timesheets" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "timesheet_approval_workflows_org_isolation" ON "timesheet_approval_workflows" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "timesheet_adjustments_org_isolation" ON "timesheet_adjustments" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "timesheet_templates_org_isolation" ON "timesheet_templates" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "invoices_org_isolation" ON "invoices" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "invoice_payments_org_isolation" ON "invoice_payments" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "payment_terms_org_isolation" ON "payment_terms" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "invoice_batches_org_isolation" ON "invoice_batches" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "invoice_templates_org_isolation" ON "invoice_templates" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "pay_periods_org_isolation" ON "pay_periods" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "pay_runs_org_isolation" ON "pay_runs" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "worker_tax_setup_org_isolation" ON "worker_tax_setup" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "worker_benefits_org_isolation" ON "worker_benefits" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "worker_garnishments_org_isolation" ON "worker_garnishments" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "tax_documents_org_isolation" ON "tax_documents" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "org_isolation_workflow_executions" ON "workflow_executions" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "execution_access_workflow_steps" ON "workflow_steps" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM workflow_executions we
  WHERE ((we.id = workflow_steps.execution_id) AND (we.org_id = (current_setting('app.org_id'::text, true))::uuid)))));--> statement-breakpoint
CREATE POLICY "execution_access_workflow_actions" ON "workflow_actions" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM workflow_executions we
  WHERE ((we.id = workflow_actions.execution_id) AND (we.org_id = (current_setting('app.org_id'::text, true))::uuid)))));--> statement-breakpoint
CREATE POLICY "org_isolation_workflow_approvals" ON "workflow_approvals" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "execution_access_workflow_logs" ON "workflow_execution_logs" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM workflow_executions we
  WHERE ((we.id = workflow_execution_logs.execution_id) AND (we.org_id = (current_setting('app.org_id'::text, true))::uuid)))));--> statement-breakpoint
CREATE POLICY "user_isolation_notification_preferences" ON "notification_preferences" AS PERMISSIVE FOR ALL TO public USING ((user_id = (current_setting('app.user_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "org_isolation_notification_templates" ON "notification_templates" AS PERMISSIVE FOR ALL TO public USING (((org_id IS NULL) OR (org_id = (current_setting('app.org_id'::text, true))::uuid)));--> statement-breakpoint
CREATE POLICY "campaigns_create" ON "campaigns" AS PERMISSIVE FOR INSERT TO public WITH CHECK ((auth_has_role('admin'::text) OR auth_has_role('recruiter'::text)));--> statement-breakpoint
CREATE POLICY "campaigns_employee_all" ON "campaigns" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "campaigns_employee_select" ON "campaigns" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "campaigns_org_isolation" ON "campaigns" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "campaigns_owner_update" ON "campaigns" AS PERMISSIVE FOR UPDATE TO public;--> statement-breakpoint
CREATE POLICY "campaign_enrollments_org_isolation" ON "campaign_enrollments" AS PERMISSIVE FOR ALL TO public USING ((org_id = ((auth.jwt() ->> 'org_id'::text))::uuid));--> statement-breakpoint
CREATE POLICY "campaign_sequence_logs_org_isolation" ON "campaign_sequence_logs" AS PERMISSIVE FOR ALL TO public USING ((org_id = auth_org_id()));--> statement-breakpoint
CREATE POLICY "campaign_sequence_logs_select" ON "campaign_sequence_logs" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "org_isolation_communications" ON "communications" AS PERMISSIVE FOR ALL TO public USING ((org_id = (current_setting('app.org_id'::text, true))::uuid));--> statement-breakpoint
CREATE POLICY "comm_access_communication_events" ON "communication_events" AS PERMISSIVE FOR ALL TO public USING ((EXISTS ( SELECT 1
   FROM communications c
  WHERE ((c.id = communication_events.communication_id) AND (c.org_id = (current_setting('app.org_id'::text, true))::uuid)))));--> statement-breakpoint
CREATE POLICY "pto_balances_employee_own" ON "pto_balances" AS PERMISSIVE FOR SELECT TO public USING ((employee_id = auth.uid()));--> statement-breakpoint
CREATE POLICY "pto_balances_hr_all" ON "pto_balances" AS PERMISSIVE FOR ALL TO public;--> statement-breakpoint
CREATE POLICY "Admins can manage user roles" ON "user_roles" AS PERMISSIVE FOR ALL TO public USING (user_is_admin()) WITH CHECK (user_is_admin());--> statement-breakpoint
CREATE POLICY "Admins can view all user roles" ON "user_roles" AS PERMISSIVE FOR SELECT TO public;--> statement-breakpoint
CREATE POLICY "Users can view own roles" ON "user_roles" AS PERMISSIVE FOR SELECT TO public;
*/