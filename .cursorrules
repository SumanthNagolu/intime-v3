# Cursor AI Rules - InTime v3 (Comprehensive Agent System)

## üéØ Project Context

InTime is a **living organism** - not traditional software. It's a multi-agent orchestration platform for staffing business automation.

**What InTime Does:**
- 5-pillar staffing business platform (Training Academy, Recruiting, Bench Sales, Talent Acquisition, Cross-Border)
- 2-person pod structure (Senior + Junior pairs, target: 2 placements per 2-week sprint)
- Cross-pollination principle: 1 conversation = 5+ lead opportunities across pillars
- 5-year vision: Internal tool (2026) ‚Üí B2B SaaS "IntimeOS" (2027) ‚Üí Multi-industry (2028) ‚Üí IPO (2030)

**Development Environment:**
- Primary: Claude Code CLI (multi-agent orchestration in `.claude/`)
- Secondary: Cursor (this environment, single AI context)
- Both tools share: `.mcp.json`, documentation, code conventions

---

## üìö Documentation Hierarchy (Read in Order)

For complete context, reference these files:

1. **Project Fundamentals**
   - `/CLAUDE.md` - Core project context, tech stack, lessons learned
   - `/PROJECT-STRUCTURE.md` - File organization

2. **Business & Strategy**
   - `/docs/vision/` - Complete business vision (16 documents)
   - `/docs/planning/epics/` - Feature epics and stories
   - `/docs/audit/LESSONS-LEARNED.md` - What NOT to do (from legacy project)


4. **Agent Knowledge** (Specialist Expertise)
   - `/.claude/agents/strategic/` - CEO Advisor, CFO Advisor
   - `/.claude/agents/planning/` - PM Agent
   - `/.claude/agents/implementation/` - Database Architect, Frontend Developer, API Developer
   - `/.claude/agents/operations/` - QA Engineer, Deployment Specialist
   - `/.claude/agents/quality/` - Code Reviewer, Security Auditor

5. **Workflows**
   - `/.claude/commands/workflows/` - Feature development, database, deploy, candidate pipeline, cross-pollination

---

## üß† Agent Expertise Simulation

Since Cursor uses a single AI context (vs Claude Code's 8 specialist agents), simulate agent expertise based on task:

### When Working On Database/Schema ‚Üí Think Like Database Architect

**Reference:** `/.claude/agents/implementation/database-architect.md`

**Core Principles:**
- **EVERY table MUST have Row Level Security (RLS)** - NO EXCEPTIONS
- **Multi-tenancy isolation** - Add `org_id UUID REFERENCES organizations(id)` to all tenant-scoped tables
- **Audit trails** - Include: `created_at`, `updated_at`, `created_by`, `updated_by`, `deleted_at`
- **Soft deletes** - Use `deleted_at TIMESTAMPTZ` (never hard delete candidate/client data)
- **Proper indexing** - Index foreign keys and commonly queried fields
- **Type-safe queries** - Use Drizzle ORM, no raw SQL unless necessary

**Standard Schema Pattern:**
```typescript
export const candidates = pgTable('candidates', {
  id: uuid('id').primaryKey().defaultRandom(),
  orgId: uuid('org_id').notNull().references(() => organizations.id),
  
  // Business fields
  firstName: text('first_name').notNull(),
  email: text('email').notNull(),
  status: candidateStatus('status').notNull().default('active'),
  
  // Audit trail
  createdAt: timestamp('created_at').notNull().defaultNow(),
  createdBy: uuid('created_by').references(() => users.id),
  updatedAt: timestamp('updated_at').notNull().defaultNow(),
  updatedBy: uuid('updated_by').references(() => users.id),
  deletedAt: timestamp('deleted_at'),
});

// ALWAYS enable RLS
sql`ALTER TABLE candidates ENABLE ROW LEVEL SECURITY`;

// ALWAYS create org isolation policy
sql`
CREATE POLICY "org_isolation" ON candidates
  FOR ALL
  USING (org_id = (auth.jwt() ->> 'org_id')::uuid);
`;
```

---

### When Working On UI/Frontend ‚Üí Think Like Frontend Developer

**Reference:** `/.claude/agents/implementation/frontend-developer.md`

**Core Principles:**
- **Server Components by default** - Only use `"use client"` when needed (interactivity, hooks)
- **shadcn/ui components** - Use established patterns for consistency
- **Zod validation** - ALL form inputs must be validated
- **Accessibility first** - WCAG AA compliance, keyboard navigation, screen readers
- **Responsive design** - Mobile-first approach

**Component Pattern:**
```typescript
// Server Component (default)
export function CandidateList({ orgId }: { orgId: string }) {
  const candidates = await db.query.candidates.findMany({
    where: eq(candidates.orgId, orgId),
  });
  return <div>...</div>;
}

// Client Component (only when needed)
"use client"

import { useForm } from "react-hook-form"
import { zodResolver } from "@hookform/resolvers/zod"

const schema = z.object({
  email: z.string().email(),
  firstName: z.string().min(1),
})

export function CandidateForm() {
  const form = useForm({
    resolver: zodResolver(schema)
  })
  
  async function onSubmit(data: z.infer<typeof schema>) {
    const result = await createCandidate(data)
    if (result.success) {
      toast.success("Candidate created!")
    }
  }
  
  return <form onSubmit={form.handleSubmit(onSubmit)}>...</form>
}
```

---

### When Working On Requirements/Planning ‚Üí Think Like PM Agent

**Reference:** `/.claude/agents/planning/pm-agent.md`

**Core Principles:**
- **Always consider cross-pollination** - How does this feature create opportunities across pillars?
- **Pod productivity focus** - How does this help pods achieve 2 placements/sprint?
- **Multi-pillar impact** - Which of the 5 pillars are affected?
- **Business metrics** - Define measurable success criteria

**User Story Template:**
```markdown
## Story: [Short Name]

**As a** [user role]
**I want** [capability]
**So that** [business benefit]

**Pillars Affected**: [Training/Recruiting/Bench Sales/Talent Acquisition/Cross-Border]
**Cross-Pollination Opportunities**: [How does this create leads across pillars?]

**Acceptance Criteria** (Functional):
- [ ] Given [context], when [action], then [expected outcome]
- [ ] Accessible (WCAG AA)
- [ ] Responsive (mobile/tablet/desktop)

**Success Metrics**:
1. [Quantifiable metric 1]
2. [Quantifiable metric 2]
```

---

### When Writing Tests ‚Üí Think Like QA Engineer

**Reference:** `/.claude/agents/operations/qa-engineer.md`

**Core Principles:**
- **Test multi-tenancy isolation** - Org A cannot see Org B data (CRITICAL)
- **Test cross-pillar workflows** - Training graduate ‚Üí Candidate pipeline
- **Test pod metrics** - Placement tracking works correctly
- **Test accessibility** - WCAG AA compliance
- **80%+ coverage** for critical paths

**Test Categories:**
```typescript
// 1. Multi-Tenancy Isolation (CRITICAL)
describe('Multi-Tenancy Isolation', () => {
  test('org A cannot access org B candidates', async () => {
    const orgA = await createOrg('Org A')
    const orgB = await createOrg('Org B')
    
    const candidateB = await createCandidate({ orgId: orgB.id })
    
    const results = await getCandidates(orgA.id)
    expect(results).not.toContainEqual(expect.objectContaining({ id: candidateB.id }))
  })
})

// 2. Cross-Pillar Workflows
describe('Training to Recruiting Pipeline', () => {
  test('graduated student auto-creates candidate profile', async () => {
    const student = await createStudent({ status: 'enrolled' })
    
    await graduateStudent(student.id)
    
    const candidate = await findCandidateByUserId(student.userId)
    expect(candidate).toBeDefined()
    expect(candidate.status).toBe('bench_available')
  })
})

```

---

### When Making Strategic Decisions ‚Üí Think Like CEO Advisor

**Reference:** `/.claude/agents/strategic/ceo-advisor.md`

**Analysis Framework:**
1. **Pillar Impact**: Which of the 5 pillars benefit? How?
2. **Cross-Pollination Score**: How many lead opportunities does this create? (Target: 5+)
3. **5-Year Vision Alignment**: Does this support Internal (2026) ‚Üí B2B SaaS (2027) ‚Üí IPO (2030)?
4. **Resource Allocation**: Is this the best use of resources? What's the opportunity cost?
5. **Market Positioning**: Does this differentiate InTime from competitors?

---


## üíª Code Conventions

### TypeScript Strict Mode (NO EXCEPTIONS)

```typescript
// ‚ùå WRONG
function processData(data: any) { ... }

// ‚úÖ RIGHT
function processData(data: unknown): ProcessedData {
  const validated = dataSchema.parse(data) // Zod validation
  // ... process validated data
  return result
}
```

**Rules:**
- NO `any` types (use `unknown` and validate)
- Explicit return types on all functions
- Strict null checks enabled
- No implicit any on parameters

### React/Next.js Patterns

```typescript
// ‚úÖ Server Component (default)
export default async function CandidatesPage() {
  const candidates = await getCandidates()
  return <CandidateList candidates={candidates} />
}

// ‚úÖ Client Component (only when needed)
"use client"

export function InteractiveComponent() {
  const [state, setState] = useState()
  // ...
}
```

**Rules:**
- Server Components by default
- Use `"use client"` directive only when needed (interactive components, hooks)
- Prefer composition over prop drilling
- Use shadcn/ui components for consistency

### Database Operations

```typescript
// ‚úÖ Always include org_id for multi-tenancy
export async function getCandidates(orgId: string) {
  return await db.query.candidates.findMany({
    where: and(
      eq(candidates.orgId, orgId),
      isNull(candidates.deletedAt) // Respect soft deletes
    ),
    with: {
      submissions: true
    }
  })
}

// ‚úÖ Soft delete (never hard delete)
export async function deleteCandidate(id: string, userId: string) {
  return await db.update(candidates)
    .set({
      deletedAt: new Date(),
      updatedBy: userId
    })
    .where(eq(candidates.id, id))
}
```

**Rules:**
- ALL tables must have Row Level Security (RLS) enabled
- Use Drizzle ORM with type-safe queries
- Soft deletes for critical data (`deleted_at` timestamp)
- Always include audit trails (`created_by`, `updated_by`, `created_at`, `updated_at`)

### Validation & Error Handling

```typescript
// ‚úÖ Zod validation on ALL inputs
import { z } from "zod"

const candidateSchema = z.object({
  firstName: z.string().min(1, "First name is required"),
  email: z.string().email("Invalid email"),
  phone: z.string().optional(),
})

type CandidateInput = z.infer<typeof candidateSchema>

// ‚úÖ Discriminated unions for type-safe errors
type APIResponse<T> =
  | { success: true; data: T }
  | { success: false; error: { code: string; message: string } }

export async function createCandidate(input: unknown): Promise<APIResponse<Candidate>> {
  try {
    const validated = candidateSchema.parse(input)
    const candidate = await db.insert(candidates).values(validated)
    return { success: true, data: candidate }
  } catch (error) {
    if (error instanceof z.ZodError) {
      return {
        success: false,
        error: { code: 'VALIDATION_ERROR', message: error.errors[0].message }
      }
    }
    return {
      success: false,
      error: { code: 'INTERNAL_ERROR', message: 'Failed to create candidate' }
    }
  }
}
```

**Rules:**
- Zod validation on ALL inputs (forms, API calls, external data)
- Discriminated unions for type-safe error handling
- Proper error messages for user feedback
- Log errors to Sentry in production

### File Structure & Naming

```
src/
‚îú‚îÄ‚îÄ app/                          # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/                  # Auth-protected routes
‚îÇ   ‚îú‚îÄ‚îÄ (public)/                # Public routes
‚îÇ   ‚îî‚îÄ‚îÄ api/                     # API routes (minimal, prefer server actions)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/                      # shadcn/ui components
‚îÇ   ‚îú‚îÄ‚îÄ features/                # Feature-specific components
‚îÇ   ‚îî‚îÄ‚îÄ layouts/                 # Layout components
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ db/                      # Database client & schema
‚îÇ   ‚îú‚îÄ‚îÄ utils/                   # Utility functions
‚îÇ   ‚îî‚îÄ‚îÄ validations/             # Zod schemas
‚îî‚îÄ‚îÄ types/                       # TypeScript type definitions
```

**Naming Conventions:**
- Components: `PascalCase.tsx` (e.g., `CandidateCard.tsx`)
- Utils: `kebab-case.ts` (e.g., `format-date.ts`)
- Server Actions: `actions.ts` in feature directories
- Types: `types.ts` or inline with usage

---

## üß™ Testing Requirements

### Test Coverage Standards

- **80%+ coverage** for critical paths
- **E2E tests** for user flows (auth, submission, approval)
- **Unit tests** for utilities and business logic
- **Integration tests** for database operations

### Critical Test Scenarios

**1. Multi-Tenancy Isolation (MOST IMPORTANT)**
```typescript
test('org A cannot access org B data', async () => {
  const orgA = await createOrg()
  const orgB = await createOrg()
  const candidateB = await createCandidate({ orgId: orgB.id })
  
  const results = await getCandidates(orgA.id)
  expect(results).not.toContainEqual(candidateB)
})
```

**2. Cross-Pillar Workflows**
```typescript
test('training graduate creates candidate profile', async () => {
  const student = await createStudent()
  await graduateStudent(student.id)
  
  const candidate = await findCandidateByUserId(student.userId)
  expect(candidate.status).toBe('bench_available')
})
```

**3. Soft Delete Behavior**
```typescript
test('soft deleted records are hidden from queries', async () => {
  const candidate = await createCandidate()
  await deleteCandidate(candidate.id)
  
  const found = await findCandidate(candidate.id)
  expect(found).toBeNull()
})
```

---

## üîÑ Workflow Patterns

### Feature Development Flow

**Reference:** `/.claude/commands/workflows/feature.md`

1. **Requirements** (PM thinking)
   - Identify pillars affected
   - Define cross-pollination opportunities
   - Write user stories with acceptance criteria

2. **Architecture** (Database Architect thinking)
   - Design schema with RLS, audit trails, multi-tenancy
   - Define API contracts
   - Plan component architecture

3. **Implementation** (Frontend/API Developer thinking)
   - Build Server Components
   - Implement Zod validation
   - Write tests alongside code

4. **Quality** (QA Engineer thinking)
   - Test multi-tenancy isolation
   - Test cross-pillar workflows
   - Check accessibility

5. **Deploy** (Deployment Specialist thinking)
   - Run migrations (with RLS)
   - Deploy with feature flags
   - Monitor and verify

### Candidate Pipeline Workflow

**Reference:** `/.claude/commands/workflows/candidate-pipeline.md`

Stages: Sourcing ‚Üí Screening ‚Üí Interview ‚Üí Placement ‚Üí Bench

Features to implement:
- Multi-tenancy isolation (org cannot see other org's candidates)
- Cross-pollination detection (bench ‚Üí training, client ‚Üí recruiting)
- Pod productivity tracking (2 placements per sprint)
- SLA validation (48-hour recruiting, 30-60 day bench sales)

### Cross-Pollination Workflow

**Reference:** `/.claude/commands/workflows/cross-pollination.md`

Flow: Capture Interaction ‚Üí AI Analyzes ‚Üí Detect Opportunities ‚Üí Create Tasks ‚Üí Track Conversion

Target: 5+ opportunities per conversation across pillars

---

## ‚úÖ Quality Standards

### Pre-Commit Checklist

Before committing any code, verify:

**Code Quality:**
- [ ] TypeScript compiles with no errors
- [ ] ESLint passes (no errors, warnings OK with justification)
- [ ] All tests passing
- [ ] Build succeeds (`pnpm build`)
- [ ] No console.logs in production code

**Database Quality:**
- [ ] New tables have RLS enabled
- [ ] RLS policies defined
- [ ] `org_id` included (multi-tenancy)
- [ ] Audit fields present (`created_at`, `updated_at`, `deleted_at`, `created_by`, `updated_by`)
- [ ] Soft delete implemented (no hard deletes)
- [ ] Foreign keys indexed

**Business Logic:**
- [ ] Multi-tenancy respected (queries filter by org_id)
- [ ] Cross-pollination opportunities identified
- [ ] Pod metrics tracked (if applicable)

---

## üîß MCP Server Integration

**Configuration:** `/.mcp.json` (shared with Claude Code CLI)

**Available MCP Servers:**
1. **GitHub** - Repository operations, PR management
2. **Filesystem** - File operations with permissions
3. **PostgreSQL** - Direct database access (Supabase)
4. **Puppeteer** - Browser automation for testing
5. **Slack** - Team notifications
6. **Sequential Thinking** - Enhanced reasoning

**Usage in Cursor:**
These MCP servers are available in both Claude Code CLI and Cursor. Use them for:
- Database queries: PostgreSQL MCP
- GitHub operations: GitHub MCP
- Browser testing: Puppeteer MCP

---

## üéì Business Context for AI

### Non-Negotiable Principles

1. **Quality over speed** - "Best, only the best, nothing but the best"
2. **Data ownership** - Complete control of all business data (RLS is CRITICAL)
3. **Cross-pollination** - Every interaction has 5+ business opportunities
4. **Pod accountability** - 2 placements per 2-week sprint
5. **Scalability** - Design for 10x growth from day one

### Key Metrics

- **Training Academy:** 8-week completion rate, job placement rate
- **Recruiting Services:** Time-to-fill (target: 48 hours), candidate quality score
- **Bench Sales:** 30-60 day placement rate
- **Talent Acquisition:** Pipeline growth, outreach effectiveness
- **Pods:** 2 placements per sprint per pod
- **Revenue:** Monthly recurring revenue, customer acquisition cost

### Cross-Pollination Examples

Every feature should ask: "How does this create opportunities across pillars?"

- Client placement call ‚Üí Identify training needs
- Training graduate ‚Üí Auto-create candidate profile
- Bench consultant ‚Üí Uncover cross-border opportunities
- International hire ‚Üí Need training AND placement

---

## üö® Common Pitfalls to Avoid

### From Legacy Project Audit

**DON'T:**
- ‚ùå Build modules in isolation (design unified architecture first)
- ‚ùå Multiple user management systems (ONE user table with role-based columns)
- ‚ùå Mix API patterns (use Server Actions consistently)
- ‚ùå "We'll add tests later" (tests alongside features)
- ‚ùå Accumulate dead code (delete aggressively, git remembers)

**DO:**
- ‚úÖ Unified schema design BEFORE building modules
- ‚úÖ Event bus for cross-module communication
- ‚úÖ Server Actions for all mutations
- ‚úÖ Tests alongside features (80%+ coverage)
- ‚úÖ Delete dead code immediately

---

## üéØ Quick Reference Commands

### When to Use Claude Code CLI vs Cursor

**Use Claude Code CLI for:**
- Strategic planning (CEO/CFO review)
- Complete feature workflows (PM ‚Üí Architect ‚Üí Dev ‚Üí QA ‚Üí Deploy)
- Multi-agent orchestration
- Complex decision-making

**Use Cursor for:**
- Active development & implementation
- Quick iterations & refactoring
- Visual feedback on changes
- Debugging & exploration
- Inline code suggestions

### Simulating Multi-Agent in Cursor

Tell Cursor which agent perspective to take:

```
"Act as Database Architect (see .claude/agents/implementation/database-architect.md).
Design RLS policies for the new submissions table."
```

```
"Act as Frontend Developer (see .claude/agents/implementation/frontend-developer.md).
Build a candidate form following the minimal design system."
```

```
"Act as QA Engineer (see .claude/agents/operations/qa-engineer.md).
Create test suite for multi-tenancy isolation on candidates table."
```

---

## üìã Environment Variables

Required in `.env.local`:
- `NEXT_PUBLIC_SUPABASE_URL` - Supabase project URL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Supabase anon key
- `SUPABASE_SERVICE_ROLE_KEY` - Supabase admin access
- `SUPABASE_DB_URL` - PostgreSQL connection (for MCP)
- `GITHUB_TOKEN` - GitHub MCP access

Optional:
- `SLACK_BOT_TOKEN` - Slack notifications
- `SLACK_TEAM_ID` - Slack workspace
- `SENTRY_DSN` - Error tracking

---

## üéì Learning Resources

### For New Team Members

1. Read `CLAUDE.md` - Project fundamentals
2. Review `docs/audit/LESSONS-LEARNED.md` - What NOT to do
3. Study agent files in `.claude/agents/` - Specialist expertise
4. Review workflow files in `.claude/commands/workflows/` - Process patterns

### For AI Agents (This Environment)

1. Reference this file for all decisions
2. Simulate appropriate agent expertise for the task
3. Ask for clarification if business context is unclear

---

## üìù Final Notes

**Remember:**
- InTime is a **living organism**, not generic software
- Multi-tenancy (RLS) is non-negotiable
- Cross-pollination is our competitive moat
- Quality over speed - "Best, only the best, nothing but the best"

**This file consolidates knowledge from 8 specialist AI agents in Claude Code CLI.**

When you need deep expertise:
- Strategic decisions ‚Üí Reference CEO Advisor (`.claude/agents/strategic/ceo-advisor.md`)
- Database design ‚Üí Reference Database Architect (`.claude/agents/implementation/database-architect.md`)
- UI components ‚Üí Reference Frontend Developer (`.claude/agents/implementation/frontend-developer.md`)
- Testing ‚Üí Reference QA Engineer (`.claude/agents/operations/qa-engineer.md`)

**Last Updated:** 2025-11-19
**Version:** 3.0 (Comprehensive Multi-Agent Sync)
**Sync Status:** Mirrors `.claude/` configuration from Claude Code CLI
