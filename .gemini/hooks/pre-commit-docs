#!/bin/bash
# Pre-commit hook: Auto-update documentation

echo "ğŸ“š Updating documentation before commit..."

# Update file structure documentation
echo "  â†’ Updating FILE-STRUCTURE.md..."
pnpm exec tsx .gemini/orchestration/scripts/update-docs.ts

# Update folder-specific documentation (MAXIMUM GRANULARITY - all 27 folders)
echo "  â†’ Updating ALL folder GEMINI.md files (27 folders)..."
pnpm exec tsx .gemini/orchestration/scripts/generate-all-folder-docs.ts

# Check if documentation was updated and add to commit
DOCS_UPDATED=false

if ! git diff --quiet .gemini/orchestration/FILE-STRUCTURE.md; then
  echo "ğŸ“ FILE-STRUCTURE.md updated - adding to commit"
  git add .gemini/orchestration/FILE-STRUCTURE.md
  DOCS_UPDATED=true
fi

# Add any updated GEMINI.md files
CLAUDE_FILES=$(git diff --name-only | grep "CLAUDE\.md$" || true)
if [ -n "$CLAUDE_FILES" ]; then
  echo "ğŸ“ Folder GEMINI.md files updated - adding to commit"
  git add $CLAUDE_FILES
  DOCS_UPDATED=true
fi

# Add documentation index if updated
if ! git diff --quiet .gemini/DOCUMENTATION-INDEX.md 2>/dev/null; then
  echo "ğŸ“ Documentation index updated - adding to commit"
  git add .gemini/DOCUMENTATION-INDEX.md
  DOCS_UPDATED=true
fi

if [ "$DOCS_UPDATED" = false ]; then
  echo "âœ… All documentation is up to date"
fi

exit 0
